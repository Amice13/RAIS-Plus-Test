import{_ as N,a as P,b as E,c as L,d as B,e as j,f as R}from"./DistributionFormDocument-DxFOV5DB.js";import{_ as W}from"./DistributionFormCash-CKxJmwFE.js";import{c as $}from"./config-CpTMMwfY.js";import{_ as w,a as A,p as x,g as C,c as I,b as q,f as z,e as Y}from"./index-Dr3A69Vy.js";import{l as G,s as J,m as K,A as V,z as v,F as Q,o as X,f as S,p as Z,q as ee}from"./vuetify-8yKwgmF2.js";import{v as te}from"./uuid-C6aID195.js";import{a2 as y,a3 as h,a4 as l,u as i,a7 as c,Y as n,W as o,a9 as b,a6 as r,ad as ae,ae as se,aa as D,F as le}from"./@vue-CVhpfiSJ.js";import{_ as oe}from"./CustomTable-B09n9Rt0.js";import{b as O}from"./route-block-B_A1xBdJ.js";import"./signature_pad-De9feHul.js";import"./CustomDate-CfhxorUI.js";import"./CustomGender-NBBuUwfP.js";import"./index-1qao1M8l.js";import"./arabic-transliterate-CaB0grAR.js";import"./@turf-BykKS3Vs.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./dot-object-sCKibp8s.js";import"./CustomTextFieldTranslit-_r0XMlwr.js";import"./CustomPhone-XOzdDG_n.js";import"./data-BbwszT0d.js";import"./CustomTag-Dg3cr3e-.js";import"./debouncer-Whu4ZLob.js";import"./CustomPopulationType-CM50j2Gz.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./jszip-B9I6jZYU.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";import"./searchProcessor-BfIe0Ps2.js";const ie={name:"DistributionPocDialow",inject:["$confirm","$error","$loading","$showResult"],props:{modelValue:{type:Object,default:()=>({})},items:{type:Array,default:()=>[]}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},canEdit(){var e,s,m,f,p,a;if((m=(s=(e=this.appStore)==null?void 0:e.user)==null?void 0:s.role)!=null&&m.includes("Admin")||(a=(p=(f=this.appStore)==null?void 0:f.user)==null?void 0:p.role)!=null&&a.includes("Partner Editor")||!this.model.id||new Date-new Date(this.model.date)<$.timeToEditSinceDistribution||this.model.createdAt&&new Date-new Date(this.model.createdAt)<$.timeToEditSinceCreation)return!0},dialog(){const e=document.querySelector("html"),s=Object.keys(this.model).length>0;return e.classList[s?"add":"remove"]("overflow-hidden"),s}},methods:{countFamilyStats(){this.model.familyStats=q([...this.model.familyMembers,this.model.headOfHousehold])},formatAddress:A,createFamilyMembersIds(){var f;const e=this.model.taxId||this.model.passport||te(),s=I(this.model,e);let m=[];return(f=this.model)!=null&&f.familyMembers&&(m=this.model.familyMembers.map(p=>I(p,e))),[s,...m]},async removeData(){if(!await this.$confirm({title:"Delete assistance",description:"Would you like to delete data about the assistance?"}))return!1;this.$loading(!0);const{assistances:s}=this.$storage;let m;try{m=await delete s[this.model.id]}catch(f){await this.$error(f)}if(this.$loading(!1),!m)return!1;await this.$showResult(),this.model={},this.$emit("loadItems")},async saveData(){var m,f,p,a,_;if(!await this.$confirm({title:"Save assistance",description:"Would you like to save data about the assistance?"}))return!1;(m=this.model)!=null&&m.headOfHousehold&&(this.model.headOfHousehold=x(this.model.headOfHousehold)),(f=this.model)!=null&&f.headOfHousehold&&this.model.household&&((a=(p=this.model)==null?void 0:p.address)!=null&&a.pCode4&&(this.model.household.pCode4=this.model.address.pCode4,this.model.household.admin4=this.model.address.admin4),this.model.household.fullAddress=this.formatAddress(this.model.household,"en"),this.model.household.translation.uk.fullAddress=this.formatAddress(this.model.household,"uk")),this.countFamilyStats(),this.model.familyMembersIds=this.createFamilyMembersIds(),this.model.taxIds=[C((_=this.model)==null?void 0:_.headOfHousehold),...(this.model.familyMembers||[]).map(C)].filter(Boolean);let s;try{if(!this.model.id){const{assistances:t}=this.$storage;s=await t.push(this.model)}this.model.id&&(s=await database.update(this.model.id,this.model))}catch(t){return this.$loading(!1),await this.$error(t)}this.$loading(!1),await this.$showResult(),this.model={},this.$emit("loadItems")}}},de={key:0,class:"main-part"},re={class:"text-h5 mb-2 offset-md1 black--text"},ne={class:"text-h5 mb-2 offset-md1 black--text"};function me(e,s,m,f,p,a){const _=N,t=P,u=E,g=L,k=B,T=j,F=W,U=R;return h(),y(ee,{"model-value":a.dialog,class:ae(["assistance-dialog",{"poc-dialog":e.$vuetify.display.xs}]),"content-class":"poc-dialog",scrollable:"",persistent:"",overlay:!1,"max-width":"500px",transition:"slide-x-reverse-transition"},{default:l(()=>[i(G,{tile:"",class:"fill-height"},{default:l(()=>[i(J,{"primary-title":""},{default:l(()=>[n(o(e.$t("Add")),1)]),_:1}),a.model.headOfHousehold?(h(),y(K,{key:0,class:"pt-4",style:{"font-size":"0.875rem"}},{default:l(()=>[i(_,{modelValue:a.model.headOfHousehold,"onUpdate:modelValue":s[0]||(s[0]=d=>a.model.headOfHousehold=d),onSetId:s[1]||(s[1]=d=>a.model.householdId=d),onSetFamilyMembers:s[2]||(s[2]=d=>a.model.familyMembers=d),onSetHousehold:s[3]||(s[3]=d=>a.model.household=d),householdId:a.model.householdId},null,8,["modelValue","householdId"]),a.model.householdId?(h(),b("div",de,[i(t,{modelValue:a.model,"onUpdate:modelValue":s[4]||(s[4]=d=>a.model=d)},null,8,["modelValue"]),i(u,{modelValue:a.model.address,"onUpdate:modelValue":s[5]||(s[5]=d=>a.model.address=d)},null,8,["modelValue"]),a.model.headOfHousehold?(h(),y(g,{key:0,modelValue:a.model.headOfHousehold,"onUpdate:modelValue":s[6]||(s[6]=d=>a.model.headOfHousehold=d)},null,8,["modelValue"])):c("",!0),a.model.household?(h(),y(k,{key:1,modelValue:a.model.household,"onUpdate:modelValue":s[7]||(s[7]=d=>a.model.household=d),householdId:a.model.householdId},null,8,["modelValue","householdId"])):c("",!0),i(T,{modelValue:a.model.familyMembers,"onUpdate:modelValue":s[8]||(s[8]=d=>a.model.familyMembers=d)},null,8,["modelValue"]),i(F,{modelValue:a.model,"onUpdate:modelValue":s[9]||(s[9]=d=>a.model=d)},null,8,["modelValue"]),i(V,{class:"mb-4 mt-4"},{default:l(()=>[i(v,{cols:"12"},{default:l(()=>[r("div",re,o(e.$t("Signature")),1),r("div",null,o(e.$t("Please sign the completed form")),1)]),_:1}),i(v,{cols:"12"},{default:l(()=>[i(U,{modelValue:a.model.signature,"onUpdate:modelValue":s[10]||(s[10]=d=>a.model.signature=d),mode:"edit"},null,8,["modelValue"])]),_:1})]),_:1}),i(V,{class:"mb-4 mt-4"},{default:l(()=>[i(v,{cols:"12"},{default:l(()=>[r("div",ne,o(e.$t("Comment")),1),r("div",null,o(e.$t("You can add any additional comment")),1)]),_:1}),i(v,{cols:"12"},{default:l(()=>[i(Q,{modelValue:a.model.comment,"onUpdate:modelValue":s[11]||(s[11]=d=>a.model.comment=d),variant:"underlined"},null,8,["modelValue"])]),_:1})]),_:1})])):c("",!0)]),_:1})):c("",!0),i(X,null,{default:l(()=>[a.canEdit&&a.model.id?(h(),y(S,{key:0,onClick:a.removeData,color:"error",variant:"tonal",class:"ml-4"},{default:l(()=>[n(o(e.$t("Delete")),1)]),_:1},8,["onClick"])):c("",!0),i(Z),i(S,{onClick:s[12]||(s[12]=d=>this.model={}),color:"orange darken-2",variant:"text"},{default:l(()=>[n(o(e.$t("Cancel")),1)]),_:1}),a.canEdit?(h(),y(S,{key:1,onClick:a.saveData,color:"primary",variant:"tonal",class:"mr-4"},{default:l(()=>[n(o(e.$t("Save")),1)]),_:1},8,["onClick"])):c("",!0)]),_:1})]),_:1})]),_:1},8,["model-value","class"])}const ue=w(ie,[["render",me]]),H={New:"green-darken-2",Duplicated:"red-darken-2"},he=e=>H[e]?H[e]:"grey-darken-2",fe={name:"CashCustomTable",props:{items:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},hasAddress:{type:Boolean},publicId:{type:String}},computed:{itemList(){return this.items?this.items.map((e,s)=>({title:e.key,value:`item.${e.key}`,align:"center"})):[]},headers(){const e=[{title:"",align:"center",value:"synced"},{title:"Tax ID",align:"start",value:"taxId",sortable:!0},{title:"Name",align:"start",value:"name",sortable:!0},{title:"Place of Origin",align:"start",value:"origin",sortable:!0},{title:"Phone",align:"start",value:"phone"},this.hasAddress?{title:"Address",align:"start",value:"household"}:!1,{title:"Male, <18",align:"center",value:"familyStats.boys"},{title:"Female, <18",align:"center",value:"familyStats.girls"},{title:"Male, 18-60",align:"center",value:"familyStats.men"},{title:"Female, 18-60",align:"center",value:"familyStats.women"},{title:"Male, 60+",align:"center",value:"familyStats.seniorMen"},{title:"Female, 60+",align:"center",value:"familyStats.seniorWomen"},{title:"People with disabilities",align:"center",value:"familyStats.disabled"},{title:"Value",align:"center",value:"value"},{title:"Currency",align:"center",value:"currency"},{title:"Start date",align:"start",value:"attendedFrom"},{title:"End date",align:"start",value:"attendedTo"},{title:"Comment",align:"start",value:"comment"}].filter(Boolean);return e.push(...this.itemList),e}},methods:{getChipColor:he,async loadItems(){this.$refs.mainTable.loadItems()},formatAddress:A,formatPrice:Y,formatDate:z}},ce=["onClick"],pe={class:"text-no-wrap"},_e={class:"text-no-wrap"},ye={class:"text-no-wrap"},ge={class:"text-no-wrap"},be={key:0,class:"text-no-wrap"},ve=["href"],Ve={class:"text-no-wrap"},Se={key:0,class:"text-no-wrap"},ke={key:0,class:"text-no-wrap"};function we(e,s,m,f,p,a){const _=oe;return e.appStore.loading?c("",!0):(h(),y(_,{key:0,title:e.$t("Receivers"),headers:a.headers,filters:m.filters,"sort-by":{key:"createdAt",sort:"asc"},"search-keys":["headOfHousehold.fullName","headOfHousehold.translation.uk.fullName","headOfHousehold.taxId","headOfHousehold.passport"],index:"date",class:"cash-custom-table",ref:"mainTable",table:"assistances"},se({"item.synced":l(({item:t})=>[r("div",null,[r("div",{onClick:u=>e.$emit("editData",t)},[i(S,{icon:"mdi-pencil",size:"x-small",color:"grey",variant:"tonal"})],8,ce)])]),"item.taxId":l(({item:t})=>{var u;return[n(o((u=t.headOfHousehold)!=null&&u.taxId?t.headOfHousehold.taxId:t.headOfHousehold.passport),1)]}),"item.value":l(({item:t})=>[r("span",pe,o(a.formatPrice(t.value)),1)]),"item.attendedFrom":l(({item:t})=>[r("span",_e,o(a.formatDate(t.attendedFrom)),1)]),"item.attendedTo":l(({item:t})=>[r("span",ye,o(a.formatDate(t.attendedTo)),1)]),"item.name":l(({item:t})=>[r("span",ge,o(t.headOfHousehold?e.$_translate(t.headOfHousehold).fullName:""),1)]),"item.origin":l(({item:t})=>{var u,g;return[(u=t.headOfHousehold)!=null&&u.origin?(h(),b("span",be,o(e.$t(((g=t.headOfHousehold)==null?void 0:g.origin)||""))+" "+o(["UA80","UA01"].includes(t.origin)?"":e.$t("oblast")),1)):c("",!0)]}),"item.phone":l(({item:t})=>[(h(!0),b(le,null,D(t.headOfHousehold.phone,u=>(h(),b("div",null,[r("a",{href:`tel:${u}`,class:"text-no-wrap"},o(u),9,ve)]))),256))]),"item.household":l(({item:t})=>[r("span",Ve,o(a.formatAddress(t.household)),1)]),"item.familyStats.girls":l(({item:t})=>[n(o(t.familyStats.girls),1)]),"item.familyStats.boys":l(({item:t})=>[n(o(t.familyStats.boys),1)]),"item.familyStats.men":l(({item:t})=>[n(o(t.familyStats.men),1)]),"item.familyStats.women":l(({item:t})=>[n(o(t.familyStats.women),1)]),"item.familyStats.seniorMen":l(({item:t})=>[n(o(t.familyStats.seniorMen),1)]),"item.familyStats.seniorWomen":l(({item:t})=>[n(o(t.familyStats.seniorWomen),1)]),"item.familyStats.disabled":l(({item:t})=>[n(o(t.familyStats.disabled),1)]),"item.attendedFrom":l(({item:t})=>[t.attendedFrom?(h(),b("span",Se,o(new Date(t.attendedFrom).toLocaleDateString("uk")),1)):c("",!0)]),"item.attendedTo":l(({item:t})=>[t.attendedTo?(h(),b("span",ke,o(new Date(t.attendedTo).toLocaleDateString("uk")),1)):c("",!0)]),_:2},[D(m.items,t=>({name:`item.item.${t.key}`,fn:l(({item:u})=>{var g;return[n(o(Array.isArray(u.items)?(g=u.items.find(k=>k.key===t.key))==null?void 0:g.value:0),1)]})}))]),1032,["title","headers","filters"]))}const $e=w(fe,[["render",we]]),M={name:"request",inject:["$confirm","$error","$loading","$showResult"],data:()=>({filters:void 0,assistance:void 0}),created(){this.init()},computed:{title(){this.filters||(this.appStore.breadcrumb="New cash intervention");const{date:e}=this.filters;return this.appStore.breadcrumb="Cash interventions",this.$t("Cash intervention",{date:new Date(e).toLocaleDateString("uk")})}},methods:{async init(){const e=this.$route.query;e["address.pCode4"]=e.pCode4,delete e.pCode4,this.filters=e,this.appStore.loading=!1},loadItems(){this.$refs.cashTable.loadItems()},editData(e){this.assistance=e}}},Ce={class:"report pa-2"},Ie={class:"text-h4 font-weight-bold"},De={class:"bg-grey-lighten-4 pa-4 d-flex w-100 justify-space-between"},Oe={class:"mb-1"},He={class:"mb-1"},Ae={class:"mb-1"};function Me(e,s,m,f,p,a){const _=$e,t=ue;return h(),b("div",Ce,[i(V,{class:"mb-0 mt-0"},{default:l(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:l(()=>[r("div",Ie,o(a.title||e.$t("Cash interventions")),1)]),_:1})]),_:1}),i(V,{class:"mb-0 mt-0"},{default:l(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:l(()=>[r("div",De,[r("div",null,[r("p",Oe,[r("strong",null,o(e.$t("Assistance type"))+":",1),n(" "+o(e.$t(e.filters.bundleName)),1)]),r("p",He,[r("strong",null,o(e.$t("Distribution modality"))+":",1),n(" "+o(e.$t(e.filters.distributionModality)),1)]),r("p",Ae,[r("strong",null,o(e.$t("Population type"))+":",1),n(" "+o(e.$t(e.filters.populationType)),1)]),r("p",null,[r("strong",null,o(e.$t("Locality"))+":",1),n(" "+o(e.$t(e.filters["address.pCode4"])),1)])]),r("div",null,[i(S,{to:"/cash",color:"primary"},{default:l(()=>[n(o(e.$t("Close")),1)]),_:1})])])]),_:1})]),_:1}),i(V,{class:"mb-0 mt-0"},{default:l(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:l(()=>[e.filters?(h(),y(_,{key:0,ref:"cashTable",onEditData:a.editData,filters:e.filters},null,8,["onEditData","filters"])):c("",!0)]),_:1})]),_:1}),i(t,{modelValue:e.assistance,"onUpdate:modelValue":s[0]||(s[0]=u=>e.assistance=u),onLoadItems:a.loadItems},null,8,["modelValue","onLoadItems"])])}typeof O=="function"&&O(M);const Ot=w(M,[["render",Me]]);export{Ot as default};

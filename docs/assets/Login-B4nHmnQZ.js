import{a9 as p,a3 as u,Q as $,S as y,u as o,a4 as n,a6 as i,F as V,a2 as _,aa as I,W as d,Y as g,ac as w,a8 as N,V as E}from"./@vue-CVhpfiSJ.js";import{_ as c,v as L}from"./index-Dr3A69Vy.js";import{m as b,$ as P,z as k,e as x,f,A as C,I as T,B as z,l as M,t as B}from"./vuetify-8yKwgmF2.js";import{a as j}from"./pinia-DJQ_g8GY.js";import{j as O}from"./jwt-decode-VWaDGczM.js";import{b as v}from"./route-block-B_A1xBdJ.js";/* empty css             */import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@turf-BykKS3Vs.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./uuid-C6aID195.js";import"./dot-object-sCKibp8s.js";import"./jszip-B9I6jZYU.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";const D={};function H(e,t){return u(),p(V,null,[$(o(b,{class:"bg-brown-lighten-5 pa-6 pa-sm-8 pa-md-12 text-justify"},{default:n(()=>t[0]||(t[0]=[i("p",{class:"mb-2"},"Access to UNHCR information and communications technology (ICT) resources, tools, and data is restricted to authorized users only.",-1),i("p",{class:"mb-2"},"Authorized users must ensure that their use of UNHCR ICT resources, tools, and data complies with the conditions set out in applicable UNHCR rules and is consistent with their obligations under the UN Staff Regulations and Rules or the respective conditions of service or the obligations under the relevant data sharing agreement, partnership agreement, or other agreement with UNHCR.",-1),i("p",{class:"mb-2"},"All use of UNHCR ICT resources, tools, and data, including from a private device, is subject to monitoring and investigation. Unauthorized or non-acceptable use may result, as applicable, in a disciplinary process and the imposition of disciplinary measures and/or in the withdrawal of access rights.",-1),i("p",null,"By continuing, you acknowledge that you have read and understand and that you agree (including, where applicable, on behalf of your organization), to the above statements.",-1)])),_:1},512),[[y,this.$i18n.locale==="en"]]),$(o(b,{class:"bg-brown-lighten-5 pa-6 pa-sm-8 pa-md-12 text-justify"},{default:n(()=>t[1]||(t[1]=[i("p",{class:"mb-2"},"Доступ до ресурсів, інструментів та даних УВКБ ООН у сфері інформаційно-комунікаційних технологій надається лише авторизованим користувачам.",-1),i("p",{class:"mb-2"},"Уповноважені користувачі повинні переконатися, що використання ними ресурсів, інструментів і даних УВКБ ООН у сфері інформаційно-комунікаційних технологій відповідає умовам, викладеним у відповідних правилах УВКБ ООН, і узгоджується з їхніми зобов’язаннями згідно з Положеннями та правилами про персонал ООН або відповідними умовами обслуговування чи зобов’язаннями згідно з відповідною угодою про обмін даними, угоду про партнерство чи іншу угоду з УВКБ ООН.",-1),i("p",{class:"mb-2"},"Будь-яке використання інформаційно-комунікаційних технологій, інструментів і даних УВКБ ООН, у тому числі з приватного пристрою, підлягає моніторингу та розслідуванню. Несанкціоноване або неприйнятне використання може призвести, у відповідних випадках, до дисциплінарного процесу та застосуванню дисциплінарних заходів та/або позбавлення прав доступу.",-1),i("p",null,"Продовжуючи, ви підтверджуєте, що прочитали та зрозуміли, а також погоджуєтеся (зокрема, де це можливо, від імені вашої організації) з наведеними вище заявами.",-1)])),_:1},512),[[y,this.$i18n.locale==="uk"]])],64)}const q=c(D,[["render",H]]),G={props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},alertType(){return this.model.status==="fail"?"error":this.model.status},messages(){var e,t,l,r;return this.model.data?this.model.status==="success"?(t=(e=this.model)==null?void 0:e.data)==null?void 0:t.messages:((r=(l=this.model)==null?void 0:l.data)==null?void 0:r.errors)||[]:[]},alert(){var e;return((e=this.messages)==null?void 0:e.length)>0}}},F={class:"ma-0"};function K(e,t,l,r,a,s){return u(),_(P,{modelValue:s.alert,"onUpdate:modelValue":t[0]||(t[0]=m=>s.alert=m),"onClick:close":t[1]||(t[1]=m=>s.model={}),type:s.alertType,density:"compact",closable:"",class:"mb-4",dense:""},{default:n(()=>[(u(!0),p(V,null,I(s.messages,m=>(u(),p("p",F,d(e.$t(m.message)),1))),256))]),_:1},8,["modelValue","type"])}const Y=c(G,[["render",K]]);var Q={APP_SHORTNAME:"RAIS+"};const W={computed:{logo(){return`/themes/${this.$vuetify.theme.global.name}/logo-horizontal.svg`},name(){return Q.APP_SHORTNAME}}},J={class:"hidden-sm-and-down flex-grow-1 text-primary text-h5 ml-2 pl-4",style:{"border-left":"1px solid #1976d2"}};function X(e,t,l,r,a,s){return u(),_(C,null,{default:n(()=>[o(k,{class:"mt-4 mb-4 d-flex align-center justify-space-between"},{default:n(()=>[o(x,{alt:"UNHCR Logo",class:"mr-2 flex-grow-1 cursor-pointer",contain:"",src:s.logo,onClick:t[0]||(t[0]=m=>e.$emit("goTo","loginSign")),transition:"scale-transition","min-width":100,"max-width":180,height:40},null,8,["src"]),i("div",J,d(e.$t(s.name)),1),o(f,{color:"primary",variant:"outlined",onClick:t[1]||(t[1]=m=>this.$i18n.locale=this.$i18n.locale==="en"?"uk":"en")},{default:n(()=>[g(d(this.$i18n.locale),1)]),_:1})]),_:1})]),_:1})}const Z=c(W,[["render",X]]),ee={name:"LoginInitialize",props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data(){return{loading:!1}},methods:{async createUser(){this.loading=!0;const e={email:this.modelValue.email};let t=await this.$api.auth.initialize(e);this.$emit("respond",t),this.loading=!1},login(){this.$emit("goTo","loginMsal")}}},te={class:"mt-4 mb-4 text-h4 black--text"},se={class:"mb-4"},ae={class:"mt-10 d-flex justify-end"};function oe(e,t,l,r,a,s){return u(),p("div",null,[i("div",te,d(e.$t("Create admin user")),1),i("p",se,d(e.$t('Here you can create an admin user. Provide your email and press "Create" button to proceed.')),1),o(T,{modelValue:s.model.email,"onUpdate:modelValue":t[0]||(t[0]=m=>s.model.email=m),label:e.$t("User Email"),variant:"underlined","hide-details":""},null,8,["modelValue","label"]),w(e.$slots,"alert"),i("div",ae,[$(o(f,{onClick:s.login,color:"primary",variant:"text",class:"mr-2"},{default:n(()=>[g(d(e.$t("Back to login")),1)]),_:1},8,["onClick"]),[[y,!a.loading]]),o(f,{onClick:s.createUser,loading:a.loading,color:"primary"},{default:n(()=>[g(d(e.$t("Create")),1)]),_:1},8,["onClick","loading"])])])}const ie=c(ee,[["render",oe]]);var ne={MS_APP_CLIENT_ID:"4f92930c-13d8-4c36-95d6-2f2d31727e6e"};const A=[ne.MS_APP_CLIENT_ID+"/.default"],le={scopes:A},re={name:"LoginMsal",mounted(){this.init()},data(){return{loading:!1}},methods:{async init(){try{await this.$msal.initialize()}catch(e){console.log(e)}},async login(){var e;if(!window.navigator.onLine)return this.$router.push("/");try{this.loading=!0,await this.$msal.initialize(),await this.$msal.handleRedirectPromise();const t=await this.$msal.loginPopup(le);this.appStore.setAccount(t.account);const l={scopes:A,account:t.account,forceRefresh:!0,refreshTokenExpirationOffsetSeconds:7200},r=await this.$msal.acquireTokenSilent(l),a=await this.$api.auth.msalVerify({token:r.accessToken});if(this.$emit("respond",a),await new Promise(s=>setTimeout(s,1e3)),(e=a==null?void 0:a.data)!=null&&e.accessToken)return this.$emit("grantAccess",a.data.accessToken);this.loading=!1}catch(t){this.loading=!1,console.log(t)}}}},de={class:"mt-8 mb-4"};function me(e,t,l,r,a,s){return u(),p("div",null,[i("div",de,d(e.$t("Press login button to authorize with Microsoft Entra")),1),w(e.$slots,"alert"),o(f,{onClick:s.login,loading:a.loading,color:"primary"},{default:n(()=>[g(d(e.$t("Login")),1)]),_:1},8,["onClick","loading"])])}const ue=c(re,[["render",me]]),ce={name:"LoginByEmail",props:{modelValue:{type:Object,default:()=>({})}},mounted(){const e=localStorage.getItem("login-email");e&&(this.model={email:e})},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data(){return{loading:!1}},methods:{async login(){var e;if(!window.navigator.onLine)return this.$router.push("/");try{this.loading=!0;const t=await this.$api.auth.bypassMsal({email:this.model.email});if(this.$emit("respond",t),await new Promise(l=>setTimeout(l,1e3)),(e=t==null?void 0:t.data)!=null&&e.accessToken)return localStorage.setItem("login-email",this.model.email),this.appStore.setAccount({idToken:"bypassed"}),this.$emit("grantAccess",t.data.accessToken);this.loading=!1}catch(t){this.loading=!1,console.log(t)}}}},pe={class:"mt-4 mb-4 text-h4 black--text"},he={class:"mb-4"},ge={class:"mt-10 d-flex justify-end"};function fe(e,t,l,r,a,s){return u(),p("div",null,[i("div",pe,d(e.$t("Login by email")),1),i("p",he,d(e.$t('On this page you can bypass MS Entra and log in as a user just by email. This beahaviour is enabled when "BYPASS_MSAL" environment variable is set to "1".')),1),i("p",null,[i("strong",null,d(e.$t("DO NOT ENABLE THIS IN PRODUCTION MODE!")),1)]),o(T,{modelValue:s.model.email,"onUpdate:modelValue":t[0]||(t[0]=m=>s.model.email=m),onKeyup:N(s.login,["enter"]),label:e.$t("User Email"),variant:"underlined","hide-details":""},null,8,["modelValue","onKeyup","label"]),w(e.$slots,"alert"),i("div",ge,[o(f,{onClick:s.login,loading:a.loading,color:"primary"},{default:n(()=>[g(d(e.$t("Login")),1)]),_:1},8,["onClick","loading"])])])}const _e=c(ce,[["render",fe]]),$e={initialize:"loginInitialize",msal:"loginMsal",bypass:"loginByEmail"},S={name:"Login",components:{loginInitialize:ie,loginMsal:ue,loginByEmail:_e},mounted(){var e,t;if("expired"in this.$route.query&&(this.alert={status:"fail",data:{errors:[{message:"Your session is expired!"}]}}),!((t=(e=this.$route)==null?void 0:e.query)!=null&&t.type))return!1;this.currentView=$e[this.$route.query.type]||"msal"},data(){return{currentView:"loginMsal",alert:{},model:{password:void 0,login:void 0,qr:void 0}}},methods:{...j(L,["setUser"]),async grantAccess(e){var r;if(!e)return!1;if(this.$auth.setToken(e),(r=O(e).role)!=null&&r.includes("Signer"))return await this.setUser(),this.$router.push("/terms");let l=await this.$api.user.me();l.email&&(await this.setUser(l),this.$router.push("/"))},goTo(e){this.alert={},this.currentView=e}}};function ye(e,t,l,r,a,s){const m=Z,U=Y,R=q;return u(),_(B,{fluid:"",class:"fill-height"},{default:n(()=>[o(z,{class:"align-center fill-height"},{default:n(()=>[o(C,null,{default:n(()=>[o(k,{cols:"12",md:"6","offset-md":"3",sm:"8","offset-sm":"2"},{default:n(()=>[o(M,{class:"mx-auto"},{default:n(()=>[o(b,{class:"pa-6 pa-sm-8 pa-md-12"},{default:n(()=>[o(m),(u(),_(E(a.currentView),{modelValue:a.model,"onUpdate:modelValue":t[1]||(t[1]=h=>a.model=h),onGrantAccess:s.grantAccess,onGoTo:s.goTo,onRespond:t[2]||(t[2]=h=>a.alert=h)},{alert:n(()=>[o(U,{modelValue:a.alert,"onUpdate:modelValue":t[0]||(t[0]=h=>a.alert=h)},null,8,["modelValue"])]),_:1},40,["modelValue","onGrantAccess","onGoTo"]))]),_:1}),o(R)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}typeof v=="function"&&v(S);const et=c(S,[["render",ye]]);export{et as default};

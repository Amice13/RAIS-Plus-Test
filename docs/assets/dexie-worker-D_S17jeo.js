/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ii=Symbol("Comlink.proxy"),qs=Symbol("Comlink.endpoint"),Fs=Symbol("Comlink.releaseProxy"),wn=Symbol("Comlink.finalizer"),Er=Symbol("Comlink.thrown"),Ti=u=>typeof u=="object"&&u!==null||typeof u=="function",Ns={canHandle:u=>Ti(u)&&u[Ii],serialize(u){const{port1:m,port2:x}=new MessageChannel;return En(u,m),[x,[x]]},deserialize(u){return u.start(),Ks(u)}},Ms={canHandle:u=>Ti(u)&&Er in u,serialize({value:u}){let m;return u instanceof Error?m={isError:!0,value:{message:u.message,name:u.name,stack:u.stack}}:m={isError:!1,value:u},[m,[]]},deserialize(u){throw u.isError?Object.assign(new Error(u.value.message),u.value):u.value}},qi=new Map([["proxy",Ns],["throw",Ms]]);function Bs(u,m){for(const x of u)if(m===x||x==="*"||x instanceof RegExp&&x.test(m))return!0;return!1}function En(u,m=globalThis,x=["*"]){m.addEventListener("message",function D(P){if(!P||!P.data)return;if(!Bs(x,P.origin)){console.warn(`Invalid origin '${P.origin}' for comlink proxy`);return}const{id:E,type:w,path:c}=Object.assign({path:[]},P.data),A=(P.data.argumentList||[]).map(yt);let _;try{const b=c.slice(0,-1).reduce((o,i)=>o[i],u),r=c.reduce((o,i)=>o[i],u);switch(w){case"GET":_=r;break;case"SET":b[c.slice(-1)[0]]=yt(P.data.value),_=!0;break;case"APPLY":_=r.apply(b,A);break;case"CONSTRUCT":{const o=new r(...A);_=Gs(o)}break;case"ENDPOINT":{const{port1:o,port2:i}=new MessageChannel;En(u,i),_=Ws(o,[o])}break;case"RELEASE":_=void 0;break;default:return}}catch(b){_={value:b,[Er]:0}}Promise.resolve(_).catch(b=>({value:b,[Er]:0})).then(b=>{const[r,o]=Pr(b);m.postMessage(Object.assign(Object.assign({},r),{id:E}),o),w==="RELEASE"&&(m.removeEventListener("message",D),Fi(m),wn in u&&typeof u[wn]=="function"&&u[wn]())}).catch(b=>{const[r,o]=Pr({value:new TypeError("Unserializable return value"),[Er]:0});m.postMessage(Object.assign(Object.assign({},r),{id:E}),o)})}),m.start&&m.start()}function zs(u){return u.constructor.name==="MessagePort"}function Fi(u){zs(u)&&u.close()}function Ks(u,m){const x=new Map;return u.addEventListener("message",function(P){const{data:E}=P;if(!E||!E.id)return;const w=x.get(E.id);if(w)try{w(E)}finally{x.delete(E.id)}}),On(u,x,[],m)}function Sr(u){if(u)throw new Error("Proxy has been released and is not useable")}function Ni(u){return Et(u,new Map,{type:"RELEASE"}).then(()=>{Fi(u)})}const Rr=new WeakMap,Cr="FinalizationRegistry"in globalThis&&new FinalizationRegistry(u=>{const m=(Rr.get(u)||0)-1;Rr.set(u,m),m===0&&Ni(u)});function Ls(u,m){const x=(Rr.get(m)||0)+1;Rr.set(m,x),Cr&&Cr.register(u,m,u)}function Us(u){Cr&&Cr.unregister(u)}function On(u,m,x=[],D=function(){}){let P=!1;const E=new Proxy(D,{get(w,c){if(Sr(P),c===Fs)return()=>{Us(E),Ni(u),m.clear(),P=!0};if(c==="then"){if(x.length===0)return{then:()=>E};const A=Et(u,m,{type:"GET",path:x.map(_=>_.toString())}).then(yt);return A.then.bind(A)}return On(u,m,[...x,c])},set(w,c,A){Sr(P);const[_,b]=Pr(A);return Et(u,m,{type:"SET",path:[...x,c].map(r=>r.toString()),value:_},b).then(yt)},apply(w,c,A){Sr(P);const _=x[x.length-1];if(_===qs)return Et(u,m,{type:"ENDPOINT"}).then(yt);if(_==="bind")return On(u,m,x.slice(0,-1));const[b,r]=$i(A);return Et(u,m,{type:"APPLY",path:x.map(o=>o.toString()),argumentList:b},r).then(yt)},construct(w,c){Sr(P);const[A,_]=$i(c);return Et(u,m,{type:"CONSTRUCT",path:x.map(b=>b.toString()),argumentList:A},_).then(yt)}});return Ls(E,u),E}function Hs(u){return Array.prototype.concat.apply([],u)}function $i(u){const m=u.map(Pr);return[m.map(x=>x[0]),Hs(m.map(x=>x[1]))]}const Mi=new WeakMap;function Ws(u,m){return Mi.set(u,m),u}function Gs(u){return Object.assign(u,{[Ii]:!0})}function Pr(u){for(const[m,x]of qi)if(x.canHandle(u)){const[D,P]=x.serialize(u);return[{type:"HANDLER",name:m,value:D},P]}return[{type:"RAW",value:u},Mi.get(u)||[]]}function yt(u){switch(u.type){case"HANDLER":return qi.get(u.name).deserialize(u.value);case"RAW":return u.value}}function Et(u,m,x,D){return new Promise(P=>{const E=Ys();m.set(E,P),u.start&&u.start(),u.postMessage(Object.assign({id:E},x),D)})}function Ys(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var kn={version:11,availableEntities:["assistances","donations","files","organizations","requests","tags","users","userlog","_deleted"],definitions:{assistances:"&id,hash,createdAt,date,bundleName,*familyMembersIds,distributionId,publicId,aor,address.pCode2,address.pCode3,address.pCode4,organization.id,organization.name,householdId,*taxIds,*peopleIds,headOfHousehold.passport,*tags,synced",donations:"&id,createdAt,date,bundleName,distributionId,publicId,aor,address.pCode4,organization.name,*tags,createdByEmail,synced",files:"&path,synced",organizations:"&id,createdAt,code,name,legalName,translation.uk.name,translation.uk.legalName,*tags,synced",requests:"&id,createdAt,date,bundleName,publicId,aor,address.pCode4,organization.name,createdByEmail,*tags,synced",tags:"name,entity",users:"&id,createdAt,email,person.fullName,updatedAt,person.translation.uk.fullName,*tags,synced",userlog:"$id,email,organization,userAgent,ip,eventType,eventDetail",_deleted:"&id, _type"}},Zs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dn(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Dr={exports:{}},Qs=Dr.exports,Oi;function Js(){return Oi||(Oi=1,function(u,m){(function(x,D){u.exports=D()})(Qs,function(){var x=function(e,t){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(l[v]=p[v])})(e,t)},D=function(){return(D=Object.assign||function(e){for(var t,l=1,p=arguments.length;l<p;l++)for(var v in t=arguments[l])Object.prototype.hasOwnProperty.call(t,v)&&(e[v]=t[v]);return e}).apply(this,arguments)};function P(e,t,l){for(var p,v=0,O=t.length;v<O;v++)!p&&v in t||((p=p||Array.prototype.slice.call(t,0,v))[v]=t[v]);return e.concat(p||Array.prototype.slice.call(t))}var E=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Zs,w=Object.keys,c=Array.isArray;function A(e,t){return typeof t!="object"||w(t).forEach(function(l){e[l]=t[l]}),e}typeof Promise>"u"||E.Promise||(E.Promise=Promise);var _=Object.getPrototypeOf,b={}.hasOwnProperty;function r(e,t){return b.call(e,t)}function o(e,t){typeof t=="function"&&(t=t(_(e))),(typeof Reflect>"u"?w:Reflect.ownKeys)(t).forEach(function(l){s(e,l,t[l])})}var i=Object.defineProperty;function s(e,t,l,p){i(e,t,A(l&&r(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},p))}function n(e){return{from:function(t){return e.prototype=Object.create(t.prototype),s(e.prototype,"constructor",e),{extend:o.bind(null,e.prototype)}}}}var d=Object.getOwnPropertyDescriptor,a=[].slice;function f(e,t,l){return a.call(e,t,l)}function y(e,t){return t(e)}function $(e){if(!e)throw new Error("Assertion Failed")}function S(e){E.setImmediate?setImmediate(e):setTimeout(e,0)}function I(e,t){if(typeof t=="string"&&r(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var l=[],p=0,v=t.length;p<v;++p){var O=I(e,t[p]);l.push(O)}return l}var R=t.indexOf(".");if(R!==-1){var T=e[t.substr(0,R)];return T==null?void 0:I(T,t.substr(R+1))}}function C(e,t,l){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){$(typeof l!="string"&&"length"in l);for(var p=0,v=t.length;p<v;++p)C(e,t[p],l[p])}else{var O,R,T=t.indexOf(".");T!==-1?(O=t.substr(0,T),(R=t.substr(T+1))===""?l===void 0?c(e)&&!isNaN(parseInt(O))?e.splice(O,1):delete e[O]:e[O]=l:C(T=!(T=e[O])||!r(e,O)?e[O]={}:T,R,l)):l===void 0?c(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=l}}function g(e){var t,l={};for(t in e)r(e,t)&&(l[t]=e[t]);return l}var k=[].concat;function j(e){return k.apply([],e)}var ot="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(j([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return E[e]}),B=new Set(ot.map(function(e){return E[e]})),Q=null;function J(e){return Q=new WeakMap,e=function t(l){if(!l||typeof l!="object")return l;var p=Q.get(l);if(p)return p;if(c(l)){p=[],Q.set(l,p);for(var v=0,O=l.length;v<O;++v)p.push(t(l[v]))}else if(B.has(l.constructor))p=l;else{var R,T=_(l);for(R in p=T===Object.prototype?{}:Object.create(T),Q.set(l,p),l)r(l,R)&&(p[R]=t(l[R]))}return p}(e),Q=null,e}var ae={}.toString;function oe(e){return ae.call(e).slice(8,-1)}var de=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ve=typeof de=="symbol"?function(e){var t;return e!=null&&(t=e[de])&&t.apply(e)}:function(){return null};function we(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var Se={};function me(e){var t,l,p,v;if(arguments.length===1){if(c(e))return e.slice();if(this===Se&&typeof e=="string")return[e];if(v=ve(e)){for(l=[];!(p=v.next()).done;)l.push(p.value);return l}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(l=new Array(t);t--;)l[t]=e[t];return l}for(t=arguments.length,l=new Array(t);t--;)l[t]=arguments[t];return l}var ye=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},It=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Be=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(It),Re={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ce(e,t){this.name=e,this.message=t}function ze(e,t){return e+". Errors: "+Object.keys(t).map(function(l){return t[l].toString()}).filter(function(l,p,v){return v.indexOf(l)===p}).join(`
`)}function Ke(e,t,l,p){this.failures=t,this.failedKeys=p,this.successCount=l,this.message=ze(e,t)}function Le(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(l){return t[l]}),this.failuresByPos=t,this.message=ze(e,this.failures)}n(Ce).from(Error).extend({toString:function(){return this.name+": "+this.message}}),n(Ke).from(Ce),n(Le).from(Ce);var Ge=Be.reduce(function(e,t){return e[t]=t+"Error",e},{}),ss=Ce,ue=Be.reduce(function(e,t){var l=t+"Error";function p(v,O){this.name=l,v?typeof v=="string"?(this.message="".concat(v).concat(O?`
 `+O:""),this.inner=O||null):typeof v=="object"&&(this.message="".concat(v.name," ").concat(v.message),this.inner=v):(this.message=Re[t]||l,this.inner=null)}return n(p).from(ss),e[t]=p,e},{});ue.Syntax=SyntaxError,ue.Type=TypeError,ue.Range=RangeError;var Ln=It.reduce(function(e,t){return e[t+"Error"]=ue[t],e},{}),er=Be.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=ue[t]),e},{});function _e(){}function Ct(e){return e}function as(e,t){return e==null||e===Ct?t:function(l){return t(e(l))}}function at(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function os(e,t){return e===_e?t:function(){var l=e.apply(this,arguments);l!==void 0&&(arguments[0]=l);var p=this.onsuccess,v=this.onerror;this.onsuccess=null,this.onerror=null;var O=t.apply(this,arguments);return p&&(this.onsuccess=this.onsuccess?at(p,this.onsuccess):p),v&&(this.onerror=this.onerror?at(v,this.onerror):v),O!==void 0?O:l}}function ls(e,t){return e===_e?t:function(){e.apply(this,arguments);var l=this.onsuccess,p=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?at(l,this.onsuccess):l),p&&(this.onerror=this.onerror?at(p,this.onerror):p)}}function us(e,t){return e===_e?t:function(l){var p=e.apply(this,arguments);A(l,p);var v=this.onsuccess,O=this.onerror;return this.onsuccess=null,this.onerror=null,l=t.apply(this,arguments),v&&(this.onsuccess=this.onsuccess?at(v,this.onsuccess):v),O&&(this.onerror=this.onerror?at(O,this.onerror):O),p===void 0?l===void 0?void 0:l:A(p,l)}}function cs(e,t){return e===_e?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Nr(e,t){return e===_e?t:function(){var l=e.apply(this,arguments);if(l&&typeof l.then=="function"){for(var p=this,v=arguments.length,O=new Array(v);v--;)O[v]=arguments[v];return l.then(function(){return t.apply(p,O)})}return t.apply(this,arguments)}}er.ModifyError=Ke,er.DexieError=Ce,er.BulkError=Le;var Ue=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Un(e){Ue=e}var Pt={},Hn=100,ot=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,_(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,_(t),e]}(),It=ot[0],Be=ot[1],ot=ot[2],Be=Be&&Be.then,lt=It&&It.constructor,Mr=!!ot,Tt=function(e,t){qt.push([e,t]),tr&&(queueMicrotask(ds),tr=!1)},Br=!0,tr=!0,ut=[],rr=[],zr=Ct,Ve={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:_e,pgp:!1,env:{},finalize:_e},le=Ve,qt=[],ct=0,nr=[];function ie(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=le;if(typeof e!="function"){if(e!==Pt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Lr(this,this._value))}this._state=null,this._value=null,++t.ref,function l(p,v){try{v(function(O){if(p._state===null){if(O===p)throw new TypeError("A promise cannot be resolved with itself.");var R=p._lib&&xt();O&&typeof O.then=="function"?l(p,function(T,F){O instanceof ie?O._then(T,F):O.then(T,F)}):(p._state=!0,p._value=O,Gn(p)),R&&$t()}},Lr.bind(null,p))}catch(O){Lr(p,O)}}(this,e)}var Kr={get:function(){var e=le,t=or;function l(p,v){var O=this,R=!e.global&&(e!==le||t!==or),T=R&&!tt(),F=new ie(function(M,L){Ur(O,new Wn(Zn(p,e,R,T),Zn(v,e,R,T),M,L,e))});return this._consoleTask&&(F._consoleTask=this._consoleTask),F}return l.prototype=Pt,l},set:function(e){s(this,"then",e&&e.prototype===Pt?Kr:{get:function(){return e},set:Kr.set})}};function Wn(e,t,l,p,v){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=l,this.reject=p,this.psd=v}function Lr(e,t){var l,p;rr.push(t),e._state===null&&(l=e._lib&&xt(),t=zr(t),e._state=!1,e._value=t,p=e,ut.some(function(v){return v._value===p._value})||ut.push(p),Gn(e),l&&$t())}function Gn(e){var t=e._listeners;e._listeners=[];for(var l=0,p=t.length;l<p;++l)Ur(e,t[l]);var v=e._PSD;--v.ref||v.finalize(),ct===0&&(++ct,Tt(function(){--ct==0&&Hr()},[]))}function Ur(e,t){if(e._state!==null){var l=e._state?t.onFulfilled:t.onRejected;if(l===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++ct,Tt(fs,[l,e,t])}else e._listeners.push(t)}function fs(e,t,l){try{var p,v=t._value;!t._state&&rr.length&&(rr=[]),p=Ue&&t._consoleTask?t._consoleTask.run(function(){return e(v)}):e(v),t._state||rr.indexOf(v)!==-1||function(O){for(var R=ut.length;R;)if(ut[--R]._value===O._value)return ut.splice(R,1)}(t),l.resolve(p)}catch(O){l.reject(O)}finally{--ct==0&&Hr(),--l.psd.ref||l.psd.finalize()}}function ds(){ft(Ve,function(){xt()&&$t()})}function xt(){var e=Br;return tr=Br=!1,e}function $t(){var e,t,l;do for(;0<qt.length;)for(e=qt,qt=[],l=e.length,t=0;t<l;++t){var p=e[t];p[0].apply(null,p[1])}while(0<qt.length);tr=Br=!0}function Hr(){var e=ut;ut=[],e.forEach(function(p){p._PSD.onunhandled.call(null,p._value,p)});for(var t=nr.slice(0),l=t.length;l;)t[--l]()}function ir(e){return new ie(Pt,!1,e)}function $e(e,t){var l=le;return function(){var p=xt(),v=le;try{return rt(l,!0),e.apply(this,arguments)}catch(O){t&&t(O)}finally{rt(v,!1),p&&$t()}}}o(ie.prototype,{then:Kr,_then:function(e,t){Ur(this,new Wn(null,null,e,t,le))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,l=arguments[1];return typeof t=="function"?this.then(null,function(p){return(p instanceof t?l:ir)(p)}):this.then(null,function(p){return(p&&p.name===t?l:ir)(p)})},finally:function(e){return this.then(function(t){return ie.resolve(e()).then(function(){return t})},function(t){return ie.resolve(e()).then(function(){return ir(t)})})},timeout:function(e,t){var l=this;return e<1/0?new ie(function(p,v){var O=setTimeout(function(){return v(new ue.Timeout(t))},e);l.then(p,v).finally(clearTimeout.bind(null,O))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&s(ie.prototype,Symbol.toStringTag,"Dexie.Promise"),Ve.env=Yn(),o(ie,{all:function(){var e=me.apply(null,arguments).map(lr);return new ie(function(t,l){e.length===0&&t([]);var p=e.length;e.forEach(function(v,O){return ie.resolve(v).then(function(R){e[O]=R,--p||t(e)},l)})})},resolve:function(e){return e instanceof ie?e:e&&typeof e.then=="function"?new ie(function(t,l){e.then(t,l)}):new ie(Pt,!0,e)},reject:ir,race:function(){var e=me.apply(null,arguments).map(lr);return new ie(function(t,l){e.map(function(p){return ie.resolve(p).then(t,l)})})},PSD:{get:function(){return le},set:function(e){return le=e}},totalEchoes:{get:function(){return or}},newPSD:et,usePSD:ft,scheduler:{get:function(){return Tt},set:function(e){Tt=e}},rejectionMapper:{get:function(){return zr},set:function(e){zr=e}},follow:function(e,t){return new ie(function(l,p){return et(function(v,O){var R=le;R.unhandleds=[],R.onunhandled=O,R.finalize=at(function(){var T,F=this;T=function(){F.unhandleds.length===0?v():O(F.unhandleds[0])},nr.push(function M(){T(),nr.splice(nr.indexOf(M),1)}),++ct,Tt(function(){--ct==0&&Hr()},[])},R.finalize),e()},t,l,p)})}}),lt&&(lt.allSettled&&s(ie,"allSettled",function(){var e=me.apply(null,arguments).map(lr);return new ie(function(t){e.length===0&&t([]);var l=e.length,p=new Array(l);e.forEach(function(v,O){return ie.resolve(v).then(function(R){return p[O]={status:"fulfilled",value:R}},function(R){return p[O]={status:"rejected",reason:R}}).then(function(){return--l||t(p)})})})}),lt.any&&typeof AggregateError<"u"&&s(ie,"any",function(){var e=me.apply(null,arguments).map(lr);return new ie(function(t,l){e.length===0&&l(new AggregateError([]));var p=e.length,v=new Array(p);e.forEach(function(O,R){return ie.resolve(O).then(function(T){return t(T)},function(T){v[R]=T,--p||l(new AggregateError(v))})})})}),lt.withResolvers&&(ie.withResolvers=lt.withResolvers));var je={awaits:0,echoes:0,id:0},hs=0,sr=[],ar=0,or=0,ps=0;function et(e,t,l,p){var v=le,O=Object.create(v);return O.parent=v,O.ref=0,O.global=!1,O.id=++ps,Ve.env,O.env=Mr?{Promise:ie,PromiseProp:{value:ie,configurable:!0,writable:!0},all:ie.all,race:ie.race,allSettled:ie.allSettled,any:ie.any,resolve:ie.resolve,reject:ie.reject}:{},t&&A(O,t),++v.ref,O.finalize=function(){--this.parent.ref||this.parent.finalize()},p=ft(O,e,l,p),O.ref===0&&O.finalize(),p}function Ot(){return je.id||(je.id=++hs),++je.awaits,je.echoes+=Hn,je.id}function tt(){return!!je.awaits&&(--je.awaits==0&&(je.id=0),je.echoes=je.awaits*Hn,!0)}function lr(e){return je.echoes&&e&&e.constructor===lt?(Ot(),e.then(function(t){return tt(),t},function(t){return tt(),ke(t)})):e}function ms(){var e=sr[sr.length-1];sr.pop(),rt(e,!1)}function rt(e,t){var l,p=le;(t?!je.echoes||ar++&&e===le:!ar||--ar&&e===le)||queueMicrotask(t?(function(v){++or,je.echoes&&--je.echoes!=0||(je.echoes=je.awaits=je.id=0),sr.push(le),rt(v,!0)}).bind(null,e):ms),e!==le&&(le=e,p===Ve&&(Ve.env=Yn()),Mr&&(l=Ve.env.Promise,t=e.env,(p.global||e.global)&&(Object.defineProperty(E,"Promise",t.PromiseProp),l.all=t.all,l.race=t.race,l.resolve=t.resolve,l.reject=t.reject,t.allSettled&&(l.allSettled=t.allSettled),t.any&&(l.any=t.any))))}function Yn(){var e=E.Promise;return Mr?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(E,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ft(e,t,l,p,v){var O=le;try{return rt(e,!0),t(l,p,v)}finally{rt(O,!1)}}function Zn(e,t,l,p){return typeof e!="function"?e:function(){var v=le;l&&Ot(),rt(t,!0);try{return e.apply(this,arguments)}finally{rt(v,!1),p&&queueMicrotask(tt)}}}function Wr(e){Promise===lt&&je.echoes===0?ar===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Be).indexOf("[native code]")===-1&&(Ot=tt=_e);var ke=ie.reject,dt="ï¿¿",Ye="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Qn="String expected.",kt=[],ur="__dbnames",Gr="readonly",Yr="readwrite";function ht(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Jn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function cr(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=J(t))[e],t}}function Xn(){throw ue.Type()}function ge(e,t){try{var l=Vn(e),p=Vn(t);if(l!==p)return l==="Array"?1:p==="Array"?-1:l==="binary"?1:p==="binary"?-1:l==="string"?1:p==="string"?-1:l==="Date"?1:p!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(v,O){for(var R=v.length,T=O.length,F=R<T?R:T,M=0;M<F;++M)if(v[M]!==O[M])return v[M]<O[M]?-1:1;return R===T?0:R<T?-1:1}(ei(e),ei(t));case"Array":return function(v,O){for(var R=v.length,T=O.length,F=R<T?R:T,M=0;M<F;++M){var L=ge(v[M],O[M]);if(L!==0)return L}return R===T?0:R<T?-1:1}(e,t)}}catch{}return NaN}function Vn(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=oe(e),e==="ArrayBuffer"?"binary":e)}function ei(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var ti=(xe.prototype._trans=function(e,t,l){var p=this._tx||le.trans,v=this.name,O=Ue&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function R(M,L,q){if(!q.schema[v])throw new ue.NotFound("Table "+v+" not part of transaction");return t(q.idbtrans,q)}var T=xt();try{var F=p&&p.db._novip===this.db._novip?p===le.trans?p._promise(e,R,l):et(function(){return p._promise(e,R,l)},{trans:p,transless:le.transless||le}):function M(L,q,H,N){if(L.idbdb&&(L._state.openComplete||le.letThrough||L._vip)){var K=L._createTransaction(q,H,L._dbSchema);try{K.create(),L._state.PR1398_maxLoop=3}catch(U){return U.name===Ge.InvalidState&&L.isOpen()&&0<--L._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),L.close({disableAutoOpen:!1}),L.open().then(function(){return M(L,q,H,N)})):ke(U)}return K._promise(q,function(U,z){return et(function(){return le.trans=K,N(U,z,K)})}).then(function(U){if(q==="readwrite")try{K.idbtrans.commit()}catch{}return q==="readonly"?U:K._completion.then(function(){return U})})}if(L._state.openComplete)return ke(new ue.DatabaseClosed(L._state.dbOpenError));if(!L._state.isBeingOpened){if(!L._state.autoOpen)return ke(new ue.DatabaseClosed);L.open().catch(_e)}return L._state.dbReadyPromise.then(function(){return M(L,q,H,N)})}(this.db,e,[this.name],R);return O&&(F._consoleTask=O,F=F.catch(function(M){return console.trace(M),ke(M)})),F}finally{T&&$t()}},xe.prototype.get=function(e,t){var l=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?ke(new ue.Type("Invalid argument to Table.get()")):this._trans("readonly",function(p){return l.core.get({trans:p,key:e}).then(function(v){return l.hook.reading.fire(v)})}).then(t)},xe.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(c(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=w(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(T){if(T.compound&&t.every(function(M){return 0<=T.keyPath.indexOf(M)})){for(var F=0;F<t.length;++F)if(t.indexOf(T.keyPath[F])===-1)return!1;return!0}return!1}).sort(function(T,F){return T.keyPath.length-F.keyPath.length})[0];if(l&&this.db._maxKey!==dt){var O=l.keyPath.slice(0,t.length);return this.where(O).equals(O.map(function(F){return e[F]}))}!l&&Ue&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var p=this.schema.idxByName;function v(T,F){return ge(T,F)===0}var R=t.reduce(function(q,F){var M=q[0],L=q[1],q=p[F],H=e[F];return[M||q,M||!q?ht(L,q&&q.multi?function(N){return N=I(N,F),c(N)&&N.some(function(K){return v(H,K)})}:function(N){return v(H,I(N,F))}):L]},[null,null]),O=R[0],R=R[1];return O?this.where(O.name).equals(e[O.keyPath]).filter(R):l?this.filter(R):this.where(t).equals("")},xe.prototype.filter=function(e){return this.toCollection().and(e)},xe.prototype.count=function(e){return this.toCollection().count(e)},xe.prototype.offset=function(e){return this.toCollection().offset(e)},xe.prototype.limit=function(e){return this.toCollection().limit(e)},xe.prototype.each=function(e){return this.toCollection().each(e)},xe.prototype.toArray=function(e){return this.toCollection().toArray(e)},xe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},xe.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,c(e)?"[".concat(e.join("+"),"]"):e))},xe.prototype.reverse=function(){return this.toCollection().reverse()},xe.prototype.mapToClass=function(e){var t,l=this.db,p=this.name;function v(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Xn&&(function(F,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function L(){this.constructor=F}x(F,M),F.prototype=M===null?Object.create(M):(L.prototype=M.prototype,new L)}(v,t=e),Object.defineProperty(v.prototype,"db",{get:function(){return l},enumerable:!1,configurable:!0}),v.prototype.table=function(){return p},e=v);for(var O=new Set,R=e.prototype;R;R=_(R))Object.getOwnPropertyNames(R).forEach(function(F){return O.add(F)});function T(F){if(!F)return F;var M,L=Object.create(e.prototype);for(M in F)if(!O.has(M))try{L[M]=F[M]}catch{}return L}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=T,this.hook("reading",T),e},xe.prototype.defineClass=function(){return this.mapToClass(function(e){A(this,e)})},xe.prototype.add=function(e,t){var l=this,p=this.schema.primKey,v=p.auto,O=p.keyPath,R=e;return O&&v&&(R=cr(O)(e)),this._trans("readwrite",function(T){return l.core.mutate({trans:T,type:"add",keys:t!=null?[t]:null,values:[R]})}).then(function(T){return T.numFailures?ie.reject(T.failures[0]):T.lastResult}).then(function(T){if(O)try{C(e,O,T)}catch{}return T})},xe.prototype.update=function(e,t){return typeof e!="object"||c(e)?this.where(":id").equals(e).modify(t):(e=I(e,this.schema.primKey.keyPath),e===void 0?ke(new ue.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},xe.prototype.put=function(e,t){var l=this,p=this.schema.primKey,v=p.auto,O=p.keyPath,R=e;return O&&v&&(R=cr(O)(e)),this._trans("readwrite",function(T){return l.core.mutate({trans:T,type:"put",values:[R],keys:t!=null?[t]:null})}).then(function(T){return T.numFailures?ie.reject(T.failures[0]):T.lastResult}).then(function(T){if(O)try{C(e,O,T)}catch{}return T})},xe.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(l){return t.core.mutate({trans:l,type:"delete",keys:[e]})}).then(function(l){return l.numFailures?ie.reject(l.failures[0]):void 0})},xe.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Jn})}).then(function(t){return t.numFailures?ie.reject(t.failures[0]):void 0})},xe.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(l){return t.core.getMany({keys:e,trans:l}).then(function(p){return p.map(function(v){return t.hook.reading.fire(v)})})})},xe.prototype.bulkAdd=function(e,t,l){var p=this,v=Array.isArray(t)?t:void 0,O=(l=l||(v?void 0:t))?l.allKeys:void 0;return this._trans("readwrite",function(R){var M=p.schema.primKey,T=M.auto,M=M.keyPath;if(M&&v)throw new ue.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(v&&v.length!==e.length)throw new ue.InvalidArgument("Arguments objects and keys must have the same length");var F=e.length,M=M&&T?e.map(cr(M)):e;return p.core.mutate({trans:R,type:"add",keys:v,values:M,wantResults:O}).then(function(K){var q=K.numFailures,H=K.results,N=K.lastResult,K=K.failures;if(q===0)return O?H:N;throw new Le("".concat(p.name,".bulkAdd(): ").concat(q," of ").concat(F," operations failed"),K)})})},xe.prototype.bulkPut=function(e,t,l){var p=this,v=Array.isArray(t)?t:void 0,O=(l=l||(v?void 0:t))?l.allKeys:void 0;return this._trans("readwrite",function(R){var M=p.schema.primKey,T=M.auto,M=M.keyPath;if(M&&v)throw new ue.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(v&&v.length!==e.length)throw new ue.InvalidArgument("Arguments objects and keys must have the same length");var F=e.length,M=M&&T?e.map(cr(M)):e;return p.core.mutate({trans:R,type:"put",keys:v,values:M,wantResults:O}).then(function(K){var q=K.numFailures,H=K.results,N=K.lastResult,K=K.failures;if(q===0)return O?H:N;throw new Le("".concat(p.name,".bulkPut(): ").concat(q," of ").concat(F," operations failed"),K)})})},xe.prototype.bulkUpdate=function(e){var t=this,l=this.core,p=e.map(function(R){return R.key}),v=e.map(function(R){return R.changes}),O=[];return this._trans("readwrite",function(R){return l.getMany({trans:R,keys:p,cache:"clone"}).then(function(T){var F=[],M=[];e.forEach(function(q,H){var N=q.key,K=q.changes,U=T[H];if(U){for(var z=0,W=Object.keys(K);z<W.length;z++){var G=W[z],Y=K[G];if(G===t.schema.primKey.keyPath){if(ge(Y,N)!==0)throw new ue.Constraint("Cannot update primary key in bulkUpdate()")}else C(U,G,Y)}O.push(H),F.push(N),M.push(U)}});var L=F.length;return l.mutate({trans:R,type:"put",keys:F,values:M,updates:{keys:p,changeSpecs:v}}).then(function(q){var H=q.numFailures,N=q.failures;if(H===0)return L;for(var K=0,U=Object.keys(N);K<U.length;K++){var z,W=U[K],G=O[Number(W)];G!=null&&(z=N[W],delete N[W],N[G]=z)}throw new Le("".concat(t.name,".bulkUpdate(): ").concat(H," of ").concat(L," operations failed"),N)})})})},xe.prototype.bulkDelete=function(e){var t=this,l=e.length;return this._trans("readwrite",function(p){return t.core.mutate({trans:p,type:"delete",keys:e})}).then(function(R){var v=R.numFailures,O=R.lastResult,R=R.failures;if(v===0)return O;throw new Le("".concat(t.name,".bulkDelete(): ").concat(v," of ").concat(l," operations failed"),R)})},xe);function xe(){}function Ft(e){function t(R,T){if(T){for(var F=arguments.length,M=new Array(F-1);--F;)M[F-1]=arguments[F];return l[R].subscribe.apply(null,M),e}if(typeof R=="string")return l[R]}var l={};t.addEventType=O;for(var p=1,v=arguments.length;p<v;++p)O(arguments[p]);return t;function O(R,T,F){if(typeof R!="object"){var M;T=T||cs;var L={subscribers:[],fire:F=F||_e,subscribe:function(q){L.subscribers.indexOf(q)===-1&&(L.subscribers.push(q),L.fire=T(L.fire,q))},unsubscribe:function(q){L.subscribers=L.subscribers.filter(function(H){return H!==q}),L.fire=L.subscribers.reduce(T,F)}};return l[R]=t[R]=L}w(M=R).forEach(function(q){var H=M[q];if(c(H))O(q,M[q][0],M[q][1]);else{if(H!=="asap")throw new ue.InvalidArgument("Invalid event config");var N=O(q,Ct,function(){for(var K=arguments.length,U=new Array(K);K--;)U[K]=arguments[K];N.subscribers.forEach(function(z){S(function(){z.apply(null,U)})})})}})}}function Nt(e,t){return n(t).from({prototype:e}),t}function At(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Zr(e,t){e.filter=ht(e.filter,t)}function Qr(e,t,l){var p=e.replayFilter;e.replayFilter=p?function(){return ht(p(),t())}:t,e.justLimit=l&&!p}function fr(e,t){if(e.isPrimKey)return t.primaryKey;var l=t.getIndexByKeyPath(e.index);if(!l)throw new ue.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return l}function ri(e,t,l){var p=fr(e,t.schema);return t.openCursor({trans:l,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:p,range:e.range}})}function dr(e,t,l,p){var v=e.replayFilter?ht(e.filter,e.replayFilter()):e.filter;if(e.or){var O={},R=function(T,F,M){var L,q;v&&!v(F,M,function(H){return F.stop(H)},function(H){return F.fail(H)})||((q=""+(L=F.primaryKey))=="[object ArrayBuffer]"&&(q=""+new Uint8Array(L)),r(O,q)||(O[q]=!0,t(T,F,M)))};return Promise.all([e.or._iterate(R,l),ni(ri(e,p,l),e.algorithm,R,!e.keysOnly&&e.valueMapper)])}return ni(ri(e,p,l),ht(e.algorithm,v),t,!e.keysOnly&&e.valueMapper)}function ni(e,t,l,p){var v=$e(p?function(O,R,T){return l(p(O),R,T)}:l);return e.then(function(O){if(O)return O.start(function(){var R=function(){return O.continue()};t&&!t(O,function(T){return R=T},function(T){O.stop(T),R=_e},function(T){O.fail(T),R=_e})||v(O.value,O,function(T){return R=T}),R()})})}var Mt=(ii.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var l=t.add;if(c(l))return P(P([],c(e)?e:[],!0),l).sort();if(typeof l=="number")return(Number(e)||0)+l;if(typeof l=="bigint")try{return BigInt(e)+l}catch{return BigInt(0)+l}throw new TypeError("Invalid term ".concat(l))}if(t.remove!==void 0){var p=t.remove;if(c(p))return c(e)?e.filter(function(v){return!p.includes(v)}).sort():[];if(typeof p=="number")return Number(e)-p;if(typeof p=="bigint")try{return BigInt(e)-p}catch{return BigInt(0)-p}throw new TypeError("Invalid subtrahend ".concat(p))}return l=(l=t.replacePrefix)===null||l===void 0?void 0:l[0],l&&typeof e=="string"&&e.startsWith(l)?t.replacePrefix[1]+e.substring(l.length):e},ii);function ii(e){this["@@propmod"]=e}var gs=(be.prototype._read=function(e,t){var l=this._ctx;return l.error?l.table._trans(null,ke.bind(null,l.error)):l.table._trans("readonly",e).then(t)},be.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,ke.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},be.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=ht(t.algorithm,e)},be.prototype._iterate=function(e,t){return dr(this._ctx,e,t,this._ctx.table.core)},be.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return e&&A(l,e),t._ctx=l,t},be.prototype.raw=function(){return this._ctx.valueMapper=null,this},be.prototype.each=function(e){var t=this._ctx;return this._read(function(l){return dr(t,e,l,t.table.core)})},be.prototype.count=function(e){var t=this;return this._read(function(l){var p=t._ctx,v=p.table.core;if(At(p,!0))return v.count({trans:l,query:{index:fr(p,v.schema),range:p.range}}).then(function(R){return Math.min(R,p.limit)});var O=0;return dr(p,function(){return++O,!1},l,v).then(function(){return O})}).then(e)},be.prototype.sortBy=function(e,t){var l=e.split(".").reverse(),p=l[0],v=l.length-1;function O(F,M){return M?O(F[l[M]],M-1):F[p]}var R=this._ctx.dir==="next"?1:-1;function T(F,M){return ge(O(F,v),O(M,v))*R}return this.toArray(function(F){return F.sort(T)}).then(t)},be.prototype.toArray=function(e){var t=this;return this._read(function(l){var p=t._ctx;if(p.dir==="next"&&At(p,!0)&&0<p.limit){var v=p.valueMapper,O=fr(p,p.table.core.schema);return p.table.core.query({trans:l,limit:p.limit,values:!0,query:{index:O,range:p.range}}).then(function(T){return T=T.result,v?T.map(v):T})}var R=[];return dr(p,function(T){return R.push(T)},l,p.table.core).then(function(){return R})},e)},be.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,At(t)?Qr(t,function(){var l=e;return function(p,v){return l===0||(l===1?--l:v(function(){p.advance(l),l=0}),!1)}}):Qr(t,function(){var l=e;return function(){return--l<0}})),this},be.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Qr(this._ctx,function(){var t=e;return function(l,p,v){return--t<=0&&p(v),0<=t}},!0),this},be.prototype.until=function(e,t){return Zr(this._ctx,function(l,p,v){return!e(l.value)||(p(v),t)}),this},be.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},be.prototype.last=function(e){return this.reverse().first(e)},be.prototype.filter=function(e){var t;return Zr(this._ctx,function(l){return e(l.value)}),(t=this._ctx).isMatch=ht(t.isMatch,e),this},be.prototype.and=function(e){return this.filter(e)},be.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},be.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},be.prototype.desc=function(){return this.reverse()},be.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(l,p){e(p.key,p)})},be.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},be.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(l,p){e(p.primaryKey,p)})},be.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var l=[];return this.each(function(p,v){l.push(v.key)}).then(function(){return l}).then(e)},be.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&At(t,!0)&&0<t.limit)return this._read(function(p){var v=fr(t,t.table.core.schema);return t.table.core.query({trans:p,values:!1,limit:t.limit,query:{index:v,range:t.range}})}).then(function(p){return p.result}).then(e);t.keysOnly=!t.isMatch;var l=[];return this.each(function(p,v){l.push(v.primaryKey)}).then(function(){return l}).then(e)},be.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},be.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},be.prototype.lastKey=function(e){return this.reverse().firstKey(e)},be.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return Zr(this._ctx,function(v){var p=v.primaryKey.toString(),v=r(t,p);return t[p]=!0,!v}),this},be.prototype.modify=function(e){var t=this,l=this._ctx;return this._write(function(p){var v,O,R;R=typeof e=="function"?e:(v=w(e),O=v.length,function(z){for(var W=!1,G=0;G<O;++G){var Y=v[G],Z=e[Y],X=I(z,Y);Z instanceof Mt?(C(z,Y,Z.execute(X)),W=!0):X!==Z&&(C(z,Y,Z),W=!0)}return W});var T=l.table.core,q=T.schema.primaryKey,F=q.outbound,M=q.extractKey,L=200,q=t.db._options.modifyChunkSize;q&&(L=typeof q=="object"?q[T.name]||q["*"]||200:q);function H(z,Y){var G=Y.failures,Y=Y.numFailures;K+=z-Y;for(var Z=0,X=w(G);Z<X.length;Z++){var re=X[Z];N.push(G[re])}}var N=[],K=0,U=[];return t.clone().primaryKeys().then(function(z){function W(Y){var Z=Math.min(L,z.length-Y);return T.getMany({trans:p,keys:z.slice(Y,Y+Z),cache:"immutable"}).then(function(X){for(var re=[],V=[],ee=F?[]:null,ne=[],te=0;te<Z;++te){var se=X[te],fe={value:J(se),primKey:z[Y+te]};R.call(fe,fe.value,fe)!==!1&&(fe.value==null?ne.push(z[Y+te]):F||ge(M(se),M(fe.value))===0?(V.push(fe.value),F&&ee.push(z[Y+te])):(ne.push(z[Y+te]),re.push(fe.value)))}return Promise.resolve(0<re.length&&T.mutate({trans:p,type:"add",values:re}).then(function(he){for(var pe in he.failures)ne.splice(parseInt(pe),1);H(re.length,he)})).then(function(){return(0<V.length||G&&typeof e=="object")&&T.mutate({trans:p,type:"put",keys:ee,values:V,criteria:G,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<Y}).then(function(he){return H(V.length,he)})}).then(function(){return(0<ne.length||G&&e===Jr)&&T.mutate({trans:p,type:"delete",keys:ne,criteria:G,isAdditionalChunk:0<Y}).then(function(he){return H(ne.length,he)})}).then(function(){return z.length>Y+Z&&W(Y+L)})})}var G=At(l)&&l.limit===1/0&&(typeof e!="function"||e===Jr)&&{index:l.index,range:l.range};return W(0).then(function(){if(0<N.length)throw new Ke("Error modifying one or more objects",N,K,U);return z.length})})})},be.prototype.delete=function(){var e=this._ctx,t=e.range;return At(e)&&(e.isPrimKey||t.type===3)?this._write(function(l){var p=e.table.core.schema.primaryKey,v=t;return e.table.core.count({trans:l,query:{index:p,range:v}}).then(function(O){return e.table.core.mutate({trans:l,type:"deleteRange",range:v}).then(function(R){var T=R.failures;if(R.lastResult,R.results,R=R.numFailures,R)throw new Ke("Could not delete some values",Object.keys(T).map(function(F){return T[F]}),O-R);return O-R})})}):this.modify(Jr)},be);function be(){}var Jr=function(e,t){return t.value=null};function ys(e,t){return e<t?-1:e===t?0:1}function bs(e,t){return t<e?-1:e===t?0:1}function Ne(e,t,l){return e=e instanceof ai?new e.Collection(e):e,e._ctx.error=new(l||TypeError)(t),e}function St(e){return new e.Collection(e,function(){return si("")}).limit(0)}function hr(e,t,l,p){var v,O,R,T,F,M,L,q=l.length;if(!l.every(function(K){return typeof K=="string"}))return Ne(e,Qn);function H(K){v=K==="next"?function(z){return z.toUpperCase()}:function(z){return z.toLowerCase()},O=K==="next"?function(z){return z.toLowerCase()}:function(z){return z.toUpperCase()},R=K==="next"?ys:bs;var U=l.map(function(z){return{lower:O(z),upper:v(z)}}).sort(function(z,W){return R(z.lower,W.lower)});T=U.map(function(z){return z.upper}),F=U.map(function(z){return z.lower}),L=(M=K)==="next"?"":p}H("next"),e=new e.Collection(e,function(){return nt(T[0],F[q-1]+p)}),e._ondirectionchange=function(K){H(K)};var N=0;return e._addAlgorithm(function(K,U,z){var W=K.key;if(typeof W!="string")return!1;var G=O(W);if(t(G,F,N))return!0;for(var Y=null,Z=N;Z<q;++Z){var X=function(re,V,ee,ne,te,se){for(var fe=Math.min(re.length,ne.length),he=-1,pe=0;pe<fe;++pe){var Me=V[pe];if(Me!==ne[pe])return te(re[pe],ee[pe])<0?re.substr(0,pe)+ee[pe]+ee.substr(pe+1):te(re[pe],ne[pe])<0?re.substr(0,pe)+ne[pe]+ee.substr(pe+1):0<=he?re.substr(0,he)+V[he]+ee.substr(he+1):null;te(re[pe],Me)<0&&(he=pe)}return fe<ne.length&&se==="next"?re+ee.substr(re.length):fe<re.length&&se==="prev"?re.substr(0,ee.length):he<0?null:re.substr(0,he)+ne[he]+ee.substr(he+1)}(W,G,T[Z],F[Z],R,M);X===null&&Y===null?N=Z+1:(Y===null||0<R(Y,X))&&(Y=X)}return U(Y!==null?function(){K.continue(Y+L)}:z),!1}),e}function nt(e,t,l,p){return{type:2,lower:e,upper:t,lowerOpen:l,upperOpen:p}}function si(e){return{type:1,lower:e,upper:e}}var ai=(Object.defineProperty(Ee.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Ee.prototype.between=function(e,t,l,p){l=l!==!1,p=p===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(l||p)&&(!l||!p)?St(this):new this.Collection(this,function(){return nt(e,t,!l,!p)})}catch{return Ne(this,Ye)}},Ee.prototype.equals=function(e){return e==null?Ne(this,Ye):new this.Collection(this,function(){return si(e)})},Ee.prototype.above=function(e){return e==null?Ne(this,Ye):new this.Collection(this,function(){return nt(e,void 0,!0)})},Ee.prototype.aboveOrEqual=function(e){return e==null?Ne(this,Ye):new this.Collection(this,function(){return nt(e,void 0,!1)})},Ee.prototype.below=function(e){return e==null?Ne(this,Ye):new this.Collection(this,function(){return nt(void 0,e,!1,!0)})},Ee.prototype.belowOrEqual=function(e){return e==null?Ne(this,Ye):new this.Collection(this,function(){return nt(void 0,e)})},Ee.prototype.startsWith=function(e){return typeof e!="string"?Ne(this,Qn):this.between(e,e+dt,!0,!0)},Ee.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):hr(this,function(t,l){return t.indexOf(l[0])===0},[e],dt)},Ee.prototype.equalsIgnoreCase=function(e){return hr(this,function(t,l){return t===l[0]},[e],"")},Ee.prototype.anyOfIgnoreCase=function(){var e=me.apply(Se,arguments);return e.length===0?St(this):hr(this,function(t,l){return l.indexOf(t)!==-1},e,"")},Ee.prototype.startsWithAnyOfIgnoreCase=function(){var e=me.apply(Se,arguments);return e.length===0?St(this):hr(this,function(t,l){return l.some(function(p){return t.indexOf(p)===0})},e,dt)},Ee.prototype.anyOf=function(){var e=this,t=me.apply(Se,arguments),l=this._cmp;try{t.sort(l)}catch{return Ne(this,Ye)}if(t.length===0)return St(this);var p=new this.Collection(this,function(){return nt(t[0],t[t.length-1])});p._ondirectionchange=function(O){l=O==="next"?e._ascending:e._descending,t.sort(l)};var v=0;return p._addAlgorithm(function(O,R,T){for(var F=O.key;0<l(F,t[v]);)if(++v===t.length)return R(T),!1;return l(F,t[v])===0||(R(function(){O.continue(t[v])}),!1)}),p},Ee.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Ee.prototype.noneOf=function(){var e=me.apply(Se,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ne(this,Ye)}var t=e.reduce(function(l,p){return l?l.concat([[l[l.length-1][1],p]]):[[-1/0,p]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Ee.prototype.inAnyRange=function(W,t){var l=this,p=this._cmp,v=this._ascending,O=this._descending,R=this._min,T=this._max;if(W.length===0)return St(this);if(!W.every(function(G){return G[0]!==void 0&&G[1]!==void 0&&v(G[0],G[1])<=0}))return Ne(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ue.InvalidArgument);var F=!t||t.includeLowers!==!1,M=t&&t.includeUppers===!0,L,q=v;function H(G,Y){return q(G[0],Y[0])}try{(L=W.reduce(function(G,Y){for(var Z=0,X=G.length;Z<X;++Z){var re=G[Z];if(p(Y[0],re[1])<0&&0<p(Y[1],re[0])){re[0]=R(re[0],Y[0]),re[1]=T(re[1],Y[1]);break}}return Z===X&&G.push(Y),G},[])).sort(H)}catch{return Ne(this,Ye)}var N=0,K=M?function(G){return 0<v(G,L[N][1])}:function(G){return 0<=v(G,L[N][1])},U=F?function(G){return 0<O(G,L[N][0])}:function(G){return 0<=O(G,L[N][0])},z=K,W=new this.Collection(this,function(){return nt(L[0][0],L[L.length-1][1],!F,!M)});return W._ondirectionchange=function(G){q=G==="next"?(z=K,v):(z=U,O),L.sort(H)},W._addAlgorithm(function(G,Y,Z){for(var X,re=G.key;z(re);)if(++N===L.length)return Y(Z),!1;return!K(X=re)&&!U(X)||(l._cmp(re,L[N][1])===0||l._cmp(re,L[N][0])===0||Y(function(){q===v?G.continue(L[N][0]):G.continue(L[N][1])}),!1)}),W},Ee.prototype.startsWithAnyOf=function(){var e=me.apply(Se,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?St(this):this.inAnyRange(e.map(function(t){return[t,t+dt]})):Ne(this,"startsWithAnyOf() only works with strings")},Ee);function Ee(){}function He(e){return $e(function(t){return Bt(t),e(t.target.error),!1})}function Bt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var zt="storagemutated",Xr="x-storagemutated-1",it=Ft(null,zt),vs=(We.prototype._lock=function(){return $(!le.global),++this._reculock,this._reculock!==1||le.global||(le.lockOwnerFor=this),this},We.prototype._unlock=function(){if($(!le.global),--this._reculock==0)for(le.global||(le.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ft(e[1],e[0])}catch{}}return this},We.prototype._locked=function(){return this._reculock&&le.lockOwnerFor!==this},We.prototype.create=function(e){var t=this;if(!this.mode)return this;var l=this.db.idbdb,p=this.db._state.dbOpenError;if($(!this.idbtrans),!e&&!l)switch(p&&p.name){case"DatabaseClosedError":throw new ue.DatabaseClosed(p);case"MissingAPIError":throw new ue.MissingAPI(p.message,p);default:throw new ue.OpenFailed(p)}if(!this.active)throw new ue.TransactionInactive;return $(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=$e(function(v){Bt(v),t._reject(e.error)}),e.onabort=$e(function(v){Bt(v),t.active&&t._reject(new ue.Abort(e.error)),t.active=!1,t.on("abort").fire(v)}),e.oncomplete=$e(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&it.storagemutated.fire(e.mutatedParts)}),this},We.prototype._promise=function(e,t,l){var p=this;if(e==="readwrite"&&this.mode!=="readwrite")return ke(new ue.ReadOnly("Transaction is readonly"));if(!this.active)return ke(new ue.TransactionInactive);if(this._locked())return new ie(function(O,R){p._blockedFuncs.push([function(){p._promise(e,t,l).then(O,R)},le])});if(l)return et(function(){var O=new ie(function(R,T){p._lock();var F=t(R,T,p);F&&F.then&&F.then(R,T)});return O.finally(function(){return p._unlock()}),O._lib=!0,O});var v=new ie(function(O,R){var T=t(O,R,p);T&&T.then&&T.then(O,R)});return v._lib=!0,v},We.prototype._root=function(){return this.parent?this.parent._root():this},We.prototype.waitFor=function(e){var t,l=this._root(),p=ie.resolve(e);l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return p}):(l._waitingFor=p,l._waitingQueue=[],t=l.idbtrans.objectStore(l.storeNames[0]),function O(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(t.get(-1/0).onsuccess=O)}());var v=l._waitingFor;return new ie(function(O,R){p.then(function(T){return l._waitingQueue.push($e(O.bind(null,T)))},function(T){return l._waitingQueue.push($e(R.bind(null,T)))}).finally(function(){l._waitingFor===v&&(l._waitingFor=null)})})},We.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ue.Abort))},We.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(r(t,e))return t[e];var l=this.schema[e];if(!l)throw new ue.NotFound("Table "+e+" not part of transaction");return l=new this.db.Table(e,l,this),l.core=this.db.core.table(e),t[e]=l},We);function We(){}function Vr(e,t,l,p,v,O,R){return{name:e,keyPath:t,unique:l,multi:p,auto:v,compound:O,src:(l&&!R?"&":"")+(p?"*":"")+(v?"++":"")+oi(t)}}function oi(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function en(e,t,l){return{name:e,primKey:t,indexes:l,mappedClass:null,idxByName:(p=function(v){return[v.name,v]},l.reduce(function(v,O,R){return R=p(O,R),R&&(v[R[0]]=R[1]),v},{}))};var p}var Kt=function(e){try{return e.only([[]]),Kt=function(){return[[]]},[[]]}catch{return Kt=function(){return dt},dt}};function tn(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(l){return l[t]}:function(l){return I(l,t)}:function(l){return I(l,e)};var t}function li(e){return[].slice.call(e)}var _s=0;function Lt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function ws(e,t,F){function p(z){if(z.type===3)return null;if(z.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var N=z.lower,K=z.upper,U=z.lowerOpen,z=z.upperOpen;return N===void 0?K===void 0?null:t.upperBound(K,!!z):K===void 0?t.lowerBound(N,!!U):t.bound(N,K,!!U,!!z)}function v(H){var N,K=H.name;return{name:K,schema:H,mutate:function(U){var z=U.trans,W=U.type,G=U.keys,Y=U.values,Z=U.range;return new Promise(function(X,re){X=$e(X);var V=z.objectStore(K),ee=V.keyPath==null,ne=W==="put"||W==="add";if(!ne&&W!=="delete"&&W!=="deleteRange")throw new Error("Invalid operation type: "+W);var te,se=(G||Y||{length:1}).length;if(G&&Y&&G.length!==Y.length)throw new Error("Given keys array must have same length as given values array.");if(se===0)return X({numFailures:0,failures:{},results:[],lastResult:void 0});function fe(Fe){++Me,Bt(Fe)}var he=[],pe=[],Me=0;if(W==="deleteRange"){if(Z.type===4)return X({numFailures:Me,failures:pe,results:[],lastResult:void 0});Z.type===3?he.push(te=V.clear()):he.push(te=V.delete(p(Z)))}else{var ee=ne?ee?[Y,G]:[Y,null]:[G,null],ce=ee[0],Ie=ee[1];if(ne)for(var Te=0;Te<se;++Te)he.push(te=Ie&&Ie[Te]!==void 0?V[W](ce[Te],Ie[Te]):V[W](ce[Te])),te.onerror=fe;else for(Te=0;Te<se;++Te)he.push(te=V[W](ce[Te])),te.onerror=fe}function Ar(Fe){Fe=Fe.target.result,he.forEach(function(gt,_n){return gt.error!=null&&(pe[_n]=gt.error)}),X({numFailures:Me,failures:pe,results:W==="delete"?G:he.map(function(gt){return gt.result}),lastResult:Fe})}te.onerror=function(Fe){fe(Fe),Ar(Fe)},te.onsuccess=Ar})},getMany:function(U){var z=U.trans,W=U.keys;return new Promise(function(G,Y){G=$e(G);for(var Z,X=z.objectStore(K),re=W.length,V=new Array(re),ee=0,ne=0,te=function(he){he=he.target,V[he._pos]=he.result,++ne===ee&&G(V)},se=He(Y),fe=0;fe<re;++fe)W[fe]!=null&&((Z=X.get(W[fe]))._pos=fe,Z.onsuccess=te,Z.onerror=se,++ee);ee===0&&G(V)})},get:function(U){var z=U.trans,W=U.key;return new Promise(function(G,Y){G=$e(G);var Z=z.objectStore(K).get(W);Z.onsuccess=function(X){return G(X.target.result)},Z.onerror=He(Y)})},query:(N=M,function(U){return new Promise(function(z,W){z=$e(z);var G,Y,Z,ee=U.trans,X=U.values,re=U.limit,te=U.query,V=re===1/0?void 0:re,ne=te.index,te=te.range,ee=ee.objectStore(K),ne=ne.isPrimaryKey?ee:ee.index(ne.name),te=p(te);if(re===0)return z({result:[]});N?((V=X?ne.getAll(te,V):ne.getAllKeys(te,V)).onsuccess=function(se){return z({result:se.target.result})},V.onerror=He(W)):(G=0,Y=!X&&"openKeyCursor"in ne?ne.openKeyCursor(te):ne.openCursor(te),Z=[],Y.onsuccess=function(se){var fe=Y.result;return fe?(Z.push(X?fe.value:fe.primaryKey),++G===re?z({result:Z}):void fe.continue()):z({result:Z})},Y.onerror=He(W))})}),openCursor:function(U){var z=U.trans,W=U.values,G=U.query,Y=U.reverse,Z=U.unique;return new Promise(function(X,re){X=$e(X);var ne=G.index,V=G.range,ee=z.objectStore(K),ee=ne.isPrimaryKey?ee:ee.index(ne.name),ne=Y?Z?"prevunique":"prev":Z?"nextunique":"next",te=!W&&"openKeyCursor"in ee?ee.openKeyCursor(p(V),ne):ee.openCursor(p(V),ne);te.onerror=He(re),te.onsuccess=$e(function(se){var fe,he,pe,Me,ce=te.result;ce?(ce.___id=++_s,ce.done=!1,fe=ce.continue.bind(ce),he=(he=ce.continuePrimaryKey)&&he.bind(ce),pe=ce.advance.bind(ce),Me=function(){throw new Error("Cursor not stopped")},ce.trans=z,ce.stop=ce.continue=ce.continuePrimaryKey=ce.advance=function(){throw new Error("Cursor not started")},ce.fail=$e(re),ce.next=function(){var Ie=this,Te=1;return this.start(function(){return Te--?Ie.continue():Ie.stop()}).then(function(){return Ie})},ce.start=function(Ie){function Te(){if(te.result)try{Ie()}catch(Fe){ce.fail(Fe)}else ce.done=!0,ce.start=function(){throw new Error("Cursor behind last entry")},ce.stop()}var Ar=new Promise(function(Fe,gt){Fe=$e(Fe),te.onerror=He(gt),ce.fail=gt,ce.stop=function(_n){ce.stop=ce.continue=ce.continuePrimaryKey=ce.advance=Me,Fe(_n)}});return te.onsuccess=$e(function(Fe){te.onsuccess=Te,Te()}),ce.continue=fe,ce.continuePrimaryKey=he,ce.advance=pe,Te(),Ar},X(ce)):X(null)},re)})},count:function(U){var z=U.query,W=U.trans,G=z.index,Y=z.range;return new Promise(function(Z,X){var re=W.objectStore(K),V=G.isPrimaryKey?re:re.index(G.name),re=p(Y),V=re?V.count(re):V.count();V.onsuccess=$e(function(ee){return Z(ee.target.result)}),V.onerror=He(X)})}}}var O,R,T,L=(R=F,T=li((O=e).objectStoreNames),{schema:{name:O.name,tables:T.map(function(H){return R.objectStore(H)}).map(function(H){var N=H.keyPath,z=H.autoIncrement,K=c(N),U={},z={name:H.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:N==null,compound:K,keyPath:N,autoIncrement:z,unique:!0,extractKey:tn(N)},indexes:li(H.indexNames).map(function(W){return H.index(W)}).map(function(Z){var G=Z.name,Y=Z.unique,X=Z.multiEntry,Z=Z.keyPath,X={name:G,compound:c(Z),keyPath:Z,unique:Y,multiEntry:X,extractKey:tn(Z)};return U[Lt(Z)]=X}),getIndexByKeyPath:function(W){return U[Lt(W)]}};return U[":id"]=z.primaryKey,N!=null&&(U[Lt(N)]=z.primaryKey),z})},hasGetAll:0<T.length&&"getAll"in R.objectStore(T[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),F=L.schema,M=L.hasGetAll,L=F.tables.map(v),q={};return L.forEach(function(H){return q[H.name]=H}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(H){if(!q[H])throw new Error("Table '".concat(H,"' not found"));return q[H]},MIN_KEY:-1/0,MAX_KEY:Kt(t),schema:F}}function xs(e,t,l,p){var v=l.IDBKeyRange;return l.indexedDB,{dbcore:(p=ws(t,v,p),e.dbcore.reduce(function(O,R){return R=R.create,D(D({},O),R(O))},p))}}function pr(e,p){var l=p.db,p=xs(e._middlewares,l,e._deps,p);e.core=p.dbcore,e.tables.forEach(function(v){var O=v.name;e.core.schema.tables.some(function(R){return R.name===O})&&(v.core=e.core.table(O),e[O]instanceof e.Table&&(e[O].core=v.core))})}function mr(e,t,l,p){l.forEach(function(v){var O=p[v];t.forEach(function(R){var T=function F(M,L){return d(M,L)||(M=_(M))&&F(M,L)}(R,v);(!T||"value"in T&&T.value===void 0)&&(R===e.Transaction.prototype||R instanceof e.Transaction?s(R,v,{get:function(){return this.table(v)},set:function(F){i(this,v,{value:F,writable:!0,configurable:!0,enumerable:!0})}}):R[v]=new e.Table(v,O))})})}function rn(e,t){t.forEach(function(l){for(var p in l)l[p]instanceof e.Table&&delete l[p]})}function $s(e,t){return e._cfg.version-t._cfg.version}function Os(e,t,l,p){var v=e._dbSchema;l.objectStoreNames.contains("$meta")&&!v.$meta&&(v.$meta=en("$meta",ci("")[0],[]),e._storeNames.push("$meta"));var O=e._createTransaction("readwrite",e._storeNames,v);O.create(l),O._completion.catch(p);var R=O._reject.bind(O),T=le.transless||le;et(function(){return le.trans=O,le.transless=T,t!==0?(pr(e,l),M=t,((F=O).storeNames.includes("$meta")?F.table("$meta").get("version").then(function(L){return L??M}):ie.resolve(M)).then(function(L){return H=L,N=O,K=l,U=[],L=(q=e)._versions,z=q._dbSchema=yr(0,q.idbdb,K),(L=L.filter(function(W){return W._cfg.version>=H})).length!==0?(L.forEach(function(W){U.push(function(){var G=z,Y=W._cfg.dbschema;br(q,G,K),br(q,Y,K),z=q._dbSchema=Y;var Z=nn(G,Y);Z.add.forEach(function(ne){sn(K,ne[0],ne[1].primKey,ne[1].indexes)}),Z.change.forEach(function(ne){if(ne.recreate)throw new ue.Upgrade("Not yet support for changing primary key");var te=K.objectStore(ne.name);ne.add.forEach(function(se){return gr(te,se)}),ne.change.forEach(function(se){te.deleteIndex(se.name),gr(te,se)}),ne.del.forEach(function(se){return te.deleteIndex(se)})});var X=W._cfg.contentUpgrade;if(X&&W._cfg.version>H){pr(q,K),N._memoizedTables={};var re=g(Y);Z.del.forEach(function(ne){re[ne]=G[ne]}),rn(q,[q.Transaction.prototype]),mr(q,[q.Transaction.prototype],w(re),re),N.schema=re;var V,ee=ye(X);return ee&&Ot(),Z=ie.follow(function(){var ne;(V=X(N))&&ee&&(ne=tt.bind(null,null),V.then(ne,ne))}),V&&typeof V.then=="function"?ie.resolve(V):Z.then(function(){return V})}}),U.push(function(G){var Y,Z,X=W._cfg.dbschema;Y=X,Z=G,[].slice.call(Z.db.objectStoreNames).forEach(function(re){return Y[re]==null&&Z.db.deleteObjectStore(re)}),rn(q,[q.Transaction.prototype]),mr(q,[q.Transaction.prototype],q._storeNames,q._dbSchema),N.schema=q._dbSchema}),U.push(function(G){q.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(q.idbdb.version/10)===W._cfg.version?(q.idbdb.deleteObjectStore("$meta"),delete q._dbSchema.$meta,q._storeNames=q._storeNames.filter(function(Y){return Y!=="$meta"})):G.objectStore("$meta").put(W._cfg.version,"version"))})}),function W(){return U.length?ie.resolve(U.shift()(N.idbtrans)).then(W):ie.resolve()}().then(function(){ui(z,K)})):ie.resolve();var q,H,N,K,U,z}).catch(R)):(w(v).forEach(function(L){sn(l,L,v[L].primKey,v[L].indexes)}),pr(e,l),void ie.follow(function(){return e.on.populate.fire(O)}).catch(R));var F,M})}function ks(e,t){ui(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var l=yr(0,e.idbdb,t);br(e,e._dbSchema,t);for(var p=0,v=nn(l,e._dbSchema).change;p<v.length;p++){var O=function(R){if(R.change.length||R.recreate)return console.warn("Unable to patch indexes of table ".concat(R.name," because it has changes on the type of index or primary key.")),{value:void 0};var T=t.objectStore(R.name);R.add.forEach(function(F){Ue&&console.debug("Dexie upgrade patch: Creating missing index ".concat(R.name,".").concat(F.src)),gr(T,F)})}(v[p]);if(typeof O=="object")return O.value}}function nn(e,t){var l,p={del:[],add:[],change:[]};for(l in e)t[l]||p.del.push(l);for(l in t){var v=e[l],O=t[l];if(v){var R={name:l,def:O,recreate:!1,del:[],add:[],change:[]};if(""+(v.primKey.keyPath||"")!=""+(O.primKey.keyPath||"")||v.primKey.auto!==O.primKey.auto)R.recreate=!0,p.change.push(R);else{var T=v.idxByName,F=O.idxByName,M=void 0;for(M in T)F[M]||R.del.push(M);for(M in F){var L=T[M],q=F[M];L?L.src!==q.src&&R.change.push(q):R.add.push(q)}(0<R.del.length||0<R.add.length||0<R.change.length)&&p.change.push(R)}}else p.add.push([l,O])}return p}function sn(e,t,l,p){var v=e.db.createObjectStore(t,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});return p.forEach(function(O){return gr(v,O)}),v}function ui(e,t){w(e).forEach(function(l){t.db.objectStoreNames.contains(l)||(Ue&&console.debug("Dexie: Creating missing table",l),sn(t,l,e[l].primKey,e[l].indexes))})}function gr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function yr(e,t,l){var p={};return f(t.objectStoreNames,0).forEach(function(v){for(var O=l.objectStore(v),R=Vr(oi(M=O.keyPath),M||"",!0,!1,!!O.autoIncrement,M&&typeof M!="string",!0),T=[],F=0;F<O.indexNames.length;++F){var L=O.index(O.indexNames[F]),M=L.keyPath,L=Vr(L.name,M,!!L.unique,!!L.multiEntry,!1,M&&typeof M!="string",!1);T.push(L)}p[v]=en(v,R,T)}),p}function br(e,t,l){for(var p=l.db.objectStoreNames,v=0;v<p.length;++v){var O=p[v],R=l.objectStore(O);e._hasGetAll="getAll"in R;for(var T=0;T<R.indexNames.length;++T){var F=R.indexNames[T],M=R.index(F).keyPath,L=typeof M=="string"?M:"["+f(M).join("+")+"]";!t[O]||(M=t[O].idxByName[L])&&(M.name=F,delete t[O].idxByName[L],t[O].idxByName[F]=M)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&E.WorkerGlobalScope&&E instanceof E.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function ci(e){return e.split(",").map(function(t,l){var p=(t=t.trim()).replace(/([&*]|\+\+)/g,""),v=/^\[/.test(p)?p.match(/^\[(.*)\]$/)[1].split("+"):p;return Vr(p,v||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),c(v),l===0)})}var As=(vr.prototype._parseStoresSpec=function(e,t){w(e).forEach(function(l){if(e[l]!==null){var p=ci(e[l]),v=p.shift();if(v.unique=!0,v.multi)throw new ue.Schema("Primary key cannot be multi-valued");p.forEach(function(O){if(O.auto)throw new ue.Schema("Only primary key can be marked as autoIncrement (++)");if(!O.keyPath)throw new ue.Schema("Index must have a name and cannot be an empty string")}),t[l]=en(l,v,p)}})},vr.prototype.stores=function(l){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?A(this._cfg.storesSource,l):l;var l=t._versions,p={},v={};return l.forEach(function(O){A(p,O._cfg.storesSource),v=O._cfg.dbschema={},O._parseStoresSpec(p,v)}),t._dbSchema=v,rn(t,[t._allTables,t,t.Transaction.prototype]),mr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],w(v),v),t._storeNames=w(v),this},vr.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Nr(this._cfg.contentUpgrade||_e,e),this},vr);function vr(){}function an(e,t){var l=e._dbNamesDB;return l||(l=e._dbNamesDB=new Ze(ur,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function on(e){return e&&typeof e.databases=="function"}function ln(e){return et(function(){return le.letThrough=!0,e()})}function un(e){return!("from"in e)}var Pe=function(e,t){if(!this){var l=new Pe;return e&&"d"in e&&A(l,e),l}A(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Ut(e,t,l){var p=ge(t,l);if(!isNaN(p)){if(0<p)throw RangeError();if(un(e))return A(e,{from:t,to:l,d:1});var v=e.l,p=e.r;if(ge(l,e.from)<0)return v?Ut(v,t,l):e.l={from:t,to:l,d:1,l:null,r:null},di(e);if(0<ge(t,e.to))return p?Ut(p,t,l):e.r={from:t,to:l,d:1,l:null,r:null},di(e);ge(t,e.from)<0&&(e.from=t,e.l=null,e.d=p?p.d+1:1),0<ge(l,e.to)&&(e.to=l,e.r=null,e.d=e.l?e.l.d+1:1),l=!e.r,v&&!e.l&&Ht(e,v),p&&l&&Ht(e,p)}}function Ht(e,t){un(t)||function l(p,F){var O=F.from,R=F.to,T=F.l,F=F.r;Ut(p,O,R),T&&l(p,T),F&&l(p,F)}(e,t)}function fi(e,t){var l=_r(t),p=l.next();if(p.done)return!1;for(var v=p.value,O=_r(e),R=O.next(v.from),T=R.value;!p.done&&!R.done;){if(ge(T.from,v.to)<=0&&0<=ge(T.to,v.from))return!0;ge(v.from,T.from)<0?v=(p=l.next(T.from)).value:T=(R=O.next(v.from)).value}return!1}function _r(e){var t=un(e)?null:{s:0,n:e};return{next:function(l){for(var p=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,p)for(;t.n.l&&ge(l,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!p||ge(l,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function di(e){var t,l,p=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((l=e.l)===null||l===void 0?void 0:l.d)||0),v=1<p?"r":p<-1?"l":"";v&&(t=v=="r"?"l":"r",l=D({},e),p=e[v],e.from=p.from,e.to=p.to,e[v]=p[v],l[v]=p[t],(e[t]=l).d=hi(l)),e.d=hi(e)}function hi(l){var t=l.r,l=l.l;return(t?l?Math.max(t.d,l.d):t.d:l?l.d:0)+1}function wr(e,t){return w(t).forEach(function(l){e[l]?Ht(e[l],t[l]):e[l]=function p(v){var O,R,T={};for(O in v)r(v,O)&&(R=v[O],T[O]=!R||typeof R!="object"||B.has(R.constructor)?R:p(R));return T}(t[l])}),e}function cn(e,t){return e.all||t.all||Object.keys(e).some(function(l){return t[l]&&fi(t[l],e[l])})}o(Pe.prototype,((Be={add:function(e){return Ht(this,e),this},addKey:function(e){return Ut(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(l){return Ut(t,l,l)}),this},hasKey:function(e){var t=_r(this).next(e).value;return t&&ge(t.from,e)<=0&&0<=ge(t.to,e)}})[de]=function(){return _r(this)},Be));var pt={},fn={},dn=!1;function xr(e){wr(fn,e),dn||(dn=!0,setTimeout(function(){dn=!1,hn(fn,!(fn={}))},0))}function hn(e,t){t===void 0&&(t=!1);var l=new Set;if(e.all)for(var p=0,v=Object.values(pt);p<v.length;p++)pi(R=v[p],e,l,t);else for(var O in e){var R,T=/^idb\:\/\/(.*)\/(.*)\//.exec(O);T&&(O=T[1],T=T[2],(R=pt["idb://".concat(O,"/").concat(T)])&&pi(R,e,l,t))}l.forEach(function(F){return F()})}function pi(e,t,l,p){for(var v=[],O=0,R=Object.entries(e.queries.query);O<R.length;O++){for(var T=R[O],F=T[0],M=[],L=0,q=T[1];L<q.length;L++){var H=q[L];cn(t,H.obsSet)?H.subscribers.forEach(function(z){return l.add(z)}):p&&M.push(H)}p&&v.push([F,M])}if(p)for(var N=0,K=v;N<K.length;N++){var U=K[N],F=U[0],M=U[1];e.queries.query[F]=M}}function Ss(e){var t=e._state,l=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?ke(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var p=t.openCanceller,v=Math.round(10*e.verno),O=!1;function R(){if(t.openCanceller!==p)throw new ue.DatabaseClosed("db.open() was cancelled")}function T(){return new ie(function(H,N){if(R(),!l)throw new ue.MissingAPI;var K=e.name,U=t.autoSchema||!v?l.open(K):l.open(K,v);if(!U)throw new ue.MissingAPI;U.onerror=He(N),U.onblocked=$e(e._fireOnBlocked),U.onupgradeneeded=$e(function(z){var W;L=U.transaction,t.autoSchema&&!e._options.allowEmptyDB?(U.onerror=Bt,L.abort(),U.result.close(),(W=l.deleteDatabase(K)).onsuccess=W.onerror=$e(function(){N(new ue.NoSuchDatabase("Database ".concat(K," doesnt exist")))})):(L.onerror=He(N),z=z.oldVersion>Math.pow(2,62)?0:z.oldVersion,q=z<1,e.idbdb=U.result,O&&ks(e,L),Os(e,z/10,L,N))},N),U.onsuccess=$e(function(){L=null;var z,W,G,Y,Z,X=e.idbdb=U.result,re=f(X.objectStoreNames);if(0<re.length)try{var V=X.transaction((Y=re).length===1?Y[0]:Y,"readonly");if(t.autoSchema)W=X,G=V,(z=e).verno=W.version/10,G=z._dbSchema=yr(0,W,G),z._storeNames=f(W.objectStoreNames,0),mr(z,[z._allTables],w(G),G);else if(br(e,e._dbSchema,V),((Z=nn(yr(0,(Z=e).idbdb,V),Z._dbSchema)).add.length||Z.change.some(function(ee){return ee.add.length||ee.change.length}))&&!O)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),X.close(),v=X.version+1,O=!0,H(T());pr(e,V)}catch{}kt.push(e),X.onversionchange=$e(function(ee){t.vcFired=!0,e.on("versionchange").fire(ee)}),X.onclose=$e(function(ee){e.on("close").fire(ee)}),q&&(Z=e._deps,V=K,X=Z.indexedDB,Z=Z.IDBKeyRange,on(X)||V===ur||an(X,Z).put({name:V}).catch(_e)),H()},N)}).catch(function(H){switch(H==null?void 0:H.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),T();break;case"VersionError":if(0<v)return v=0,T()}return ie.reject(H)})}var F,M=t.dbReadyResolve,L=null,q=!1;return ie.race([p,(typeof navigator>"u"?ie.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(H){function N(){return indexedDB.databases().finally(H)}F=setInterval(N,100),N()}).finally(function(){return clearInterval(F)}):Promise.resolve()).then(T)]).then(function(){return R(),t.onReadyBeingFired=[],ie.resolve(ln(function(){return e.on.ready.fire(e.vip)})).then(function H(){if(0<t.onReadyBeingFired.length){var N=t.onReadyBeingFired.reduce(Nr,_e);return t.onReadyBeingFired=[],ie.resolve(ln(function(){return N(e.vip)})).then(H)}})}).finally(function(){t.openCanceller===p&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(H){t.dbOpenError=H;try{L&&L.abort()}catch{}return p===t.openCanceller&&e._close(),ke(H)}).finally(function(){t.openComplete=!0,M()}).then(function(){var H;return q&&(H={},e.tables.forEach(function(N){N.schema.indexes.forEach(function(K){K.name&&(H["idb://".concat(e.name,"/").concat(N.name,"/").concat(K.name)]=new Pe(-1/0,[[[]]]))}),H["idb://".concat(e.name,"/").concat(N.name,"/")]=H["idb://".concat(e.name,"/").concat(N.name,"/:dels")]=new Pe(-1/0,[[[]]])}),it(zt).fire(H),hn(H,!0)),e})}function pn(e){function t(O){return e.next(O)}var l=v(t),p=v(function(O){return e.throw(O)});function v(O){return function(F){var T=O(F),F=T.value;return T.done?F:F&&typeof F.then=="function"?F.then(l,p):c(F)?Promise.all(F).then(l,p):l(F)}}return v(t)()}function $r(e,t,l){for(var p=c(e)?e.slice():[e],v=0;v<l;++v)p.push(t);return p}var js={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return D(D({},e),{table:function(t){var l=e.table(t),p=l.schema,v={},O=[];function R(q,H,N){var K=Lt(q),U=v[K]=v[K]||[],z=q==null?0:typeof q=="string"?1:q.length,W=0<H,W=D(D({},N),{name:W?"".concat(K,"(virtual-from:").concat(N.name,")"):N.name,lowLevelIndex:N,isVirtual:W,keyTail:H,keyLength:z,extractKey:tn(q),unique:!W&&N.unique});return U.push(W),W.isPrimaryKey||O.push(W),1<z&&R(z===2?q[0]:q.slice(0,z-1),H+1,N),U.sort(function(G,Y){return G.keyTail-Y.keyTail}),W}t=R(p.primaryKey.keyPath,0,p.primaryKey),v[":id"]=[t];for(var T=0,F=p.indexes;T<F.length;T++){var M=F[T];R(M.keyPath,0,M)}function L(q){var H,N=q.query.index;return N.isVirtual?D(D({},q),{query:{index:N.lowLevelIndex,range:(H=q.query.range,N=N.keyTail,{type:H.type===1?2:H.type,lower:$r(H.lower,H.lowerOpen?e.MAX_KEY:e.MIN_KEY,N),lowerOpen:!0,upper:$r(H.upper,H.upperOpen?e.MIN_KEY:e.MAX_KEY,N),upperOpen:!0})}}):q}return D(D({},l),{schema:D(D({},p),{primaryKey:t,indexes:O,getIndexByKeyPath:function(q){return(q=v[Lt(q)])&&q[0]}}),count:function(q){return l.count(L(q))},query:function(q){return l.query(L(q))},openCursor:function(q){var H=q.query.index,N=H.keyTail,K=H.isVirtual,U=H.keyLength;return K?l.openCursor(L(q)).then(function(W){return W&&z(W)}):l.openCursor(q);function z(W){return Object.create(W,{continue:{value:function(G){G!=null?W.continue($r(G,q.reverse?e.MAX_KEY:e.MIN_KEY,N)):q.unique?W.continue(W.key.slice(0,U).concat(q.reverse?e.MIN_KEY:e.MAX_KEY,N)):W.continue()}},continuePrimaryKey:{value:function(G,Y){W.continuePrimaryKey($r(G,e.MAX_KEY,N),Y)}},primaryKey:{get:function(){return W.primaryKey}},key:{get:function(){var G=W.key;return U===1?G[0]:G.slice(0,U)}},value:{get:function(){return W.value}}})}}})}})}};function mn(e,t,l,p){return l=l||{},p=p||"",w(e).forEach(function(v){var O,R,T;r(t,v)?(O=e[v],R=t[v],typeof O=="object"&&typeof R=="object"&&O&&R?(T=oe(O))!==oe(R)?l[p+v]=t[v]:T==="Object"?mn(O,R,l,p+v+"."):O!==R&&(l[p+v]=t[v]):O!==R&&(l[p+v]=t[v])):l[p+v]=void 0}),w(t).forEach(function(v){r(e,v)||(l[p+v]=t[v])}),l}function gn(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Es={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return D(D({},e),{table:function(t){var l=e.table(t),p=l.schema.primaryKey;return D(D({},l),{mutate:function(v){var O=le.trans,R=O.table(t).hook,T=R.deleting,F=R.creating,M=R.updating;switch(v.type){case"add":if(F.fire===_e)break;return O._promise("readwrite",function(){return L(v)},!0);case"put":if(F.fire===_e&&M.fire===_e)break;return O._promise("readwrite",function(){return L(v)},!0);case"delete":if(T.fire===_e)break;return O._promise("readwrite",function(){return L(v)},!0);case"deleteRange":if(T.fire===_e)break;return O._promise("readwrite",function(){return function q(H,N,K){return l.query({trans:H,values:!1,query:{index:p,range:N},limit:K}).then(function(U){var z=U.result;return L({type:"delete",keys:z,trans:H}).then(function(W){return 0<W.numFailures?Promise.reject(W.failures[0]):z.length<K?{failures:[],numFailures:0,lastResult:void 0}:q(H,D(D({},N),{lower:z[z.length-1],lowerOpen:!0}),K)})})}(v.trans,v.range,1e4)},!0)}return l.mutate(v);function L(q){var H,N,K,U=le.trans,z=q.keys||gn(p,q);if(!z)throw new Error("Keys missing");return(q=q.type==="add"||q.type==="put"?D(D({},q),{keys:z}):D({},q)).type!=="delete"&&(q.values=P([],q.values)),q.keys&&(q.keys=P([],q.keys)),H=l,K=z,((N=q).type==="add"?Promise.resolve([]):H.getMany({trans:N.trans,keys:K,cache:"immutable"})).then(function(W){var G=z.map(function(Y,Z){var X,re,V,ee=W[Z],ne={onerror:null,onsuccess:null};return q.type==="delete"?T.fire.call(ne,Y,ee,U):q.type==="add"||ee===void 0?(X=F.fire.call(ne,Y,q.values[Z],U),Y==null&&X!=null&&(q.keys[Z]=Y=X,p.outbound||C(q.values[Z],p.keyPath,Y))):(X=mn(ee,q.values[Z]),(re=M.fire.call(ne,X,Y,ee,U))&&(V=q.values[Z],Object.keys(re).forEach(function(te){r(V,te)?V[te]=re[te]:C(V,te,re[te])}))),ne});return l.mutate(q).then(function(Y){for(var Z=Y.failures,X=Y.results,re=Y.numFailures,Y=Y.lastResult,V=0;V<z.length;++V){var ee=(X||z)[V],ne=G[V];ee==null?ne.onerror&&ne.onerror(Z[V]):ne.onsuccess&&ne.onsuccess(q.type==="put"&&W[V]?q.values[V]:ee)}return{failures:Z,results:X,numFailures:re,lastResult:Y}}).catch(function(Y){return G.forEach(function(Z){return Z.onerror&&Z.onerror(Y)}),Promise.reject(Y)})})}}})}})}};function mi(e,t,l){try{if(!t||t.keys.length<e.length)return null;for(var p=[],v=0,O=0;v<t.keys.length&&O<e.length;++v)ge(t.keys[v],e[O])===0&&(p.push(l?J(t.values[v]):t.values[v]),++O);return p.length===e.length?p:null}catch{return null}}var Ds={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var l=e.table(t);return D(D({},l),{getMany:function(p){if(!p.cache)return l.getMany(p);var v=mi(p.keys,p.trans._cache,p.cache==="clone");return v?ie.resolve(v):l.getMany(p).then(function(O){return p.trans._cache={keys:p.keys,values:p.cache==="clone"?J(O):O},O})},mutate:function(p){return p.type!=="add"&&(p.trans._cache=null),l.mutate(p)}})}}}};function gi(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function yi(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Rs={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,l=new Pe(e.MIN_KEY,e.MAX_KEY);return D(D({},e),{transaction:function(p,v,O){if(le.subscr&&v!=="readonly")throw new ue.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(le.querier));return e.transaction(p,v,O)},table:function(p){var v=e.table(p),O=v.schema,R=O.primaryKey,q=O.indexes,T=R.extractKey,F=R.outbound,M=R.autoIncrement&&q.filter(function(N){return N.compound&&N.keyPath.includes(R.keyPath)}),L=D(D({},v),{mutate:function(N){function K(te){return te="idb://".concat(t,"/").concat(p,"/").concat(te),Y[te]||(Y[te]=new Pe)}var U,z,W,G=N.trans,Y=N.mutatedParts||(N.mutatedParts={}),Z=K(""),X=K(":dels"),re=N.type,ne=N.type==="deleteRange"?[N.range]:N.type==="delete"?[N.keys]:N.values.length<50?[gn(R,N).filter(function(te){return te}),N.values]:[],V=ne[0],ee=ne[1],ne=N.trans._cache;return c(V)?(Z.addKeys(V),(ne=re==="delete"||V.length===ee.length?mi(V,ne):null)||X.addKeys(V),(ne||ee)&&(U=K,z=ne,W=ee,O.indexes.forEach(function(te){var se=U(te.name||"");function fe(pe){return pe!=null?te.extractKey(pe):null}function he(pe){return te.multiEntry&&c(pe)?pe.forEach(function(Me){return se.addKey(Me)}):se.addKey(pe)}(z||W).forEach(function(pe,Ie){var ce=z&&fe(z[Ie]),Ie=W&&fe(W[Ie]);ge(ce,Ie)!==0&&(ce!=null&&he(ce),Ie!=null&&he(Ie))})}))):V?(ee={from:(ee=V.lower)!==null&&ee!==void 0?ee:e.MIN_KEY,to:(ee=V.upper)!==null&&ee!==void 0?ee:e.MAX_KEY},X.add(ee),Z.add(ee)):(Z.add(l),X.add(l),O.indexes.forEach(function(te){return K(te.name).add(l)})),v.mutate(N).then(function(te){return!V||N.type!=="add"&&N.type!=="put"||(Z.addKeys(te.results),M&&M.forEach(function(se){for(var fe=N.values.map(function(ce){return se.extractKey(ce)}),he=se.keyPath.findIndex(function(ce){return ce===R.keyPath}),pe=0,Me=te.results.length;pe<Me;++pe)fe[pe][he]=te.results[pe];K(se.name).addKeys(fe)})),G.mutatedParts=wr(G.mutatedParts||{},Y),te})}}),q=function(K){var U=K.query,K=U.index,U=U.range;return[K,new Pe((K=U.lower)!==null&&K!==void 0?K:e.MIN_KEY,(U=U.upper)!==null&&U!==void 0?U:e.MAX_KEY)]},H={get:function(N){return[R,new Pe(N.key)]},getMany:function(N){return[R,new Pe().addKeys(N.keys)]},count:q,query:q,openCursor:q};return w(H).forEach(function(N){L[N]=function(K){var U=le.subscr,z=!!U,W=gi(le,v)&&yi(N,K)?K.obsSet={}:U;if(z){var G=function(ee){return ee="idb://".concat(t,"/").concat(p,"/").concat(ee),W[ee]||(W[ee]=new Pe)},Y=G(""),Z=G(":dels"),U=H[N](K),z=U[0],U=U[1];if((N==="query"&&z.isPrimaryKey&&!K.values?Z:G(z.name||"")).add(U),!z.isPrimaryKey){if(N!=="count"){var X=N==="query"&&F&&K.values&&v.query(D(D({},K),{values:!1}));return v[N].apply(this,arguments).then(function(ee){if(N==="query"){if(F&&K.values)return X.then(function(fe){return fe=fe.result,Y.addKeys(fe),ee});var ne=K.values?ee.result.map(T):ee.result;(K.values?Y:Z).addKeys(ne)}else if(N==="openCursor"){var te=ee,se=K.values;return te&&Object.create(te,{key:{get:function(){return Z.addKey(te.primaryKey),te.key}},primaryKey:{get:function(){var fe=te.primaryKey;return Z.addKey(fe),fe}},value:{get:function(){return se&&Y.addKey(te.primaryKey),te.value}}})}return ee})}Z.add(l)}}return v[N].apply(this,arguments)}}),L}})}};function bi(e,t,l){if(l.numFailures===0)return t;if(t.type==="deleteRange")return null;var p=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return l.numFailures===p?null:(t=D({},t),c(t.keys)&&(t.keys=t.keys.filter(function(v,O){return!(O in l.failures)})),"values"in t&&c(t.values)&&(t.values=t.values.filter(function(v,O){return!(O in l.failures)})),t)}function yn(e,t){return l=e,((p=t).lower===void 0||(p.lowerOpen?0<ge(l,p.lower):0<=ge(l,p.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?ge(e,t.upper)<0:ge(e,t.upper)<=0));var l,p}function vi(e,t,H,p,v,O){if(!H||H.length===0)return e;var R=t.query.index,T=R.multiEntry,F=t.query.range,M=p.schema.primaryKey.extractKey,L=R.extractKey,q=(R.lowLevelIndex||R).extractKey,H=H.reduce(function(N,K){var U=N,z=[];if(K.type==="add"||K.type==="put")for(var W=new Pe,G=K.values.length-1;0<=G;--G){var Y,Z=K.values[G],X=M(Z);W.hasKey(X)||(Y=L(Z),(T&&c(Y)?Y.some(function(te){return yn(te,F)}):yn(Y,F))&&(W.addKey(X),z.push(Z)))}switch(K.type){case"add":var re=new Pe().addKeys(t.values?N.map(function(se){return M(se)}):N),U=N.concat(t.values?z.filter(function(se){return se=M(se),!re.hasKey(se)&&(re.addKey(se),!0)}):z.map(function(se){return M(se)}).filter(function(se){return!re.hasKey(se)&&(re.addKey(se),!0)}));break;case"put":var V=new Pe().addKeys(K.values.map(function(se){return M(se)}));U=N.filter(function(se){return!V.hasKey(t.values?M(se):se)}).concat(t.values?z:z.map(function(se){return M(se)}));break;case"delete":var ee=new Pe().addKeys(K.keys);U=N.filter(function(se){return!ee.hasKey(t.values?M(se):se)});break;case"deleteRange":var ne=K.range;U=N.filter(function(se){return!yn(M(se),ne)})}return U},e);return H===e?e:(H.sort(function(N,K){return ge(q(N),q(K))||ge(M(N),M(K))}),t.limit&&t.limit<1/0&&(H.length>t.limit?H.length=t.limit:e.length===t.limit&&H.length<t.limit&&(v.dirty=!0)),O?Object.freeze(H):H)}function _i(e,t){return ge(e.lower,t.lower)===0&&ge(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Cs(e,t){return function(l,p,v,O){if(l===void 0)return p!==void 0?-1:0;if(p===void 0)return 1;if((p=ge(l,p))===0){if(v&&O)return 0;if(v)return 1;if(O)return-1}return p}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(l,p,v,O){if(l===void 0)return p!==void 0?1:0;if(p===void 0)return-1;if((p=ge(l,p))===0){if(v&&O)return 0;if(v)return-1;if(O)return 1}return p}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Ps(e,t,l,p){e.subscribers.add(l),p.addEventListener("abort",function(){var v,O;e.subscribers.delete(l),e.subscribers.size===0&&(v=e,O=t,setTimeout(function(){v.subscribers.size===0&&we(O,v)},3e3))})}var Is={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return D(D({},e),{transaction:function(l,p,v){var O,R,T=e.transaction(l,p,v);return p==="readwrite"&&(R=(O=new AbortController).signal,v=function(F){return function(){if(O.abort(),p==="readwrite"){for(var M=new Set,L=0,q=l;L<q.length;L++){var H=q[L],N=pt["idb://".concat(t,"/").concat(H)];if(N){var K=e.table(H),U=N.optimisticOps.filter(function(se){return se.trans===T});if(T._explicit&&F&&T.mutatedParts)for(var z=0,W=Object.values(N.queries.query);z<W.length;z++)for(var G=0,Y=(re=W[z]).slice();G<Y.length;G++)cn((V=Y[G]).obsSet,T.mutatedParts)&&(we(re,V),V.subscribers.forEach(function(se){return M.add(se)}));else if(0<U.length){N.optimisticOps=N.optimisticOps.filter(function(se){return se.trans!==T});for(var Z=0,X=Object.values(N.queries.query);Z<X.length;Z++)for(var re,V,ee,ne=0,te=(re=X[Z]).slice();ne<te.length;ne++)(V=te[ne]).res!=null&&T.mutatedParts&&(F&&!V.dirty?(ee=Object.isFrozen(V.res),ee=vi(V.res,V.req,U,K,V,ee),V.dirty?(we(re,V),V.subscribers.forEach(function(se){return M.add(se)})):ee!==V.res&&(V.res=ee,V.promise=ie.resolve({result:ee}))):(V.dirty&&we(re,V),V.subscribers.forEach(function(se){return M.add(se)})))}}}M.forEach(function(se){return se()})}}},T.addEventListener("abort",v(!1),{signal:R}),T.addEventListener("error",v(!1),{signal:R}),T.addEventListener("complete",v(!0),{signal:R})),T},table:function(l){var p=e.table(l),v=p.schema.primaryKey;return D(D({},p),{mutate:function(O){var R=le.trans;if(v.outbound||R.db._options.cache==="disabled"||R.explicit||R.idbtrans.mode!=="readwrite")return p.mutate(O);var T=pt["idb://".concat(t,"/").concat(l)];return T?(R=p.mutate(O),O.type!=="add"&&O.type!=="put"||!(50<=O.values.length||gn(v,O).some(function(F){return F==null}))?(T.optimisticOps.push(O),O.mutatedParts&&xr(O.mutatedParts),R.then(function(F){0<F.numFailures&&(we(T.optimisticOps,O),(F=bi(0,O,F))&&T.optimisticOps.push(F),O.mutatedParts&&xr(O.mutatedParts))}),R.catch(function(){we(T.optimisticOps,O),O.mutatedParts&&xr(O.mutatedParts)})):R.then(function(F){var M=bi(0,D(D({},O),{values:O.values.map(function(L,q){var H;return F.failures[q]?L:(L=(H=v.keyPath)!==null&&H!==void 0&&H.includes(".")?J(L):D({},L),C(L,v.keyPath,F.results[q]),L)})}),F);T.optimisticOps.push(M),queueMicrotask(function(){return O.mutatedParts&&xr(O.mutatedParts)})}),R):p.mutate(O)},query:function(O){if(!gi(le,p)||!yi("query",O))return p.query(O);var R=((M=le.trans)===null||M===void 0?void 0:M.db._options.cache)==="immutable",q=le,T=q.requery,F=q.signal,M=function(K,U,z,W){var G=pt["idb://".concat(K,"/").concat(U)];if(!G)return[];if(!(U=G.queries[z]))return[null,!1,G,null];var Y=U[(W.query?W.query.index.name:null)||""];if(!Y)return[null,!1,G,null];switch(z){case"query":var Z=Y.find(function(X){return X.req.limit===W.limit&&X.req.values===W.values&&_i(X.req.query.range,W.query.range)});return Z?[Z,!0,G,Y]:[Y.find(function(X){return("limit"in X.req?X.req.limit:1/0)>=W.limit&&(!W.values||X.req.values)&&Cs(X.req.query.range,W.query.range)}),!1,G,Y];case"count":return Z=Y.find(function(X){return _i(X.req.query.range,W.query.range)}),[Z,!!Z,G,Y]}}(t,l,"query",O),L=M[0],q=M[1],H=M[2],N=M[3];return L&&q?L.obsSet=O.obsSet:(q=p.query(O).then(function(K){var U=K.result;if(L&&(L.res=U),R){for(var z=0,W=U.length;z<W;++z)Object.freeze(U[z]);Object.freeze(U)}else K.result=J(U);return K}).catch(function(K){return N&&L&&we(N,L),Promise.reject(K)}),L={obsSet:O.obsSet,promise:q,subscribers:new Set,type:"query",req:O,dirty:!1},N?N.push(L):(N=[L],(H=H||(pt["idb://".concat(t,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[O.query.index.name||""]=N)),Ps(L,N,T,F),L.promise.then(function(K){return{result:vi(K.result,O,H==null?void 0:H.optimisticOps,p,L,R)}})}})}})}};function Or(e,t){return new Proxy(e,{get:function(l,p,v){return p==="db"?t:Reflect.get(l,p,v)}})}var Ze=(Ae.prototype.version=function(e){if(isNaN(e)||e<.1)throw new ue.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ue.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,l=t.filter(function(p){return p._cfg.version===e})[0];return l||(l=new this.Version(e),t.push(l),t.sort($s),l.stores({}),this._state.autoSchema=!1,l)},Ae.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||le.letThrough||this._vip)?e():new ie(function(l,p){if(t._state.openComplete)return p(new ue.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void p(new ue.DatabaseClosed);t.open().catch(_e)}t._state.dbReadyPromise.then(l,p)}).then(e)},Ae.prototype.use=function(e){var t=e.stack,l=e.create,p=e.level,v=e.name;return v&&this.unuse({stack:t,name:v}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:l,level:p??10,name:v}),e.sort(function(O,R){return O.level-R.level}),this},Ae.prototype.unuse=function(e){var t=e.stack,l=e.name,p=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(v){return p?v.create!==p:!!l&&v.name!==l})),this},Ae.prototype.open=function(){var e=this;return ft(Ve,function(){return Ss(e)})},Ae.prototype._close=function(){var e=this._state,t=kt.indexOf(this);if(0<=t&&kt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new ie(function(l){e.dbReadyResolve=l}),e.openCanceller=new ie(function(l,p){e.cancelOpen=p}))},Ae.prototype.close=function(l){var t=(l===void 0?{disableAutoOpen:!0}:l).disableAutoOpen,l=this._state;t?(l.isBeingOpened&&l.cancelOpen(new ue.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new ue.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Ae.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var l=0<arguments.length&&typeof arguments[0]!="object",p=this._state;return new ie(function(v,O){function R(){t.close(e);var T=t._deps.indexedDB.deleteDatabase(t.name);T.onsuccess=$e(function(){var F,M,L;F=t._deps,M=t.name,L=F.indexedDB,F=F.IDBKeyRange,on(L)||M===ur||an(L,F).delete(M).catch(_e),v()}),T.onerror=He(O),T.onblocked=t._fireOnBlocked}if(l)throw new ue.InvalidArgument("Invalid closeOptions argument to db.delete()");p.isBeingOpened?p.dbReadyPromise.then(R):R()})},Ae.prototype.backendDB=function(){return this.idbdb},Ae.prototype.isOpen=function(){return this.idbdb!==null},Ae.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},Ae.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ae.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ae.prototype,"tables",{get:function(){var e=this;return w(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),Ae.prototype.transaction=function(){var e=(function(t,l,p){var v=arguments.length;if(v<2)throw new ue.InvalidArgument("Too few arguments");for(var O=new Array(v-1);--v;)O[v-1]=arguments[v];return p=O.pop(),[t,j(O),p]}).apply(this,arguments);return this._transaction.apply(this,e)},Ae.prototype._transaction=function(e,t,l){var p=this,v=le.trans;v&&v.db===this&&e.indexOf("!")===-1||(v=null);var O,R,T=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(R=t.map(function(M){if(M=M instanceof p.Table?M.name:M,typeof M!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return M}),e=="r"||e===Gr)O=Gr;else{if(e!="rw"&&e!=Yr)throw new ue.InvalidArgument("Invalid transaction mode: "+e);O=Yr}if(v){if(v.mode===Gr&&O===Yr){if(!T)throw new ue.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");v=null}v&&R.forEach(function(M){if(v&&v.storeNames.indexOf(M)===-1){if(!T)throw new ue.SubTransaction("Table "+M+" not included in parent transaction.");v=null}}),T&&v&&!v.active&&(v=null)}}catch(M){return v?v._promise(null,function(L,q){q(M)}):ke(M)}var F=(function M(L,q,H,N,K){return ie.resolve().then(function(){var U=le.transless||le,z=L._createTransaction(q,H,L._dbSchema,N);if(z.explicit=!0,U={trans:z,transless:U},N)z.idbtrans=N.idbtrans;else try{z.create(),z.idbtrans._explicit=!0,L._state.PR1398_maxLoop=3}catch(Y){return Y.name===Ge.InvalidState&&L.isOpen()&&0<--L._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),L.close({disableAutoOpen:!1}),L.open().then(function(){return M(L,q,H,null,K)})):ke(Y)}var W,G=ye(K);return G&&Ot(),U=ie.follow(function(){var Y;(W=K.call(z,z))&&(G?(Y=tt.bind(null,null),W.then(Y,Y)):typeof W.next=="function"&&typeof W.throw=="function"&&(W=pn(W)))},U),(W&&typeof W.then=="function"?ie.resolve(W).then(function(Y){return z.active?Y:ke(new ue.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):U.then(function(){return W})).then(function(Y){return N&&z._resolve(),z._completion.then(function(){return Y})}).catch(function(Y){return z._reject(Y),ke(Y)})})}).bind(null,this,O,R,v,l);return v?v._promise(O,F,"lock"):le.trans?ft(le.transless,function(){return p._whenReady(F)}):this._whenReady(F)},Ae.prototype.table=function(e){if(!r(this._allTables,e))throw new ue.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},Ae);function Ae(e,t){var l=this;this._middlewares={},this.verno=0;var p=Ae.dependencies;this._options=t=D({addons:Ae.addons,autoOpen:!0,indexedDB:p.indexedDB,IDBKeyRange:p.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},p=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var v,O,R,T,F,M={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:_e,dbReadyPromise:null,cancelOpen:_e,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};M.dbReadyPromise=new ie(function(q){M.dbReadyResolve=q}),M.openCanceller=new ie(function(q,H){M.cancelOpen=H}),this._state=M,this.name=e,this.on=Ft(this,"populate","blocked","versionchange","close",{ready:[Nr,_e]}),this.on.ready.subscribe=y(this.on.ready.subscribe,function(q){return function(H,N){Ae.vip(function(){var K,U=l._state;U.openComplete?(U.dbOpenError||ie.resolve().then(H),N&&q(H)):U.onReadyBeingFired?(U.onReadyBeingFired.push(H),N&&q(H)):(q(H),K=l,N||q(function z(){K.on.ready.unsubscribe(H),K.on.ready.unsubscribe(z)}))})}}),this.Collection=(v=this,Nt(gs.prototype,function(W,z){this.db=v;var N=Jn,K=null;if(z)try{N=z()}catch(G){K=G}var U=W._ctx,z=U.table,W=z.hook.reading.fire;this._ctx={table:z,index:U.index,isPrimKey:!U.index||z.schema.primKey.keyPath&&U.index===z.schema.primKey.name,range:N,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:K,or:U.or,valueMapper:W!==Ct?W:null}})),this.Table=(O=this,Nt(ti.prototype,function(q,H,N){this.db=O,this._tx=N,this.name=q,this.schema=H,this.hook=O._allTables[q]?O._allTables[q].hook:Ft(null,{creating:[os,_e],reading:[as,Ct],updating:[us,_e],deleting:[ls,_e]})})),this.Transaction=(R=this,Nt(vs.prototype,function(q,H,N,K,U){var z=this;this.db=R,this.mode=q,this.storeNames=H,this.schema=N,this.chromeTransactionDurability=K,this.idbtrans=null,this.on=Ft(this,"complete","error","abort"),this.parent=U||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ie(function(W,G){z._resolve=W,z._reject=G}),this._completion.then(function(){z.active=!1,z.on.complete.fire()},function(W){var G=z.active;return z.active=!1,z.on.error.fire(W),z.parent?z.parent._reject(W):G&&z.idbtrans&&z.idbtrans.abort(),ke(W)})})),this.Version=(T=this,Nt(As.prototype,function(q){this.db=T,this._cfg={version:q,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(F=this,Nt(ai.prototype,function(q,H,N){if(this.db=F,this._ctx={table:q,index:H===":id"?null:H,or:N},this._cmp=this._ascending=ge,this._descending=function(K,U){return ge(U,K)},this._max=function(K,U){return 0<ge(K,U)?K:U},this._min=function(K,U){return ge(K,U)<0?K:U},this._IDBKeyRange=F._deps.IDBKeyRange,!this._IDBKeyRange)throw new ue.MissingAPI})),this.on("versionchange",function(q){0<q.newVersion?console.warn("Another connection wants to upgrade database '".concat(l.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(l.name,"'. Closing db now to resume the delete request.")),l.close({disableAutoOpen:!1})}),this.on("blocked",function(q){!q.newVersion||q.newVersion<q.oldVersion?console.warn("Dexie.delete('".concat(l.name,"') was blocked")):console.warn("Upgrade '".concat(l.name,"' blocked by other connection holding version ").concat(q.oldVersion/10))}),this._maxKey=Kt(t.IDBKeyRange),this._createTransaction=function(q,H,N,K){return new l.Transaction(q,H,N,l._options.chromeTransactionDurability,K)},this._fireOnBlocked=function(q){l.on("blocked").fire(q),kt.filter(function(H){return H.name===l.name&&H!==l&&!H._state.vcFired}).map(function(H){return H.on("versionchange").fire(q)})},this.use(Ds),this.use(Is),this.use(Rs),this.use(js),this.use(Es);var L=new Proxy(this,{get:function(q,H,N){if(H==="_vip")return!0;if(H==="table")return function(U){return Or(l.table(U),L)};var K=Reflect.get(q,H,N);return K instanceof ti?Or(K,L):H==="tables"?K.map(function(U){return Or(U,L)}):H==="_createTransaction"?function(){return Or(K.apply(this,arguments),L)}:K}});this.vip=L,p.forEach(function(q){return q(l)})}var kr,Be=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ts=(bn.prototype.subscribe=function(e,t,l){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:l})},bn.prototype[Be]=function(){return this},bn);function bn(e){this._subscribe=e}try{kr={indexedDB:E.indexedDB||E.mozIndexedDB||E.webkitIndexedDB||E.msIndexedDB,IDBKeyRange:E.IDBKeyRange||E.webkitIDBKeyRange}}catch{kr={indexedDB:null,IDBKeyRange:null}}function wi(e){var t,l=!1,p=new Ts(function(v){var O=ye(e),R,T=!1,F={},M={},L={get closed(){return T},unsubscribe:function(){T||(T=!0,R&&R.abort(),q&&it.storagemutated.unsubscribe(N))}};v.start&&v.start(L);var q=!1,H=function(){return Wr(K)},N=function(U){wr(F,U),cn(M,F)&&H()},K=function(){var U,z,W;!T&&kr.indexedDB&&(F={},U={},R&&R.abort(),R=new AbortController,W=function(G){var Y=xt();try{O&&Ot();var Z=et(e,G);return Z=O?Z.finally(tt):Z}finally{Y&&$t()}}(z={subscr:U,signal:R.signal,requery:H,querier:e,trans:null}),Promise.resolve(W).then(function(G){l=!0,t=G,T||z.signal.aborted||(F={},function(Y){for(var Z in Y)if(r(Y,Z))return;return 1}(M=U)||q||(it(zt,N),q=!0),Wr(function(){return!T&&v.next&&v.next(G)}))},function(G){l=!1,["DatabaseClosedError","AbortError"].includes(G==null?void 0:G.name)||T||Wr(function(){T||v.error&&v.error(G)})}))};return setTimeout(H,0),L});return p.hasValue=function(){return l},p.getValue=function(){return t},p}var mt=Ze;function vn(e){var t=st;try{st=!0,it.storagemutated.fire(e),hn(e,!0)}finally{st=t}}o(mt,D(D({},er),{delete:function(e){return new mt(e,{addons:[]}).delete()},exists:function(e){return new mt(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=mt.dependencies,l=t.indexedDB,t=t.IDBKeyRange,(on(l)?Promise.resolve(l.databases()).then(function(p){return p.map(function(v){return v.name}).filter(function(v){return v!==ur})}):an(l,t).toCollection().primaryKeys()).then(e)}catch{return ke(new ue.MissingAPI)}var t,l},defineClass:function(){return function(e){A(this,e)}},ignoreTransaction:function(e){return le.trans?ft(le.transless,e):e()},vip:ln,async:function(e){return function(){try{var t=pn(e.apply(this,arguments));return t&&typeof t.then=="function"?t:ie.resolve(t)}catch(l){return ke(l)}}},spawn:function(e,t,l){try{var p=pn(e.apply(l,t||[]));return p&&typeof p.then=="function"?p:ie.resolve(p)}catch(v){return ke(v)}},currentTransaction:{get:function(){return le.trans||null}},waitFor:function(e,t){return t=ie.resolve(typeof e=="function"?mt.ignoreTransaction(e):e).timeout(t||6e4),le.trans?le.trans.waitFor(t):t},Promise:ie,debug:{get:function(){return Ue},set:function(e){Un(e)}},derive:n,extend:A,props:o,override:y,Events:Ft,on:it,liveQuery:wi,extendObservabilitySet:wr,getByKeyPath:I,setByKeyPath:C,delByKeyPath:function(e,t){typeof t=="string"?C(e,t,void 0):"length"in t&&[].map.call(t,function(l){C(e,l,void 0)})},shallowClone:g,deepClone:J,getObjectDiff:mn,cmp:ge,asap:S,minKey:-1/0,addons:[],connections:kt,errnames:Ge,dependencies:kr,cache:pt,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,l){return e+t/Math.pow(10,2*l)})})),mt.maxKey=Kt(mt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(it(zt,function(e){st||(e=new CustomEvent(Xr,{detail:e}),st=!0,dispatchEvent(e),st=!1)}),addEventListener(Xr,function(e){e=e.detail,st||vn(e)}));var jt,st=!1,xi=function(){};return typeof BroadcastChannel<"u"&&((xi=function(){(jt=new BroadcastChannel(Xr)).onmessage=function(e){return e.data&&vn(e.data)}})(),typeof jt.unref=="function"&&jt.unref(),it(zt,function(e){st||jt.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Ze.disableBfCache&&e.persisted){Ue&&console.debug("Dexie: handling persisted pagehide"),jt!=null&&jt.close();for(var t=0,l=kt;t<l.length;t++)l[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Ze.disableBfCache&&e.persisted&&(Ue&&console.debug("Dexie: handling persisted pageshow"),xi(),vn({all:new Pe(-1/0,[[]])}))})),ie.rejectionMapper=function(e,t){return!e||e instanceof Ce||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ln[e.name]?e:(t=new Ln[e.name](t||e.message,e),"stack"in e&&s(t,"stack",{get:function(){return this.inner.stack}}),t)},Un(Ue),D(Ze,Object.freeze({__proto__:null,Dexie:Ze,liveQuery:wi,Entity:Xn,cmp:ge,PropModification:Mt,replacePrefix:function(e,t){return new Mt({replacePrefix:[e,t]})},add:function(e){return new Mt({add:e})},remove:function(e){return new Mt({remove:e})},default:Ze,RangeSet:Pe,mergeRanges:Ht,rangesOverlap:fi}),{default:Ze}),Ze})}(Dr)),Dr.exports}var Xs=Js(),An=Dn(Xs);const ki=Symbol.for("Dexie"),Ir=globalThis[ki]||(globalThis[ki]=An);if(An.semVer!==Ir.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${An.semVer} and ${Ir.semVer}`);const{liveQuery:fl,mergeRanges:dl,rangesOverlap:hl,RangeSet:pl,cmp:ml,Entity:gl,PropModification:yl,replacePrefix:bl,add:vl,remove:_l}=Ir;var Vs={APP_NAME:"rais-plus"};const ea=Vs.APP_NAME+"-test",Oe=new Ir(ea);Oe.version(kn.version).stores(kn.definitions);const ta=u=>typeof u=="object"&&!Array.isArray(u)&&u!==null,Qe=(u,m,x=".")=>{if(m[u])return m[u];if(typeof u!="string")throw new Error("Key must be a string");if(typeof x!="string")throw Error("Delimiter must be a string");if(u.indexOf(x)===-1)return m[u];if(!ta(m))throw Error("Provided object is invalid");const D=u.split(x);let P=m;for(const E of D){if(Array.isArray(P)){P=P.map(w=>w?w[E]:void 0).filter(Boolean).flat();continue}if(!P||!Object.prototype.hasOwnProperty.call(P,E))return;if(P=P[E],typeof P!="object"||P===null)return P}return P},ra=(u,m,x=".")=>{if(typeof u!="string")throw new Error("Key must be a string");if(typeof x!="string")throw Error("Delimiter must be a string");const D=u.split(x);let P=m;for(let E=0;E<D.length;E++){const w=D[E];if(E===D.length-1)return delete P[w],m;if(!P||!Object.prototype.hasOwnProperty.call(P,w))return m;P=P[w]}return m},Dt=(u,m,x)=>{if(u=typeof u=="string"?new Date(u.slice(0,10)):u,m=typeof m=="string"?new Date(m.slice(0,10)):m,x==="!=")return u!==m;if(x==="=")return u===m;if(x===">=")return u>=m;if(x===">")return u>m;if(x==="<=")return u<=m;if(x==="<")return u<m},na=(u,m)=>String(u).match(/\d{4}-\d{2}-\d{2}/)||u instanceof Date?Dt(u,m,">="):u>=m,ia=(u,m)=>String(u).match(/\d{4}-\d{2}-\d{2}/)||u instanceof Date?Dt(u,m,">"):u>m,sa=(u,m)=>String(u).match(/\d{4}-\d{2}-\d{2}/)||u instanceof Date?Dt(u,m,"<="):u<=m,aa=(u,m)=>String(u).match(/\d{4}-\d{2}-\d{2}/)||u instanceof Date?Dt(u,m,"<"):u<m,oa=(u,m)=>{if(typeof m=="function")throw Error("Can't process functions");if(String(u).match(/\d{4}-\d{2}-\d{2}/)||u instanceof Date)return Dt(u,m,"=");if(typeof u!="object"||u===null)return u===m;if(Array.isArray(u)){for(const x of u)if(x===m)return!0}return!1},la=(u,m)=>{if(typeof m=="function")throw Error("Can't process functions");if(String(u).match(/\d{4}-\d{2}-\d{2}/)||u instanceof Date)return Dt(u,m,"!=");if(typeof u!="object"||u===null)return u!==m;if(Array.isArray(u)){for(const x of u)if(x!==m)return!0}return!1},ua=(u,m)=>{if(typeof m!="string")throw Error("Filter value is not a string");if(typeof u=="string")return u.indexOf(m)>-1;if(Array.isArray(u)){for(const x of u)if(typeof x=="string"&&x.indexOf(m)>-1)return!0}return!1},ca=(u,m)=>{if(typeof m!="string")throw Error("Filter value is not a string");if(typeof u=="string")return u.indexOf(m)===-1;if(Array.isArray(u)){for(const x of u)if(typeof x=="string"&&x.indexOf(m)===-1)return!0}return!1},Sn=(u,m)=>{if(!Array.isArray(m))throw Error("Filter value is not an array");if(!m.length)return!0;if(typeof u=="string")return m.indexOf(u)>-1;if(Array.isArray(u)){for(const x of u)if(m.indexOf(x)>-1)return!0}return!1},fa=(u,m)=>{if(!Array.isArray(m))throw Error("Filter value is not an array");if(typeof u=="string")return m.indexOf(u)===-1;if(Array.isArray(u)){for(const x of u)if(m.indexOf(x)>-1)return!0}return!1},da=(u,m)=>{if(!(m instanceof RegExp||typeof m=="string"))throw Error("Filter value is not a string or a regex");if(m instanceof RegExp||(m=new RegExp(m,"gi")),typeof u=="string")return m.test(u);if(Array.isArray(u)){for(const x of u)if(typeof x=="string"&&x.match(m))return!0}return!1},ha=(u,m)=>{if(!Array.isArray(m))throw Error("Filter value is not an array");if(!Array.isArray(u))throw Error("Object value value is not an array");let x=0;const D=m.length;for(const P of u)if(m.includes(P)&&x++,x===D)return!0;return!1},pa=(u,m)=>{if(!Array.isArray(m))throw Error("Filter value is not an array");const x=m.length;if(Array.isArray(u))for(const D of u){if(typeof D!="string")continue;if(m.filter(E=>D.indexOf(E)>-1).length===x)return!0}return typeof u=="string"?m.filter(D=>u.indexOf(D)>-1).length===x:!1},ma=(u,m)=>{if(!Array.isArray(m))throw Error("Filter value is not an array");m=m.map(D=>D instanceof RegExp?D:new RegExp(D,"gi"));const x=m.length;if(Array.isArray(u))for(const D of u){if(typeof D!="string")continue;if(m.filter(E=>D.match(E)).length===x)return!0}return typeof u=="string"?m.filter(D=>u.match(D)).length===x:!1},ga=(u,m)=>{if(typeof m!="number")throw Error("Filter is not a number");return typeof u=="string"||Array.isArray(u)?u.length===m:!1},ya=(u,m)=>{if(typeof m!="number")throw Error("Filter is not a number");return typeof u=="string"||Array.isArray(u)?u.length>m:!1},ba=(u,m)=>{if(typeof m!="number")throw Error("Filter is not a number");return typeof u=="string"||Array.isArray(u)?u.length>=m:!1},va=(u,m)=>{if(typeof m!="number")throw Error("Filter is not a number");return typeof u=="string"||Array.isArray(u)?u.length<m:!1},_a=(u,m)=>{if(typeof m!="number")throw Error("Filter is not a number");return typeof u=="string"||Array.isArray(u)?u.length<=m:!1},Ai={lt:aa,gt:ia,lte:sa,gte:na,eq:oa,ne:la,contains:ua,notContains:ca,isOneOf:Sn,isNotOneOf:fa,regex:da,allOf:pa,containsAll:ha,regexAll:ma,hasSize:ga,hasSizeGt:ya,hasSizeGte:ba,hasSizeLt:va,hasSizeLte:_a},wa=(u,m)=>{if(typeof m=="string")return Sn(u,[m]);if(Array.isArray(m))return Sn(u,m);for(const[x,D]of Object.entries(m)){const P=x.slice(1);if(x==="$nested")return u?u.filter(E=>Rn(E,D)).length>0:!1;if(!Object.prototype.hasOwnProperty.call(Ai,P)||!Ai[P](u,D))return!1}return!0},Si=(u,m)=>{for(let[x,D]of Object.entries(m)){const P=Qe(x,u);if(typeof P>"u"||!wa(P,D))return!1}return!0},Rn=(u,m,x)=>{if(m&&Object.keys(m).keys&&!Si(u,m))return!1;if(!x||!Object.keys(x).length)return!0;for(const D of x)if(Si(u,D))return!0;return!1},xa=async(u,{filter:m,should:x}={})=>await Oe[u].filter(w=>Rn(w,m,x)).count(),$a=async u=>await Oe[u].schema;var xn,ji;function Oa(){if(ji)return xn;ji=1;for(var u=Math.floor(Math.random()*16777215),m=_.index=parseInt(Math.random()*16777215,10),x=(typeof process>"u"||typeof process.pid!="number"?Math.floor(Math.random()*1e5):process.pid)%65535,D=(()=>{try{return _Buffer}catch{try{return Buffer}catch{return null}}})(),P=function(i){return!!(i!=null&&i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i))},E=[],w=0;w<256;w++)E[w]=(w<=15?"0":"")+w.toString(16);var c=new RegExp("^[0-9a-fA-F]{24}$"),A=[];for(w=0;w<10;)A[48+w]=w++;for(;w<16;)A[55+w]=A[87+w]=w++;function _(i){if(!(this instanceof _))return new _(i);if(i&&(i instanceof _||i._bsontype==="ObjectID"))return i;if(this._bsontype="ObjectID",i==null||typeof i=="number"){this.id=this.generate(i);return}var s=_.isValid(i);if(!s&&i!=null)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(s&&typeof i=="string"&&i.length===24)return _.createFromHexString(i);if(i!=null&&i.length===12)this.id=i;else{if(i!=null&&typeof i.toHexString=="function")return i;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}}xn=_,_.default=_,_.createFromTime=function(i){return i=parseInt(i,10)%4294967295,new _(r(8,i)+"0000000000000000")},_.createFromHexString=function(i){if(typeof i>"u"||i!=null&&i.length!==24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var s="",n=0;n<24;)s+=String.fromCharCode(A[i.charCodeAt(n++)]<<4|A[i.charCodeAt(n++)]);return new _(s)},_.isValid=function(i){return i==null?!1:typeof i=="number"?!0:typeof i=="string"?i.length===12||i.length===24&&c.test(i):i instanceof _?!0:P(i)?_.isValid(i.toString("hex")):typeof i.toHexString=="function"&&D&&(i.id instanceof D||typeof i.id=="string")?i.id.length===12||i.id.length===24&&c.test(i.id):!1},_.prototype={constructor:_,toHexString:function(){if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id.length===24)return this.id;if(P(this.id))return this.id.toString("hex");for(var i="",s=0;s<this.id.length;s++)i+=E[this.id.charCodeAt(s)];return i},equals:function(i){return i instanceof _?this.toString()===i.toString():typeof i=="string"&&_.isValid(i)&&i.length===12&&P(this.id)?i===this.id.toString("binary"):typeof i=="string"&&_.isValid(i)&&i.length===24?i.toLowerCase()===this.toHexString():typeof i=="string"&&_.isValid(i)&&i.length===12?i===this.id:i!=null&&(i instanceof _||i.toHexString)?i.toHexString()===this.toHexString():!1},getTimestamp:function(){var i=new Date,s;return P(this.id)?s=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24:s=this.id.charCodeAt(3)|this.id.charCodeAt(2)<<8|this.id.charCodeAt(1)<<16|this.id.charCodeAt(0)<<24,i.setTime(Math.floor(s)*1e3),i},generate:function(i){typeof i!="number"&&(i=~~(Date.now()/1e3)),i=parseInt(i,10)%4294967295;var s=b();return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255,u>>16&255,u>>8&255,u&255,x>>8&255,x&255,s>>16&255,s>>8&255,s&255)}};function b(){return m=(m+1)%16777215}function r(i,s){return s=s.toString(16),s.length===i?s:"00000000".substring(s.length,i)+s}var o=Symbol&&Symbol.for&&Symbol.for("nodejs.util.inspect.custom")||"inspect";return _.prototype[o]=function(){return"ObjectID("+this+")"},_.prototype.toJSON=_.prototype.toHexString,_.prototype.toString=_.prototype.toHexString,xn}var ka=Oa(),Bi=Dn(ka);const Aa={"post/v1/assistances":u=>u.required(),put:u=>u.optional()},Sa={post:u=>u.optional(),put:u=>u.required()};var ja={idAlter:Sa,globalAlter:Aa},$n={exports:{}},Ei;function Ea(){return Ei||(Ei=1,function(u,m){(function(x,D){u.exports=D()})(self,()=>{return x={7629:(P,E,w)=>{const c=w(375),A=w(8571),_=w(9474),b=w(1687),r=w(8652),o=w(8160),i=w(3292),s=w(6354),n=w(8901),d=w(9708),a=w(6914),f=w(2294),y=w(6133),$=w(1152),S=w(8863),I=w(2036),C={Base:class{constructor(g){this.type=g,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new f.Ids,this._preferences=null,this._refs=new y.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return c(typeof d.describe=="function","Manifest functionality disabled"),d.describe(this)}allow(...g){return o.verifyFlat(g,"allow"),this._values(g,"_valids")}alter(g){c(g&&typeof g=="object"&&!Array.isArray(g),"Invalid targets argument"),c(!this._inRuleset(),"Cannot set alterations inside a ruleset");const k=this.clone();k.$_terms.alterations=k.$_terms.alterations||[];for(const j in g){const B=g[j];c(typeof B=="function","Alteration adjuster for",j,"must be a function"),k.$_terms.alterations.push({target:j,adjuster:B})}return k.$_temp.ruleset=!1,k}artifact(g){return c(g!==void 0,"Artifact cannot be undefined"),c(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",g)}cast(g){return c(g===!1||typeof g=="string","Invalid to value"),c(g===!1||this._definition.cast[g],"Type",this.type,"does not support casting to",g),this.$_setFlag("cast",g===!1?void 0:g)}default(g,k){return this._default("default",g,k)}description(g){return c(g&&typeof g=="string","Description must be a non-empty string"),this.$_setFlag("description",g)}empty(g){const k=this.clone();return g!==void 0&&(g=k.$_compile(g,{override:!1})),k.$_setFlag("empty",g,{clone:!1})}error(g){return c(g,"Missing error"),c(g instanceof Error||typeof g=="function","Must provide a valid Error object or a function"),this.$_setFlag("error",g)}example(g,k={}){return c(g!==void 0,"Missing example"),o.assertOptions(k,["override"]),this._inner("examples",g,{single:!0,override:k.override})}external(g,k){return typeof g=="object"&&(c(!k,"Cannot combine options with description"),k=g.description,g=g.method),c(typeof g=="function","Method must be a function"),c(k===void 0||k&&typeof k=="string","Description must be a non-empty string"),this._inner("externals",{method:g,description:k},{single:!0})}failover(g,k){return this._default("failover",g,k)}forbidden(){return this.presence("forbidden")}id(g){return g?(c(typeof g=="string","id must be a non-empty string"),c(/^[^\.]+$/.test(g),"id cannot contain period character"),this.$_setFlag("id",g)):this.$_setFlag("id",void 0)}invalid(...g){return this._values(g,"_invalids")}label(g){return c(g&&typeof g=="string","Label name must be a non-empty string"),this.$_setFlag("label",g)}meta(g){return c(g!==void 0,"Meta cannot be undefined"),this._inner("metas",g,{single:!0})}note(...g){c(g.length,"Missing notes");for(const k of g)c(k&&typeof k=="string","Notes must be non-empty strings");return this._inner("notes",g)}only(g=!0){return c(typeof g=="boolean","Invalid mode:",g),this.$_setFlag("only",g)}optional(){return this.presence("optional")}prefs(g){c(g,"Missing preferences"),c(g.context===void 0,"Cannot override context"),c(g.externals===void 0,"Cannot override externals"),c(g.warnings===void 0,"Cannot override warnings"),c(g.debug===void 0,"Cannot override debug"),o.checkPreferences(g);const k=this.clone();return k._preferences=o.preferences(k._preferences,g),k}presence(g){return c(["optional","required","forbidden"].includes(g),"Unknown presence mode",g),this.$_setFlag("presence",g)}raw(g=!0){return this.$_setFlag("result",g?"raw":void 0)}result(g){return c(["raw","strip"].includes(g),"Unknown result mode",g),this.$_setFlag("result",g)}required(){return this.presence("required")}strict(g){const k=this.clone(),j=g!==void 0&&!g;return k._preferences=o.preferences(k._preferences,{convert:j}),k}strip(g=!0){return this.$_setFlag("result",g?"strip":void 0)}tag(...g){c(g.length,"Missing tags");for(const k of g)c(k&&typeof k=="string","Tags must be non-empty strings");return this._inner("tags",g)}unit(g){return c(g&&typeof g=="string","Unit name must be a non-empty string"),this.$_setFlag("unit",g)}valid(...g){o.verifyFlat(g,"valid");const k=this.allow(...g);return k.$_setFlag("only",!!k._valids,{clone:!1}),k}when(g,k){const j=this.clone();j.$_terms.whens||(j.$_terms.whens=[]);const B=i.when(j,g,k);if(!["any","link"].includes(j.type)){const Q=B.is?[B]:B.switch;for(const J of Q)c(!J.then||J.then.type==="any"||J.then.type===j.type,"Cannot combine",j.type,"with",J.then&&J.then.type),c(!J.otherwise||J.otherwise.type==="any"||J.otherwise.type===j.type,"Cannot combine",j.type,"with",J.otherwise&&J.otherwise.type)}return j.$_terms.whens.push(B),j.$_mutateRebuild()}cache(g){c(!this._inRuleset(),"Cannot set caching inside a ruleset"),c(!this._cache,"Cannot override schema cache"),c(this._flags.artifact===void 0,"Cannot cache a rule with an artifact");const k=this.clone();return k._cache=g||r.provider.provision(),k.$_temp.ruleset=!1,k}clone(){const g=Object.create(Object.getPrototypeOf(this));return this._assign(g)}concat(g){c(o.isSchema(g),"Invalid schema object"),c(this.type==="any"||g.type==="any"||g.type===this.type,"Cannot merge type",this.type,"with another type:",g.type),c(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),c(!g._inRuleset(),"Cannot concatenate a schema with open ruleset");let k=this.clone();if(this.type==="any"&&g.type!=="any"){const j=g.clone();for(const B of Object.keys(k))B!=="type"&&(j[B]=k[B]);k=j}k._ids.concat(g._ids),k._refs.register(g,y.toSibling),k._preferences=k._preferences?o.preferences(k._preferences,g._preferences):g._preferences,k._valids=I.merge(k._valids,g._valids,g._invalids),k._invalids=I.merge(k._invalids,g._invalids,g._valids);for(const j of g._singleRules.keys())k._singleRules.has(j)&&(k._rules=k._rules.filter(B=>B.keep||B.name!==j),k._singleRules.delete(j));for(const j of g._rules)g._definition.rules[j.method].multi||k._singleRules.set(j.name,j),k._rules.push(j);if(k._flags.empty&&g._flags.empty){k._flags.empty=k._flags.empty.concat(g._flags.empty);const j=Object.assign({},g._flags);delete j.empty,b(k._flags,j)}else if(g._flags.empty){k._flags.empty=g._flags.empty;const j=Object.assign({},g._flags);delete j.empty,b(k._flags,j)}else b(k._flags,g._flags);for(const j in g.$_terms){const B=g.$_terms[j];B?k.$_terms[j]?k.$_terms[j]=k.$_terms[j].concat(B):k.$_terms[j]=B.slice():k.$_terms[j]||(k.$_terms[j]=B)}return this.$_root._tracer&&this.$_root._tracer._combine(k,[this,g]),k.$_mutateRebuild()}extend(g){return c(!g.base,"Cannot extend type with another base"),n.type(this,g)}extract(g){return g=Array.isArray(g)?g:g.split("."),this._ids.reach(g)}fork(g,k){c(!this._inRuleset(),"Cannot fork inside a ruleset");let j=this;for(let B of[].concat(g))B=Array.isArray(B)?B:B.split("."),j=j._ids.fork(B,k,j);return j.$_temp.ruleset=!1,j}rule(g){const k=this._definition;o.assertOptions(g,Object.keys(k.modifiers)),c(this.$_temp.ruleset!==!1,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const j=this.$_temp.ruleset===null?this._rules.length-1:this.$_temp.ruleset;c(j>=0&&j<this._rules.length,"Cannot apply rules to empty ruleset");const B=this.clone();for(let Q=j;Q<B._rules.length;++Q){const J=B._rules[Q],ae=A(J);for(const oe in g)k.modifiers[oe](ae,g[oe]),c(ae.name===J.name,"Cannot change rule name");B._rules[Q]=ae,B._singleRules.get(ae.name)===J&&B._singleRules.set(ae.name,ae)}return B.$_temp.ruleset=!1,B.$_mutateRebuild()}get ruleset(){c(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");const g=this.clone();return g.$_temp.ruleset=g._rules.length,g}get $(){return this.ruleset}tailor(g){g=[].concat(g),c(!this._inRuleset(),"Cannot tailor inside a ruleset");let k=this;if(this.$_terms.alterations)for(const{target:j,adjuster:B}of this.$_terms.alterations)g.includes(j)&&(k=B(k),c(o.isSchema(k),"Alteration adjuster for",j,"failed to return a schema object"));return k=k.$_modify({each:j=>j.tailor(g),ref:!1}),k.$_temp.ruleset=!1,k.$_mutateRebuild()}tracer(){return $.location?$.location(this):this}validate(g,k){return S.entry(g,this,k)}validateAsync(g,k){return S.entryAsync(g,this,k)}$_addRule(g){typeof g=="string"&&(g={name:g}),c(g&&typeof g=="object","Invalid options"),c(g.name&&typeof g.name=="string","Invalid rule name");for(const J in g)c(J[0]!=="_","Cannot set private rule properties");const k=Object.assign({},g);k._resolve=[],k.method=k.method||k.name;const j=this._definition.rules[k.method],B=k.args;c(j,"Unknown rule",k.method);const Q=this.clone();if(B){c(Object.keys(B).length===1||Object.keys(B).length===this._definition.rules[k.name].args.length,"Invalid rule definition for",this.type,k.name);for(const J in B){let ae=B[J];if(j.argsByName){const oe=j.argsByName.get(J);if(oe.ref&&o.isResolvable(ae))k._resolve.push(J),Q.$_mutateRegister(ae);else if(oe.normalize&&(ae=oe.normalize(ae),B[J]=ae),oe.assert){const de=o.validateArg(ae,J,oe);c(!de,de,"or reference")}}ae!==void 0?B[J]=ae:delete B[J]}}return j.multi||(Q._ruleRemove(k.name,{clone:!1}),Q._singleRules.set(k.name,k)),Q.$_temp.ruleset===!1&&(Q.$_temp.ruleset=null),j.priority?Q._rules.unshift(k):Q._rules.push(k),Q}$_compile(g,k){return i.schema(this.$_root,g,k)}$_createError(g,k,j,B,Q,J={}){const ae=J.flags!==!1?this._flags:{},oe=J.messages?a.merge(this._definition.messages,J.messages):this._definition.messages;return new s.Report(g,k,j,ae,oe,B,Q)}$_getFlag(g){return this._flags[g]}$_getRule(g){return this._singleRules.get(g)}$_mapLabels(g){return g=Array.isArray(g)?g:g.split("."),this._ids.labels(g)}$_match(g,k,j,B){(j=Object.assign({},j)).abortEarly=!0,j._externals=!1,k.snapshot();const Q=!S.validate(g,this,k,j,B).errors;return k.restore(),Q}$_modify(g){return o.assertOptions(g,["each","once","ref","schema"]),f.schema(this,g)||this}$_mutateRebuild(){return c(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset(),this.$_modify({each:(g,{source:k,name:j,path:B,key:Q})=>{const J=this._definition[k][j]&&this._definition[k][j].register;J!==!1&&this.$_mutateRegister(g,{family:J,key:Q})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(g,{family:k,key:j}={}){this._refs.register(g,k),this._ids.register(g,{key:j})}$_property(g){return this._definition.properties[g]}$_reach(g){return this._ids.reach(g)}$_rootReferences(){return this._refs.roots()}$_setFlag(g,k,j={}){c(g[0]==="_"||!this._inRuleset(),"Cannot set flag inside a ruleset");const B=this._definition.flags[g]||{};if(_(k,B.default)&&(k=void 0),_(k,this._flags[g]))return this;const Q=j.clone!==!1?this.clone():this;return k!==void 0?(Q._flags[g]=k,Q.$_mutateRegister(k)):delete Q._flags[g],g[0]!=="_"&&(Q.$_temp.ruleset=!1),Q}$_parent(g,...k){return this[g][o.symbols.parent].call(this,...k)}$_validate(g,k,j){return S.validate(g,this,k,j)}_assign(g){g.type=this.type,g.$_root=this.$_root,g.$_temp=Object.assign({},this.$_temp),g.$_temp.whens={},g._ids=this._ids.clone(),g._preferences=this._preferences,g._valids=this._valids&&this._valids.clone(),g._invalids=this._invalids&&this._invalids.clone(),g._rules=this._rules.slice(),g._singleRules=A(this._singleRules,{shallow:!0}),g._refs=this._refs.clone(),g._flags=Object.assign({},this._flags),g._cache=null,g.$_terms={};for(const k in this.$_terms)g.$_terms[k]=this.$_terms[k]?this.$_terms[k].slice():null;g.$_super={};for(const k in this.$_super)g.$_super[k]=this._super[k].bind(g);return g}_bare(){const g=this.clone();g._reset();const k=g._definition.terms;for(const j in k){const B=k[j];g.$_terms[j]=B.init}return g.$_mutateRebuild()}_default(g,k,j={}){return o.assertOptions(j,"literal"),c(k!==void 0,"Missing",g,"value"),c(typeof k=="function"||!j.literal,"Only function value supports literal option"),typeof k=="function"&&j.literal&&(k={[o.symbols.literal]:!0,literal:k}),this.$_setFlag(g,k)}_generate(g,k,j){if(!this.$_terms.whens)return{schema:this};const B=[],Q=[];for(let oe=0;oe<this.$_terms.whens.length;++oe){const de=this.$_terms.whens[oe];if(de.concat){B.push(de.concat),Q.push(`${oe}.concat`);continue}const ve=de.ref?de.ref.resolve(g,k,j):g,we=de.is?[de]:de.switch,Se=Q.length;for(let me=0;me<we.length;++me){const{is:ye,then:Re,otherwise:Ce}=we[me],ze=`${oe}${de.switch?"."+me:""}`;if(ye.$_match(ve,k.nest(ye,`${ze}.is`),j)){if(Re){const Ke=k.localize([...k.path,`${ze}.then`],k.ancestors,k.schemas),{schema:Le,id:Ge}=Re._generate(g,Ke,j);B.push(Le),Q.push(`${ze}.then${Ge?`(${Ge})`:""}`);break}}else if(Ce){const Ke=k.localize([...k.path,`${ze}.otherwise`],k.ancestors,k.schemas),{schema:Le,id:Ge}=Ce._generate(g,Ke,j);B.push(Le),Q.push(`${ze}.otherwise${Ge?`(${Ge})`:""}`);break}}if(de.break&&Q.length>Se)break}const J=Q.join(", ");if(k.mainstay.tracer.debug(k,"rule","when",J),!J)return{schema:this};if(!k.mainstay.tracer.active&&this.$_temp.whens[J])return{schema:this.$_temp.whens[J],id:J};let ae=this;this._definition.generate&&(ae=this._definition.generate(this,g,k,j));for(const oe of B)ae=ae.concat(oe);return this.$_root._tracer&&this.$_root._tracer._combine(ae,[this,...B]),this.$_temp.whens[J]=ae,{schema:ae,id:J}}_inner(g,k,j={}){c(!this._inRuleset(),`Cannot set ${g} inside a ruleset`);const B=this.clone();return B.$_terms[g]&&!j.override||(B.$_terms[g]=[]),j.single?B.$_terms[g].push(k):B.$_terms[g].push(...k),B.$_temp.ruleset=!1,B}_inRuleset(){return this.$_temp.ruleset!==null&&this.$_temp.ruleset!==!1}_ruleRemove(g,k={}){if(!this._singleRules.has(g))return this;const j=k.clone!==!1?this.clone():this;j._singleRules.delete(g);const B=[];for(let Q=0;Q<j._rules.length;++Q){const J=j._rules[Q];J.name!==g||J.keep?B.push(J):j._inRuleset()&&Q<j.$_temp.ruleset&&--j.$_temp.ruleset}return j._rules=B,j}_values(g,k){o.verifyFlat(g,k.slice(1,-1));const j=this.clone(),B=g[0]===o.symbols.override;if(B&&(g=g.slice(1)),!j[k]&&g.length?j[k]=new I:B&&(j[k]=g.length?new I:null,j.$_mutateRebuild()),!j[k])return j;B&&j[k].override();for(const Q of g){c(Q!==void 0,"Cannot call allow/valid/invalid with undefined"),c(Q!==o.symbols.override,"Override must be the first value");const J=k==="_invalids"?"_valids":"_invalids";j[J]&&(j[J].remove(Q),j[J].length||(c(k==="_valids"||!j._flags.only,"Setting invalid value",Q,"leaves schema rejecting all values due to previous valid rule"),j[J]=null)),j[k].add(Q,j._refs)}return j}}};C.Base.prototype[o.symbols.any]={version:o.version,compile:i.compile,root:"$_root"},C.Base.prototype.isImmutable=!0,C.Base.prototype.deny=C.Base.prototype.invalid,C.Base.prototype.disallow=C.Base.prototype.invalid,C.Base.prototype.equal=C.Base.prototype.valid,C.Base.prototype.exist=C.Base.prototype.required,C.Base.prototype.not=C.Base.prototype.invalid,C.Base.prototype.options=C.Base.prototype.prefs,C.Base.prototype.preferences=C.Base.prototype.prefs,P.exports=new C.Base},8652:(P,E,w)=>{const c=w(375),A=w(8571),_=w(8160),b={max:1e3,supported:new Set(["undefined","boolean","number","string"])};E.provider={provision:r=>new b.Cache(r)},b.Cache=class{constructor(r={}){_.assertOptions(r,["max"]),c(r.max===void 0||r.max&&r.max>0&&isFinite(r.max),"Invalid max cache size"),this._max=r.max||b.max,this._map=new Map,this._list=new b.List}get length(){return this._map.size}set(r,o){if(r!==null&&!b.supported.has(typeof r))return;let i=this._map.get(r);if(i)return i.value=o,void this._list.first(i);i=this._list.unshift({key:r,value:o}),this._map.set(r,i),this._compact()}get(r){const o=this._map.get(r);if(o)return this._list.first(o),A(o.value)}_compact(){if(this._map.size>this._max){const r=this._list.pop();this._map.delete(r.key)}}},b.List=class{constructor(){this.tail=null,this.head=null}unshift(r){return r.next=null,r.prev=this.head,this.head&&(this.head.next=r),this.head=r,this.tail||(this.tail=r),r}first(r){r!==this.head&&(this._remove(r),this.unshift(r))}pop(){return this._remove(this.tail)}_remove(r){const{next:o,prev:i}=r;return o.prev=i,i&&(i.next=o),r===this.tail&&(this.tail=o),r.prev=null,r.next=null,r}}},8160:(P,E,w)=>{const c=w(375),A=w(7916),_=w(5934);let b,r;const o={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};E.version=_.version,E.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},E.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")},E.assertOptions=function(i,s,n="Options"){c(i&&typeof i=="object"&&!Array.isArray(i),"Options must be of type object");const d=Object.keys(i).filter(a=>!s.includes(a));c(d.length===0,`${n} contain unknown keys: ${d}`)},E.checkPreferences=function(i){r=r||w(3378);const s=r.preferences.validate(i);if(s.error)throw new A([s.error.details[0].message])},E.compare=function(i,s,n){switch(n){case"=":return i===s;case">":return i>s;case"<":return i<s;case">=":return i>=s;case"<=":return i<=s}},E.default=function(i,s){return i===void 0?s:i},E.isIsoDate=function(i){return o.isoDate.test(i)},E.isNumber=function(i){return typeof i=="number"&&!isNaN(i)},E.isResolvable=function(i){return!!i&&(i[E.symbols.ref]||i[E.symbols.template])},E.isSchema=function(i,s={}){const n=i&&i[E.symbols.any];return!!n&&(c(s.legacy||n.version===E.version,"Cannot mix different versions of joi schemas"),!0)},E.isValues=function(i){return i[E.symbols.values]},E.limit=function(i){return Number.isSafeInteger(i)&&i>=0},E.preferences=function(i,s){b=b||w(6914),i=i||{},s=s||{};const n=Object.assign({},i,s);return s.errors&&i.errors&&(n.errors=Object.assign({},i.errors,s.errors),n.errors.wrap=Object.assign({},i.errors.wrap,s.errors.wrap)),s.messages&&(n.messages=b.compile(s.messages,i.messages)),delete n[E.symbols.prefs],n},E.tryWithPath=function(i,s,n={}){try{return i()}catch(d){throw d.path!==void 0?d.path=s+"."+d.path:d.path=s,n.append&&(d.message=`${d.message} (${d.path})`),d}},E.validateArg=function(i,s,{assert:n,message:d}){if(E.isSchema(n)){const a=n.validate(i);return a.error?a.error.message:void 0}if(!n(i))return s?`${s} ${d}`:d},E.verifyFlat=function(i,s){for(const n of i)c(!Array.isArray(n),"Method no longer accepts array arguments:",s)}},3292:(P,E,w)=>{const c=w(375),A=w(8160),_=w(6133),b={};E.schema=function(r,o,i={}){A.assertOptions(i,["appendPath","override"]);try{return b.schema(r,o,i)}catch(s){throw i.appendPath&&s.path!==void 0&&(s.message=`${s.message} (${s.path})`),s}},b.schema=function(r,o,i){c(o!==void 0,"Invalid undefined schema"),Array.isArray(o)&&(c(o.length,"Invalid empty array schema"),o.length===1&&(o=o[0]));const s=(n,...d)=>i.override!==!1?n.valid(r.override,...d):n.valid(...d);if(b.simple(o))return s(r,o);if(typeof o=="function")return r.custom(o);if(c(typeof o=="object","Invalid schema content:",typeof o),A.isResolvable(o))return s(r,o);if(A.isSchema(o))return o;if(Array.isArray(o)){for(const n of o)if(!b.simple(n))return r.alternatives().try(...o);return s(r,...o)}return o instanceof RegExp?r.string().regex(o):o instanceof Date?s(r.date(),o):(c(Object.getPrototypeOf(o)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),r.object().keys(o))},E.ref=function(r,o){return _.isRef(r)?r:_.create(r,o)},E.compile=function(r,o,i={}){A.assertOptions(i,["legacy"]);const s=o&&o[A.symbols.any];if(s)return c(i.legacy||s.version===A.version,"Cannot mix different versions of joi schemas:",s.version,A.version),o;if(typeof o!="object"||!i.legacy)return E.schema(r,o,{appendPath:!0});const n=b.walk(o);return n?n.compile(n.root,o):E.schema(r,o,{appendPath:!0})},b.walk=function(r){if(typeof r!="object")return null;if(Array.isArray(r)){for(const i of r){const s=b.walk(i);if(s)return s}return null}const o=r[A.symbols.any];if(o)return{root:r[o.root],compile:o.compile};c(Object.getPrototypeOf(r)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const i in r){const s=b.walk(r[i]);if(s)return s}return null},b.simple=function(r){return r===null||["boolean","string","number"].includes(typeof r)},E.when=function(r,o,i){if(i===void 0&&(c(o&&typeof o=="object","Missing options"),i=o,o=_.create(".")),Array.isArray(i)&&(i={switch:i}),A.assertOptions(i,["is","not","then","otherwise","switch","break"]),A.isSchema(o))return c(i.is===void 0,'"is" can not be used with a schema condition'),c(i.not===void 0,'"not" can not be used with a schema condition'),c(i.switch===void 0,'"switch" can not be used with a schema condition'),b.condition(r,{is:o,then:i.then,otherwise:i.otherwise,break:i.break});if(c(_.isRef(o)||typeof o=="string","Invalid condition:",o),c(i.not===void 0||i.is===void 0,'Cannot combine "is" with "not"'),i.switch===void 0){let n=i;i.not!==void 0&&(n={is:i.not,then:i.otherwise,otherwise:i.then,break:i.break});let d=n.is!==void 0?r.$_compile(n.is):r.$_root.invalid(null,!1,0,"").required();return c(n.then!==void 0||n.otherwise!==void 0,'options must have at least one of "then", "otherwise", or "switch"'),c(n.break===void 0||n.then===void 0||n.otherwise===void 0,"Cannot specify then, otherwise, and break all together"),i.is===void 0||_.isRef(i.is)||A.isSchema(i.is)||(d=d.required()),b.condition(r,{ref:E.ref(o),is:d,then:n.then,otherwise:n.otherwise,break:n.break})}c(Array.isArray(i.switch),'"switch" must be an array'),c(i.is===void 0,'Cannot combine "switch" with "is"'),c(i.not===void 0,'Cannot combine "switch" with "not"'),c(i.then===void 0,'Cannot combine "switch" with "then"');const s={ref:E.ref(o),switch:[],break:i.break};for(let n=0;n<i.switch.length;++n){const d=i.switch[n],a=n===i.switch.length-1;A.assertOptions(d,a?["is","then","otherwise"]:["is","then"]),c(d.is!==void 0,'Switch statement missing "is"'),c(d.then!==void 0,'Switch statement missing "then"');const f={is:r.$_compile(d.is),then:r.$_compile(d.then)};if(_.isRef(d.is)||A.isSchema(d.is)||(f.is=f.is.required()),a){c(i.otherwise===void 0||d.otherwise===void 0,'Cannot specify "otherwise" inside and outside a "switch"');const y=i.otherwise!==void 0?i.otherwise:d.otherwise;y!==void 0&&(c(s.break===void 0,"Cannot specify both otherwise and break"),f.otherwise=r.$_compile(y))}s.switch.push(f)}return s},b.condition=function(r,o){for(const i of["then","otherwise"])o[i]===void 0?delete o[i]:o[i]=r.$_compile(o[i]);return o}},6354:(P,E,w)=>{const c=w(5688),A=w(8160),_=w(3328);E.Report=class{constructor(b,r,o,i,s,n,d){if(this.code=b,this.flags=i,this.messages=s,this.path=n.path,this.prefs=d,this.state=n,this.value=r,this.message=null,this.template=null,this.local=o||{},this.local.label=E.label(this.flags,this.state,this.prefs,this.messages),this.value===void 0||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const a=this.path[this.path.length-1];typeof a!="object"&&(this.local.key=a)}}_setTemplate(b){if(this.template=b,!this.flags.label&&this.path.length===0){const r=this._template(this.template,"root");r&&(this.local.label=r)}}toString(){if(this.message)return this.message;const b=this.code;if(!this.prefs.errors.render)return this.code;const r=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return r===void 0?`Error code "${b}" is not defined, your custom type is missing the correct messages definition`:(this.message=r.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(b,r){return E.template(this.value,b,r||this.code,this.state,this.prefs)}},E.path=function(b){let r="";for(const o of b)typeof o!="object"&&(typeof o=="string"?(r&&(r+="."),r+=o):r+=`[${o}]`);return r},E.template=function(b,r,o,i,s){if(!r)return;if(_.isTemplate(r))return o!=="root"?r:null;let n=s.errors.language;if(A.isResolvable(n)&&(n=n.resolve(b,i,s)),n&&r[n]){if(r[n][o]!==void 0)return r[n][o];if(r[n]["*"]!==void 0)return r[n]["*"]}return r[o]?r[o]:r["*"]},E.label=function(b,r,o,i){if(!o.errors.label)return"";if(b.label)return b.label;let s=r.path;return o.errors.label==="key"&&r.path.length>1&&(s=r.path.slice(-1)),E.path(s)||E.template(null,o.messages,"root",r,o)||i&&E.template(null,i,"root",r,o)||"value"},E.process=function(b,r,o){if(!b)return null;const{override:i,message:s,details:n}=E.details(b);if(i)return i;if(o.errors.stack)return new E.ValidationError(s,n,r);const d=Error.stackTraceLimit;Error.stackTraceLimit=0;const a=new E.ValidationError(s,n,r);return Error.stackTraceLimit=d,a},E.details=function(b,r={}){let o=[];const i=[];for(const s of b){if(s instanceof Error){if(r.override!==!1)return{override:s};const d=s.toString();o.push(d),i.push({message:d,type:"override",context:{error:s}});continue}const n=s.toString();o.push(n),i.push({message:n,path:s.path.filter(d=>typeof d!="object"),type:s.code,context:s.local})}return o.length>1&&(o=[...new Set(o)]),{message:o.join(". "),details:i}},E.ValidationError=class extends Error{constructor(b,r,o){super(b),this._original=o,this.details=r}static isError(b){return b instanceof E.ValidationError}},E.ValidationError.prototype.isJoi=!0,E.ValidationError.prototype.name="ValidationError",E.ValidationError.prototype.annotate=c.error},8901:(P,E,w)=>{const c=w(375),A=w(8571),_=w(8160),b=w(6914),r={};E.type=function(o,i){const s=Object.getPrototypeOf(o),n=A(s),d=o._assign(Object.create(n)),a=Object.assign({},i);delete a.base,n._definition=a;const f=s._definition||{};a.messages=b.merge(f.messages,a.messages),a.properties=Object.assign({},f.properties,a.properties),d.type=a.type,a.flags=Object.assign({},f.flags,a.flags);const y=Object.assign({},f.terms);if(a.terms)for(const C in a.terms){const g=a.terms[C];c(d.$_terms[C]===void 0,"Invalid term override for",a.type,C),d.$_terms[C]=g.init,y[C]=g}a.terms=y,a.args||(a.args=f.args),a.prepare=r.prepare(a.prepare,f.prepare),a.coerce&&(typeof a.coerce=="function"&&(a.coerce={method:a.coerce}),a.coerce.from&&!Array.isArray(a.coerce.from)&&(a.coerce={method:a.coerce.method,from:[].concat(a.coerce.from)})),a.coerce=r.coerce(a.coerce,f.coerce),a.validate=r.validate(a.validate,f.validate);const $=Object.assign({},f.rules);if(a.rules)for(const C in a.rules){const g=a.rules[C];c(typeof g=="object","Invalid rule definition for",a.type,C);let k=g.method;if(k===void 0&&(k=function(){return this.$_addRule(C)}),k&&(c(!n[C],"Rule conflict in",a.type,C),n[C]=k),c(!$[C],"Rule conflict in",a.type,C),$[C]=g,g.alias){const j=[].concat(g.alias);for(const B of j)n[B]=g.method}g.args&&(g.argsByName=new Map,g.args=g.args.map(j=>(typeof j=="string"&&(j={name:j}),c(!g.argsByName.has(j.name),"Duplicated argument name",j.name),_.isSchema(j.assert)&&(j.assert=j.assert.strict().label(j.name)),g.argsByName.set(j.name,j),j)))}a.rules=$;const S=Object.assign({},f.modifiers);if(a.modifiers)for(const C in a.modifiers){c(!n[C],"Rule conflict in",a.type,C);const g=a.modifiers[C];c(typeof g=="function","Invalid modifier definition for",a.type,C);const k=function(j){return this.rule({[C]:j})};n[C]=k,S[C]=g}if(a.modifiers=S,a.overrides){n._super=s,d.$_super={};for(const C in a.overrides)c(s[C],"Cannot override missing",C),a.overrides[C][_.symbols.parent]=s[C],d.$_super[C]=s[C].bind(d);Object.assign(n,a.overrides)}a.cast=Object.assign({},f.cast,a.cast);const I=Object.assign({},f.manifest,a.manifest);return I.build=r.build(a.manifest&&a.manifest.build,f.manifest&&f.manifest.build),a.manifest=I,a.rebuild=r.rebuild(a.rebuild,f.rebuild),d},r.build=function(o,i){return o&&i?function(s,n){return i(o(s,n),n)}:o||i},r.coerce=function(o,i){return o&&i?{from:o.from&&i.from?[...new Set([...o.from,...i.from])]:null,method(s,n){let d;if((!i.from||i.from.includes(typeof s))&&(d=i.method(s,n),d)){if(d.errors||d.value===void 0)return d;s=d.value}if(!o.from||o.from.includes(typeof s)){const a=o.method(s,n);if(a)return a}return d}}:o||i},r.prepare=function(o,i){return o&&i?function(s,n){const d=o(s,n);if(d){if(d.errors||d.value===void 0)return d;s=d.value}return i(s,n)||d}:o||i},r.rebuild=function(o,i){return o&&i?function(s){i(s),o(s)}:o||i},r.validate=function(o,i){return o&&i?function(s,n){const d=i(s,n);if(d){if(d.errors&&(!Array.isArray(d.errors)||d.errors.length))return d;s=d.value}return o(s,n)||d}:o||i}},5107:(P,E,w)=>{const c=w(375),A=w(8571),_=w(8652),b=w(8160),r=w(3292),o=w(6354),i=w(8901),s=w(9708),n=w(6133),d=w(3328),a=w(1152);let f;const y={types:{alternatives:w(4946),any:w(8068),array:w(546),boolean:w(4937),date:w(7500),function:w(390),link:w(8785),number:w(3832),object:w(8966),string:w(7417),symbol:w(8826)},aliases:{alt:"alternatives",bool:"boolean",func:"function"},root:function(){const $={_types:new Set(Object.keys(y.types))};for(const S of $._types)$[S]=function(...I){return c(!I.length||["alternatives","link","object"].includes(S),"The",S,"type does not allow arguments"),y.generate(this,y.types[S],I)};for(const S of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])$[S]=function(...I){return this.any()[S](...I)};Object.assign($,y.methods);for(const S in y.aliases){const I=y.aliases[S];$[S]=$[I]}return $.x=$.expression,a.setup&&a.setup($),$}};y.methods={ValidationError:o.ValidationError,version:b.version,cache:_.provider,assert($,S,...I){y.assert($,S,!0,I)},attempt:($,S,...I)=>y.assert($,S,!1,I),build($){return c(typeof s.build=="function","Manifest functionality disabled"),s.build(this,$)},checkPreferences($){b.checkPreferences($)},compile($,S){return r.compile(this,$,S)},defaults($){c(typeof $=="function","modifier must be a function");const S=Object.assign({},this);for(const I of S._types){const C=$(S[I]());c(b.isSchema(C),"modifier must return a valid schema object"),S[I]=function(...g){return y.generate(this,C,g)}}return S},expression:(...$)=>new d(...$),extend(...$){b.verifyFlat($,"extend"),f=f||w(3378),c($.length,"You need to provide at least one extension"),this.assert($,f.extensions);const S=Object.assign({},this);S._types=new Set(S._types);for(let I of $){typeof I=="function"&&(I=I(S)),this.assert(I,f.extension);const C=y.expandExtension(I,S);for(const g of C){c(S[g.type]===void 0||S._types.has(g.type),"Cannot override name",g.type);const k=g.base||this.any(),j=i.type(k,g);S._types.add(g.type),S[g.type]=function(...B){return y.generate(this,j,B)}}}return S},isError:o.ValidationError.isError,isExpression:d.isTemplate,isRef:n.isRef,isSchema:b.isSchema,in:(...$)=>n.in(...$),override:b.symbols.override,ref:(...$)=>n.create(...$),types(){const $={};for(const S of this._types)$[S]=this[S]();for(const S in y.aliases)$[S]=this[S]();return $}},y.assert=function($,S,I,C){const g=C[0]instanceof Error||typeof C[0]=="string"?C[0]:null,k=g!==null?C[1]:C[0],j=S.validate($,b.preferences({errors:{stack:!0}},k||{}));let B=j.error;if(!B)return j.value;if(g instanceof Error)throw g;const Q=I&&typeof B.annotate=="function"?B.annotate():B.message;throw B instanceof o.ValidationError==0&&(B=A(B)),B.message=g?`${g} ${Q}`:Q,B},y.generate=function($,S,I){return c($,"Must be invoked on a Joi instance."),S.$_root=$,S._definition.args&&I.length?S._definition.args(S,...I):S},y.expandExtension=function($,S){if(typeof $.type=="string")return[$];const I=[];for(const C of S._types)if($.type.test(C)){const g=Object.assign({},$);g.type=C,g.base=S[C](),I.push(g)}return I},P.exports=y.root()},6914:(P,E,w)=>{const c=w(375),A=w(8571),_=w(3328);E.compile=function(b,r){if(typeof b=="string")return c(!r,"Cannot set single message string"),new _(b);if(_.isTemplate(b))return c(!r,"Cannot set single message template"),b;c(typeof b=="object"&&!Array.isArray(b),"Invalid message options"),r=r?A(r):{};for(let o in b){const i=b[o];if(o==="root"||_.isTemplate(i)){r[o]=i;continue}if(typeof i=="string"){r[o]=new _(i);continue}c(typeof i=="object"&&!Array.isArray(i),"Invalid message for",o);const s=o;for(o in r[s]=r[s]||{},i){const n=i[o];o==="root"||_.isTemplate(n)?r[s][o]=n:(c(typeof n=="string","Invalid message for",o,"in",s),r[s][o]=new _(n))}}return r},E.decompile=function(b){const r={};for(let o in b){const i=b[o];if(o==="root"){r.root=i;continue}if(_.isTemplate(i)){r[o]=i.describe({compact:!0});continue}const s=o;for(o in r[s]={},i){const n=i[o];o!=="root"?r[s][o]=n.describe({compact:!0}):r[s].root=n}}return r},E.merge=function(b,r){if(!b)return E.compile(r);if(!r)return b;if(typeof r=="string")return new _(r);if(_.isTemplate(r))return r;const o=A(b);for(let i in r){const s=r[i];if(i==="root"||_.isTemplate(s)){o[i]=s;continue}if(typeof s=="string"){o[i]=new _(s);continue}c(typeof s=="object"&&!Array.isArray(s),"Invalid message for",i);const n=i;for(i in o[n]=o[n]||{},s){const d=s[i];i==="root"||_.isTemplate(d)?o[n][i]=d:(c(typeof d=="string","Invalid message for",i,"in",n),o[n][i]=new _(d))}}return o}},2294:(P,E,w)=>{const c=w(375),A=w(8160),_=w(6133),b={};E.Ids=b.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){const r=new b.Ids;return r._byId=new Map(this._byId),r._byKey=new Map(this._byKey),r._schemaChain=this._schemaChain,r}concat(r){r._schemaChain&&(this._schemaChain=!0);for(const[o,i]of r._byId.entries())c(!this._byKey.has(o),"Schema id conflicts with existing key:",o),this._byId.set(o,i);for(const[o,i]of r._byKey.entries())c(!this._byId.has(o),"Schema key conflicts with existing id:",o),this._byKey.set(o,i)}fork(r,o,i){const s=this._collect(r);s.push({schema:i});const n=s.shift();let d={id:n.id,schema:o(n.schema)};c(A.isSchema(d.schema),"adjuster function failed to return a joi schema type");for(const a of s)d={id:a.id,schema:b.fork(a.schema,d.id,d.schema)};return d.schema}labels(r,o=[]){const i=r[0],s=this._get(i);if(!s)return[...o,...r].join(".");const n=r.slice(1);return o=[...o,s.schema._flags.label||i],n.length?s.schema._ids.labels(n,o):o.join(".")}reach(r,o=[]){const i=r[0],s=this._get(i);c(s,"Schema does not contain path",[...o,...r].join("."));const n=r.slice(1);return n.length?s.schema._ids.reach(n,[...o,i]):s.schema}register(r,{key:o}={}){if(!r||!A.isSchema(r))return;(r.$_property("schemaChain")||r._ids._schemaChain)&&(this._schemaChain=!0);const i=r._flags.id;if(i){const s=this._byId.get(i);c(!s||s.schema===r,"Cannot add different schemas with the same id:",i),c(!this._byKey.has(i),"Schema id conflicts with existing key:",i),this._byId.set(i,{schema:r,id:i})}o&&(c(!this._byKey.has(o),"Schema already contains key:",o),c(!this._byId.has(o),"Schema key conflicts with existing id:",o),this._byKey.set(o,{schema:r,id:o}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(r,o=[],i=[]){const s=r[0],n=this._get(s);c(n,"Schema does not contain path",[...o,...r].join(".")),i=[n,...i];const d=r.slice(1);return d.length?n.schema._ids._collect(d,[...o,s],i):i}_get(r){return this._byId.get(r)||this._byKey.get(r)}},b.fork=function(r,o,i){const s=E.schema(r,{each:(n,{key:d})=>{if(o===(n._flags.id||d))return i},ref:!1});return s?s.$_mutateRebuild():r},E.schema=function(r,o){let i;for(const s in r._flags){if(s[0]==="_")continue;const n=b.scan(r._flags[s],{source:"flags",name:s},o);n!==void 0&&(i=i||r.clone(),i._flags[s]=n)}for(let s=0;s<r._rules.length;++s){const n=r._rules[s],d=b.scan(n.args,{source:"rules",name:n.name},o);if(d!==void 0){i=i||r.clone();const a=Object.assign({},n);a.args=d,i._rules[s]=a,i._singleRules.get(n.name)===n&&i._singleRules.set(n.name,a)}}for(const s in r.$_terms){if(s[0]==="_")continue;const n=b.scan(r.$_terms[s],{source:"terms",name:s},o);n!==void 0&&(i=i||r.clone(),i.$_terms[s]=n)}return i},b.scan=function(r,o,i,s,n){const d=s||[];if(r===null||typeof r!="object")return;let a;if(Array.isArray(r)){for(let f=0;f<r.length;++f){const y=o.source==="terms"&&o.name==="keys"&&r[f].key,$=b.scan(r[f],o,i,[f,...d],y);$!==void 0&&(a=a||r.slice(),a[f]=$)}return a}if(i.schema!==!1&&A.isSchema(r)||i.ref!==!1&&_.isRef(r)){const f=i.each(r,{...o,path:d,key:n});return f===r?void 0:f}for(const f in r){if(f[0]==="_")continue;const y=b.scan(r[f],o,i,[f,...d],n);y!==void 0&&(a=a||Object.assign({},r),a[f]=y)}return a}},6133:(P,E,w)=>{const c=w(375),A=w(8571),_=w(9621),b=w(8160);let r;const o={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};E.create=function(i,s={}){c(typeof i=="string","Invalid reference key:",i),b.assertOptions(s,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),c(!s.prefix||typeof s.prefix=="object","options.prefix must be of type object");const n=Object.assign({},o.defaults,s);delete n.prefix;const d=n.separator,a=o.context(i,d,s.prefix);if(n.type=a.type,i=a.key,n.type==="value")if(a.root&&(c(!d||i[0]!==d,"Cannot specify relative path with root prefix"),n.ancestor="root",i||(i=null)),d&&d===i)i=null,n.ancestor=0;else if(n.ancestor!==void 0)c(!d||!i||i[0]!==d,"Cannot combine prefix with ancestor option");else{const[f,y]=o.ancestor(i,d);y&&(i=i.slice(y))===""&&(i=null),n.ancestor=f}return n.path=d?i===null?[]:i.split(d):[i],new o.Ref(n)},E.in=function(i,s={}){return E.create(i,{...s,in:!0})},E.isRef=function(i){return!!i&&!!i[b.symbols.ref]},o.Ref=class{constructor(i){c(typeof i=="object","Invalid reference construction"),b.assertOptions(i,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),c([!1,void 0].includes(i.separator)||typeof i.separator=="string"&&i.separator.length===1,"Invalid separator"),c(!i.adjust||typeof i.adjust=="function","options.adjust must be a function"),c(!i.map||Array.isArray(i.map),"options.map must be an array"),c(!i.map||!i.adjust,"Cannot set both map and adjust options"),Object.assign(this,o.defaults,i),c(this.type==="value"||this.ancestor===void 0,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(i,s,n,d,a={}){return c(!this.in||a.in,"Invalid in() reference usage"),this.type==="global"?this._resolve(n.context,s,a):this.type==="local"?this._resolve(d,s,a):this.ancestor?this.ancestor==="root"?this._resolve(s.ancestors[s.ancestors.length-1],s,a):(c(this.ancestor<=s.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(s.ancestors[this.ancestor-1],s,a)):this._resolve(i,s,a)}_resolve(i,s,n){let d;if(this.type==="value"&&s.mainstay.shadow&&n.shadow!==!1&&(d=s.mainstay.shadow.get(this.absolute(s))),d===void 0&&(d=_(i,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(d=this.adjust(d)),this.map){const a=this.map.get(d);a!==void 0&&(d=a)}return s.mainstay&&s.mainstay.tracer.resolve(s,this,d),d}toString(){return this.display}absolute(i){return[...i.path.slice(0,-this.ancestor),...this.path]}clone(){return new o.Ref(this)}describe(){const i={path:this.path};this.type!=="value"&&(i.type=this.type),this.separator!=="."&&(i.separator=this.separator),this.type==="value"&&this.ancestor!==1&&(i.ancestor=this.ancestor),this.map&&(i.map=[...this.map]);for(const s of["adjust","iterables","render"])this[s]!==null&&this[s]!==void 0&&(i[s]=this[s]);return this.in!==!1&&(i.in=!0),{ref:i}}updateDisplay(){const i=this.key!==null?this.key:"";if(this.type!=="value")return void(this.display=`ref:${this.type}:${i}`);if(!this.separator)return void(this.display=`ref:${i}`);if(!this.ancestor)return void(this.display=`ref:${this.separator}${i}`);if(this.ancestor==="root")return void(this.display=`ref:root:${i}`);if(this.ancestor===1)return void(this.display=`ref:${i||".."}`);const s=new Array(this.ancestor+1).fill(this.separator).join("");this.display=`ref:${s}${i||""}`}},o.Ref.prototype[b.symbols.ref]=!0,E.build=function(i){return(i=Object.assign({},o.defaults,i)).type==="value"&&i.ancestor===void 0&&(i.ancestor=1),new o.Ref(i)},o.context=function(i,s,n={}){if(i=i.trim(),n){const d=n.global===void 0?"$":n.global;if(d!==s&&i.startsWith(d))return{key:i.slice(d.length),type:"global"};const a=n.local===void 0?"#":n.local;if(a!==s&&i.startsWith(a))return{key:i.slice(a.length),type:"local"};const f=n.root===void 0?"/":n.root;if(f!==s&&i.startsWith(f))return{key:i.slice(f.length),type:"value",root:!0}}return{key:i,type:"value"}},o.ancestor=function(i,s){if(!s)return[1,0];if(i[0]!==s)return[1,0];if(i[1]!==s)return[0,1];let n=2;for(;i[n]===s;)++n;return[n-1,n]},E.toSibling=0,E.toParent=1,E.Manager=class{constructor(){this.refs=[]}register(i,s){if(i)if(s=s===void 0?E.toParent:s,Array.isArray(i))for(const n of i)this.register(n,s);else if(b.isSchema(i))for(const n of i._refs.refs)n.ancestor-s>=0&&this.refs.push({ancestor:n.ancestor-s,root:n.root});else E.isRef(i)&&i.type==="value"&&i.ancestor-s>=0&&this.refs.push({ancestor:i.ancestor-s,root:i.root}),r=r||w(3328),r.isTemplate(i)&&this.register(i.refs(),s)}get length(){return this.refs.length}clone(){const i=new E.Manager;return i.refs=A(this.refs),i}reset(){this.refs=[]}roots(){return this.refs.filter(i=>!i.ancestor).map(i=>i.root)}}},3378:(P,E,w)=>{const c=w(5107),A={};A.wrap=c.string().min(1).max(2).allow(!1),E.preferences=c.object({allowUnknown:c.boolean(),abortEarly:c.boolean(),artifacts:c.boolean(),cache:c.boolean(),context:c.object(),convert:c.boolean(),dateFormat:c.valid("date","iso","string","time","utc"),debug:c.boolean(),errors:{escapeHtml:c.boolean(),label:c.valid("path","key",!1),language:[c.string(),c.object().ref()],render:c.boolean(),stack:c.boolean(),wrap:{label:A.wrap,array:A.wrap,string:A.wrap}},externals:c.boolean(),messages:c.object(),noDefaults:c.boolean(),nonEnumerables:c.boolean(),presence:c.valid("required","optional","forbidden"),skipFunctions:c.boolean(),stripUnknown:c.object({arrays:c.boolean(),objects:c.boolean()}).or("arrays","objects").allow(!0,!1),warnings:c.boolean()}).strict(),A.nameRx=/^[a-zA-Z0-9]\w*$/,A.rule=c.object({alias:c.array().items(c.string().pattern(A.nameRx)).single(),args:c.array().items(c.string(),c.object({name:c.string().pattern(A.nameRx).required(),ref:c.boolean(),assert:c.alternatives([c.function(),c.object().schema()]).conditional("ref",{is:!0,then:c.required()}),normalize:c.function(),message:c.string().when("assert",{is:c.function(),then:c.required()})})),convert:c.boolean(),manifest:c.boolean(),method:c.function().allow(!1),multi:c.boolean(),validate:c.function()}),E.extension=c.object({type:c.alternatives([c.string(),c.object().regex()]).required(),args:c.function(),cast:c.object().pattern(A.nameRx,c.object({from:c.function().maxArity(1).required(),to:c.function().minArity(1).maxArity(2).required()})),base:c.object().schema().when("type",{is:c.object().regex(),then:c.forbidden()}),coerce:[c.function().maxArity(3),c.object({method:c.function().maxArity(3).required(),from:c.array().items(c.string()).single()})],flags:c.object().pattern(A.nameRx,c.object({setter:c.string(),default:c.any()})),manifest:{build:c.function().arity(2)},messages:[c.object(),c.string()],modifiers:c.object().pattern(A.nameRx,c.function().minArity(1).maxArity(2)),overrides:c.object().pattern(A.nameRx,c.function()),prepare:c.function().maxArity(3),rebuild:c.function().arity(1),rules:c.object().pattern(A.nameRx,A.rule),terms:c.object().pattern(A.nameRx,c.object({init:c.array().allow(null).required(),manifest:c.object().pattern(/.+/,[c.valid("schema","single"),c.object({mapped:c.object({from:c.string().required(),to:c.string().required()}).required()})])})),validate:c.function().maxArity(3)}).strict(),E.extensions=c.array().items(c.object(),c.function().arity(1)).strict(),A.desc={buffer:c.object({buffer:c.string()}),func:c.object({function:c.function().required(),options:{literal:!0}}),override:c.object({override:!0}),ref:c.object({ref:c.object({type:c.valid("value","global","local"),path:c.array().required(),separator:c.string().length(1).allow(!1),ancestor:c.number().min(0).integer().allow("root"),map:c.array().items(c.array().length(2)).min(1),adjust:c.function(),iterables:c.boolean(),in:c.boolean(),render:c.boolean()}).required()}),regex:c.object({regex:c.string().min(3)}),special:c.object({special:c.valid("deep").required()}),template:c.object({template:c.string().required(),options:c.object()}),value:c.object({value:c.alternatives([c.object(),c.array()]).required()})},A.desc.entity=c.alternatives([c.array().items(c.link("...")),c.boolean(),c.function(),c.number(),c.string(),A.desc.buffer,A.desc.func,A.desc.ref,A.desc.regex,A.desc.special,A.desc.template,A.desc.value,c.link("/")]),A.desc.values=c.array().items(null,c.boolean(),c.function(),c.number().allow(1/0,-1/0),c.string().allow(""),c.symbol(),A.desc.buffer,A.desc.func,A.desc.override,A.desc.ref,A.desc.regex,A.desc.template,A.desc.value),A.desc.messages=c.object().pattern(/.+/,[c.string(),A.desc.template,c.object().pattern(/.+/,[c.string(),A.desc.template])]),E.description=c.object({type:c.string().required(),flags:c.object({cast:c.string(),default:c.any(),description:c.string(),empty:c.link("/"),failover:A.desc.entity,id:c.string(),label:c.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:c.boolean(),unit:c.string()}).unknown(),preferences:{allowUnknown:c.boolean(),abortEarly:c.boolean(),artifacts:c.boolean(),cache:c.boolean(),convert:c.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:c.boolean(),label:["path","key"],language:[c.string(),A.desc.ref],wrap:{label:A.wrap,array:A.wrap}},externals:c.boolean(),messages:A.desc.messages,noDefaults:c.boolean(),nonEnumerables:c.boolean(),presence:["required","optional","forbidden"],skipFunctions:c.boolean(),stripUnknown:c.object({arrays:c.boolean(),objects:c.boolean()}).or("arrays","objects").allow(!0,!1),warnings:c.boolean()},allow:A.desc.values,invalid:A.desc.values,rules:c.array().min(1).items({name:c.string().required(),args:c.object().min(1),keep:c.boolean(),message:[c.string(),A.desc.messages],warn:c.boolean()}),keys:c.object().pattern(/.*/,c.link("/")),link:A.desc.ref}).pattern(/^[a-z]\w*$/,c.any())},493:(P,E,w)=>{const c=w(8571),A=w(9621),_=w(8160),b={value:Symbol("value")};P.exports=b.State=class{constructor(r,o,i){this.path=r,this.ancestors=o,this.mainstay=i.mainstay,this.schemas=i.schemas,this.debug=null}localize(r,o=null,i=null){const s=new b.State(r,o,this);return i&&s.schemas&&(s.schemas=[b.schemas(i),...s.schemas]),s}nest(r,o){const i=new b.State(this.path,this.ancestors,this);return i.schemas=i.schemas&&[b.schemas(r),...i.schemas],i.debug=o,i}shadow(r,o){this.mainstay.shadow=this.mainstay.shadow||new b.Shadow,this.mainstay.shadow.set(this.path,r,o)}snapshot(){this.mainstay.shadow&&(this._snapshot=c(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}commit(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.commit()}},b.schemas=function(r){return _.isSchema(r)?{schema:r}:r},b.Shadow=class{constructor(){this._values=null}set(r,o,i){if(!r.length||i==="strip"&&typeof r[r.length-1]=="number")return;this._values=this._values||new Map;let s=this._values;for(let n=0;n<r.length;++n){const d=r[n];let a=s.get(d);a||(a=new Map,s.set(d,a)),s=a}s[b.value]=o}get(r){const o=this.node(r);if(o)return o[b.value]}node(r){if(this._values)return A(this._values,r,{iterables:!0})}override(r,o){if(!this._values)return;const i=r.slice(0,-1),s=r[r.length-1],n=A(this._values,i,{iterables:!0});o?n.set(s,o):n&&n.delete(s)}}},3328:(P,E,w)=>{const c=w(375),A=w(8571),_=w(5277),b=w(1447),r=w(8160),o=w(6354),i=w(6133),s={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};P.exports=s.Template=class{constructor(n,d){if(c(typeof n=="string","Template source must be a string"),c(!n.includes("\0")&&!n.includes(""),"Template source cannot contain reserved control characters"),this.source=n,this.rendered=n,this._template=null,d){const{functions:a,...f}=d;this._settings=Object.keys(f).length?A(f):void 0,this._functions=a,this._functions&&(c(Object.keys(this._functions).every(y=>typeof y=="string"),"Functions keys must be strings"),c(Object.values(this._functions).every(y=>typeof y=="function"),"Functions values must be functions"))}else this._settings=void 0,this._functions=void 0;this._parse()}_parse(){if(!this.source.includes("{"))return;const n=s.encode(this.source),d=s.split(n);let a=!1;const f=[],y=d.shift();y&&f.push(y);for(const $ of d){const S=$[0]!=="{",I=S?"}":"}}",C=$.indexOf(I);if(C===-1||$[1]==="{"){f.push(`{${s.decode($)}`);continue}let g=$.slice(S?0:1,C);const k=g[0]===":";k&&(g=g.slice(1));const j=this._ref(s.decode(g),{raw:S,wrapped:k});f.push(j),typeof j!="string"&&(a=!0);const B=$.slice(C+I.length);B&&f.push(s.decode(B))}a?this._template=f:this.rendered=f.join("")}static date(n,d){return s.dateFormat[d.dateFormat].call(n)}describe(n={}){if(!this._settings&&n.compact)return this.source;const d={template:this.source};return this._settings&&(d.options=this._settings),this._functions&&(d.functions=this._functions),d}static build(n){return new s.Template(n.template,n.options||n.functions?{...n.options,functions:n.functions}:void 0)}isDynamic(){return!!this._template}static isTemplate(n){return!!n&&!!n[r.symbols.template]}refs(){if(!this._template)return;const n=[];for(const d of this._template)typeof d!="string"&&n.push(...d.refs);return n}resolve(n,d,a,f){return this._template&&this._template.length===1?this._part(this._template[0],n,d,a,f,{}):this.render(n,d,a,f)}_part(n,...d){return n.ref?n.ref.resolve(...d):n.formula.evaluate(d)}render(n,d,a,f,y={}){if(!this.isDynamic())return this.rendered;const $=[];for(const S of this._template)if(typeof S=="string")$.push(S);else{const I=this._part(S,n,d,a,f,y),C=s.stringify(I,n,d,a,f,y);if(C!==void 0){const g=S.raw||(y.errors&&y.errors.escapeHtml)===!1?C:_(C);$.push(s.wrap(g,S.wrapped&&a.errors.wrap.label))}}return $.join("")}_ref(n,{raw:d,wrapped:a}){const f=[],y=S=>{const I=i.create(S,this._settings);return f.push(I),C=>{const g=I.resolve(...C);return g!==void 0?g:null}};try{const S=this._functions?{...s.functions,...this._functions}:s.functions;var $=new b.Parser(n,{reference:y,functions:S,constants:s.constants})}catch(S){throw S.message=`Invalid template variable "${n}" fails due to: ${S.message}`,S}if($.single){if($.single.type==="reference"){const S=f[0];return{ref:S,raw:d,refs:f,wrapped:a||S.type==="local"&&S.key==="label"}}return s.stringify($.single.value)}return{formula:$,raw:d,refs:f}}toString(){return this.source}},s.Template.prototype[r.symbols.template]=!0,s.Template.prototype.isImmutable=!0,s.encode=function(n){return n.replace(/\\(\{+)/g,(d,a)=>s.opens.slice(0,a.length)).replace(/\\(\}+)/g,(d,a)=>s.closes.slice(0,a.length))},s.decode=function(n){return n.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},s.split=function(n){const d=[];let a="";for(let f=0;f<n.length;++f){const y=n[f];if(y==="{"){let $="";for(;f+1<n.length&&n[f+1]==="{";)$+="{",++f;d.push(a),a=$}else a+=y}return d.push(a),d},s.wrap=function(n,d){return d?d.length===1?`${d}${n}${d}`:`${d[0]}${n}${d[1]}`:n},s.stringify=function(n,d,a,f,y,$={}){const S=typeof n,I=f&&f.errors&&f.errors.wrap||{};let C=!1;if(i.isRef(n)&&n.render&&(C=n.in,n=n.resolve(d,a,f,y,{in:n.in,...$})),n===null)return"null";if(S==="string")return s.wrap(n,$.arrayItems&&I.string);if(S==="number"||S==="function"||S==="symbol")return n.toString();if(S!=="object")return JSON.stringify(n);if(n instanceof Date)return s.Template.date(n,f);if(n instanceof Map){const k=[];for(const[j,B]of n.entries())k.push(`${j.toString()} -> ${B.toString()}`);n=k}if(!Array.isArray(n))return n.toString();const g=[];for(const k of n)g.push(s.stringify(k,d,a,f,y,{arrayItems:!0,...$}));return s.wrap(g.join(", "),!C&&I.array)},s.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},s.functions={if:(n,d,a)=>n?d:a,length:n=>typeof n=="string"?n.length:n&&typeof n=="object"?Array.isArray(n)?n.length:Object.keys(n).length:null,msg(n){const[d,a,f,y,$]=this,S=$.messages;if(!S)return"";const I=o.template(d,S[0],n,a,f)||o.template(d,S[1],n,a,f);return I?I.render(d,a,f,y,$):""},number:n=>typeof n=="number"?n:typeof n=="string"?parseFloat(n):typeof n=="boolean"?n?1:0:n instanceof Date?n.getTime():null}},4946:(P,E,w)=>{const c=w(375),A=w(1687),_=w(8068),b=w(8160),r=w(3292),o=w(6354),i=w(6133),s={};P.exports=_.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:i.toSibling}},args:(n,...d)=>d.length===1&&Array.isArray(d[0])?n.try(...d[0]):n.try(...d),validate(n,d){const{schema:a,error:f,state:y,prefs:$}=d;if(a._flags.match){const I=[],C=[];for(let k=0;k<a.$_terms.matches.length;++k){const j=a.$_terms.matches[k],B=y.nest(j.schema,`match.${k}`);B.snapshot();const Q=j.schema.$_validate(n,B,$);Q.errors?(C.push(Q.errors),B.restore()):(I.push(Q.value),B.commit())}if(I.length===0)return{errors:f("alternatives.any",{details:C.map(k=>o.details(k,{override:!1}))})};if(a._flags.match==="one")return I.length===1?{value:I[0]}:{errors:f("alternatives.one")};if(I.length!==a.$_terms.matches.length)return{errors:f("alternatives.all",{details:C.map(k=>o.details(k,{override:!1}))})};const g=k=>k.$_terms.matches.some(j=>j.schema.type==="object"||j.schema.type==="alternatives"&&g(j.schema));return g(a)?{value:I.reduce((k,j)=>A(k,j,{mergeArrays:!1}))}:{value:I[I.length-1]}}const S=[];for(let I=0;I<a.$_terms.matches.length;++I){const C=a.$_terms.matches[I];if(C.schema){const j=y.nest(C.schema,`match.${I}`);j.snapshot();const B=C.schema.$_validate(n,j,$);if(!B.errors)return j.commit(),B;j.restore(),S.push({schema:C.schema,reports:B.errors});continue}const g=C.ref?C.ref.resolve(n,y,$):n,k=C.is?[C]:C.switch;for(let j=0;j<k.length;++j){const B=k[j],{is:Q,then:J,otherwise:ae}=B,oe=`match.${I}${C.switch?"."+j:""}`;if(Q.$_match(g,y.nest(Q,`${oe}.is`),$)){if(J)return J.$_validate(n,y.nest(J,`${oe}.then`),$)}else if(ae)return ae.$_validate(n,y.nest(ae,`${oe}.otherwise`),$)}}return s.errors(S,d)},rules:{conditional:{method(n,d){c(!this._flags._endedSwitch,"Unreachable condition"),c(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),c(d.break===void 0,"Cannot use break option with alternatives conditional");const a=this.clone(),f=r.when(a,n,d),y=f.is?[f]:f.switch;for(const $ of y)if($.then&&$.otherwise){a.$_setFlag("_endedSwitch",!0,{clone:!1});break}return a.$_terms.matches.push(f),a.$_mutateRebuild()}},match:{method(n){if(c(["any","one","all"].includes(n),"Invalid alternatives match mode",n),n!=="any")for(const d of this.$_terms.matches)c(d.schema,"Cannot combine match mode",n,"with conditional rules");return this.$_setFlag("match",n)}},try:{method(...n){c(n.length,"Missing alternative schemas"),b.verifyFlat(n,"try"),c(!this._flags._endedSwitch,"Unreachable condition");const d=this.clone();for(const a of n)d.$_terms.matches.push({schema:d.$_compile(a)});return d.$_mutateRebuild()}}},overrides:{label(n){return this.$_parent("label",n).$_modify({each:(d,a)=>a.path[0]!=="is"&&typeof d._flags.label!="string"?d.label(n):void 0,ref:!1})}},rebuild(n){n.$_modify({each:d=>{b.isSchema(d)&&d.type==="array"&&n.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(n,d){if(d.matches)for(const a of d.matches){const{schema:f,ref:y,is:$,not:S,then:I,otherwise:C}=a;n=f?n.try(f):y?n.conditional(y,{is:$,then:I,not:S,otherwise:C,switch:a.switch}):n.conditional($,{then:I,otherwise:C})}return n}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),s.errors=function(n,{error:d,state:a}){if(!n.length)return{errors:d("alternatives.any")};if(n.length===1)return{errors:n[0].reports};const f=new Set,y=[];for(const{reports:$,schema:S}of n){if($.length>1)return s.unmatched(n,d);const I=$[0];if(I instanceof o.Report==0)return s.unmatched(n,d);if(I.state.path.length!==a.path.length){y.push({type:S.type,report:I});continue}if(I.code==="any.only"){for(const k of I.local.valids)f.add(k);continue}const[C,g]=I.code.split(".");g!=="base"?y.push({type:S.type,report:I}):I.code==="object.base"?f.add(I.local.type):f.add(C)}return y.length?y.length===1?{errors:y[0].report}:s.unmatched(n,d):{errors:d("alternatives.types",{types:[...f]})}},s.unmatched=function(n,d){const a=[];for(const f of n)a.push(...f.reports);return{errors:d("alternatives.match",o.details(a,{override:!1}))}}},8068:(P,E,w)=>{const c=w(375),A=w(7629),_=w(8160),b=w(6914);P.exports=A.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(r,o){return c(typeof r=="function","Method must be a function"),c(o===void 0||o&&typeof o=="string","Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:r,description:o}})},validate(r,o,{method:i}){try{return i(r,o)}catch(s){return o.error("any.custom",{error:s})}},args:["method","description"],multi:!0},messages:{method(r){return this.prefs({messages:r})}},shared:{method(r){c(_.isSchema(r)&&r._flags.id,"Schema must be a schema with an id");const o=this.clone();return o.$_terms.shared=o.$_terms.shared||[],o.$_terms.shared.push(r),o.$_mutateRegister(r),o}},warning:{method(r,o){return c(r&&typeof r=="string","Invalid warning code"),this.$_addRule({name:"warning",args:{code:r,local:o},warn:!0})},validate:(r,o,{code:i,local:s})=>o.error(i,s),args:["code","local"],multi:!0}},modifiers:{keep(r,o=!0){r.keep=o},message(r,o){r.message=b.compile(o)},warn(r,o=!0){r.warn=o}},manifest:{build(r,o){for(const i in o){const s=o[i];if(["examples","externals","metas","notes","tags"].includes(i))for(const n of s)r=r[i.slice(0,-1)](n);else if(i!=="alterations")if(i!=="whens"){if(i==="shared")for(const n of s)r=r.shared(n)}else for(const n of s){const{ref:d,is:a,not:f,then:y,otherwise:$,concat:S}=n;r=S?r.concat(S):d?r.when(d,{is:a,not:f,then:y,otherwise:$,switch:n.switch,break:n.break}):r.when(a,{then:y,otherwise:$,break:n.break})}else{const n={};for(const{target:d,adjuster:a}of s)n[d]=a;r=r.alter(n)}}return r}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}})},546:(P,E,w)=>{const c=w(375),A=w(9474),_=w(9621),b=w(8068),r=w(8160),o=w(3292),i={};P.exports=b.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(s,{schema:n,state:d,prefs:a}){if(!Array.isArray(s))return;const f=n.$_getRule("sort");return f?i.sort(n,s,f.args.options,d,a):void 0}},validate(s,{schema:n,error:d}){if(!Array.isArray(s)){if(n._flags.single){const a=[s];return a[r.symbols.arraySingle]=!0,{value:a}}return{errors:d("array.base")}}if(n.$_getRule("items")||n.$_terms.externals)return{value:s.slice()}},rules:{has:{method(s){s=this.$_compile(s,{appendPath:!0});const n=this.$_addRule({name:"has",args:{schema:s}});return n.$_mutateRegister(s),n},validate(s,{state:n,prefs:d,error:a},{schema:f}){const y=[s,...n.ancestors];for(let S=0;S<s.length;++S){const I=n.localize([...n.path,S],y,f);if(f.$_match(s[S],I,d))return s}const $=f._flags.label;return $?a("array.hasKnown",{patternLabel:$}):a("array.hasUnknown",null)},multi:!0},items:{method(...s){r.verifyFlat(s,"items");const n=this.$_addRule("items");for(let d=0;d<s.length;++d){const a=r.tryWithPath(()=>this.$_compile(s[d]),d,{append:!0});n.$_terms.items.push(a)}return n.$_mutateRebuild()},validate(s,{schema:n,error:d,state:a,prefs:f,errorsArray:y}){const $=n.$_terms._requireds.slice(),S=n.$_terms.ordered.slice(),I=[...n.$_terms._inclusions,...$],C=!s[r.symbols.arraySingle];delete s[r.symbols.arraySingle];const g=y();let k=s.length;for(let j=0;j<k;++j){const B=s[j];let Q=!1,J=!1;const ae=C?j:new Number(j),oe=[...a.path,ae];if(!n._flags.sparse&&B===void 0){if(g.push(d("array.sparse",{key:ae,path:oe,pos:j,value:void 0},a.localize(oe))),f.abortEarly)return g;S.shift();continue}const de=[s,...a.ancestors];for(const me of n.$_terms._exclusions)if(me.$_match(B,a.localize(oe,de,me),f,{presence:"ignore"})){if(g.push(d("array.excludes",{pos:j,value:B},a.localize(oe))),f.abortEarly)return g;Q=!0,S.shift();break}if(Q)continue;if(n.$_terms.ordered.length){if(S.length){const me=S.shift(),ye=me.$_validate(B,a.localize(oe,de,me),f);if(ye.errors){if(g.push(...ye.errors),f.abortEarly)return g}else if(me._flags.result==="strip")i.fastSplice(s,j),--j,--k;else{if(!n._flags.sparse&&ye.value===void 0){if(g.push(d("array.sparse",{key:ae,path:oe,pos:j,value:void 0},a.localize(oe))),f.abortEarly)return g;continue}s[j]=ye.value}continue}if(!n.$_terms.items.length){if(g.push(d("array.orderedLength",{pos:j,limit:n.$_terms.ordered.length})),f.abortEarly)return g;break}}const ve=[];let we=$.length;for(let me=0;me<we;++me){const ye=a.localize(oe,de,$[me]);ye.snapshot();const Re=$[me].$_validate(B,ye,f);if(ve[me]=Re,!Re.errors){if(ye.commit(),s[j]=Re.value,J=!0,i.fastSplice($,me),--me,--we,!n._flags.sparse&&Re.value===void 0&&(g.push(d("array.sparse",{key:ae,path:oe,pos:j,value:void 0},a.localize(oe))),f.abortEarly))return g;break}ye.restore()}if(J)continue;const Se=f.stripUnknown&&!!f.stripUnknown.arrays||!1;we=I.length;for(const me of I){let ye;const Re=$.indexOf(me);if(Re!==-1)ye=ve[Re];else{const Ce=a.localize(oe,de,me);if(Ce.snapshot(),ye=me.$_validate(B,Ce,f),!ye.errors){Ce.commit(),me._flags.result==="strip"?(i.fastSplice(s,j),--j,--k):n._flags.sparse||ye.value!==void 0?s[j]=ye.value:(g.push(d("array.sparse",{key:ae,path:oe,pos:j,value:void 0},a.localize(oe))),Q=!0),J=!0;break}Ce.restore()}if(we===1){if(Se){i.fastSplice(s,j),--j,--k,J=!0;break}if(g.push(...ye.errors),f.abortEarly)return g;Q=!0;break}}if(!Q&&(n.$_terms._inclusions.length||n.$_terms._requireds.length)&&!J){if(Se){i.fastSplice(s,j),--j,--k;continue}if(g.push(d("array.includes",{pos:j,value:B},a.localize(oe))),f.abortEarly)return g}}return $.length&&i.fillMissedErrors(n,g,$,s,a,f),S.length&&(i.fillOrderedErrors(n,g,S,s,a,f),g.length||i.fillDefault(S,s,a,f)),g.length?g:s},priority:!0,manifest:!1},length:{method(s){return this.$_addRule({name:"length",args:{limit:s},operator:"="})},validate:(s,n,{limit:d},{name:a,operator:f,args:y})=>r.compare(s.length,d,f)?s:n.error("array."+a,{limit:y.limit,value:s}),args:[{name:"limit",ref:!0,assert:r.limit,message:"must be a positive integer"}]},max:{method(s){return this.$_addRule({name:"max",method:"length",args:{limit:s},operator:"<="})}},min:{method(s){return this.$_addRule({name:"min",method:"length",args:{limit:s},operator:">="})}},ordered:{method(...s){r.verifyFlat(s,"ordered");const n=this.$_addRule("items");for(let d=0;d<s.length;++d){const a=r.tryWithPath(()=>this.$_compile(s[d]),d,{append:!0});i.validateSingle(a,n),n.$_mutateRegister(a),n.$_terms.ordered.push(a)}return n.$_mutateRebuild()}},single:{method(s){const n=s===void 0||!!s;return c(!n||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",n)}},sort:{method(s={}){r.assertOptions(s,["by","order"]);const n={order:s.order||"ascending"};return s.by&&(n.by=o.ref(s.by,{ancestor:0}),c(!n.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:n}})},validate(s,{error:n,state:d,prefs:a,schema:f},{options:y}){const{value:$,errors:S}=i.sort(f,s,y,d,a);if(S)return S;for(let I=0;I<s.length;++I)if(s[I]!==$[I])return n("array.sort",{order:y.order,by:y.by?y.by.key:"value"});return s},convert:!0},sparse:{method(s){const n=s===void 0||!!s;return this._flags.sparse===n?this:(n?this.clone():this.$_addRule("items")).$_setFlag("sparse",n,{clone:!1})}},unique:{method(s,n={}){c(!s||typeof s=="function"||typeof s=="string","comparator must be a function or a string"),r.assertOptions(n,["ignoreUndefined","separator"]);const d={name:"unique",args:{options:n,comparator:s}};if(s)if(typeof s=="string"){const a=r.default(n.separator,".");d.path=a?s.split(a):[s]}else d.comparator=s;return this.$_addRule(d)},validate(s,{state:n,error:d,schema:a},{comparator:f,options:y},{comparator:$,path:S}){const I={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),bigint:Object.create(null),object:new Map,function:new Map,custom:new Map},C=$||A,g=y.ignoreUndefined;for(let k=0;k<s.length;++k){const j=S?_(s[k],S):s[k],B=$?I.custom:I[typeof j];if(c(B,"Failed to find unique map container for type",typeof j),B instanceof Map){const Q=B.entries();let J;for(;!(J=Q.next()).done;)if(C(J.value[0],j)){const ae=n.localize([...n.path,k],[s,...n.ancestors]),oe={pos:k,value:s[k],dupePos:J.value[1],dupeValue:s[J.value[1]]};return S&&(oe.path=f),d("array.unique",oe,ae)}B.set(j,k)}else{if((!g||j!==void 0)&&B[j]!==void 0){const Q={pos:k,value:s[k],dupePos:B[j],dupeValue:s[B[j]]};return S&&(Q.path=f),d("array.unique",Q,n.localize([...n.path,k],[s,...n.ancestors]))}B[j]=k}}return s},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to:(s,n)=>new Set(s)}},rebuild(s){s.$_terms._inclusions=[],s.$_terms._exclusions=[],s.$_terms._requireds=[];for(const n of s.$_terms.items)i.validateSingle(n,s),n._flags.presence==="required"?s.$_terms._requireds.push(n):n._flags.presence==="forbidden"?s.$_terms._exclusions.push(n):s.$_terms._inclusions.push(n);for(const n of s.$_terms.ordered)i.validateSingle(n,s)},manifest:{build:(s,n)=>(n.items&&(s=s.items(...n.items)),n.ordered&&(s=s.ordered(...n.ordered)),s)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),i.fillMissedErrors=function(s,n,d,a,f,y){const $=[];let S=0;for(const I of d){const C=I._flags.label;C?$.push(C):++S}$.length?S?n.push(s.$_createError("array.includesRequiredBoth",a,{knownMisses:$,unknownMisses:S},f,y)):n.push(s.$_createError("array.includesRequiredKnowns",a,{knownMisses:$},f,y)):n.push(s.$_createError("array.includesRequiredUnknowns",a,{unknownMisses:S},f,y))},i.fillOrderedErrors=function(s,n,d,a,f,y){const $=[];for(const S of d)S._flags.presence==="required"&&$.push(S);$.length&&i.fillMissedErrors(s,n,$,a,f,y)},i.fillDefault=function(s,n,d,a){const f=[];let y=!0;for(let $=s.length-1;$>=0;--$){const S=s[$],I=[n,...d.ancestors],C=S.$_validate(void 0,d.localize(d.path,I,S),a).value;if(y){if(C===void 0)continue;y=!1}f.unshift(C)}f.length&&n.push(...f)},i.fastSplice=function(s,n){let d=n;for(;d<s.length;)s[d++]=s[d];--s.length},i.validateSingle=function(s,n){(s.type==="array"||s._flags._arrayItems)&&(c(!n._flags.single,"Cannot specify array item with single rule enabled"),n.$_setFlag("_arrayItems",!0,{clone:!1}))},i.sort=function(s,n,d,a,f){const y=d.order==="ascending"?1:-1,$=-1*y,S=y,I=(C,g)=>{let k=i.compare(C,g,$,S);if(k!==null||(d.by&&(C=d.by.resolve(C,a,f),g=d.by.resolve(g,a,f)),k=i.compare(C,g,$,S),k!==null))return k;const j=typeof C;if(j!==typeof g)throw s.$_createError("array.sort.mismatching",n,null,a,f);if(j!=="number"&&j!=="string")throw s.$_createError("array.sort.unsupported",n,{type:j},a,f);return j==="number"?(C-g)*y:C<g?$:S};try{return{value:n.slice().sort(I)}}catch(C){return{errors:C}}},i.compare=function(s,n,d,a){return s===n?0:s===void 0?1:n===void 0?-1:s===null?a:n===null?d:null}},4937:(P,E,w)=>{const c=w(375),A=w(8068),_=w(8160),b=w(2036),r={isBool:function(o){return typeof o=="boolean"}};P.exports=A.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(o,{schema:i}){if(typeof o!="boolean"){if(typeof o=="string"){const s=i._flags.sensitive?o:o.toLowerCase();o=s==="true"||s!=="false"&&o}return typeof o!="boolean"&&(o=i.$_terms.truthy&&i.$_terms.truthy.has(o,null,null,!i._flags.sensitive)||(!i.$_terms.falsy||!i.$_terms.falsy.has(o,null,null,!i._flags.sensitive))&&o),{value:o}}},validate(o,{error:i}){if(typeof o!="boolean")return{value:o,errors:i("boolean.base")}},rules:{truthy:{method(...o){_.verifyFlat(o,"truthy");const i=this.clone();i.$_terms.truthy=i.$_terms.truthy||new b;for(let s=0;s<o.length;++s){const n=o[s];c(n!==void 0,"Cannot call truthy with undefined"),i.$_terms.truthy.add(n)}return i}},falsy:{method(...o){_.verifyFlat(o,"falsy");const i=this.clone();i.$_terms.falsy=i.$_terms.falsy||new b;for(let s=0;s<o.length;++s){const n=o[s];c(n!==void 0,"Cannot call falsy with undefined"),i.$_terms.falsy.add(n)}return i}},sensitive:{method(o=!0){return this.$_setFlag("sensitive",o)}}},cast:{number:{from:r.isBool,to:(o,i)=>o?1:0},string:{from:r.isBool,to:(o,i)=>o?"true":"false"}},manifest:{build:(o,i)=>(i.truthy&&(o=o.truthy(...i.truthy)),i.falsy&&(o=o.falsy(...i.falsy)),o)},messages:{"boolean.base":"{{#label}} must be a boolean"}})},7500:(P,E,w)=>{const c=w(375),A=w(8068),_=w(8160),b=w(3328),r={isDate:function(o){return o instanceof Date}};P.exports=A.extend({type:"date",coerce:{from:["number","string"],method:(o,{schema:i})=>({value:r.parse(o,i._flags.format)||o})},validate(o,{schema:i,error:s,prefs:n}){if(o instanceof Date&&!isNaN(o.getTime()))return;const d=i._flags.format;return n.convert&&d&&typeof o=="string"?{value:o,errors:s("date.format",{format:d})}:{value:o,errors:s("date.base")}},rules:{compare:{method:!1,validate(o,i,{date:s},{name:n,operator:d,args:a}){const f=s==="now"?Date.now():s.getTime();return _.compare(o.getTime(),f,d)?o:i.error("date."+n,{limit:a.date,value:o})},args:[{name:"date",ref:!0,normalize:o=>o==="now"?o:r.parse(o),assert:o=>o!==null,message:"must have a valid date format"}]},format:{method(o){return c(["iso","javascript","unix"].includes(o),"Unknown date format",o),this.$_setFlag("format",o)}},greater:{method(o){return this.$_addRule({name:"greater",method:"compare",args:{date:o},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(o){return this.$_addRule({name:"less",method:"compare",args:{date:o},operator:"<"})}},max:{method(o){return this.$_addRule({name:"max",method:"compare",args:{date:o},operator:"<="})}},min:{method(o){return this.$_addRule({name:"min",method:"compare",args:{date:o},operator:">="})}},timestamp:{method(o="javascript"){return c(["javascript","unix"].includes(o),'"type" must be one of "javascript, unix"'),this.format(o)}}},cast:{number:{from:r.isDate,to:(o,i)=>o.getTime()},string:{from:r.isDate,to:(o,{prefs:i})=>b.date(o,i)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),r.parse=function(o,i){if(o instanceof Date)return o;if(typeof o!="string"&&(isNaN(o)||!isFinite(o))||/^\s*$/.test(o))return null;if(i==="iso")return _.isIsoDate(o)?r.date(o.toString()):null;const s=o;if(typeof o=="string"&&/^[+-]?\d+(\.\d+)?$/.test(o)&&(o=parseFloat(o)),i){if(i==="javascript")return r.date(1*o);if(i==="unix")return r.date(1e3*o);if(typeof s=="string")return null}return r.date(o)},r.date=function(o){const i=new Date(o);return isNaN(i.getTime())?null:i}},390:(P,E,w)=>{const c=w(375),A=w(7824);P.exports=A.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(_){return c(Number.isSafeInteger(_)&&_>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:_}})},validate:(_,b,{n:r})=>_.length===r?_:b.error("function.arity",{n:r})},class:{method(){return this.$_addRule("class")},validate:(_,b)=>/^\s*class\s/.test(_.toString())?_:b.error("function.class",{value:_})},minArity:{method(_){return c(Number.isSafeInteger(_)&&_>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:_}})},validate:(_,b,{n:r})=>_.length>=r?_:b.error("function.minArity",{n:r})},maxArity:{method(_){return c(Number.isSafeInteger(_)&&_>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:_}})},validate:(_,b,{n:r})=>_.length<=r?_:b.error("function.maxArity",{n:r})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})},7824:(P,E,w)=>{const c=w(978),A=w(375),_=w(8571),b=w(3652),r=w(8068),o=w(8160),i=w(3292),s=w(6354),n=w(6133),d=w(3328),a={renameDefaults:{alias:!1,multiple:!1,override:!1}};P.exports=r.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:void 0}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(f,y)=>f.keys(y),validate(f,{schema:y,error:$,state:S,prefs:I}){if(!f||typeof f!==y.$_property("typeof")||Array.isArray(f))return{value:f,errors:$("object.base",{type:y.$_property("typeof")})};if(!(y.$_terms.renames||y.$_terms.dependencies||y.$_terms.keys||y.$_terms.patterns||y.$_terms.externals))return;f=a.clone(f,I);const C=[];if(y.$_terms.renames&&!a.rename(y,f,S,I,C))return{value:f,errors:C};if(!y.$_terms.keys&&!y.$_terms.patterns&&!y.$_terms.dependencies)return{value:f,errors:C};const g=new Set(Object.keys(f));if(y.$_terms.keys){const k=[f,...S.ancestors];for(const j of y.$_terms.keys){const B=j.key,Q=f[B];g.delete(B);const J=S.localize([...S.path,B],k,j),ae=j.schema.$_validate(Q,J,I);if(ae.errors){if(I.abortEarly)return{value:f,errors:ae.errors};ae.value!==void 0&&(f[B]=ae.value),C.push(...ae.errors)}else j.schema._flags.result==="strip"||ae.value===void 0&&Q!==void 0?delete f[B]:ae.value!==void 0&&(f[B]=ae.value)}}if(g.size||y._flags._hasPatternMatch){const k=a.unknown(y,f,g,C,S,I);if(k)return k}if(y.$_terms.dependencies)for(const k of y.$_terms.dependencies){if(k.key!==null&&a.isPresent(k.options)(k.key.resolve(f,S,I,null,{shadow:!1}))===!1)continue;const j=a.dependencies[k.rel](y,k,f,S,I);if(j){const B=y.$_createError(j.code,f,j.context,S,I);if(I.abortEarly)return{value:f,errors:B};C.push(B)}}return{value:f,errors:C}},rules:{and:{method(...f){return o.verifyFlat(f,"and"),a.dependency(this,"and",null,f)}},append:{method(f){return f==null||Object.keys(f).length===0?this:this.keys(f)}},assert:{method(f,y,$){d.isTemplate(f)||(f=i.ref(f)),A($===void 0||typeof $=="string","Message must be a string"),y=this.$_compile(y,{appendPath:!0});const S=this.$_addRule({name:"assert",args:{subject:f,schema:y,message:$}});return S.$_mutateRegister(f),S.$_mutateRegister(y),S},validate(f,{error:y,prefs:$,state:S},{subject:I,schema:C,message:g}){const k=I.resolve(f,S,$),j=n.isRef(I)?I.absolute(S):[];return C.$_match(k,S.localize(j,[f,...S.ancestors],C),$)?f:y("object.assert",{subject:I,message:g})},args:["subject","schema","message"],multi:!0},instance:{method(f,y){return A(typeof f=="function","constructor must be a function"),y=y||f.name,this.$_addRule({name:"instance",args:{constructor:f,name:y}})},validate:(f,y,{constructor:$,name:S})=>f instanceof $?f:y.error("object.instance",{type:S,value:f}),args:["constructor","name"]},keys:{method(f){A(f===void 0||typeof f=="object","Object schema must be a valid object"),A(!o.isSchema(f),"Object schema cannot be a joi schema");const y=this.clone();if(f)if(Object.keys(f).length){y.$_terms.keys=y.$_terms.keys?y.$_terms.keys.filter($=>!f.hasOwnProperty($.key)):new a.Keys;for(const $ in f)o.tryWithPath(()=>y.$_terms.keys.push({key:$,schema:this.$_compile(f[$])}),$)}else y.$_terms.keys=new a.Keys;else y.$_terms.keys=null;return y.$_mutateRebuild()}},length:{method(f){return this.$_addRule({name:"length",args:{limit:f},operator:"="})},validate:(f,y,{limit:$},{name:S,operator:I,args:C})=>o.compare(Object.keys(f).length,$,I)?f:y.error("object."+S,{limit:C.limit,value:f}),args:[{name:"limit",ref:!0,assert:o.limit,message:"must be a positive integer"}]},max:{method(f){return this.$_addRule({name:"max",method:"length",args:{limit:f},operator:"<="})}},min:{method(f){return this.$_addRule({name:"min",method:"length",args:{limit:f},operator:">="})}},nand:{method(...f){return o.verifyFlat(f,"nand"),a.dependency(this,"nand",null,f)}},or:{method(...f){return o.verifyFlat(f,"or"),a.dependency(this,"or",null,f)}},oxor:{method(...f){return a.dependency(this,"oxor",null,f)}},pattern:{method(f,y,$={}){const S=f instanceof RegExp;S||(f=this.$_compile(f,{appendPath:!0})),A(y!==void 0,"Invalid rule"),o.assertOptions($,["fallthrough","matches"]),S&&A(!f.flags.includes("g")&&!f.flags.includes("y"),"pattern should not use global or sticky mode"),y=this.$_compile(y,{appendPath:!0});const I=this.clone();I.$_terms.patterns=I.$_terms.patterns||[];const C={[S?"regex":"schema"]:f,rule:y};return $.matches&&(C.matches=this.$_compile($.matches),C.matches.type!=="array"&&(C.matches=C.matches.$_root.array().items(C.matches)),I.$_mutateRegister(C.matches),I.$_setFlag("_hasPatternMatch",!0,{clone:!1})),$.fallthrough&&(C.fallthrough=!0),I.$_terms.patterns.push(C),I.$_mutateRegister(y),I}},ref:{method(){return this.$_addRule("ref")},validate:(f,y)=>n.isRef(f)?f:y.error("object.refType",{value:f})},regex:{method(){return this.$_addRule("regex")},validate:(f,y)=>f instanceof RegExp?f:y.error("object.regex",{value:f})},rename:{method(f,y,$={}){A(typeof f=="string"||f instanceof RegExp,"Rename missing the from argument"),A(typeof y=="string"||y instanceof d,"Invalid rename to argument"),A(y!==f,"Cannot rename key to same name:",f),o.assertOptions($,["alias","ignoreUndefined","override","multiple"]);const S=this.clone();S.$_terms.renames=S.$_terms.renames||[];for(const I of S.$_terms.renames)A(I.from!==f,"Cannot rename the same key multiple times");return y instanceof d&&S.$_mutateRegister(y),S.$_terms.renames.push({from:f,to:y,options:c(a.renameDefaults,$)}),S}},schema:{method(f="any"){return this.$_addRule({name:"schema",args:{type:f}})},validate:(f,y,{type:$})=>!o.isSchema(f)||$!=="any"&&f.type!==$?y.error("object.schema",{type:$}):f},unknown:{method(f){return this.$_setFlag("unknown",f!==!1)}},with:{method(f,y,$={}){return a.dependency(this,"with",f,y,$)}},without:{method(f,y,$={}){return a.dependency(this,"without",f,y,$)}},xor:{method(...f){return o.verifyFlat(f,"xor"),a.dependency(this,"xor",null,f)}}},overrides:{default(f,y){return f===void 0&&(f=o.symbols.deepDefault),this.$_parent("default",f,y)}},rebuild(f){if(f.$_terms.keys){const y=new b.Sorter;for(const $ of f.$_terms.keys)o.tryWithPath(()=>y.add($,{after:$.schema.$_rootReferences(),group:$.key}),$.key);f.$_terms.keys=new a.Keys(...y.nodes)}},manifest:{build(f,y){if(y.keys&&(f=f.keys(y.keys)),y.dependencies)for(const{rel:$,key:S=null,peers:I,options:C}of y.dependencies)f=a.dependency(f,$,S,I,C);if(y.patterns)for(const{regex:$,schema:S,rule:I,fallthrough:C,matches:g}of y.patterns)f=f.pattern($||S,I,{fallthrough:C,matches:g});if(y.renames)for(const{from:$,to:S,options:I}of y.renames)f=f.rename($,S,I);return f}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),a.clone=function(f,y){if(typeof f=="object"){if(y.nonEnumerables)return _(f,{shallow:!0});const S=Object.create(Object.getPrototypeOf(f));return Object.assign(S,f),S}const $=function(...S){return f.apply(this,S)};return $.prototype=_(f.prototype),Object.defineProperty($,"name",{value:f.name,writable:!1}),Object.defineProperty($,"length",{value:f.length,writable:!1}),Object.assign($,f),$},a.dependency=function(f,y,$,S,I){A($===null||typeof $=="string",y,"key must be a strings"),I||(I=S.length>1&&typeof S[S.length-1]=="object"?S.pop():{}),o.assertOptions(I,["separator","isPresent"]),S=[].concat(S);const C=o.default(I.separator,"."),g=[];for(const j of S)A(typeof j=="string",y,"peers must be strings"),g.push(i.ref(j,{separator:C,ancestor:0,prefix:!1}));$!==null&&($=i.ref($,{separator:C,ancestor:0,prefix:!1}));const k=f.clone();return k.$_terms.dependencies=k.$_terms.dependencies||[],k.$_terms.dependencies.push(new a.Dependency(y,$,g,S,I)),k},a.dependencies={and(f,y,$,S,I){const C=[],g=[],k=y.peers.length,j=a.isPresent(y.options);for(const B of y.peers)j(B.resolve($,S,I,null,{shadow:!1}))===!1?C.push(B.key):g.push(B.key);if(C.length!==k&&g.length!==k)return{code:"object.and",context:{present:g,presentWithLabels:a.keysToLabels(f,g),missing:C,missingWithLabels:a.keysToLabels(f,C)}}},nand(f,y,$,S,I){const C=[],g=a.isPresent(y.options);for(const B of y.peers)g(B.resolve($,S,I,null,{shadow:!1}))&&C.push(B.key);if(C.length!==y.peers.length)return;const k=y.paths[0],j=y.paths.slice(1);return{code:"object.nand",context:{main:k,mainWithLabel:a.keysToLabels(f,k),peers:j,peersWithLabels:a.keysToLabels(f,j)}}},or(f,y,$,S,I){const C=a.isPresent(y.options);for(const g of y.peers)if(C(g.resolve($,S,I,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:y.paths,peersWithLabels:a.keysToLabels(f,y.paths)}}},oxor(f,y,$,S,I){const C=[],g=a.isPresent(y.options);for(const j of y.peers)g(j.resolve($,S,I,null,{shadow:!1}))&&C.push(j.key);if(!C.length||C.length===1)return;const k={peers:y.paths,peersWithLabels:a.keysToLabels(f,y.paths)};return k.present=C,k.presentWithLabels=a.keysToLabels(f,C),{code:"object.oxor",context:k}},with(f,y,$,S,I){const C=a.isPresent(y.options);for(const g of y.peers)if(C(g.resolve($,S,I,null,{shadow:!1}))===!1)return{code:"object.with",context:{main:y.key.key,mainWithLabel:a.keysToLabels(f,y.key.key),peer:g.key,peerWithLabel:a.keysToLabels(f,g.key)}}},without(f,y,$,S,I){const C=a.isPresent(y.options);for(const g of y.peers)if(C(g.resolve($,S,I,null,{shadow:!1})))return{code:"object.without",context:{main:y.key.key,mainWithLabel:a.keysToLabels(f,y.key.key),peer:g.key,peerWithLabel:a.keysToLabels(f,g.key)}}},xor(f,y,$,S,I){const C=[],g=a.isPresent(y.options);for(const j of y.peers)g(j.resolve($,S,I,null,{shadow:!1}))&&C.push(j.key);if(C.length===1)return;const k={peers:y.paths,peersWithLabels:a.keysToLabels(f,y.paths)};return C.length===0?{code:"object.missing",context:k}:(k.present=C,k.presentWithLabels=a.keysToLabels(f,C),{code:"object.xor",context:k})}},a.keysToLabels=function(f,y){return Array.isArray(y)?y.map($=>f.$_mapLabels($)):f.$_mapLabels(y)},a.isPresent=function(f){return typeof f.isPresent=="function"?f.isPresent:y=>y!==void 0},a.rename=function(f,y,$,S,I){const C={};for(const g of f.$_terms.renames){const k=[],j=typeof g.from!="string";if(j)for(const B in y){if(y[B]===void 0&&g.options.ignoreUndefined||B===g.to)continue;const Q=g.from.exec(B);Q&&k.push({from:B,to:g.to,match:Q})}else!Object.prototype.hasOwnProperty.call(y,g.from)||y[g.from]===void 0&&g.options.ignoreUndefined||k.push(g);for(const B of k){const Q=B.from;let J=B.to;if(J instanceof d&&(J=J.render(y,$,S,B.match)),Q!==J){if(!g.options.multiple&&C[J]&&(I.push(f.$_createError("object.rename.multiple",y,{from:Q,to:J,pattern:j},$,S)),S.abortEarly)||Object.prototype.hasOwnProperty.call(y,J)&&!g.options.override&&!C[J]&&(I.push(f.$_createError("object.rename.override",y,{from:Q,to:J,pattern:j},$,S)),S.abortEarly))return!1;y[Q]===void 0?delete y[J]:y[J]=y[Q],C[J]=!0,g.options.alias||delete y[Q]}}}return!0},a.unknown=function(f,y,$,S,I,C){if(f.$_terms.patterns){let g=!1;const k=f.$_terms.patterns.map(B=>{if(B.matches)return g=!0,[]}),j=[y,...I.ancestors];for(const B of $){const Q=y[B],J=[...I.path,B];for(let ae=0;ae<f.$_terms.patterns.length;++ae){const oe=f.$_terms.patterns[ae];if(oe.regex){const we=oe.regex.test(B);if(I.mainstay.tracer.debug(I,"rule",`pattern.${ae}`,we?"pass":"error"),!we)continue}else if(!oe.schema.$_match(B,I.nest(oe.schema,`pattern.${ae}`),C))continue;$.delete(B);const de=I.localize(J,j,{schema:oe.rule,key:B}),ve=oe.rule.$_validate(Q,de,C);if(ve.errors){if(C.abortEarly)return{value:y,errors:ve.errors};S.push(...ve.errors)}if(oe.matches&&k[ae].push(B),y[B]=ve.value,!oe.fallthrough)break}}if(g)for(let B=0;B<k.length;++B){const Q=k[B];if(!Q)continue;const J=f.$_terms.patterns[B].matches,ae=I.localize(I.path,j,J),oe=J.$_validate(Q,ae,C);if(oe.errors){const de=s.details(oe.errors,{override:!1});de.matches=Q;const ve=f.$_createError("object.pattern.match",y,de,I,C);if(C.abortEarly)return{value:y,errors:ve};S.push(ve)}}}if($.size&&(f.$_terms.keys||f.$_terms.patterns)){if(C.stripUnknown&&f._flags.unknown===void 0||C.skipFunctions){const g=!(!C.stripUnknown||C.stripUnknown!==!0&&!C.stripUnknown.objects);for(const k of $)g?(delete y[k],$.delete(k)):typeof y[k]=="function"&&$.delete(k)}if(!o.default(f._flags.unknown,C.allowUnknown))for(const g of $){const k=I.localize([...I.path,g],[]),j=f.$_createError("object.unknown",y[g],{child:g},k,C,{flags:!1});if(C.abortEarly)return{value:y,errors:j};S.push(j)}}},a.Dependency=class{constructor(f,y,$,S,I){this.rel=f,this.key=y,this.peers=$,this.paths=S,this.options=I}describe(){const f={rel:this.rel,peers:this.paths};return this.key!==null&&(f.key=this.key.key),this.peers[0].separator!=="."&&(f.options={...f.options,separator:this.peers[0].separator}),this.options.isPresent&&(f.options={...f.options,isPresent:this.options.isPresent}),f}},a.Keys=class extends Array{concat(f){const y=this.slice(),$=new Map;for(let S=0;S<y.length;++S)$.set(y[S].key,S);for(const S of f){const I=S.key,C=$.get(I);C!==void 0?y[C]={key:I,schema:y[C].schema.concat(S.schema)}:y.push(S)}return y}}},8785:(P,E,w)=>{const c=w(375),A=w(8068),_=w(8160),b=w(3292),r=w(6354),o={};P.exports=A.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(i,s)=>i.ref(s),validate(i,{schema:s,state:n,prefs:d}){c(s.$_terms.link,"Uninitialized link schema");const a=o.generate(s,i,n,d),f=s.$_terms.link[0].ref;return a.$_validate(i,n.nest(a,`link:${f.display}:${a.type}`),d)},generate:(i,s,n,d)=>o.generate(i,s,n,d),rules:{ref:{method(i){c(!this.$_terms.link,"Cannot reinitialize schema"),i=b.ref(i),c(i.type==="value"||i.type==="local","Invalid reference type:",i.type),c(i.type==="local"||i.ancestor==="root"||i.ancestor>0,"Link cannot reference itself");const s=this.clone();return s.$_terms.link=[{ref:i}],s}},relative:{method(i=!0){return this.$_setFlag("relative",i)}}},overrides:{concat(i){c(this.$_terms.link,"Uninitialized link schema"),c(_.isSchema(i),"Invalid schema object"),c(i.type!=="link","Cannot merge type link with another link");const s=this.clone();return s.$_terms.whens||(s.$_terms.whens=[]),s.$_terms.whens.push({concat:i}),s.$_mutateRebuild()}},manifest:{build:(i,s)=>(c(s.link,"Invalid link description missing link"),i.ref(s.link))}}),o.generate=function(i,s,n,d){let a=n.mainstay.links.get(i);if(a)return a._generate(s,n,d).schema;const f=i.$_terms.link[0].ref,{perspective:y,path:$}=o.perspective(f,n);o.assert(y,"which is outside of schema boundaries",f,i,n,d);try{a=$.length?y.$_reach($):y}catch{o.assert(!1,"to non-existing schema",f,i,n,d)}return o.assert(a.type!=="link","which is another link",f,i,n,d),i._flags.relative||n.mainstay.links.set(i,a),a._generate(s,n,d).schema},o.perspective=function(i,s){if(i.type==="local"){for(const{schema:n,key:d}of s.schemas){if((n._flags.id||d)===i.path[0])return{perspective:n,path:i.path.slice(1)};if(n.$_terms.shared){for(const a of n.$_terms.shared)if(a._flags.id===i.path[0])return{perspective:a,path:i.path.slice(1)}}}return{perspective:null,path:null}}return i.ancestor==="root"?{perspective:s.schemas[s.schemas.length-1].schema,path:i.path}:{perspective:s.schemas[i.ancestor]&&s.schemas[i.ancestor].schema,path:i.path}},o.assert=function(i,s,n,d,a,f){i||c(!1,`"${r.label(d._flags,a,f)}" contains link reference "${n.display}" ${s}`)}},3832:(P,E,w)=>{const c=w(375),A=w(8068),_=w(8160),b={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/,decimalPlaces(r){const o=r.toString(),i=o.indexOf("."),s=o.indexOf("e");return(i<0?0:(s<0?o.length:s)-i-1)+(s<0?0:Math.max(0,-parseInt(o.slice(s+1))))}};P.exports=A.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(r,{schema:o,error:i}){if(!r.match(b.numberRx))return;r=r.trim();const s={value:parseFloat(r)};if(s.value===0&&(s.value=0),!o._flags.unsafe)if(r.match(/e/i)){if(b.extractSignificantDigits(r)!==b.extractSignificantDigits(String(s.value)))return s.errors=i("number.unsafe"),s}else{const n=s.value.toString();if(n.match(/e/i))return s;if(n!==b.normalizeDecimal(r))return s.errors=i("number.unsafe"),s}return s}},validate(r,{schema:o,error:i,prefs:s}){if(r===1/0||r===-1/0)return{value:r,errors:i("number.infinity")};if(!_.isNumber(r))return{value:r,errors:i("number.base")};const n={value:r};if(s.convert){const d=o.$_getRule("precision");if(d){const a=Math.pow(10,d.args.limit);n.value=Math.round(n.value*a)/a}}return n.value===0&&(n.value=0),!o._flags.unsafe&&(r>Number.MAX_SAFE_INTEGER||r<Number.MIN_SAFE_INTEGER)&&(n.errors=i("number.unsafe")),n},rules:{compare:{method:!1,validate:(r,o,{limit:i},{name:s,operator:n,args:d})=>_.compare(r,i,n)?r:o.error("number."+s,{limit:d.limit,value:r}),args:[{name:"limit",ref:!0,assert:_.isNumber,message:"must be a number"}]},greater:{method(r){return this.$_addRule({name:"greater",method:"compare",args:{limit:r},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(r,o)=>Math.trunc(r)-r==0?r:o.error("number.integer")},less:{method(r){return this.$_addRule({name:"less",method:"compare",args:{limit:r},operator:"<"})}},max:{method(r){return this.$_addRule({name:"max",method:"compare",args:{limit:r},operator:"<="})}},min:{method(r){return this.$_addRule({name:"min",method:"compare",args:{limit:r},operator:">="})}},multiple:{method(r){const o=typeof r=="number"?b.decimalPlaces(r):null,i=Math.pow(10,o);return this.$_addRule({name:"multiple",args:{base:r,baseDecimalPlace:o,pfactor:i}})},validate:(r,o,{base:i,baseDecimalPlace:s,pfactor:n},d)=>b.decimalPlaces(r)>s?o.error("number.multiple",{multiple:d.args.base,value:r}):Math.round(n*r)%Math.round(n*i)==0?r:o.error("number.multiple",{multiple:d.args.base,value:r}),args:[{name:"base",ref:!0,assert:r=>typeof r=="number"&&isFinite(r)&&r>0,message:"must be a positive number"},"baseDecimalPlace","pfactor"],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(r,o)=>Number.isSafeInteger(r)&&r>=0&&r<=65535?r:o.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(r){return c(Number.isSafeInteger(r),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:r}})},validate(r,o,{limit:i}){const s=r.toString().match(b.precisionRx);return Math.max((s[1]?s[1].length:0)-(s[2]?parseInt(s[2],10):0),0)<=i?r:o.error("number.precision",{limit:i,value:r})},convert:!0},sign:{method(r){return c(["negative","positive"].includes(r),"Invalid sign",r),this.$_addRule({name:"sign",args:{sign:r}})},validate:(r,o,{sign:i})=>i==="negative"&&r<0||i==="positive"&&r>0?r:o.error(`number.${i}`)},unsafe:{method(r=!0){return c(typeof r=="boolean","enabled must be a boolean"),this.$_setFlag("unsafe",r)}}},cast:{string:{from:r=>typeof r=="number",to:(r,o)=>r.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),b.extractSignificantDigits=function(r){return r.replace(b.exponentialPartRegex,"").replace(b.dotRegex,"").replace(b.trailingZerosRegex,"").replace(b.leadingSignAndZerosRegex,"")},b.normalizeDecimal=function(r){return(r=r.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2")).includes(".")&&r.endsWith("0")&&(r=r.replace(/0+$/,"")),r==="-0"?"0":r}},8966:(P,E,w)=>{const c=w(7824);P.exports=c.extend({type:"object",cast:{map:{from:A=>A&&typeof A=="object",to:(A,_)=>new Map(Object.entries(A))}}})},7417:(P,E,w)=>{const c=w(375),A=w(5380),_=w(1745),b=w(9959),r=w(6064),o=w(9926),i=w(5752),s=w(8068),n=w(8160),d={tlds:o instanceof Set&&{tlds:{allow:o,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:{withPrefix:/^0x[0-9a-f]+$/i,withOptionalPrefix:/^(?:0x)?[0-9a-f]+$/i,withoutPrefix:/^[0-9a-f]+$/i},ipRegex:b.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5",uuidv6:"6",uuidv7:"7",uuidv8:"8"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};P.exports=s.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(a,{schema:f,state:y,prefs:$}){const S=f.$_getRule("normalize");S&&(a=a.normalize(S.args.form));const I=f.$_getRule("case");I&&(a=I.args.direction==="upper"?a.toLocaleUpperCase():a.toLocaleLowerCase());const C=f.$_getRule("trim");if(C&&C.args.enabled&&(a=a.trim()),f.$_terms.replacements)for(const k of f.$_terms.replacements)a=a.replace(k.pattern,k.replacement);const g=f.$_getRule("hex");if(g&&g.args.options.byteAligned&&a.length%2!=0&&(a=`0${a}`),f.$_getRule("isoDate")){const k=d.isoDate(a);k&&(a=k)}if(f._flags.truncate){const k=f.$_getRule("max");if(k){let j=k.args.limit;if(n.isResolvable(j)&&(j=j.resolve(a,y,$),!n.limit(j)))return{value:a,errors:f.$_createError("any.ref",j,{ref:k.args.limit,arg:"limit",reason:"must be a positive integer"},y,$)};a=a.slice(0,j)}}return{value:a}}},validate(a,{schema:f,error:y}){if(typeof a!="string")return{value:a,errors:y("string.base")};if(a===""){const $=f.$_getRule("min");return $&&$.args.limit===0?void 0:{value:a,errors:y("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(a,f)=>/^[a-zA-Z0-9]+$/.test(a)?a:f.error("string.alphanum")},base64:{method(a={}){return n.assertOptions(a,["paddingRequired","urlSafe"]),a={urlSafe:!1,paddingRequired:!0,...a},c(typeof a.paddingRequired=="boolean","paddingRequired must be boolean"),c(typeof a.urlSafe=="boolean","urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:a}})},validate:(a,f,{options:y})=>d.base64Regex[y.paddingRequired][y.urlSafe].test(a)?a:f.error("string.base64")},case:{method(a){return c(["lower","upper"].includes(a),"Invalid case:",a),this.$_addRule({name:"case",args:{direction:a}})},validate:(a,f,{direction:y})=>y==="lower"&&a===a.toLocaleLowerCase()||y==="upper"&&a===a.toLocaleUpperCase()?a:f.error(`string.${y}case`),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(a,f){let y=a.length,$=0,S=1;for(;y--;){const I=a.charAt(y)*S;$+=I-9*(I>9),S^=3}return $>0&&$%10==0?a:f.error("string.creditCard")}},dataUri:{method(a={}){return n.assertOptions(a,["paddingRequired"]),a={paddingRequired:!0,...a},c(typeof a.paddingRequired=="boolean","paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:a}})},validate(a,f,{options:y}){const $=a.match(d.dataUriRegex);return $&&(!$[2]||$[2]!=="base64"||d.base64Regex[y.paddingRequired].false.test($[3]))?a:f.error("string.dataUri")}},domain:{method(a){a&&n.assertOptions(a,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const f=d.addressOptions(a);return this.$_addRule({name:"domain",args:{options:a},address:f})},validate:(a,f,y,{address:$})=>A.isValid(a,$)?a:f.error("string.domain")},email:{method(a={}){n.assertOptions(a,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),c(a.multiple===void 0||typeof a.multiple=="boolean","multiple option must be an boolean");const f=d.addressOptions(a),y=new RegExp(`\\s*[${a.separator?r(a.separator):","}]\\s*`);return this.$_addRule({name:"email",args:{options:a},regex:y,address:f})},validate(a,f,{options:y},{regex:$,address:S}){const I=y.multiple?a.split($):[a],C=[];for(const g of I)_.isValid(g,S)||C.push(g);return C.length?f.error("string.email",{value:a,invalids:C}):a}},guid:{alias:"uuid",method(a={}){n.assertOptions(a,["version","separator"]);let f="";if(a.version){const S=[].concat(a.version);c(S.length>=1,"version must have at least 1 valid version specified");const I=new Set;for(let C=0;C<S.length;++C){const g=S[C];c(typeof g=="string","version at position "+C+" must be a string");const k=d.guidVersions[g.toLowerCase()];c(k,"version at position "+C+" must be one of "+Object.keys(d.guidVersions).join(", ")),c(!I.has(k),"version at position "+C+" must not be a duplicate"),f+=k,I.add(k)}}c(d.guidSeparators.has(a.separator),'separator must be one of true, false, "-", or ":"');const y=a.separator===void 0?"[:-]?":a.separator===!0?"[:-]":a.separator===!1?"[]?":`\\${a.separator}`,$=new RegExp(`^([\\[{\\(]?)[0-9A-F]{8}(${y})[0-9A-F]{4}\\2?[${f||"0-9A-F"}][0-9A-F]{3}\\2?[${f?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$`,"i");return this.$_addRule({name:"guid",args:{options:a},regex:$})},validate(a,f,y,{regex:$}){const S=$.exec(a);return S?d.guidBrackets[S[1]]!==S[S.length-1]?f.error("string.guid"):a:f.error("string.guid")}},hex:{method(a={}){return n.assertOptions(a,["byteAligned","prefix"]),a={byteAligned:!1,prefix:!1,...a},c(typeof a.byteAligned=="boolean","byteAligned must be boolean"),c(typeof a.prefix=="boolean"||a.prefix==="optional",'prefix must be boolean or "optional"'),this.$_addRule({name:"hex",args:{options:a}})},validate:(a,f,{options:y})=>(y.prefix==="optional"?d.hexRegex.withOptionalPrefix:y.prefix===!0?d.hexRegex.withPrefix:d.hexRegex.withoutPrefix).test(a)?y.byteAligned&&a.length%2!=0?f.error("string.hexAlign"):a:f.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(a,f)=>A.isValid(a,{minDomainSegments:1})||d.ipRegex.test(a)?a:f.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(a={}){n.assertOptions(a,["cidr","version"]);const{cidr:f,versions:y,regex:$}=b.regex(a),S=a.version?y:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:f,version:S}},regex:$})},validate:(a,f,{options:y},{regex:$})=>$.test(a)?a:y.version?f.error("string.ipVersion",{value:a,cidr:y.cidr,version:y.version}):f.error("string.ip",{value:a,cidr:y.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(a,{error:f})=>d.isoDate(a)?a:f("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(a,f)=>d.isoDurationRegex.test(a)?a:f.error("string.isoDuration")},length:{method(a,f){return d.length(this,"length",a,"=",f)},validate(a,f,{limit:y,encoding:$},{name:S,operator:I,args:C}){const g=!$&&a.length;return n.compare(g,y,I)?a:f.error("string."+S,{limit:C.limit,value:a,encoding:$})},args:[{name:"limit",ref:!0,assert:n.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(a,f){return d.length(this,"max",a,"<=",f)},args:["limit","encoding"]},min:{method(a,f){return d.length(this,"min",a,">=",f)},args:["limit","encoding"]},normalize:{method(a="NFC"){return c(d.normalizationForms.includes(a),"normalization form must be one of "+d.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:a}})},validate:(a,{error:f},{form:y})=>a===a.normalize(y)?a:f("string.normalize",{value:a,form:y}),convert:!0},pattern:{alias:"regex",method(a,f={}){c(a instanceof RegExp,"regex must be a RegExp"),c(!a.flags.includes("g")&&!a.flags.includes("y"),"regex should not use global or sticky mode"),typeof f=="string"&&(f={name:f}),n.assertOptions(f,["invert","name"]);const y=["string.pattern",f.invert?".invert":"",f.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:a,options:f},errorCode:y})},validate:(a,f,{regex:y,options:$},{errorCode:S})=>y.test(a)^$.invert?a:f.error(S,{name:$.name,regex:y,value:a}),args:["regex","options"],multi:!0},replace:{method(a,f){typeof a=="string"&&(a=new RegExp(r(a),"g")),c(a instanceof RegExp,"pattern must be a RegExp"),c(typeof f=="string","replacement must be a String");const y=this.clone();return y.$_terms.replacements||(y.$_terms.replacements=[]),y.$_terms.replacements.push({pattern:a,replacement:f}),y}},token:{method(){return this.$_addRule("token")},validate:(a,f)=>/^\w+$/.test(a)?a:f.error("string.token")},trim:{method(a=!0){return c(typeof a=="boolean","enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:a}})},validate:(a,f,{enabled:y})=>y&&a!==a.trim()?f.error("string.trim"):a,convert:!0},truncate:{method(a=!0){return c(typeof a=="boolean","enabled must be a boolean"),this.$_setFlag("truncate",a)}},uppercase:{method(){return this.case("upper")}},uri:{method(a={}){n.assertOptions(a,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme","encodeUri"]),a.domain&&n.assertOptions(a.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const{regex:f,scheme:y}=i.regex(a),$=a.domain?d.addressOptions(a.domain):null;return this.$_addRule({name:"uri",args:{options:a},regex:f,domain:$,scheme:y})},validate(a,f,{options:y},{regex:$,domain:S,scheme:I}){if(["http:/","https:/"].includes(a))return f.error("string.uri");let C=$.exec(a);if(!C&&f.prefs.convert&&y.encodeUri){const g=encodeURI(a);C=$.exec(g),C&&(a=g)}if(C){const g=C[1]||C[2];return!S||y.allowRelative&&!g||A.isValid(g,S)?a:f.error("string.domain",{value:g})}return y.relativeOnly?f.error("string.uriRelativeOnly"):y.scheme?f.error("string.uriCustomScheme",{scheme:I,value:a}):f.error("string.uri")}}},manifest:{build(a,f){if(f.replacements)for(const{pattern:y,replacement:$}of f.replacements)a=a.replace(y,$);return a}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),d.addressOptions=function(a){if(!a)return d.tlds||a;if(c(a.minDomainSegments===void 0||Number.isSafeInteger(a.minDomainSegments)&&a.minDomainSegments>0,"minDomainSegments must be a positive integer"),c(a.maxDomainSegments===void 0||Number.isSafeInteger(a.maxDomainSegments)&&a.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),a.tlds===!1)return a;if(a.tlds===!0||a.tlds===void 0)return c(d.tlds,"Built-in TLD list disabled"),Object.assign({},a,d.tlds);c(typeof a.tlds=="object","tlds must be true, false, or an object");const f=a.tlds.deny;if(f)return Array.isArray(f)&&(a=Object.assign({},a,{tlds:{deny:new Set(f)}})),c(a.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),c(!a.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),d.validateTlds(a.tlds.deny,"tlds.deny"),a;const y=a.tlds.allow;return y?y===!0?(c(d.tlds,"Built-in TLD list disabled"),Object.assign({},a,d.tlds)):(Array.isArray(y)&&(a=Object.assign({},a,{tlds:{allow:new Set(y)}})),c(a.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),d.validateTlds(a.tlds.allow,"tlds.allow"),a):a},d.validateTlds=function(a,f){for(const y of a)c(A.isValid(y,{minDomainSegments:1,maxDomainSegments:1}),`${f} must contain valid top level domain names`)},d.isoDate=function(a){if(!n.isIsoDate(a))return null;/.*T.*[+-]\d\d$/.test(a)&&(a+="00");const f=new Date(a);return isNaN(f.getTime())?null:f.toISOString()},d.length=function(a,f,y,$,S){return c(!S||!1,"Invalid encoding:",S),a.$_addRule({name:f,method:"length",args:{limit:y,encoding:S},operator:$})}},8826:(P,E,w)=>{const c=w(375),A=w(8068),_={};_.Map=class extends Map{slice(){return new _.Map(this)}},P.exports=A.extend({type:"symbol",terms:{map:{init:new _.Map}},coerce:{method(b,{schema:r,error:o}){const i=r.$_terms.map.get(b);return i&&(b=i),r._flags.only&&typeof b!="symbol"?{value:b,errors:o("symbol.map",{map:r.$_terms.map})}:{value:b}}},validate(b,{error:r}){if(typeof b!="symbol")return{value:b,errors:r("symbol.base")}},rules:{map:{method(b){b&&!b[Symbol.iterator]&&typeof b=="object"&&(b=Object.entries(b)),c(b&&b[Symbol.iterator],"Iterable must be an iterable or object");const r=this.clone(),o=[];for(const i of b){c(i&&i[Symbol.iterator],"Entry must be an iterable");const[s,n]=i;c(typeof s!="object"&&typeof s!="function"&&typeof s!="symbol","Key must not be of type object, function, or Symbol"),c(typeof n=="symbol","Value must be a Symbol"),r.$_terms.map.set(s,n),o.push(n)}return r.valid(...o)}}},manifest:{build:(b,r)=>(r.map&&(b=b.map(r.map)),b)},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}})},8863:(P,E,w)=>{const c=w(375),A=w(8571),_=w(738),b=w(9621),r=w(8160),o=w(6354),i=w(493),s={result:Symbol("result")};E.entry=function(n,d,a){let f=r.defaults;a&&(c(a.warnings===void 0,"Cannot override warnings preference in synchronous validation"),c(a.artifacts===void 0,"Cannot override artifacts preference in synchronous validation"),f=r.preferences(r.defaults,a));const y=s.entry(n,d,f);c(!y.mainstay.externals.length,"Schema with external rules must use validateAsync()");const $={value:y.value};return y.error&&($.error=y.error),y.mainstay.warnings.length&&($.warning=o.details(y.mainstay.warnings)),y.mainstay.debug&&($.debug=y.mainstay.debug),y.mainstay.artifacts&&($.artifacts=y.mainstay.artifacts),$},E.entryAsync=async function(n,d,a){let f=r.defaults;a&&(f=r.preferences(r.defaults,a));const y=s.entry(n,d,f),$=y.mainstay;if(y.error)throw $.debug&&(y.error.debug=$.debug),y.error;if($.externals.length){let I=y.value;const C=[];for(const g of $.externals){const k=g.state.path,j=g.schema.type==="link"?$.links.get(g.schema):null;let B,Q,J=I;const ae=k.length?[I]:[],oe=k.length?b(n,k):n;if(k.length){B=k[k.length-1];let de=I;for(const ve of k.slice(0,-1))de=de[ve],ae.unshift(de);Q=ae[0],J=Q[B]}try{const de=(we,Se)=>(j||g.schema).$_createError(we,J,Se,g.state,f),ve=await g.method(J,{schema:g.schema,linked:j,state:g.state,prefs:a,original:oe,error:de,errorsArray:s.errorsArray,warn:(we,Se)=>$.warnings.push((j||g.schema).$_createError(we,J,Se,g.state,f)),message:(we,Se)=>(j||g.schema).$_createError("external",J,Se,g.state,f,{messages:we})});if(ve===void 0||ve===J)continue;if(ve instanceof o.Report){if($.tracer.log(g.schema,g.state,"rule","external","error"),C.push(ve),f.abortEarly)break;continue}if(Array.isArray(ve)&&ve[r.symbols.errors]){if($.tracer.log(g.schema,g.state,"rule","external","error"),C.push(...ve),f.abortEarly)break;continue}Q?($.tracer.value(g.state,"rule",J,ve,"external"),Q[B]=ve):($.tracer.value(g.state,"rule",I,ve,"external"),I=ve)}catch(de){throw f.errors.label&&(de.message+=` (${g.label})`),de}}if(y.value=I,C.length)throw y.error=o.process(C,n,f),$.debug&&(y.error.debug=$.debug),y.error}if(!f.warnings&&!f.debug&&!f.artifacts)return y.value;const S={value:y.value};return $.warnings.length&&(S.warning=o.details($.warnings)),$.debug&&(S.debug=$.debug),$.artifacts&&(S.artifacts=$.artifacts),S},s.Mainstay=class{constructor(n,d,a){this.externals=[],this.warnings=[],this.tracer=n,this.debug=d,this.links=a,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){const n=this._snapshots.pop();this.externals=n.externals,this.warnings=n.warnings}commit(){this._snapshots.pop()}},s.entry=function(n,d,a){const{tracer:f,cleanup:y}=s.tracer(d,a),$=a.debug?[]:null,S=d._ids._schemaChain?new Map:null,I=new s.Mainstay(f,$,S),C=d._ids._schemaChain?[{schema:d}]:null,g=new i([],[],{mainstay:I,schemas:C}),k=E.validate(n,d,g,a);y&&d.$_root.untrace();const j=o.process(k.errors,n,a);return{value:k.value,error:j,mainstay:I}},s.tracer=function(n,d){return n.$_root._tracer?{tracer:n.$_root._tracer._register(n)}:d.debug?(c(n.$_root.trace,"Debug mode not supported"),{tracer:n.$_root.trace()._register(n),cleanup:!0}):{tracer:s.ignore}},E.validate=function(n,d,a,f,y={}){if(d.$_terms.whens&&(d=d._generate(n,a,f).schema),d._preferences&&(f=s.prefs(d,f)),d._cache&&f.cache){const j=d._cache.get(n);if(a.mainstay.tracer.debug(a,"validate","cached",!!j),j)return j}const $=(j,B,Q)=>d.$_createError(j,n,B,Q||a,f),S={original:n,prefs:f,schema:d,state:a,error:$,errorsArray:s.errorsArray,warn:(j,B,Q)=>a.mainstay.warnings.push($(j,B,Q)),message:(j,B)=>d.$_createError("custom",n,B,a,f,{messages:j})};a.mainstay.tracer.entry(d,a);const I=d._definition;if(I.prepare&&n!==void 0&&f.convert){const j=I.prepare(n,S);if(j){if(a.mainstay.tracer.value(a,"prepare",n,j.value),j.errors)return s.finalize(j.value,[].concat(j.errors),S);n=j.value}}if(I.coerce&&n!==void 0&&f.convert&&(!I.coerce.from||I.coerce.from.includes(typeof n))){const j=I.coerce.method(n,S);if(j){if(a.mainstay.tracer.value(a,"coerced",n,j.value),j.errors)return s.finalize(j.value,[].concat(j.errors),S);n=j.value}}const C=d._flags.empty;C&&C.$_match(s.trim(n,d),a.nest(C),r.defaults)&&(a.mainstay.tracer.value(a,"empty",n,void 0),n=void 0);const g=y.presence||d._flags.presence||(d._flags._endedSwitch?null:f.presence);if(n===void 0){if(g==="forbidden")return s.finalize(n,null,S);if(g==="required")return s.finalize(n,[d.$_createError("any.required",n,null,a,f)],S);if(g==="optional"){if(d._flags.default!==r.symbols.deepDefault)return s.finalize(n,null,S);a.mainstay.tracer.value(a,"default",n,{}),n={}}}else if(g==="forbidden")return s.finalize(n,[d.$_createError("any.unknown",n,null,a,f)],S);const k=[];if(d._valids){const j=d._valids.get(n,a,f,d._flags.insensitive);if(j)return f.convert&&(a.mainstay.tracer.value(a,"valids",n,j.value),n=j.value),a.mainstay.tracer.filter(d,a,"valid",j),s.finalize(n,null,S);if(d._flags.only){const B=d.$_createError("any.only",n,{valids:d._valids.values({display:!0})},a,f);if(f.abortEarly)return s.finalize(n,[B],S);k.push(B)}}if(d._invalids){const j=d._invalids.get(n,a,f,d._flags.insensitive);if(j){a.mainstay.tracer.filter(d,a,"invalid",j);const B=d.$_createError("any.invalid",n,{invalids:d._invalids.values({display:!0})},a,f);if(f.abortEarly)return s.finalize(n,[B],S);k.push(B)}}if(I.validate){const j=I.validate(n,S);if(j&&(a.mainstay.tracer.value(a,"base",n,j.value),n=j.value,j.errors)){if(!Array.isArray(j.errors))return k.push(j.errors),s.finalize(n,k,S);if(j.errors.length)return k.push(...j.errors),s.finalize(n,k,S)}}return d._rules.length?s.rules(n,k,S):s.finalize(n,k,S)},s.rules=function(n,d,a){const{schema:f,state:y,prefs:$}=a;for(const S of f._rules){const I=f._definition.rules[S.method];if(I.convert&&$.convert){y.mainstay.tracer.log(f,y,"rule",S.name,"full");continue}let C,g=S.args;if(S._resolve.length){g=Object.assign({},g);for(const j of S._resolve){const B=I.argsByName.get(j),Q=g[j].resolve(n,y,$),J=B.normalize?B.normalize(Q):Q,ae=r.validateArg(J,null,B);if(ae){C=f.$_createError("any.ref",Q,{arg:j,ref:g[j],reason:ae},y,$);break}g[j]=J}}C=C||I.validate(n,a,g,S);const k=s.rule(C,S);if(k.errors){if(y.mainstay.tracer.log(f,y,"rule",S.name,"error"),S.warn){y.mainstay.warnings.push(...k.errors);continue}if($.abortEarly)return s.finalize(n,k.errors,a);d.push(...k.errors)}else y.mainstay.tracer.log(f,y,"rule",S.name,"pass"),y.mainstay.tracer.value(y,"rule",n,k.value,S.name),n=k.value}return s.finalize(n,d,a)},s.rule=function(n,d){return n instanceof o.Report?(s.error(n,d),{errors:[n],value:null}):Array.isArray(n)&&n[r.symbols.errors]?(n.forEach(a=>s.error(a,d)),{errors:n,value:null}):{errors:null,value:n}},s.error=function(n,d){return d.message&&n._setTemplate(d.message),n},s.finalize=function(n,d,a){d=d||[];const{schema:f,state:y,prefs:$}=a;if(d.length){const I=s.default("failover",void 0,d,a);I!==void 0&&(y.mainstay.tracer.value(y,"failover",n,I),n=I,d=[])}if(d.length&&f._flags.error)if(typeof f._flags.error=="function"){d=f._flags.error(d),Array.isArray(d)||(d=[d]);for(const I of d)c(I instanceof Error||I instanceof o.Report,"error() must return an Error object")}else d=[f._flags.error];if(n===void 0){const I=s.default("default",n,d,a);y.mainstay.tracer.value(y,"default",n,I),n=I}if(f._flags.cast&&n!==void 0){const I=f._definition.cast[f._flags.cast];if(I.from(n)){const C=I.to(n,a);y.mainstay.tracer.value(y,"cast",n,C,f._flags.cast),n=C}}if(f.$_terms.externals&&$.externals&&$._externals!==!1)for(const{method:I}of f.$_terms.externals)y.mainstay.externals.push({method:I,schema:f,state:y,label:o.label(f._flags,y,$)});const S={value:n,errors:d.length?d:null};return f._flags.result&&(S.value=f._flags.result==="strip"?void 0:a.original,y.mainstay.tracer.value(y,f._flags.result,n,S.value),y.shadow(n,f._flags.result)),f._cache&&$.cache!==!1&&!f._refs.length&&f._cache.set(a.original,S),n===void 0||S.errors||f._flags.artifact===void 0||(y.mainstay.artifacts=y.mainstay.artifacts||new Map,y.mainstay.artifacts.has(f._flags.artifact)||y.mainstay.artifacts.set(f._flags.artifact,[]),y.mainstay.artifacts.get(f._flags.artifact).push(y.path)),S},s.prefs=function(n,d){const a=d===r.defaults;return a&&n._preferences[r.symbols.prefs]?n._preferences[r.symbols.prefs]:(d=r.preferences(d,n._preferences),a&&(n._preferences[r.symbols.prefs]=d),d)},s.default=function(n,d,a,f){const{schema:y,state:$,prefs:S}=f,I=y._flags[n];if(S.noDefaults||I===void 0)return d;if($.mainstay.tracer.log(y,$,"rule",n,"full"),!I)return I;if(typeof I=="function"){const C=I.length?[A($.ancestors[0]),f]:[];try{return I(...C)}catch(g){return void a.push(y.$_createError(`any.${n}`,null,{error:g},$,S))}}return typeof I!="object"?I:I[r.symbols.literal]?I.literal:r.isResolvable(I)?I.resolve(d,$,S):A(I)},s.trim=function(n,d){if(typeof n!="string")return n;const a=d.$_getRule("trim");return a&&a.args.enabled?n.trim():n},s.ignore={active:!1,debug:_,entry:_,filter:_,log:_,resolve:_,value:_},s.errorsArray=function(){const n=[];return n[r.symbols.errors]=!0,n}},2036:(P,E,w)=>{const c=w(375),A=w(9474),_=w(8160),b={};P.exports=b.Values=class{constructor(r,o){this._values=new Set(r),this._refs=new Set(o),this._lowercase=b.lowercases(r),this._override=!1}get length(){return this._values.size+this._refs.size}add(r,o){_.isResolvable(r)?this._refs.has(r)||(this._refs.add(r),o&&o.register(r)):this.has(r,null,null,!1)||(this._values.add(r),typeof r=="string"&&this._lowercase.set(r.toLowerCase(),r))}static merge(r,o,i){if(r=r||new b.Values,o){if(o._override)return o.clone();for(const s of[...o._values,...o._refs])r.add(s)}if(i)for(const s of[...i._values,...i._refs])r.remove(s);return r.length?r:null}remove(r){_.isResolvable(r)?this._refs.delete(r):(this._values.delete(r),typeof r=="string"&&this._lowercase.delete(r.toLowerCase()))}has(r,o,i,s){return!!this.get(r,o,i,s)}get(r,o,i,s){if(!this.length)return!1;if(this._values.has(r))return{value:r};if(typeof r=="string"&&r&&s){const n=this._lowercase.get(r.toLowerCase());if(n)return{value:n}}if(!this._refs.size&&typeof r!="object")return!1;if(typeof r=="object"){for(const n of this._values)if(A(n,r))return{value:n}}if(o)for(const n of this._refs){const d=n.resolve(r,o,i,null,{in:!0});if(d===void 0)continue;const a=n.in&&typeof d=="object"?Array.isArray(d)?d:Object.keys(d):[d];for(const f of a)if(typeof f==typeof r){if(s&&r&&typeof r=="string"){if(f.toLowerCase()===r.toLowerCase())return{value:f,ref:n}}else if(A(f,r))return{value:f,ref:n}}}return!1}override(){this._override=!0}values(r){if(r&&r.display){const o=[];for(const i of[...this._values,...this._refs])i!==void 0&&o.push(i);return o}return Array.from([...this._values,...this._refs])}clone(){const r=new b.Values(this._values,this._refs);return r._override=this._override,r}concat(r){c(!r._override,"Cannot concat override set of values");const o=new b.Values([...this._values,...r._values],[...this._refs,...r._refs]);return o._override=this._override,o}describe(){const r=[];this._override&&r.push({override:!0});for(const o of this._values.values())r.push(o&&typeof o=="object"?{value:o}:o);for(const o of this._refs.values())r.push(o.describe());return r}},b.Values.prototype[_.symbols.values]=!0,b.Values.prototype.slice=b.Values.prototype.clone,b.lowercases=function(r){const o=new Map;if(r)for(const i of r)typeof i=="string"&&o.set(i.toLowerCase(),i);return o}},978:(P,E,w)=>{const c=w(375),A=w(8571),_=w(1687),b=w(9621),r={};P.exports=function(o,i,s={}){if(c(o&&typeof o=="object","Invalid defaults value: must be an object"),c(!i||i===!0||typeof i=="object","Invalid source value: must be true, falsy or an object"),c(typeof s=="object","Invalid options: must be an object"),!i)return null;if(s.shallow)return r.applyToDefaultsWithShallow(o,i,s);const n=A(o);if(i===!0)return n;const d=s.nullOverride!==void 0&&s.nullOverride;return _(n,i,{nullOverride:d,mergeArrays:!1})},r.applyToDefaultsWithShallow=function(o,i,s){const n=s.shallow;c(Array.isArray(n),"Invalid keys");const d=new Map,a=i===!0?null:new Set;for(let $ of n){$=Array.isArray($)?$:$.split(".");const S=b(o,$);S&&typeof S=="object"?d.set(S,a&&b(i,$)||S):a&&a.add($)}const f=A(o,{},d);if(!a)return f;for(const $ of a)r.reachCopy(f,i,$);const y=s.nullOverride!==void 0&&s.nullOverride;return _(f,i,{nullOverride:y,mergeArrays:!1})},r.reachCopy=function(o,i,s){for(const a of s){if(!(a in i))return;const f=i[a];if(typeof f!="object"||f===null)return;i=f}const n=i;let d=o;for(let a=0;a<s.length-1;++a){const f=s[a];typeof d[f]!="object"&&(d[f]={}),d=d[f]}d[s[s.length-1]]=n}},375:(P,E,w)=>{const c=w(7916);P.exports=function(A,..._){if(!A)throw _.length===1&&_[0]instanceof Error?_[0]:new c(_)}},8571:(P,E,w)=>{const c=w(9621),A=w(4277),_=w(7043),b={needsProtoHack:new Set([A.set,A.map,A.weakSet,A.weakMap])};P.exports=b.clone=function(r,o={},i=null){if(typeof r!="object"||r===null)return r;let s=b.clone,n=i;if(o.shallow){if(o.shallow!==!0)return b.cloneWithShallow(r,o);s=y=>y}else if(n){const y=n.get(r);if(y)return y}else n=new Map;const d=A.getInternalProto(r);if(d===A.buffer)return!1;if(d===A.date)return new Date(r.getTime());if(d===A.regex)return new RegExp(r);const a=b.base(r,d,o);if(a===r)return r;if(n&&n.set(r,a),d===A.set)for(const y of r)a.add(s(y,o,n));else if(d===A.map)for(const[y,$]of r)a.set(y,s($,o,n));const f=_.keys(r,o);for(const y of f){if(y==="__proto__")continue;if(d===A.array&&y==="length"){a.length=r.length;continue}const $=Object.getOwnPropertyDescriptor(r,y);$?$.get||$.set?Object.defineProperty(a,y,$):$.enumerable?a[y]=s(r[y],o,n):Object.defineProperty(a,y,{enumerable:!1,writable:!0,configurable:!0,value:s(r[y],o,n)}):Object.defineProperty(a,y,{enumerable:!0,writable:!0,configurable:!0,value:s(r[y],o,n)})}return a},b.cloneWithShallow=function(r,o){const i=o.shallow;(o=Object.assign({},o)).shallow=!1;const s=new Map;for(const n of i){const d=c(r,n);typeof d!="object"&&typeof d!="function"||s.set(d,d)}return b.clone(r,o,s)},b.base=function(r,o,i){if(i.prototype===!1)return b.needsProtoHack.has(o)?new o.constructor:o===A.array?[]:{};const s=Object.getPrototypeOf(r);if(s&&s.isImmutable)return r;if(o===A.array){const n=[];return s!==o&&Object.setPrototypeOf(n,s),n}if(b.needsProtoHack.has(o)){const n=new s.constructor;return s!==o&&Object.setPrototypeOf(n,s),n}return Object.create(s)}},9474:(P,E,w)=>{const c=w(4277),A={mismatched:null};P.exports=function(_,b,r){return r=Object.assign({prototype:!0},r),!!A.isDeepEqual(_,b,r,[])},A.isDeepEqual=function(_,b,r,o){if(_===b)return _!==0||1/_==1/b;const i=typeof _;if(i!==typeof b||_===null||b===null)return!1;if(i==="function"){if(!r.deepFunction||_.toString()!==b.toString())return!1}else if(i!=="object")return _!=_&&b!=b;const s=A.getSharedType(_,b,!!r.prototype);switch(s){case c.buffer:return!1;case c.promise:return _===b;case c.regex:return _.toString()===b.toString();case A.mismatched:return!1}for(let n=o.length-1;n>=0;--n)if(o[n].isSame(_,b))return!0;o.push(new A.SeenEntry(_,b));try{return!!A.isDeepEqualObj(s,_,b,r,o)}finally{o.pop()}},A.getSharedType=function(_,b,r){if(r)return Object.getPrototypeOf(_)!==Object.getPrototypeOf(b)?A.mismatched:c.getInternalProto(_);const o=c.getInternalProto(_);return o!==c.getInternalProto(b)?A.mismatched:o},A.valueOf=function(_){const b=_.valueOf;if(b===void 0)return _;try{return b.call(_)}catch(r){return r}},A.hasOwnEnumerableProperty=function(_,b){return Object.prototype.propertyIsEnumerable.call(_,b)},A.isSetSimpleEqual=function(_,b){for(const r of Set.prototype.values.call(_))if(!Set.prototype.has.call(b,r))return!1;return!0},A.isDeepEqualObj=function(_,b,r,o,i){const{isDeepEqual:s,valueOf:n,hasOwnEnumerableProperty:d}=A,{keys:a,getOwnPropertySymbols:f}=Object;if(_===c.array){if(!o.part){if(b.length!==r.length)return!1;for(let C=0;C<b.length;++C)if(!s(b[C],r[C],o,i))return!1;return!0}for(const C of b)for(const g of r)if(s(C,g,o,i))return!0}else if(_===c.set){if(b.size!==r.size)return!1;if(!A.isSetSimpleEqual(b,r)){const C=new Set(Set.prototype.values.call(r));for(const g of Set.prototype.values.call(b)){if(C.delete(g))continue;let k=!1;for(const j of C)if(s(g,j,o,i)){C.delete(j),k=!0;break}if(!k)return!1}}}else if(_===c.map){if(b.size!==r.size)return!1;for(const[C,g]of Map.prototype.entries.call(b))if(g===void 0&&!Map.prototype.has.call(r,C)||!s(g,Map.prototype.get.call(r,C),o,i))return!1}else if(_===c.error&&(b.name!==r.name||b.message!==r.message))return!1;const y=n(b),$=n(r);if((b!==y||r!==$)&&!s(y,$,o,i))return!1;const S=a(b);if(!o.part&&S.length!==a(r).length&&!o.skip)return!1;let I=0;for(const C of S)if(o.skip&&o.skip.includes(C))r[C]===void 0&&++I;else if(!d(r,C)||!s(b[C],r[C],o,i))return!1;if(!o.part&&S.length-I!==a(r).length)return!1;if(o.symbols!==!1){const C=f(b),g=new Set(f(r));for(const k of C){if(!o.skip||!o.skip.includes(k)){if(d(b,k)){if(!d(r,k)||!s(b[k],r[k],o,i))return!1}else if(d(r,k))return!1}g.delete(k)}for(const k of g)if(d(r,k))return!1}return!0},A.SeenEntry=class{constructor(_,b){this.obj=_,this.ref=b}isSame(_,b){return this.obj===_&&this.ref===b}}},7916:(P,E,w)=>{const c=w(8761);P.exports=class extends Error{constructor(A){super(A.filter(_=>_!=="").map(_=>typeof _=="string"?_:_ instanceof Error?_.message:c(_)).join(" ")||"Unknown error"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,E.assert)}}},5277:P=>{const E={};P.exports=function(w){if(!w)return"";let c="";for(let A=0;A<w.length;++A){const _=w.charCodeAt(A);E.isSafe(_)?c+=w[A]:c+=E.escapeHtmlChar(_)}return c},E.escapeHtmlChar=function(w){return E.namedHtml.get(w)||(w>=256?"&#"+w+";":`&#x${w.toString(16).padStart(2,"0")};`)},E.isSafe=function(w){return E.safeCharCodes.has(w)},E.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]),E.safeCharCodes=function(){const w=new Set;for(let c=32;c<123;++c)(c>=97||c>=65&&c<=90||c>=48&&c<=57||c===32||c===46||c===44||c===45||c===58||c===95)&&w.add(c);return w}()},6064:P=>{P.exports=function(E){return E.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")}},738:P=>{P.exports=function(){}},1687:(P,E,w)=>{const c=w(375),A=w(8571),_=w(7043),b={};P.exports=b.merge=function(r,o,i){if(c(r&&typeof r=="object","Invalid target value: must be an object"),c(o==null||typeof o=="object","Invalid source value: must be null, undefined, or an object"),!o)return r;if(i=Object.assign({nullOverride:!0,mergeArrays:!0},i),Array.isArray(o)){c(Array.isArray(r),"Cannot merge array onto an object"),i.mergeArrays||(r.length=0);for(let n=0;n<o.length;++n)r.push(A(o[n],{symbols:i.symbols}));return r}const s=_.keys(o,i);for(let n=0;n<s.length;++n){const d=s[n];if(d==="__proto__"||!Object.prototype.propertyIsEnumerable.call(o,d))continue;const a=o[d];if(a&&typeof a=="object"){if(r[d]===a)continue;!r[d]||typeof r[d]!="object"||Array.isArray(r[d])!==Array.isArray(a)||a instanceof Date||a instanceof RegExp?r[d]=A(a,{symbols:i.symbols}):b.merge(r[d],a,i)}else(a!=null||i.nullOverride)&&(r[d]=a)}return r}},9621:(P,E,w)=>{const c=w(375),A={};P.exports=function(_,b,r){if(b===!1||b==null)return _;typeof(r=r||{})=="string"&&(r={separator:r});const o=Array.isArray(b);c(!o||!r.separator,"Separator option is not valid for array-based chain");const i=o?b:b.split(r.separator||".");let s=_;for(let n=0;n<i.length;++n){let d=i[n];const a=r.iterables&&A.iterables(s);if(Array.isArray(s)||a==="set"){const f=Number(d);Number.isInteger(f)&&(d=f<0?s.length+f:f)}if(!s||typeof s=="function"&&r.functions===!1||!a&&s[d]===void 0){c(!r.strict||n+1===i.length,"Missing segment",d,"in reach path ",b),c(typeof s=="object"||r.functions===!0||typeof s!="function","Invalid segment",d,"in reach path ",b),s=r.default;break}s=a?a==="set"?[...s][d]:s.get(d):s[d]}return s},A.iterables=function(_){return _ instanceof Set?"set":_ instanceof Map?"map":void 0}},8761:P=>{P.exports=function(...E){try{return JSON.stringify(...E)}catch(w){return"[Cannot display object: "+w.message+"]"}}},4277:(P,E)=>{const w={};E=P.exports={array:Array.prototype,buffer:!1,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},w.typeMap=new Map([["[object Error]",E.error],["[object Map]",E.map],["[object Promise]",E.promise],["[object Set]",E.set],["[object WeakMap]",E.weakMap],["[object WeakSet]",E.weakSet]]),E.getInternalProto=function(c){if(Array.isArray(c))return E.array;if(c instanceof Date)return E.date;if(c instanceof RegExp)return E.regex;if(c instanceof Error)return E.error;const A=Object.prototype.toString.call(c);return w.typeMap.get(A)||E.generic}},7043:(P,E)=>{E.keys=function(w,c={}){return c.symbols!==!1?Reflect.ownKeys(w):Object.getOwnPropertyNames(w)}},3652:(P,E,w)=>{const c=w(375),A={};E.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(_,b){const r=[].concat((b=b||{}).before||[]),o=[].concat(b.after||[]),i=b.group||"?",s=b.sort||0;c(!r.includes(i),`Item cannot come before itself: ${i}`),c(!r.includes("?"),"Item cannot come before unassociated items"),c(!o.includes(i),`Item cannot come after itself: ${i}`),c(!o.includes("?"),"Item cannot come after unassociated items"),Array.isArray(_)||(_=[_]);for(const n of _){const d={seq:this._items.length,sort:s,before:r,after:o,group:i,node:n};this._items.push(d)}if(!b.manual){const n=this._sort();c(n,"item",i!=="?"?`added into group ${i}`:"","created a dependencies error")}return this.nodes}merge(_){Array.isArray(_)||(_=[_]);for(const r of _)if(r)for(const o of r._items)this._items.push(Object.assign({},o));this._items.sort(A.mergeSort);for(let r=0;r<this._items.length;++r)this._items[r].seq=r;const b=this._sort();return c(b,"merge created a dependencies error"),this.nodes}sort(){const _=this._sort();return c(_,"sort created a dependencies error"),this.nodes}_sort(){const _={},b=Object.create(null),r=Object.create(null);for(const d of this._items){const a=d.seq,f=d.group;r[f]=r[f]||[],r[f].push(a),_[a]=d.before;for(const y of d.after)b[y]=b[y]||[],b[y].push(a)}for(const d in _){const a=[];for(const f in _[d]){const y=_[d][f];r[y]=r[y]||[],a.push(...r[y])}_[d]=a}for(const d in b)if(r[d])for(const a of r[d])_[a].push(...b[d]);const o={};for(const d in _){const a=_[d];for(const f of a)o[f]=o[f]||[],o[f].push(d)}const i={},s=[];for(let d=0;d<this._items.length;++d){let a=d;if(o[d]){a=null;for(let f=0;f<this._items.length;++f){if(i[f]===!0)continue;o[f]||(o[f]=[]);const y=o[f].length;let $=0;for(let S=0;S<y;++S)i[o[f][S]]&&++$;if($===y){a=f;break}}}a!==null&&(i[a]=!0,s.push(a))}if(s.length!==this._items.length)return!1;const n={};for(const d of this._items)n[d.seq]=d;this._items=[],this.nodes=[];for(const d of s){const a=n[d];this.nodes.push(a.node),this._items.push(a)}return!0}},A.mergeSort=(_,b)=>_.sort===b.sort?0:_.sort<b.sort?-1:1},5380:(P,E,w)=>{const c=w(443),A=w(2178),_={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:c.URL||URL};E.analyze=function(b,r={}){if(!b)return A.code("DOMAIN_NON_EMPTY_STRING");if(typeof b!="string")throw new Error("Invalid input: domain must be a string");if(b.length>256)return A.code("DOMAIN_TOO_LONG");if(_.nonAsciiRx.test(b)){if(r.allowUnicode===!1)return A.code("DOMAIN_INVALID_UNICODE_CHARS");b=b.normalize("NFC")}if(_.domainControlRx.test(b))return A.code("DOMAIN_INVALID_CHARS");b=_.punycode(b),r.allowFullyQualified&&b[b.length-1]==="."&&(b=b.slice(0,-1));const o=r.minDomainSegments||_.minDomainSegments,i=b.split(".");if(i.length<o)return A.code("DOMAIN_SEGMENTS_COUNT");if(r.maxDomainSegments&&i.length>r.maxDomainSegments)return A.code("DOMAIN_SEGMENTS_COUNT_MAX");const s=r.tlds;if(s){const n=i[i.length-1].toLowerCase();if(s.deny&&s.deny.has(n)||s.allow&&!s.allow.has(n))return A.code("DOMAIN_FORBIDDEN_TLDS")}for(let n=0;n<i.length;++n){const d=i[n];if(!d.length)return A.code("DOMAIN_EMPTY_SEGMENT");if(d.length>63)return A.code("DOMAIN_LONG_SEGMENT");if(n<i.length-1){if(!_.domainSegmentRx.test(d))return A.code("DOMAIN_INVALID_CHARS")}else if(!_.tldSegmentRx.test(d))return A.code("DOMAIN_INVALID_TLDS_CHARS")}return null},E.isValid=function(b,r){return!E.analyze(b,r)},_.punycode=function(b){b.includes("%")&&(b=b.replace(/%/g,"%25"));try{return new _.URL(`http://${b}`).host}catch{return b}}},1745:(P,E,w)=>{const c=w(9848),A=w(5380),_=w(2178),b={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(c.TextEncoder||TextEncoder)};E.analyze=function(r,o){return b.email(r,o)},E.isValid=function(r,o){return!b.email(r,o)},b.email=function(r,o={}){if(typeof r!="string")throw new Error("Invalid input: email must be a string");if(!r)return _.code("EMPTY_STRING");const i=!b.nonAsciiRx.test(r);if(!i){if(o.allowUnicode===!1)return _.code("FORBIDDEN_UNICODE");r=r.normalize("NFC")}const s=r.split("@");if(s.length!==2)return s.length>2?_.code("MULTIPLE_AT_CHAR"):_.code("MISSING_AT_CHAR");const[n,d]=s;if(!n)return _.code("EMPTY_LOCAL");if(!o.ignoreLength){if(r.length>254)return _.code("ADDRESS_TOO_LONG");if(b.encoder.encode(n).length>64)return _.code("LOCAL_TOO_LONG")}return b.local(n,i)||A.analyze(d,o)},b.local=function(r,o){const i=r.split(".");for(const s of i){if(!s.length)return _.code("EMPTY_LOCAL_SEGMENT");if(o){if(!b.atextRx.test(s))return _.code("INVALID_LOCAL_CHARS")}else for(const n of s){if(b.atextRx.test(n))continue;const d=b.binary(n);if(!b.atomRx.test(d))return _.code("INVALID_LOCAL_CHARS")}}},b.binary=function(r){return Array.from(b.encoder.encode(r)).map(o=>String.fromCharCode(o)).join("")},b.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,b.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"))},2178:(P,E)=>{E.codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"},E.code=function(w){return{code:w,error:E.codes[w]}}},9959:(P,E,w)=>{const c=w(375),A=w(5752);E.regex=function(_={}){c(_.cidr===void 0||typeof _.cidr=="string","options.cidr must be a string");const b=_.cidr?_.cidr.toLowerCase():"optional";c(["required","optional","forbidden"].includes(b),"options.cidr must be one of required, optional, forbidden"),c(_.version===void 0||typeof _.version=="string"||Array.isArray(_.version),"options.version must be a string or an array of string");let r=_.version||["ipv4","ipv6","ipvfuture"];Array.isArray(r)||(r=[r]),c(r.length>=1,"options.version must have at least 1 version specified");for(let s=0;s<r.length;++s)c(typeof r[s]=="string","options.version must only contain strings"),r[s]=r[s].toLowerCase(),c(["ipv4","ipv6","ipvfuture"].includes(r[s]),"options.version contains unknown version "+r[s]+" - must be one of ipv4, ipv6, ipvfuture");r=Array.from(new Set(r));const o=`(?:${r.map(s=>{if(b==="forbidden")return A.ip[s];const n=`\\/${s==="ipv4"?A.ip.v4Cidr:A.ip.v6Cidr}`;return b==="required"?`${A.ip[s]}${n}`:`${A.ip[s]}(?:${n})?`}).join("|")})`,i=new RegExp(`^${o}$`);return{cidr:b,versions:r,regex:i,raw:o}}},5752:(P,E,w)=>{const c=w(375),A=w(6064),_={generate:function(){const b={},r="\\dA-Fa-f",o="["+r+"]",i="\\w-\\.~",s="!\\$&'\\(\\)\\*\\+,;=",n="%"+r,d=i+n+s+":@",a="["+d+"]",f="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";b.ipv4address="(?:"+f+"\\.){3}"+f;const y=o+"{1,4}",$="(?:"+y+":"+y+"|"+b.ipv4address+")",S="(?:"+y+":){6}"+$,I="::(?:"+y+":){5}"+$,C="(?:"+y+")?::(?:"+y+":){4}"+$,g="(?:(?:"+y+":){0,1}"+y+")?::(?:"+y+":){3}"+$,k="(?:(?:"+y+":){0,2}"+y+")?::(?:"+y+":){2}"+$,j="(?:(?:"+y+":){0,3}"+y+")?::"+y+":"+$,B="(?:(?:"+y+":){0,4}"+y+")?::"+$,Q="(?:(?:"+y+":){0,5}"+y+")?::"+y,J="(?:(?:"+y+":){0,6}"+y+")?::";b.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",b.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",b.ipv6address="(?:"+S+"|"+I+"|"+C+"|"+g+"|"+k+"|"+j+"|"+B+"|"+Q+"|"+J+")",b.ipvFuture="v"+o+"+\\.["+i+s+":]+",b.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",b.schemeRegex=new RegExp(b.scheme);const ae="["+i+n+s+":]*",oe="["+i+n+s+"]{1,255}",de="(?:\\[(?:"+b.ipv6address+"|"+b.ipvFuture+")\\]|"+b.ipv4address+"|"+oe+")",ve="(?:"+ae+"@)?"+de+"(?::\\d*)?",we="(?:"+ae+"@)?("+de+")(?::\\d*)?",Se=a+"*",me=a+"+",ye="(?:\\/"+Se+")*",Re="\\/(?:"+me+ye+")?",Ce=me+ye,ze="["+i+n+s+"@]+"+ye,Ke="(?:\\/\\/\\/"+Se+ye+")";return b.hierPart="(?:(?:\\/\\/"+ve+ye+")|"+Re+"|"+Ce+"|"+Ke+")",b.hierPartCapture="(?:(?:\\/\\/"+we+ye+")|"+Re+"|"+Ce+")",b.relativeRef="(?:(?:\\/\\/"+ve+ye+")|"+Re+"|"+ze+"|)",b.relativeRefCapture="(?:(?:\\/\\/"+we+ye+")|"+Re+"|"+ze+"|)",b.query="["+d+"\\/\\?]*(?=#|$)",b.queryWithSquareBrackets="["+d+"\\[\\]\\/\\?]*(?=#|$)",b.fragment="["+d+"\\/\\?]*",b}};_.rfc3986=_.generate(),E.ip={v4Cidr:_.rfc3986.ipv4Cidr,v6Cidr:_.rfc3986.ipv6Cidr,ipv4:_.rfc3986.ipv4address,ipv6:_.rfc3986.ipv6address,ipvfuture:_.rfc3986.ipvFuture},_.createRegex=function(b){const r=_.rfc3986,o="(?:\\?"+(b.allowQuerySquareBrackets?r.queryWithSquareBrackets:r.query)+")?(?:#"+r.fragment+")?",i=b.domain?r.relativeRefCapture:r.relativeRef;if(b.relativeOnly)return _.wrap(i+o);let s="";if(b.scheme){c(b.scheme instanceof RegExp||typeof b.scheme=="string"||Array.isArray(b.scheme),"scheme must be a RegExp, String, or Array");const a=[].concat(b.scheme);c(a.length>=1,"scheme must have at least 1 scheme specified");const f=[];for(let y=0;y<a.length;++y){const $=a[y];c($ instanceof RegExp||typeof $=="string","scheme at position "+y+" must be a RegExp or String"),$ instanceof RegExp?f.push($.source.toString()):(c(r.schemeRegex.test($),"scheme at position "+y+" must be a valid scheme"),f.push(A($)))}s=f.join("|")}const n="(?:"+(s?"(?:"+s+")":r.scheme)+":"+(b.domain?r.hierPartCapture:r.hierPart)+")",d=b.allowRelative?"(?:"+n+"|"+i+")":n;return _.wrap(d+o,s)},_.wrap=function(b,r){return{raw:b=`(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])${b}`,regex:new RegExp(`^${b}$`),scheme:r}},_.uriRegex=_.createRegex({}),E.regex=function(b={}){return b.scheme||b.allowRelative||b.relativeOnly||b.allowQuerySquareBrackets||b.domain?_.createRegex(b):_.uriRegex}},1447:(P,E)=>{const w={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};E.Parser=class{constructor(c,A={}){if(!A[w.settings]&&A.constants)for(const _ in A.constants){const b=A.constants[_];if(b!==null&&!["boolean","number","string"].includes(typeof b))throw new Error(`Formula constant ${_} contains invalid ${typeof b} value type`)}this.settings=A[w.settings]?A:Object.assign({[w.settings]:!0,constants:{},functions:{}},A),this.single=null,this._parts=null,this._parse(c)}_parse(c){let A=[],_="",b=0,r=!1;const o=s=>{if(b)throw new Error("Formula missing closing parenthesis");const n=A.length?A[A.length-1]:null;if(r||_||s){if(n&&n.type==="reference"&&s===")")return n.type="function",n.value=this._subFormula(_,n.value),void(_="");if(s===")"){const d=new E.Parser(_,this.settings);A.push({type:"segment",value:d})}else if(r){if(r==="]")return A.push({type:"reference",value:_}),void(_="");A.push({type:"literal",value:_})}else if(w.operatorCharacters.includes(_))n&&n.type==="operator"&&w.operators.includes(n.value+_)?n.value+=_:A.push({type:"operator",value:_});else if(_.match(w.numberRx))A.push({type:"constant",value:parseFloat(_)});else if(this.settings.constants[_]!==void 0)A.push({type:"constant",value:this.settings.constants[_]});else{if(!_.match(w.tokenRx))throw new Error(`Formula contains invalid token: ${_}`);A.push({type:"reference",value:_})}_=""}};for(const s of c)r?s===r?(o(),r=!1):_+=s:b?s==="("?(_+=s,++b):s===")"?(--b,b?_+=s:o(s)):_+=s:s in w.literals?r=w.literals[s]:s==="("?(o(),++b):w.operatorCharacters.includes(s)?(o(),_=s,o()):s!==" "?_+=s:o();o(),A=A.map((s,n)=>s.type!=="operator"||s.value!=="-"||n&&A[n-1].type!=="operator"?s:{type:"operator",value:"n"});let i=!1;for(const s of A){if(s.type==="operator"){if(w.operatorsPrefix.includes(s.value))continue;if(!i)throw new Error("Formula contains an operator in invalid position");if(!w.operators.includes(s.value))throw new Error(`Formula contains an unknown operator ${s.value}`)}else if(i)throw new Error("Formula missing expected operator");i=!i}if(!i)throw new Error("Formula contains invalid trailing operator");A.length===1&&["reference","literal","constant"].includes(A[0].type)&&(this.single={type:A[0].type==="reference"?"reference":"value",value:A[0].value}),this._parts=A.map(s=>{if(s.type==="operator")return w.operatorsPrefix.includes(s.value)?s:s.value;if(s.type!=="reference")return s.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(s.value))throw new Error(`Formula contains invalid reference ${s.value}`);return this.settings.reference?this.settings.reference(s.value):w.reference(s.value)})}_subFormula(c,A){const _=this.settings.functions[A];if(typeof _!="function")throw new Error(`Formula contains unknown function ${A}`);let b=[];if(c){let r="",o=0,i=!1;const s=()=>{if(!r)throw new Error(`Formula contains function ${A} with invalid arguments ${c}`);b.push(r),r=""};for(let n=0;n<c.length;++n){const d=c[n];i?(r+=d,d===i&&(i=!1)):d in w.literals&&!o?(r+=d,i=w.literals[d]):d!==","||o?(r+=d,d==="("?++o:d===")"&&--o):s()}s()}return b=b.map(r=>new E.Parser(r,this.settings)),function(r){const o=[];for(const i of b)o.push(i.evaluate(r));return _.call(r,...o)}}evaluate(c){const A=this._parts.slice();for(let _=A.length-2;_>=0;--_){const b=A[_];if(b&&b.type==="operator"){const r=A[_+1];A.splice(_+1,1);const o=w.evaluate(r,c);A[_]=w.single(b.value,o)}}return w.operatorsOrder.forEach(_=>{for(let b=1;b<A.length-1;)if(_.includes(A[b])){const r=A[b],o=w.evaluate(A[b-1],c),i=w.evaluate(A[b+1],c);A.splice(b,2);const s=w.calculate(r,o,i);A[b-1]=s===0?0:s}else b+=2}),w.evaluate(A[0],c)}},E.Parser.prototype[w.symbol]=!0,w.reference=function(c){return function(A){return A&&A[c]!==void 0?A[c]:null}},w.evaluate=function(c,A){return c===null?null:typeof c=="function"?c(A):c[w.symbol]?c.evaluate(A):c},w.single=function(c,A){if(c==="!")return!A;const _=-A;return _===0?0:_},w.calculate=function(c,A,_){if(c==="??")return w.exists(A)?A:_;if(typeof A=="string"||typeof _=="string"){if(c==="+")return(A=w.exists(A)?A:"")+(w.exists(_)?_:"")}else switch(c){case"^":return Math.pow(A,_);case"*":return A*_;case"/":return A/_;case"%":return A%_;case"+":return A+_;case"-":return A-_}switch(c){case"<":return A<_;case"<=":return A<=_;case">":return A>_;case">=":return A>=_;case"==":return A===_;case"!=":return A!==_;case"&&":return A&&_;case"||":return A||_}return null},w.exists=function(c){return c!=null}},9926:()=>{},5688:()=>{},9708:()=>{},1152:()=>{},443:()=>{},9848:()=>{},5934:P=>{P.exports=JSON.parse('{"version":"17.13.3"}')}},D={},function P(E){var w=D[E];if(w!==void 0)return w.exports;var c=D[E]={exports:{}};return x[E](c,c.exports,P),c.exports}(5107);var x,D})}($n)),$n.exports}var Da=Ea(),h=Dn(Da);const zi=h.object({type:h.string().valid("Point").description("Type of geographical object"),accuracy:h.number().label("Accuracy").description("Accuracy of geocoding in meters"),coordinates:h.array().items(h.number().label("Coordinates").description("Array with longitude and latitude"))}).description("Geopoint of the location"),Ki=h.object({name:h.string().description("Name of the country"),code2:h.string().regex(/^[A-Z]{2}$/).description("2-letters country code"),code3:h.string().regex(/^[A-Z]{3}$/).description("3-letters country code"),code:h.string().regex(/^\d+$/).description("Digit country code")}),Ra=["alley","avenue","borough","boulevard","bout","breakthrough","bypass","descent","entrance","farmstead","garage cooperative","gardening","harbor","highway","impasse","lane","maidan","microdistrict","other","passage","path","quarter","residential area","road","square","station","street","tract"],vt=h.object({admin1:h.string().label("First level administrative division").description("The name of the first level of the territory"),admin2:h.string().label("Second level administrative division").description("The name of the second level of the territory"),admin3:h.string().label("Third level administrative division").description("The name of the third level of the territory"),admin4:h.string().label("Fourth level administrative division").description("The name of the fourth level of the territory"),fullAddress:h.string().label("Full address").description("Address name for a quick lookup"),street:h.string().label("Street name").description("The name of the street associated with the address"),building:h.string().label("Building number").description("The house number of the address")}),Ca=h.object().pattern(/^([a-z]{2})$/,vt).description("The list of translations"),_t=h.object({id:h.string().label("UUID").description("The address unique identifier"),householdId:h.string().label("Tax ID of the head of the household").description("OpenStreetMap place_id"),osmId:h.string().label("OSM ID").description("OpenStreetMap place_id"),stateId:h.string().label("State ID").description("UUID assigned by the state where assistance is provided"),sidarId:h.string().label("SIDAR ID").description("Identifier of the address in SIDAR app"),type:h.string().label("Address type").description("Address type for indicating the households"),name:h.string().valid("",null).label("Name of the address").description("Arbitrary address name for a quick lookup"),fullAddress:h.string().label("Full address").description("Address name for a quick lookup"),country:Ki,admin1:h.string().label("First level administrative division").description("The name of the first level of the territory"),admin2:h.string().label("Second level administrative division").description("The name of the second level of the territory"),admin3:h.string().label("Third level administrative division").description("The name of the third level of the territory"),admin4:h.string().label("Fourth level administrative division").description("The name of the fourth level of the territory"),pCode1:h.string().pattern(/^UA\d{2}/).label("Code of the first level administrative division").description("the code representing the first level of geographic identification (p-code 1)"),pCode2:h.string().pattern(/^UA\d{4}/).label("Code of the second level administrative division").description("the code representing the second level of geographic identification (p-code 2)"),pCode3:h.string().pattern(/^UA\d{7}/).label("Code of the third level administrative division").description("the code representing the third level of geographic identification (p-code 3)"),pCode4:h.string().pattern(/^UA\d{10}/).label("Code of the fourth level administrative division").description("the code representing the fourth level of geographic identification (p-code 4)"),street:h.string().label("Street name").description("The name of the street associated with the address"),streetType:h.string().valid(...Ra).label("Street type").description("The name of the street associated with the address in Ukrainian"),building:h.string().label("Building number").description("The house number of the address"),block:h.string().label("Block number").description("The block in the house address"),apartment:h.string().label("Apartment number").description("The apartment number"),location:zi,tags:h.array().items(h.string()),createdAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Created At").description("Creation date of the record"),updatedAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Updated At").description("Last updated date of the record"),createdBy:h.string().label("Created by").description("The identifier of the user who added the address"),updatedBy:h.string().label("Updated at").description("The identifier of the user who updated the address"),translation:Ca}),Pa=h.object({index:h.string(),query:h.string(),size:h.number().max(100),from:h.number().min(0),filters:h.object({}),sort:h.object({key:h.string(),mode:h.string().valid("asc","desc")}),start:h.date(),end:h.date()}),Ia=[-1,5,7,9,4,6,10,5,7],Xe=(u,m)=>{if(u==="0000000000")return u;if(!u)throw new Error("Tax ID is not set");if(u=String(u).trim(),!u.match(/^\d{10}$/))throw new Error("Tax ID must contain 10 digits");const D=u.slice(0,9).split("").map(P=>parseInt(P)).reduce((P,E,w)=>P+E*Ia[w],0)%11%10;if(parseInt(u.slice(9,10))!==D)throw new Error("This tax ID is wrong");return u},Gt=h.object({id:h.string().label("UUID").description("UUID of the file"),name:h.string().label("Filename").description("User defined filename"),path:h.string().label("Path").description("Place where the file is stored"),description:h.string().label("File description").description("Comment to the file content"),size:h.number().integer().label("File size").description("File size in bytes"),base64:h.string().label("Base64 file").description("Base64 encoded file"),mimeType:h.string().label("File mimetype").description("File mimetype"),orphaned:h.boolean().label("Orphaned").description("Indicator if the file is orphaned"),createdAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Created At").description("Date when the file was uploaded"),createdBy:h.string().label("Created by").description("ID of the user who uploaded the file"),category:h.string().label("File category").description("File category for filtering")}),Cn=h.object({name:h.string().label("Name").description("Name of the vulnerability"),vulnerabilitySpecified:h.string().label("Vulnerability specified").description("Detailed name of the vulnerability"),code:h.string().label("Code").regex(/^[A-Z]{2}$/).description("2-letters code of the vulnerability")}).allow(null),Ta=["IDPs","Non-displaced","Returnees","Refugees","Statelessness"],Yt=h.object({fullName:h.string().label("Full Name").description("Full name of the person"),familyName:h.string().label("Family Name").description("Family name of the person"),givenName:h.string().label("Given Name").description("Given name of the person"),additionalName:h.string().allow(null,"").label("Additional Name").description("Additional name of the person")}),qa=h.object().pattern(/^([a-z]{2})$/,Yt).description("The list of translations"),Rt=h.object({id:h.string().label("UID").description("Unique identifier of the person"),taxId:h.string().min(10).max(10).custom(Xe).label("Tax ID").description("Tax identification number"),noTaxId:h.boolean().label("No Tax ID").description("Indicator if the person has no tax ID"),noDocuments:h.boolean().label("No documents").description("Indicator if the person has no documents at all"),passport:h.string().label("Passport").description("Passport number"),populationType:h.string().valid(...Ta).label("Population Type").description("Type of population"),fullName:h.string().label("Full Name").description("Full name of the person"),familyName:h.string().label("Family Name").description("Family name of the person"),givenName:h.string().label("Given Name").description("Given name of the person"),additionalName:h.string().allow(null,"").label("Additional Name").description("Additional name of the person"),gender:h.string().valid("Male","Female").label("Gender").description("Gender of the person"),birthday:h.date().iso().less("now").label("Birthday").description("Birthday of the person"),age:h.number().integer().label("Age").description("Age of the person"),origin:h.string().label("Origin").description("Region of origin"),vulnerability:Cn,email:h.array().items(h.string().email({tlds:{allow:!1}}).allow(null,"").label("Email").description("Email address of the person")),phone:h.array().items(h.string().allow(null,"").label("Phone").description("Phone number of the person")),website:h.array().items(h.string().allow(null,"").label("Website").description("Website of the person")),tags:h.array().items(h.string()),createdAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Created At").description("Creation date of the record"),updatedAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Updated At").description("Last updated date of the record"),createdBy:h.string().label("Created at").description("The identifier of the user who added the address"),updatedBy:h.string().label("Updated at").description("The identifier of the user who updated the address"),translation:qa}).label("Person details"),Tr=h.object({taxId:h.string().min(10).max(10).custom(Xe).label("Tax ID").description("Tax identification number"),noTaxId:h.boolean().label("No Tax ID").description("Indicator if the person has no tax ID"),passport:h.string().label("Passport").description("Passport number"),birthday:h.date().iso().less("now").label("Birthday").required().description("Birthday of the person"),age:h.number().integer().min(0).max(150).required().label("Age").description("Age of the person at the day of the assistance provision"),gender:h.string().valid("Male","Female").required().label("Gender").description("Gender of the person"),vulnerability:Cn}).label("Family member").description("Short information about the Family member"),Li=h.object({key:h.string().label("Key").description("Unique identifier for the item"),value:h.string().label("Text").description("Text as an alternative type of a variable")}).label("Item").description("A single item with various properties"),Fa=h.object({time:h.number().integer(),x:h.number(),y:h.number(),pressure:h.number()}),Ui=h.object({penColor:h.string(),dotSize:h.number(),minWidth:h.number(),maxWidth:h.number(),velocityFilterWeight:h.number().min(0),compositeOperation:h.string(),points:h.array().items(Fa)}),Zt=h.object({name:h.string().label("Name").description("Name of collective center")}),Na=h.object().pattern(/^([a-z]{2})$/,Zt).description("The list of translations"),Qt=h.object({name:h.string().label("Name").description("Name of the collective center"),code:h.string().label("Code").description("Code of the collective center"),translation:Na}),Wt=h.object({key:h.string().label("Key").description("Unique identifier for the item"),value:h.number().min(0).max(5e4).label("Value").description("Value associated with the item"),price:h.number().integer().min(0).max(2e6).label("Price").description("Price of the item in cents"),boolean:h.boolean().label("Boolean Flag").description("Boolean flag as an alternative type of a variable"),text:h.string().label("Text").description("Text as an alternative type of a variable")}).label("Item").description("A single item with various properties"),qr=h.object({clusterObjective:h.string().label("Cluster objective"),sectoralObjective:h.string().label("Sectoral objective")}).label("Objectives").description("Global objectives"),Pn=h.object({all:h.number().integer().min(0).max(50).label("Total family members").description("Total number of family members"),boys:h.number().integer().min(0).max(15).label("Boys").description("Number of boys in the family"),girls:h.number().integer().min(0).max(15).label("Girls").description("Number of girls in the family"),men:h.number().integer().min(0).max(15).label("Men").description("Number of men in the family"),women:h.number().integer().min(0).max(15).label("Women").description("Number of women in the family"),seniorMen:h.number().integer().min(0).max(15).label("Old Men").description("Number of elderly men in the family"),seniorWomen:h.number().integer().min(0).max(15).label("Old Women").description("Number of elderly women in the family"),adultsOther:h.number().integer().min(0).max(50).label("Disabled").description("Number of other members in the family"),disabled:h.number().integer().min(0).max(50).label("Disabled").description("Number of disabled members in the family"),vulnerable:h.number().integer().min(0).max(50).label("Vulnerable").description("Number of vulnerable members in the family")}).label("Family Statistics").description("Statistics about family members categorized by different groups"),Ma=["Active","Suspended","Closed"],Ba=["Academic / Research","Donor","Embassy","Government","International NGO","International Organization","Media","Military","National NGO","Other","Private sector","Red Cross / Red Crescent","Religious","United Nations"],za=["UN Agency","Operational partner","Implementing partner","Local authority"],qe=h.object({name:h.string().label("Organization name").description("Name of the organization"),legalName:h.string().label("Full name of the organization").description("Full name of the organization according to the documents"),description:h.string().label("Description").description("Description of the organization"),legalName:h.string().label("Full name of the organization").description("Full name of the organization according to the documents"),address:vt}),Ka=h.object().pattern(/^([a-z]{2})$/,qe).description("The list of translations"),De=h.object({id:h.string().label("UUID").description("UUID of the organization"),code:h.string().required().label("Organization code").description("Unique code of the organization"),name:h.string().required().label("Organization name").description("Short name of the organization"),status:h.string().allow(null).valid(...Ma).label("Current status").description("Status of the organization"),description:h.string().allow(null,"").label("Description").description("Description of the organization"),legalName:h.string().allow(null,"").label("Full name of the organization").description("Full name of the organization according to the documents"),type:h.string().allow(null).valid(...Ba).label("Organization type").description("Type of the organization (OCHA classification)"),functionalType:h.string().allow(null).label("Organization functional type").valid(...za).description("Functional type of the organization"),address:_t,logo:h.array().max(1).items(Gt),email:h.array().items(h.string().email({tlds:{allow:!1}}).allow(null,"").label("Email").description("Email address of the organization")),phone:h.array().items(h.string().allow(null,"").label("Phone").description("Phone number of the organization")),website:h.array().items(h.string().allow(null,"").label("Website").description("Website of the organization")),tags:h.array().items(h.string()),createdBy:h.string().label("Created by").description("User who created the record"),updatedBy:h.string().label("Updated by").description("User who last updated the record"),createdAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Created At").description("Creation date of the record"),updatedAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Updated At").description("Last updated date of the record"),translation:Ka}).description("Entity details"),La=h.object({headOfHousehold:Yt,address:vt,household:vt,fundedBy:qe,responsibleOrganization:qe,organization:qe,collectiveCenter:Zt}),Ua=["IDPs","Non-displaced","Returnees","Refugees","Statelessness"],Ha=["Cash","Voucher","In-kind"],Wa=h.object().pattern(/^([a-z]{2})$/,La).description("The list of translations"),Ga=h.object({id:h.string().label("UID").description("Unique identifier of the request"),date:h.alternatives().try(h.string().isoDate(),h.date()).label("Date of the assistance").description("The date when the assistance was provided"),headOfHouseholdId:h.string().label("Head of household ID").description("HH ID from the documents"),householdId:h.string().label("Household ID").description("Contains the tax ID number of the first household representative"),peopleIds:h.array().items(h.alternatives().try(h.string().pattern(/^\d{10}$/).custom(Xe),h.string().pattern(/^\d{9}$/),h.string().pattern(/^[Ð-Ð¯Ð]{2} \d{6}$/))),taxIds:h.array().items(h.alternatives().try(h.string().pattern(/^\d{10}$/).custom(Xe),h.string().pattern(/^\d{9}$/),h.string().pattern(/^[Ð-Ð¯Ð]{2} \d{6}$/))),familyMembersIds:h.array().items(h.string()).label("Family members IDs").description("List of all family members IDs, following the pattern [sex];[age group];[household Id];[age];[tax id or uid]"),objectives:qr,bundleName:h.string().required().label("Bundle Name").description("The name of the assistance bundle"),donationId:h.string().label("Donation ID").description("The id of the donation (for converted donations)"),distributionId:h.string().when("distributionModality",{is:"In-kind",then:h.string().required()}).label("Distribution ID").description("The public identifier for aggregation"),publicId:h.string().label("Public ID").description("The public identifier for aggregation"),aor:h.string().label("Area of responsibility").description("Area of responsibility for quick aggregations"),distributionModality:h.string().valid(...Ha).label("Distribution Modality").description("The modality of distribution"),populationType:h.string().valid(...Ua).label("Population Type").description("The type of population"),headOfHousehold:Rt.append({birthday:h.date().iso().required().less("now").label("Birthday").description("Birthday of the person")}),familyMembers:h.array().items(Tr),address:_t,household:_t,collectiveCenter:Qt,items:h.array().items(Wt),strings:h.array().items(Li),familyStats:Pn,fundedBy:De,responsibleOrganization:De,organization:De,totalPrice:h.number().integer().min(0).label("Total price").description("Total price of the items"),comment:h.string().label("Comment").description("Comment about the record"),duplicated:h.boolean().label("Duplicated").description("Indicates if the record is duplicated"),groupId:h.string().label("Group ID").description("ID of the group for progress tracking"),signature:h.array().items(Ui).label("Signature").description("Signature field, currently not enabled"),metadata:h.object().label("Metadata").description("Additional metadata associated with the record"),createdBy:h.string().label("Created By").description("Identifier of the user who created this record"),createdByEmail:h.string().email({tlds:{allow:!1}}).label("Created By Email").description("Email of the user who created this record"),value:h.number().min(0).label("Value").description("RAIS data value"),currency:h.string().label("Currency").description("Currency of the RAIS data"),frequency:h.number().integer().min(1).label("Frequency").description("Frequency of the RAIS data"),attendedFrom:h.alternatives().try(h.string().isoDate(),h.date()).label("Attended From").description("Start date of attendance RAIS"),attendedTo:h.alternatives().try(h.string().isoDate(),h.date()).label("Attended To").description("End date of attendance RAIS"),tags:h.array().items(h.string()).allow(null),hash:h.string().pattern(/^[a-fA-F0-9]{32}$/).label("Hash").description("MD5 Hash for quick lookups and search of duplicated records"),updatedBy:h.string().label("Updated By").description("Identifier of the user who last updated this record"),updatedByEmail:h.string().email({tlds:{allow:!1}}).label("Updated By Email").description("Email of the user who updated this record"),createdAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Created At").description("Creation date of the record"),updatedAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Updated At").description("Last updated date of the record"),translation:Wa}),Ya=h.object({"headOfHousehold.taxId":h.string().min(10).max(10).custom(Xe).label("Tax ID").when("headOfHousehold.passport",{is:void 0,then:h.string().required()}),"headOfHousehold.passport":h.string().pattern(/^(\d{9}|[Ð-Ð¯]{2} *\d{6})$/).when("headOfHousehold.taxId",{is:void 0,then:h.string().required()}),"address.pCode4":h.string().required().pattern(/UA\d{10}$/),attendedFrom:h.alternatives().try(h.string().pattern(/20\d{6}/),h.string().isoDate(),h.date()),attendedTo:h.alternatives().try(h.string().pattern(/20\d{6}/),h.string().isoDate(),h.date()),"headOfHousehold.birthday":h.alternatives().try(h.string().pattern(/20\d{6}/),h.string().isoDate(),h.date()),"headOfHousehold.gender":h.string().required().valid("Male","Female"),"headOfHousehold.vulnerability.name":h.string().required().valid("Child or Adolescent at Risk","Unaccompanied or Separated Child","Woman at Risk","Older Person at Risk","Single Parent or care giver","Disability","Serious medical condition","Family unity","Specific legal and physical protection needs","Torture","GBV","N/A"),date:h.alternatives().try(h.string().pattern(/20\d{6}/),h.string().isoDate(),h.date()),bundleName:h.string().required().pattern(/SN\d{3}/),populationType:h.string().required().valid("IDPs","Non-displaced","Returnees","Refugees","Statelessness"),value:h.number().required(),currency:h.string().required().valid("USD","UAH","EUR"),familyMembers:h.array().items(Tr)}).pattern(/^items? *[.-] */,h.number().min(0).max(5e3)).pattern(/^strings? *[.-] */,h.string()).unknown(!0),Hi=h.object({all:h.number().integer().min(0).max(1e4).label("Total family members").description("Total number of family members"),boys:h.number().integer().min(0).max(5e3).label("Boys").description("Number of boys in the family"),girls:h.number().integer().min(0).max(5e3).label("Girls").description("Number of girls in the family"),men:h.number().integer().min(0).max(5e3).label("Men").description("Number of men in the family"),women:h.number().integer().min(0).max(5e3).label("Women").description("Number of women in the family"),seniorMen:h.number().integer().min(0).max(5e3).label("Old Men").description("Number of elderly men in the family"),seniorWomen:h.number().integer().min(0).max(5e3).label("Old Women").description("Number of elderly women in the family"),adultsOther:h.number().integer().min(0).max(5e3).label("Disabled").description("Number of other members in the family"),disabled:h.number().integer().min(0).max(5e3).label("Disabled").description("Number of disabled members in the family"),vulnerable:h.number().integer().min(0).max(5e3).label("Vulnerable").description("Number of vulnerable members in the family")}).label("Family Statistics").description("Statistics about family members categorized by different groups"),In=u=>{if(!u)throw new Error("Set of items is not defined");if(u.length===0)throw new Error("Total number of items can't be equal zero");if(u.filter(x=>parseFloat(x[1])>0)===0)throw new Error("Total number of items can't be equal zero");return u},Za=["alley","avenue","borough","boulevard","bout","breakthrough","bypass","descent","entrance","farmstead","garage cooperative","gardening","harbor","highway","impasse","lane","maidan","microdistrict","other","passage","path","quarter","residential area","road","square","station","street","tract"],Qa=["Archived","In distribution","Requested","Converted","Uploaded"],Ja=h.object({address:vt,fundedBy:qe,responsibleOrganization:qe,organization:qe,receivingOrganization:qe,collectiveCenter:Zt,focalPoint:Yt}),Xa=h.object().pattern(/^([a-z]{2})$/,Ja).description("The list of translations"),Va=h.object({id:h.string().label("UUID").description("Unique identifier"),isCalculated:h.boolean().label("Is Calculated").description("Indicates if the summary is created by a script"),isDonation:h.boolean().label("Is Donation").description("Indicates if the summary is a donation"),objectives:qr,date:h.alternatives().try(h.string().isoDate(),h.date()).label("Date").description("The date of the assistance"),bundleName:h.string().required().label("Bundle Name").description("The name of the bundle"),publicId:h.string().required().label("Public ID").description("The public identifier for aggregation"),aor:h.string().label("AOR").description("Area of Responsibility for quick aggregations"),distributionModality:h.string().required().label("Distribution Modality").description("The modality of distribution"),populationType:h.string().required().label("Population Type").description("The type of population"),buildings:h.number().integer().label("Building").description("Number of buildings assisted"),households:h.number().integer().label("Households").description("Number of households assisted"),individuals:h.number().integer().label("Individuals").description("Number of individuals assisted"),familyStats:Hi,address:_t.append({pCode4:h.string().required().pattern(/^UA\d{10}/).label("Code of the fourth level administrative division").description("the code representing the fourth level of geographic identification (p-code 4)"),street:h.string().required().label("Street name").description("The name of the street associated with the address"),streetType:h.string().required().valid(...Za).label("Street type").description("The name of the street associated with the address in Ukrainian")}),collectiveCenter:Qt,items:h.array().items(Wt).custom(In),strings:h.array().items(Wt),fundedBy:De.label("Organization funded the assistance").description("Organization responsible for the assistance"),status:h.string().valid(...Qa).required(),organization:De.label("Organization").description("Implementing organization"),responsibleOrganization:De.label("Partner organization").description("Organization responsible for the assistance"),receivingOrganization:De.label("Receiving organization").description("Organization receiving the donation"),focalPoint:Rt.label("Focal point").description("Focal point or the receiving organization"),files:h.array().items(Gt),totalPrice:h.number().integer().label("Total Price").description("Total price of the assistance in cents"),comment:h.string().label("Comment").description("Comment about the record"),metadata:h.object().label("Metadata").description("Additional metadata associated with the record"),tags:h.array().items(h.string()),createdBy:h.string().label("Created By").description("Identifier of the user who created this record"),createdByEmail:h.string().email({tlds:{allow:!1}}).label("Created by email").description("Email of the user who created this record"),updatedBy:h.string().label("Updated By").description("Identifier of the user who last updated this record"),updatedByEmail:h.string().email({tlds:{allow:!1}}).label("Updated by email").description("Email of the user who updated this record"),createdAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Created At").description("Creation date of the record"),updatedAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Updated At").description("Last updated date of the record"),translation:Xa}),Wi=u=>{if(!u)return u;const m=u.split(/ *, */g);for(let x of m){let D=/^\d{10}$/.test(x),P=/^[Ð§ÐÐMFW]\d{4}-?\d{2}-?\d{2}/i.test(x);if(!D&&!P)throw new Error(`This list contians wrong values - ${x}`);if(D)try{Xe(x)}catch(E){throw new Error(E.message+" - "+x)}}return u},Gi=u=>{typeof u=="number"&&(u=String(u));const m=/^\d{9}$/.test(u),x=/^[Ð-Ð¯ÐÐÐ]{2} *\d{6}$/.test(u);if(!m&&!x)throw new Error("This passport number is wrong");return u},eo=u=>{u=u.replace(/\D/g,"");let m=String(u);return m=m.replace(/\D/g,""),m.length===9&&(m=380+m),m.length===10&&(m=38+m),m.length===11&&(m=8+m),m.length===12&&(m=m.replace(/^(\d{2})(\d{3})(\d{3})(\d{2})(\d{2})$/,"+$1 ($2) $3 $4 $5")),m},to=u=>{if(!u)return u;if(u.split(/, */g).map(eo).filter(D=>D.length===19).length===0)throw new Error("This phone number is wrong");return u},ro=["Male","Female","N/A","Other"],no=["alley","avenue","boulevard","breakthrough","bypass","descent","harbor","highway","impasse","lane","maidan","other","passage","path","road","square","street","station"],io=["In-kind","Cash","Voucher","Distribution"],so=["SN101-2024","SN102-2024","SN103-2024","SN104-2024","SN105-2024","SN106-2024","SN107-2024","SN108-2024","SN109-2024","SN110-2024","SN111-2024","SN201-2024","SN202-2024","SN203-2024","SN204-2024","SN205-2024","SN206-2024","SN207-2024","SN208-2024","SN209-2024"],ao=["Child or Adolescent at Risk","Unaccompanied or Separated Child","Woman at Risk","Older Person at Risk","Single Parent or care giver","Disability","Serious medical condition","Family unity","Specific legal and physical protection needs","Torture","GBV","N/A"],oo={"address.admin1":h.string().label("First level administrative division"),"address.admin2":h.string().label("Second level administrative division"),"address.admin3":h.string().label("Third level administrative division"),"address.admin4":h.string().label("Fourth level administrative division"),"address.block":h.string().label("Block number"),"address.building":h.string().label("Building number"),"address.pCode1":h.string().min(4).max(4).regex(/^UA\d{2}$/).label("Code of the first level administrative division"),"address.pCode2":h.string().min(6).max(6).regex(/^UA\d{4}$/).label("Code of the second level administrative division"),"address.pCode3":h.string().min(9).max(9).regex(/^UA\d{7}$/).label("Code of the third level administrative division"),"address.pCode4":h.string().min(12).max(12).regex(/^UA\d{10}$/).label("Code of the fourth level administrative division"),"address.street":h.string().label("Street name"),"address.streetType":h.string().valid(...no).label("Street type"),aor:h.string().label("Area of responsibility"),apartment:h.string().pattern(/^\d+$/).label("Apartment number"),attendedFrom:h.date().iso().label("Attended from"),attendedTo:h.date().iso().label("Attended to"),birthday:h.date().iso().less("now").label("Birthday"),"headOfHousehold.birthday":h.date().iso().less("now").label("Birthday"),block:h.string().max(5).label("Block number"),bundleName:h.string().valid(...so).label("Bundle name"),"collectiveCenter.name":h.string().label("Collective center"),comment:h.string().label("Comment"),currency:h.string().min(3).max(3).label("Currency"),date:h.date().iso().label("Date of the assistance"),distributionModality:h.string().valid(...io).label("Distribution modality"),familyMembers:h.string().custom(Wi).label("Family members"),"fundedBy.name":h.string().label("Funded by"),"headOfHousehold.additionalName":h.string().label("Additional name"),"headOfHousehold.age":h.number().integer().min(0).max(120).label("Age"),"headOfHousehold.email":h.string().email({tlds:{allow:!1}}).allow(null,"").label("Email"),"headOfHousehold.familyName":h.string().label("Family name"),"headOfHousehold.fullName":h.string().label("Full name"),"headOfHousehold.gender":h.string().valid(...ro).label("Gender"),"headOfHousehold.givenName":h.string().label("Given name"),"headOfHousehold.noDocuments":h.boolean().label("No documents"),"headOfHousehold.origin":h.string().min(4).max(4).regex(/^UA\d{2}$/).label("Origin"),"headOfHousehold.passport":h.string().custom(Gi).when("headOfHousehold.taxId",{is:null,then:h.required(),otherwise:h.optional()}).label("Passport"),"headOfHousehold.phone":h.string().custom(to).label("Phone"),"headOfHousehold.translation.uk.additionalName":h.string().label("Additional name (ukr)"),"headOfHousehold.translation.uk.familyName":h.string().label("Family name (ukr)"),"headOfHousehold.translation.uk.fullName":h.string().label("Full Name (ukr)"),"headOfHousehold.translation.uk.givenName":h.string().label("Given Name (ukr)"),"headOfHousehold.website":h.string().label("Website"),"headOfHousehold.noTaxId":h.boolean().label("No Tax ID"),"organization.name":h.string().label("Organization"),populationType:h.string().label("Population type"),"responsibleOrganization.name":h.string().label("Responsible organization"),tags:h.string().label("Tags"),"headOfHousehold.taxId":h.string().min(10).max(10).custom(Xe).when("headOfHousehold.passport",{is:null,then:h.required(),otherwise:h.optional()}).label("Tax ID"),value:h.number().min(0).label("Value"),"vulnerability.name":h.string().valid(...ao).label("Vulnerability")},lo=h.object({"headOfHousehold.taxId":h.string().min(10).max(10).custom(Xe).label("Tax ID").when("headOfHousehold.passport",{is:void 0,then:h.string().required()}),"headOfHousehold.passport":h.string().pattern(/^(\d{9}|[Ð-Ð¯]{2} *\d{6})$/).when("headOfHousehold.taxId",{is:void 0,then:h.string().required()}),"headOfHousehold.translation.uk.familyName":h.string().required(),"headOfHousehold.translation.uk.givenName":h.string().required(),"headOfHousehold.translation.uk.additionalName":h.string().required(),"headOfHousehold.origin":h.string().required(),"headOfHousehold.birthday":h.alternatives().try(h.string().pattern(/20\d{6}/),h.string().isoDate(),h.date()),"headOfHousehold.phone":h.string().required(),"headOfHousehold.gender":h.string().required().valid("Male","Female"),"headOfHousehold.vulnerability.name":h.string().required().valid("Child or Adolescent at Risk","Unaccompanied or Separated Child","Woman at Risk","Older Person at Risk","Single Parent or care giver","Disability","Serious medical condition","Family unity","Specific legal and physical protection needs","Torture","GBV","N/A"),"address.pCode4":h.string().required().pattern(/UA\d{10}$/),"household.streetType":h.string().valid("alley","avenue","borough","boulevard","bout","breakthrough","bypass","descent","entrance","farmstead","garage cooperative","gardening","harbor","highway","impasse","lane","maidan","microdistrict","other","passage","path","quarter","residential area","road","square","station","street","tract"),"household.translation.uk.street":h.string().pattern(/^[^a-z]*$/i),"household.building":h.alternatives(h.string(),h.number().integer()),date:h.alternatives().try(h.string().pattern(/20\d{6}/),h.string().isoDate(),h.date()),bundleName:h.string().required().pattern(/SN\d{3}/),populationType:h.string().required().valid("IDPs","Non-displaced","Returnees","Refugees","Statelessness"),familyMembers:h.array().items(Tr)}).pattern(/^items? *[.-] */,h.number().min(0).max(5e3)).pattern(/^strings? *[.-] */,h.string()).unknown(!0),uo=/[!"#$%&'()*+,./:;<=>?@[\\\]^_`{|}~ \-]/g,Tn=(u,m)=>{let x=[];if(u.match(/[A-Z]/)||x.push("Your password is not strong enough. Add English uppercase characters (A-Z)"),u.match(/[a-z]/)||x.push("Your password is not strong enough. Add English lowercase characters (a-z)"),u.match(/\d/)||x.push("Your password is not strong enough. Add numerals (0-9)"),u.match(uo)||x.push("Your password is not strong enough. Add numerals (0-9)"),x.length>1)throw new Error(x[0]);return u},co=h.object({email:h.string().email({tlds:{allow:!1}}).required().label("User Email").description("User email that was used for the authorization").messages({"string.empty":"Email is a mandatory field","string.base":"Email is a mandatory field","string.required":"Email is a mandatory field","string.email":"You provided an invalid email"}),password:h.string().required().min(8).max(64).pattern(/^[^Ð°-ÑÑÑÒ]+$/i).pattern(/^[^ ].*[^ ]$/).custom(Tn).label("User password").description("User password that was used for the authorization").messages({"string.empty":"Password is a mandatory field","string.base":"Password is a mandatory field","string.required":"Password is a mandatory field","string.pattern.base":"Password must not contain Cyrillic characters and spaces in the beginning or the end","any.custom":"{{#error.message}}"})}),fo=["Admin","Partner Representative","Partner Manager","Partner IM","Partner Editor","Distributor","Coordinator","Signer","Donor"],ho=["Not initiated","Secret is issued","TOTP is set"],Yi=h.object({person:Yt,organization:qe,responsibleOrganization:qe,jobTitle:h.string().allow(null,"")}),po=h.object().pattern(/^([a-z]{2})$/,Yi).description("The list of translations"),mo=h.object({id:h.string(),isSuperUser:h.boolean().label("Super User").description("Indicates if the user is a super user"),email:h.string().email({tlds:{allow:!1}}).required().label("Email").description("The email address of the user for authentication"),verified:h.boolean().label("Verified").description("Indicates if the user's email has been verified"),mfa:h.string().valid(...ho).label("MFA").description("Multi-factor authentication status"),secret:h.string().label("MFA Secret").description("Secret key for MFA authentication").allow(null,""),privacyConsent:h.boolean().label("Privacy Consent").description("Indicates if the user has given privacy consent"),termsConsent:h.boolean().label("Privacy Consent").description("Indicates if the user has accepted the terms of use"),role:h.array().items(h.string().valid(...fo).label("Role").description("Role assigned to the user")).description("List of user roles"),scopes:h.array().items(h.string().label("Scopes").description("Scopes assigned to the user")).description("List of scopes"),permissions:h.array().items(h.string().label("Permissions").description("Permissions assigned to the user")).description("List of permissions"),status:h.string().valid("Active","Blocked").label("Status").description("Status of the user"),person:Rt,organization:De,responsibleOrganizations:h.array().items(De),jobTitle:h.string().label("Job title").description("Person's position in the organization"),responsibleOrganization:h.array().items(De),image:h.array().items(Gt),restrictions:h.array().items(h.string().pattern(/^UA\d{2,10}/).label("Restrictions").description("Admin1-Admin4 p-code")).description("List of p-codes to limit user access"),tags:h.array().items(h.string()),createdAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Created by").description("The date when the user was created"),updatedAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Updated by").description("The most recent date when the user was updated"),createdBy:h.string().label("Created at").description("The identifier of the user who added the user"),updatedBy:h.string().label("Updated at").description("The identifier of the user who recently updated the user"),translation:po}),go=["alley","avenue","borough","boulevard","bout","breakthrough","bypass","descent","entrance","farmstead","garage cooperative","gardening","harbor","highway","impasse","lane","maidan","microdistrict","other","passage","path","quarter","residential area","road","square","station","street","tract"],yo=["In-kind","Cash","Voucher"],bo=["Archived","In distribution","Requested","Uploaded"],vo=["IDPs","Non-displaced","Returnees","Refugees","Statelessness"],_o=h.object({id:h.string(),person:Rt}),wo=h.object({address:vt,fundedBy:qe,responsibleOrganization:qe,collectiveCenter:Zt,assignees:Yi}),xo=h.object().pattern(/^([a-z]{2})$/,wo).description("The list of translations"),$o=h.object({id:h.string().label("UID").description("Unique identifier of the request"),date:h.alternatives().try(h.string().isoDate(),h.date()).required().label("Date of the assistance").description("The date when the assistance was provided"),objectives:qr,bundleName:h.string().required().label("Bundle Name").description("The name of the assistance bundle"),donationId:h.string().label("Donation ID").description("The identifier of the related donation"),publicId:h.string().label("Public ID").description("The public identifier for aggregation"),aor:h.string().label("Area of responsibility").description("Area of responsibility for quick aggregations"),distributionModality:h.string().valid(...yo).required().label("Distribution Modality").description("The modality of distribution"),populationType:h.string().valid(...vo).required().label("Population Type").description("The type of population"),address:_t.append({pCode4:h.string().pattern(/^UA\d{10}/).required().label("Code of the fourth level administrative division").description("the code representing the fourth level of geographic identification (p-code 4)"),street:h.string().label("Street name").description("The name of the street associated with the address"),streetType:h.string().valid(...go).label("Street type").description("The name of the street associated with the address in Ukrainian")}),collectiveCenter:Qt,items:h.array().items(Wt).custom(In),organization:De.required(),responsibleOrganization:De.required(),fundedBy:De.required(),status:h.string().valid(...bo).required(),assignees:h.array().items(_o),comment:h.string().label("Comment").description("Comment about the record"),metadata:h.object().label("Metadata").description("Additional metadata associated with the record"),tags:h.array().items(h.string()),createdBy:h.string().label("Created By").description("Identifier of the user who created this record"),createdByEmail:h.string().email({tlds:{allow:!1}}).label("Created By Email").description("Email of the user who created this record"),updatedBy:h.string().label("Updated By").description("Identifier of the user who last updated this record"),updatedByEmail:h.string().email({tlds:{allow:!1}}).label("Updated By Email").description("Email of the user who updated this record"),createdAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Created At").description("Creation date of the record"),updatedAt:h.alternatives().try(h.string().isoDate(),h.date()).label("Updated At").description("Last updated date of the record"),translation:xo}),Oo=h.object({password:h.string().required().min(8).max(64).pattern(/^[^Ð°-ÑÑÑÒ]+$/i).pattern(/^[^ ].*[^ ]$/).custom(Tn).label("User password").description("User password that was used for the authorization").messages({"string.empty":"Password is a mandatory field","string.base":"Password is a mandatory field","string.required":"Password is a mandatory field","string.pattern.base":"Password must not contain Cyrillic characters and spaces in the beginning or the end","any.custom":"{{#error.message}}"}),confirm:h.string().required().valid(h.ref("password")).messages({"string.empty":"Confirm your password","string.base":"Confirm your password","string.required":"Confirm your password","string.pattern.base":"Password must not contain Cyrillic characters and spaces in the beginning or the end","any.custom":"{{#error.message}}"}),reset:h.string()}),ko=h.object({address:vt,fundedBy:qe,responsibleOrganization:qe,organization:qe,receivingOrganization:qe,collectiveCenter:Zt,focalPoint:Yt}),Ao=h.object().pattern(/^([a-z]{2})$/,ko).description("The list of translations"),So=h.object({isCalculated:h.boolean().label("Is Calculated").description("Indicates if the summary is created by a script"),isDonation:h.boolean().label("Is Donation").description("Indicates if the summary is a donation"),date:h.string().isoDate().label("Date").description("The date of the assistance"),bundleName:h.string().label("Bundle Name").description("The name of the bundle"),publicId:h.string().label("Public ID").description("The public identifier for aggregation"),aor:h.string().label("AOR").description("Area of Responsibility for quick aggregations"),distributionModality:h.string().label("Distribution Modality").description("The modality of distribution"),populationType:h.string().label("Population Type").description("The type of population"),buildings:h.number().integer().label("Building").description("Number of buildings assisted"),households:h.number().integer().label("Households").description("Number of households assisted"),individuals:h.number().integer().label("Individuals").description("Number of individuals assisted"),familyStats:Pn,address:_t,collectiveCenter:Qt,fundedBy:De.label("Organization funded the assistance").description("Organization responsible for the assistance"),responsibleOrganization:De.label("Partner organization").description("Organization responsible for the assistance"),organization:De.label("Organization").description("Implementing organization"),receivingOrganization:De.label("Receiving organization").description("Organization receiving the donation"),focalPoint:Rt.label("Focal point").description("Focal point or the receiving organization"),files:h.array().items(Gt),totalPrice:h.number().integer().label("Total Price").description("Total price of the assistance in cents"),comment:h.string().label("Comment").description("Comment about the record"),metadata:h.object().label("Metadata").description("Additional metadata associated with the record"),tags:h.array().items(h.string()),createdBy:h.string().label("Created By").description("Identifier of the user who created this record"),createdByEmail:h.string().email({tlds:{allow:!1}}).label("Created by email").description("Email of the user who created this record"),updatedBy:h.string().label("Updated By").description("Identifier of the user who last updated this record"),updatedByEmail:h.string().email({tlds:{allow:!1}}).label("Updated by email").description("Email of the user who updated this record"),createdAt:h.string().isoDate().label("Created At").description("Creation date of the record"),updatedAt:h.string().isoDate().label("Updated At").description("Last updated date of the record"),translation:Ao}),jo=h.object({name:h.string().description("Name of the tag"),collection:h.string().description("Collection to filter tags")}),Di=Object.assign({"./_alter.js":ja,"./addresses.js":_t,"./adminRecords.js":Pa,"./assistances.js":Ga,"./cashAssistances.js":Ya,"./collectiveCenters.js":Qt,"./countries.js":Ki,"./donations.js":Va,"./familyMembers.js":Tr,"./familyMembersValidator.js":Wi,"./familyStats.js":Pn,"./familyStatsDonation.js":Hi,"./files.js":Gt,"./importValidator.js":oo,"./inKindAssistances.js":lo,"./items.js":Wt,"./itemsExist.js":In,"./locations.js":zi,"./login.js":co,"./objectives.js":qr,"./organizations.js":De,"./passportValidator.js":Gi,"./passwordStrengthValidator.js":Tn,"./people.js":Rt,"./requests.js":$o,"./setPassword.js":Oo,"./signature.js":Ui,"./strings.js":Li,"./summaries.js":So,"./tags.js":jo,"./taxIdValidator.js":Xe,"./users.js":mo,"./vulnerabilities.js":Cn});let Zi={};for(let u of Object.keys(Di))Zi[u.replace(/^\.\/|\.js$/g,"")]=Di[u];const Jt=(u,m)=>{const x=Zi[u];if(!x)return!0;if(Array.isArray(m)){const D=m.map((P,E)=>{const w=x.validate(P,{abortEarly:!1});return w.error?w.error.details.map(c=>({...c,index:E})):!1}).filter(Boolean);if(D.length)throw{errors:D.flat()};return m}if(x){const D=x.validate(m,{abortEarly:!1});if(D.error)throw{errors:D.error.details}}return m},Eo=async(u,m)=>{let x=JSON.parse(JSON.stringify(m));const D=Array.isArray(x);return D||(x=[x]),x=x.map(P=>(P={...P,createdAt:new Date,id:Bi().toString(),synced:online?1:0},online||(P.createdAt=new Date().toLocaleDateString("sv-SE")),P)),await Oe[u].bulkAdd(x),D?x:x[0]},Do=async(u,m)=>(Object.keys(m).forEach(x=>m[x]===void 0&&delete m[x]),Jt(u,m),await Eo(u,m)),Ro=async(u,m,x)=>{const D=JSON.parse(JSON.stringify(x));return D.synced=online?1:0,online||(D.updatedAt=new Date().toLocaleDateString("sv-SE")),await Oe[u].update(m,D)},Qi=async(u,m,x)=>(delete x.synced,Jt(u,x),await Ro(u,m,x)),Ji=async(u,m)=>await Oe[u].get(m),Xi=async(u,m,x)=>{delete x.synced,Jt(u,x);const D=JSON.parse(JSON.stringify(x));return online||(D.upatedAt=new Date().toLocaleDateString("sv-SE")),await Oe[u].update(m,x),D},Co=async(u,m,x)=>{Array.isArray(x)?x=x.map(P=>(Object.keys(P).forEach(E=>P[E]===void 0&&delete P[E]),P)):Object.keys(x).forEach(P=>x[P]===void 0&&delete x[P]),delete x.synced,Jt(u,x),m&&(x.id=m);const D=JSON.parse(JSON.stringify(x));return D.synced=online?1:0,online||(D.createdAt||(D.createdAt=new Date().toLocaleDateString("sv-SE")),D.id||(D.id=Bi().toString()),D.updatedAt=new Date().toLocaleDateString("sv-SE")),await Oe[u].put(D),D},Po=async(u,m)=>(await Oe.transaction("rw",Oe[u],Oe._deleted,async()=>{Oe._deleted.add({id:m,entity:u}),Oe[u].delete(m)}),{status:"ok"}),Io=async(u,m)=>{await(await import("./index-0RbCfubR.js")).axios;const D=Array.isArray(m);D||(Object.keys(m).forEach(E=>m[E]===void 0&&delete m[E]),delete m.synced),D&&(m=m.map(E=>(Object.keys(E).forEach(w=>E[w]===void 0&&delete E[w]),delete E.synced,E))),Jt(u,m);let P=JSON.parse(JSON.stringify(m));return Array.isArray(P)||(P=[P]),P=P.map(E=>{const w=E.id;return E.synced=online?1:0,delete E.id,online||(E.updatedAt=new Date().toLocaleDateString("sv-SE")),{key:w,changes:E}}),await Oe[u].bulkUpdate(P),P},bt={assign(u,m,x){if(!u||!m||!x)throw new Error("Entity, ID, and body are required for changes");return Qi(u,m,x).then(D=>{if(!D)throw new Error(`Failed to update record with ID "${m}" in entity "${u}".`);return Object.defineProperty(D,"$_entity",{value:u,enumerable:!1}),new Proxy(D,bt)})},save(u,m,x){if(!u||!m||!x)throw new Error("Entity, ID, and body are required for changes");return Xi(u,m,x).then(D=>{if(!D)throw new Error(`Failed to update record with ID "${m}" in entity "${u}".`);return Object.defineProperty(D,"$_entity",{value:u,enumerable:!1}),new Proxy(D,bt)})},updateMany(u,m){if(!u||!m||!Array.isArray(m))throw new Error("Entity and array of items are required for changes");return Io(u,m).then(x=>{if(!x)throw new Error(`Failed to update record with ID "${id}" in entity "${u}".`);return x=x.map(D=>(Object.defineProperty(D,"$_entity",{value:u,enumerable:!1}),new Proxy(D,bt))),x})},get(u,m){const x=u.$_entity;if(!x)throw new Error("Entity definition is missing in the target record.");return m==="save"?(...D)=>this[m](x,u.id,u):m==="assign"?(...D)=>this[m](x,u.id,...D):u[m]},set(u,m,x){return u[m]=x,u}},To=(u,m,x)=>!x||!m[x]?!1:u.schema.indexes.map(P=>P.name).includes(x),qo=(u,m,x)=>{if(Array.isArray(x))return u.where(m).anyOf(...x);if(typeof x=="object"){if(x.$contains)return u.where(m).startsWithIgnoreCase(x.$contains);if(x.$eq)return u.where(m).equals(x.$eq);if(x.$ne)return u.where(m).notEqual(x.$ne);if(x.$lte&&x.$gte)return u.where(m).between(x.$gte,x.$lte);if(x.$lte&&x.$gt)return u.where(m).between(x.$gt,x.$lte,!1,!0);if(x.$lt&&x.$gte)return u.where(m).between(x.$gte,x.$lt,!0,!1);if(x.$lt&&x.$gt)return u.where(m).between(x.$gt,x.$lt,!1,!1);if(x.$lt)return u.where(m).below(x.$lt);if(x.$gt)return u.where(m).above(x.$gt);if(x.$lt)return u.where(m).belowOrEqual(x.$lte);if(x.$gt)return u.where(m).aboveOrEqual(x.$gte)}return u.where({[m]:x})},Je=(u,m={},x=[],D)=>{const P=JSON.parse(JSON.stringify(m));return To(u,m,D)&&(u=qo(u,D,P[D]),delete P[D]),(Object.keys(P).length||x!=null&&x.length)&&(u=u.filter(w=>Rn(w,P,x))),u},Vi=(u,m)=>{if(!m.length)return u.toArray();const[x,D]=Object.entries(m[0])[0];return D==="desc"&&(u=u.reverse()),u.sortBy||(u=u.toCollection()),u.sortBy(x)},Fo=(u,m)=>typeof u>"u"||u===null?1:typeof m>"u"||m===null?-1:typeof u=="string"||typeof m=="string"?String(u).localeCompare(String(m)):typeof u=="number"||typeof m=="number"||!isNaN(u)&&!isNaN(m)?parseFloat(u)-parseFloat(m):0,qn=(u,m)=>m?u.sort((x,D)=>{for(const P of m){const[E,w]=Object.entries(P)[0],c=w==="asc"?1:-1,A=Fo(Qe(E,x),Qe(E,D));if(A)return A*c}return 0}):u,Fn=(u,m)=>{if(!m)return u;const x=Object.entries(m).filter(([,P])=>P===1).map(([P])=>P),D=Object.entries(m).filter(([,P])=>P===-1).map(([P])=>P);return x.length?(u=u.map(P=>Object.fromEntries(x.map(E=>[E,Qe(E,P)]))),u):D.length?u.map(P=>{const E={...P};for(const w of D)ra(w,E);return E}):u},No=async(u,{sort:m=[],filter:x={},should:D,fields:P={},index:E,offset:w=0,limit:c})=>{c=c||w+20;let A=Oe[u];A=Je(A,x,D,E),A.clone||(A=A.toCollection());const _=await A.count();if(!_)return{count:_,items:[]};let b=Oe[u];b=Je(b,x,D,E),b=Vi(b,m);let r=await b;return r=qn(r,m),r=Fn(r,P),r=r.map(o=>(delete o.synced,o)),r=r.slice(w,c),{count:_,items:r}},Mo=async(u,{sort:m=[],filter:x={},should:D,fields:P={},index:E,offset:w=0,limit:c})=>{let A=Oe[u];A=Je(A,x,D,E),A.clone||(A=A.toCollection());const _=await A.count();if(!_)return{count:_,items:[]};let b=Oe[u];b=Je(b,x,D,E),b=Vi(b,m);let r=await b;return r=qn(r,m),r=Fn(r,P),r=r.map(o=>(delete o.synced,o)),r=r.slice(w,c),{count:_,items:r}},Bo=async(u,{filter:m={},should:x,index:D})=>{let P=Oe[u];if(P=Je(P,m,x,D),P.clone||(P=P.toCollection()),!await P.count())return[];let w=Oe[u];w=Je(w,m,x,D);const c=await w.toArray();await Oe._deleted.bulkAdd(c.map(({id:_})=>({id:_,entity:u})));let A=Oe[u];return A=Je(A,m,x,D),await A.delete(),{status:"ok"}},es=u=>{if(u.$countDistinct!==void 0)return u.$count;const m=[...new Set(u)].length;return Object.defineProperty(u,"$countDistinct",{value:m,enumerable:!1}),m},wt=u=>{if(u.$count!==void 0)return u.$count;const m=u.length;return Object.defineProperty(u,"$count",{value:m,enumerable:!1}),m},ts=u=>{if(u.$sum!==void 0)return u.$sum;const m=u.reduce((x,D)=>x+D,0);return Object.defineProperty(u,"$sum",{value:m,enumerable:!1}),m},Xt=u=>{if(u.$average!==void 0)return u.$average;const m=wt(u);if(m===0)return Object.defineProperty(u,"$average",{value:0,enumerable:!1}),0;const D=ts(u)/m;return Object.defineProperty(u,"$average",{value:D,enumerable:!1}),D},zo=u=>{if(u.$geometricMean!==void 0)return u.$geometricMean;const m=wt(u);if(m===0)return Object.defineProperty(u,"$geometricMean",{value:0,enumerable:!1}),0;const x=Math.pow(u.reduce((D,P)=>D*P),1/m,0);return Object.defineProperty(u,"$geometricMean",{value:x,enumerable:!1}),x},Ko=u=>{if(u.$harmonicMean!==void 0)return u.$harmonicMean;const D=[...u].filter(Boolean).length/Math.pow(u.reduce((P,E)=>P+1/E,0));return Object.defineProperty(u,"$harmonicMean",{value:D,enumerable:!1}),D},rs=u=>{if(u.$deviations!==void 0)return u.$deviations;let m=Xt(u);const x=u.map(D=>D-m);return Object.defineProperty(u,"$deviations",{value:x,enumerable:!1}),x},Nn=u=>{if(u.$variance!==void 0)return u.$variance;const m=wt(u);if(m===0)return Object.defineProperty(u,"$variance",{value:0,enumerable:!1}),0;Xt(u);const D=rs(u).map(P=>Math.pow(P,2)).reduce((P,E)=>P+E,0)/m;return Object.defineProperty(u,"$variance",{value:D,enumerable:!1}),D},Mn=u=>{if(u.$sd!==void 0)return u.$sd;const m=Nn(u,field),x=Math.pow(m,.5);return Object.defineProperty(u,"$sd",{value:x,enumerable:!1}),x},Fr=u=>{if(u.$se!==void 0)return u.$se;const x=Mn(u,field)/Math.pow(u.length,.5);return Object.defineProperty(u,"$se",{value:x,enumerable:!1}),x},Lo=u=>{if(u.$ci!==void 0)return u.$ci;const m=Fr(u,field)*1.96;return Object.defineProperty(u,"$ci",{value:m,enumerable:!1}),m},Uo=u=>{if(u.$ci90!==void 0)return u.$ci90;const m=Fr(u,field)*1.645;return Object.defineProperty(u,"$ci90",{value:m,enumerable:!1}),m},Ho=u=>{if(u.$ci99!==void 0)return u.$ci99;const m=Fr(u,field)*1.645;return Object.defineProperty(u,"$ci99",{value:m,enumerable:!1}),m},Wo=u=>{if(u.$rms!==void 0)return u.$rms;const m=wt(u);if(m===0)return Object.defineProperty(u,"$rms",{value:0,enumerable:!1}),0;const x=Math.pow(u.reduce((D,P)=>D+Math.pow(P,2),0)/m,.5);return Object.defineProperty(u,"$rms",{value:x,enumerable:!1}),x},Go=u=>{if(u.$mad!==void 0)return u.$mad;const m=Xt(u),x=u.map(P=>Math.abs(P-m)),D=Vt(x);return Object.defineProperty(u,"$mad",{value:D,enumerable:!1}),D},Yo=u=>{if(u.$range!==void 0)return u.$range;const m=Math.abs(Math.max(...u)-Math.min(...u));return Object.defineProperty(u,"$range",{value:m,enumerable:!1}),m},Bn=u=>{if(u.$sorted!==void 0)return u.$sorted;const m=Array.from(u).sort((x,D)=>x-D);return Object.defineProperty(u,"$median",{value:m,enumerable:!1}),m},Vt=u=>{if(u.$median!==void 0)return u.$median;const m=Bn(u),x=Math.floor(m.length/2);if(m.length%2===0)return(m[x-1]+m[x])/2;const D=m[x];return Object.defineProperty(u,"$median",{value:D,enumerable:!1}),D},Zo=u=>{if(u.$mead!==void 0)return u.$mead;wt(u);const m=Vt(u),D=u.map(P=>Math.abs(P-m)).reduce((P,E)=>P+E,0);return Object.defineProperty(u,"$mead",{value:D,enumerable:!1}),D},zn=u=>{if(u.$quartile25!==void 0)return u.$quartile25;const m=Bn(values),x=Math.floor(m.length/4),D=m.length%4===0?(m[x-1]+m[x])/2:m[x];return Object.defineProperty(u,"$quartile25",{value:D,enumerable:!1}),D},Kn=u=>{if(u.$quartile25!==void 0)return u.$quartile25;const m=Bn(values),x=Math.floor(m.length/4*3),D=m.length%4===0?(m[x-1]+m[x])/2:m[x];return Object.defineProperty(u,"$quartile75",{value:D,enumerable:!1}),D},Qo=u=>{if(u.$interQuartileRange!==void 0)return u.$interQuartileRange;const m=Math.abs(Kn(u)-zn(u));return Object.defineProperty(u,"$interQuartileRange",{value:m,enumerable:!1}),m},ns=u=>{if(u.$mode!==void 0)return u.$mode;const m=u.reduce((E,w)=>(E[w]||(E[w]=0),E[w]++,E),{}),x=Math.max(...Object.values(m)),D=Object.entries(m).filter(([E,w])=>typeof E<"u"&&w===x),P=D.length===1?D[0][0]:void 0;return Object.defineProperty(u,"$mode",{value:P,enumerable:!1}),P},Jo=u=>{if(u.$moad!==void 0)return u.$moad;const m=ns(u),x=u.map(P=>Math.abs(item-m)),D=Vt(x);return Object.defineProperty(u,"$moad",{value:D,enumerable:!1}),D},Xo=u=>{if(u.$interQuartileMean!==void 0)return u.$interQuartileMean;const m=zn(u),x=Kn(u),D=u.filter(w=>w>=m&&w<=x);if(D.length===0)return Object.defineProperty(u,"$interQuartileMean",{value:0,enumerable:!1}),0;const E=2/u.length*D.reduce((w,c)=>w+c,0);return Object.defineProperty(u,"$harmonicMean",{value:E,enumerable:!1}),E},Vo=u=>{if(u.$skewness!==void 0)return u.$skewness;const m=3*(Xt(u)-Vt(u))/Mn(u);return Object.defineProperty(u,"$skewness",{value:m,enumerable:!1}),m},el=u=>{if(u.$kurtosis!==void 0)return u.$kurtosis;const m=wt(u);if(m===0)return Object.defineProperty(u,"$kurtosis",{value:0,enumerable:!1}),0;const P=rs(u).map(E=>Math.pow(E,4)).reduce((E,w)=>E+Math.pow(w,4),0)/m/Math.pow(Nn(u),2);return Object.defineProperty(u,"$kurtosis",{value:P,enumerable:!1}),P},Ri={count:wt,countDistinct:es,sum:ts,average:Xt,geometricMean:zo,harmonicMean:Ko,variance:Nn,sd:Mn,se:Fr,ci:Lo,ci90:Uo,ci99:Ho,rms:Wo,mad:Go,range:Yo,median:Vt,mead:Zo,quartile25:zn,quartile75:Kn,interQuartileRange:Qo,mode:ns,moad:Jo,interQuartileMean:Xo,skewness:Vo,kurtosis:el},tl=(u,m)=>{const x={};for(const D of u){const P=Object.fromEntries(m.map(c=>{if(c.match(/\$/)){const[A,_]=c.split(/\$/);let b=Qe(A,D);return b&&(_==="day"&&(b=new Date(b).toLocaleDateString("sv").substring(0,10)),_==="month"&&(b=new Date(b).toLocaleDateString("sv").substring(0,7)),_==="year"&&(b=new Date(b).toLocaleDateString("sv").substring(0,4))),[A,b]}return[c,Qe(c,D)]})),w=Object.values(P).join("|");x[w]||(x[w]={stats:P,items:[]}),x[w].items.push(D)}return x},is=(u,m)=>{const{groupBy:x,aggs:D}=m,P=tl(u,x);for(const w of Object.keys(P)){const c={};for(const A of Object.keys(D)){const{variable:_,operation:b}=D[A],{items:r}=P[w];if(b==="countDistinct"){const{filter:i}=D[A],s=r.map(n=>Qe(_,n)).flat().filter(n=>typeof n>"u"?!1:i?n.indexOf(i)>-1:!0);P[w].stats[A]=es(s);continue}if(b==="nested"){const{nested:i}=D[A],s=r.map(d=>Qe(_,d)).flat().filter(d=>typeof d<"u"),n=is(s,i);P[w].stats[_]=n;continue}if(!Ri[b]){P[w].stats[A]=0;continue}if(!c[_]){let i=r.map(n=>Qe(_,n)).filter(n=>typeof n<"u");const s=i.slice(0,5);s.length===s.filter(n=>typeof n=="number").length&&(i=new Float64Array(i)),c[_]=i}const o=c[_];P[w].stats[A]=Ri[b](o)}}return Object.values(P).map(w=>w.stats)},rl=async(u,{sort:m,filter:x={},fields:D,should:P,index:E,aggs:w})=>{if(!w)return[];let c=Oe[u];if(c=Je(c,x,P,E),c.clone||(c=c.toCollection()),!await c.count())return[];let _=Oe[u];w.groupBy||(w.groupBy=[]),_=Je(_,x,P,E);const b=await _.toArray();let r=is(b,w);return r=qn(r,m),r=Fn(r,D),r},nl=["lt","gt","lte","gte","eq","ne","contains","notContains","isOneOf","isNotOneOf","regex","allOf","containsAll","regexAll","hasSize","hasSizeGt","hasSizeGte","hasSizeLt","hasSizeLte"],Ci=u=>{if(["string","number","boolean"].includes(typeof u))return!0;if(Array.isArray(u)){for(const m of u)if(!["string","number","boolean"].includes(typeof m))return!1}return!0},jn=u=>{if(!u||typeof u!="object")return!1;if(Array.isArray(u)){for(const E of u)if(!jn(E))return!1}if(!Object.keys(u).length)return!1;const[m,x]=Object.entries(u)[0];if(typeof m!="string")return!1;if(Ci(x))return!0;if(!Object.keys(x).length)return!1;const[D,P]=Object.entries(x)[0];return nl.includes(D.slice(1))?["string","number","boolean"].includes(typeof P)?!0:!!Ci(P):!1},il=u=>{const m={async aggregate(x){const D=m.$_request.entity;return delete m.$_request.entity,m.$_request.aggs=x,await rl(D,m.$_request)},exclude(x){if(m.$_request.fields||(m.$_request.fields={}),typeof x=="string")return m.$_request.fields[x]=-1,m;if(Array.isArray(x))for(const D of x)typeof D=="string"&&(m.$_request.fields[D]=-1);return m},filter(x){if(m.$_request.filter||(m.$_request.filter={}),!jn(x))throw"The filter is not valid";if(Array.isArray(x)){for(const D of x)Object.assign(m.$_request.filter,D);return m}if(typeof x=="object")return Object.assign(m.$_request.filter,x),m},async export(){const x=m.$_request.entity;delete m.$_request.entity;const D=await Mo(x,m.$_request);return D&&(D.items=D.items.map(P=>(Object.defineProperty(P,"$_entity",{value:x,enumerable:!1}),P))),D},async find(){const x=m.$_request.entity;delete m.$_request.entity;const D=await No(x,m.$_request);return D&&(D.items=D.items.map(P=>(Object.defineProperty(P,"$_entity",{value:x,enumerable:!1}),new Proxy(P,bt)))),D},async delete(){const x=m.$_request.entity;return delete m.$_request.entity,await Bo(x,m.$_request)},include(x){if(m.$_request.fields||(m.$_request.fields={}),typeof x=="string")return m.$_request.fields[x]=1,m;if(Array.isArray(x))for(const D of x)typeof D=="string"&&(m.$_request.fields[D]=1);return m},match(){return m.$_request.match||(m.$_request.match=[]),m.$_request.match.push({[sort]:"asc"}),m},project(x){if(m.$_request.fields||(m.$_request.fields={}),typeof x=="string"){const D=x.split(/, */g);for(let P of D){let E=1;P.charAt(0)==="-"&&(P=P.slice(1),E=-1),m.$_request.fields[P]=E}return m}if(Array.isArray(x)){for(const D of x)m.$_request.fields[D]=1;return m}if(typeof x=="object")for(const[D,P]of Object.entries(x))typeof D!="string"||![-1,1].includes(P)||(m.$_request.fields[D]=P);return m},reverse(){if(m.$_request.sort||(m.$_request.sort=[]),m.$_request.sort.length===0)return m.$_request.sort.push({id:"desc"}),m;const x=m.$_request.sort.length-1,D=Object.keys(m.$_request.sort[x])[0],P=m.$_request.sort[x][D];return m.$_request.sort[x][D]=P==="asc"?"desc":"asc",m},should(x){if(m.$_request.should||(m.$_request.should=[]),!jn(x))throw"The filter is not valid";if(Array.isArray(x))return m.$_request.should.push(...x),m;if(typeof x=="object")return m.$_request.should.push(x),m},slice(x=0,D){if(D||(D=x+20),typeof x!="number")throw new Error("Minimum index is not a number");if(typeof D!="number")throw new Error("Maximum index is not a number");return m.$_request.offset=x,m.$_request.limit=D,m},sort(x){if(m.$_request.sort||(m.$_request.sort=[]),typeof x=="string")return m.$_request.sort.push({[x]:"asc"}),m;if(Array.isArray(x))return x=x.map(D=>{if(typeof D=="object")return D;if(typeof D=="string")return{[D]:"asc"}}),m.$_request.sort.push(...x),m;if(typeof x=="object")return m.$_request.sort.push(x),m},useIndex(x){return m.$_request.index=x,m}};return m.$_request||Object.defineProperty(m,"$_request",{value:u,enumerable:!1}),m},sl={getById:Ji},al=["schema","push","length","getById"],ol=["aggregate","delete","exclude","filter","export","find","include","match","project","reverse","should","slice","sort","useIndex"],ll={schema(u){if(!u)throw new Error("Entity is required to fetch schema.");return $a(u)},patch(u,m,x){if(!u||!m||!x)throw new Error("Entity, ID, and body are required for changes");return Qi(u,m,x).then(D=>{if(!D)throw new Error(`Failed to patch record with ID "${m}" in entity "${u}".`);return D})},update(u,m,x){if(!u||!m||!x)throw new Error("Entity, ID, and body are required for changes");return Xi(u,m,x).then(D=>{if(!D)throw new Error(`Failed to update record with ID "${m}" in entity "${u}".`);return D})},push(u,m){if(!u||!m)throw new Error("Entity and body are required for creating the entity.");return(u==="files"?insertFile:Do)(u,m).then(D=>D?Array.isArray(D)?D.map(P=>(Object.defineProperty(P,"$_entity",{value:u,enumerable:!1}),new Proxy(P,bt))):(Object.defineProperty(D,"$_entity",{value:u,enumerable:!1}),new Proxy(D,bt)):!1).catch(D=>{throw D})},length(u){if(!u)throw new Error("Entity is required to get the count.");return xa(u)},get(u,m){const{entity:x}=u;if(!x)throw new Error("Entity does not exist.");return m==="length"?this.length(x):m==="update"?(...D)=>this[m](x,...D):ol.includes(m)?il({entity:x})[m]:al.includes(m)?(...D)=>sl[m](x,...D):m==="getById"?Ji(x,m).then(D=>{if(D)return Object.defineProperty(D,"$_entity",{value:x,enumerable:!1}),D}):u[m]},set(u,m,x){const{entity:D}=u;if(!D)throw new Error("Entity does not exist.");return Co(D,m,x).then(P=>(Object.defineProperty(P,"$_entity",{value:D,enumerable:!1}),new Proxy(P,bt)))},deleteProperty(u,m){const{entity:x}=u;if(!x)throw new Error("Entity does not exist.");return Po(x,m)}},{availableEntities:jr}=kn,ul={get(u,m){if(m==="length")return jr.length;if(!jr.includes(m))throw new Error("This entity does not exist");return new Proxy({entity:m},ll)},has(u,m){return jr.includes(m)},ownKeys(){return jr},set(){throw new Error("You can't create new entities")},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}}};let Pi=new Proxy({},ul);const cl=async u=>{let m;for(let{fn:x,args:D}of u){if(m||(m=Pi),typeof D>"u"){m=Pi[x];continue}if(D===null){m=m[x]();continue}m=m[x](D)}return await m};En(cl);export{Ks as w};

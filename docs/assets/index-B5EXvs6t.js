import{_ as L}from"./CustomTable-CzX_aHyy.js";import{d as D}from"./index-T2HRTWtS.js";import{_ as F,aq as I,v as E,F as d,o,a as l,z as H,w as s,x as m,C as p,A as i,y as r,c as b,G as j,H as R,B as P,ab as q}from"./index-BtIo2-Z_.js";import{b as A}from"./route-block-B_A1xBdJ.js";import{V as S,a as N}from"./VRow-9vAZildp.js";import{V as f}from"./VBtn--bGuKZaN.js";import{V as C}from"./index-SDX8Otz2.js";import{V}from"./VChip-CKNl8kC9.js";import"./CustomDate-CLArRqjL.js";import"./VMenu-Cs322VI3.js";import"./VOverlay-BnbjS8dz.js";import"./forwardRefs--KQCZfKO.js";import"./dialog-transition-Dq7CKyny.js";import"./VSpacer-bp7-SSB-.js";/* empty css              */import"./VAvatar-l5UJO0sV.js";import"./VImg-FY_z5S7Z.js";import"./index-C5-hvfiu.js";import"./VTextField-Bn35T3UG.js";import"./VInput-CRZE-Mt3.js";import"./debouncer-Whu4ZLob.js";import"./VCard-DNHZbZ5d.js";import"./VContainer-BFGIFtcM.js";import"./VProgressCircular-DNPB7izS.js";import"./VList-Cnqqz-5U.js";import"./searchProcessor-BfIe0Ps2.js";import"./VDataTable-BrBBORsC.js";import"./VPagination-zp71F-1D.js";import"./filter-ahsWVyiP.js";import"./VCheckboxBtn-DQUGWCnj.js";import"./VToolbar-o4oksDe3.js";import"./group-DgRBM2CV.js";var O={FRONT_HOST:"https://raisplus-test.unhcr.in.ua",STATIC_ASSETS_PATH:"http://localhost:3000/static/"};const B={name:"manage-organizations",mounted(){this.appStore.loading=!1},computed:{filters(){return{}},isAdmin(){var e,a,u;return(u=(a=(e=this.appStore)==null?void 0:e.user)==null?void 0:a.role)==null?void 0:u.includes("Admin")},staticPath(){return O.STATIC_ASSETS_PATH},headers(){var a,u,c;const e=[{title:"Orangization code",align:"start",sortable:!0,value:"code"},{title:"Orangization name",align:"start",sortable:!0,value:"name"},{title:"Functional type",align:"start",value:"functionalType",filterable:!0,type:"term"},{title:"Type",align:"start",value:"type",filterable:!0,type:"term"},{title:"Status",align:"start",value:"status",filterable:!0,type:"term"},{title:"Address",align:"start",value:"address"},{title:"Contacts",align:"center",value:"contacts"}];return(c=(u=(a=this.appStore)==null?void 0:a.user)==null?void 0:u.role)!=null&&c.includes("Admin")&&e.push({title:"Edit",align:"center",value:"_id"}),e}},data(){return{showAcrhive:!1,exportLoading:!1}},methods:{pCode4ToAdmins:I,async exportData(){this.exportLoading=!0;const e=`${O.FRONT_HOST}/export/export.xlsx`,a=`${new Date().toISOString().substring(0,10)} - RAIS+ Organizations.xlsx`,{organizations:u}=this.$storage,c=["id","code","name","legalName","translation.uk.name","translation.uk.legalName","status","type","functionalType","address.pCode1","address.pCode2","address.pCode3","address.pCode4","address.admin1","address.admin2","address.admin3","address.admin4","email","phone","website","tags"],k=["ID","Legal Code","Name","Legal Name","Translated name","Translated Legal Name","Status","Type","Functional type","p-code 1","p-code 2","p-code 3","p-code 4","Admin 1","Admin 2","Admin 3","Admin 4","email","phone","website","tags"];let h=(await u.include(c).slice(0,1e4).find()).items;h=h.map(t=>{var n;return(n=t.address)!=null&&n.pCode4&&(t.address=this.pCode4ToAdmins(t.address.pCode4)),t.email&&(t.email=t.email.join(", ")),t.phone&&(t.phone=t.phone.join(", ")),t.website&&(t.website=t.website.join(", ")),t.tags&&(t.tags=t.tags.join(", ")),t});const v=c.map(t=>h.map(n=>q(t,n)));await D(e,{headers:k,columns:v},a),this.exportLoading=!1}}},G={class:"distribution-points pa-2"},M={class:"text-h4 font-weight-bold"},X={key:0},J={class:"mt-4 mb-4"},K={class:"text-h6 title-link"},Q={key:0,class:"text-caption"},U={key:1},W={class:"text-no-wrap"},Y={class:"text-no-wrap"},Z={class:"text-no-wrap"},tt={key:0,class:"text-caption text-no-wrap"},et={key:0,class:"text-caption text-no-wrap"},at={key:1,class:"text-caption text-no-wrap"},st={key:2,class:"text-caption text-no-wrap"},ot={key:0},rt={key:1},nt={key:2},it={key:3},dt={class:"text-no-wrap"};function lt(e,a,u,c,k,g){const h=E("router-link"),v=L;return o(),d("div",G,[l(N,{class:"mb-0 mt-0"},{default:s(()=>[l(S,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:s(()=>[m("div",M,[p(r(e.$t("Manage organizations"))+" ",1),g.isAdmin?(o(),d("span",X,[l(f,{onClick:g.exportData,loading:k.exportLoading,size:"small",color:"grey-dakren-4",variant:"tonal"},{default:s(()=>[p(r(e.$t("Export")),1)]),_:1},8,["onClick","loading"])])):i("",!0)])]),_:1})]),_:1}),l(N,{class:"mb-0 mt-0"},{default:s(()=>[l(S,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:s(()=>[l(v,{class:"pa-6",onBtnClick:a[0]||(a[0]=t=>e.$router.push("/organizations/new")),button:e.$t("Add"),"sort-by":{key:"name",order:"desc"},filters:g.filters,headers:g.headers,"search-keys":["name","legalName","code","translation.uk.name","translation.uk.legalName"],title:e.$t("Organizations"),table:"organizations"},{"item.code":s(({item:t})=>[l(V,{label:"",size:"small"},{default:s(()=>[p(r(t.code),1)]),_:2},1024)]),"item.name":s(({item:t})=>[m("div",J,[m("div",K,[l(h,{to:`/organizations/${t.id}`,tag:"a"},{default:s(()=>[p(r(t.name),1)]),_:2},1032,["to"])]),t.legalName?(o(),d("div",Q,r(t.legalName),1)):i("",!0),t.tags?(o(),d("div",U,[(o(!0),d(j,null,R(t.tags,n=>(o(),b(V,{key:n,size:"x-small",color:"primary",label:"",class:"mr-2"},{default:s(()=>[p(r(n),1)]),_:2},1024))),128))])):i("",!0)])]),"item.status":s(({item:t})=>[m("span",W,r(e.$t(t.status)),1)]),"item.functionalType":s(({item:t})=>[m("span",Y,r(e.$t(t.functionalType)),1)]),"item.type":s(({item:t})=>[m("span",Z,r(e.$t(t.type)),1)]),"item.address":s(({item:t})=>{var n,_,y,w,x,$,T,z;return[(n=t.address)!=null&&n.pCode1?(o(),d("div",tt,r(e.$t(t.address.pCode1)),1)):i("",!0),m("div",null,[(_=t.address)!=null&&_.pCode2?(o(),d("span",et,r(e.$t(t.address.pCode2))+", ",1)):i("",!0),a[2]||(a[2]=p()),(y=t.address)!=null&&y.pCode3?(o(),d("span",at,r(e.$t(t.address.pCode3))+", ",1)):i("",!0),a[3]||(a[3]=p()),(w=t.address)!=null&&w.pCode4?(o(),d("span",st,r(e.$t(t.address.pCode4))+", ",1)):i("",!0)]),m("div",null,[(x=t.address)!=null&&x.streetType?(o(),d("span",ot,r(e.$t(t.address.streetType)),1)):i("",!0),a[4]||(a[4]=p()),($=t.address)!=null&&$.street?(o(),d("span",rt,r(t.address.street),1)):i("",!0),a[5]||(a[5]=p()),(T=t.address)!=null&&T.building?(o(),d("span",nt,r(t.address.building),1)):i("",!0),a[6]||(a[6]=p()),(z=t.address)!=null&&z.apartment?(o(),d("span",it,","+r(t.address.apartment),1)):i("",!0)])]}),"item.contacts":s(({item:t})=>{var n,_,y;return[m("div",dt,[(n=t.phone)!=null&&n.length&&t.phone[0]?(o(),b(f,{key:0,href:`tel:${t.phone[0]}`,size:"small",variant:"text",color:"primary"},{default:s(()=>[l(C,{icon:"mdi-phone"})]),_:2},1032,["href"])):i("",!0),(_=t.email)!=null&&_.length&&t.email[0]?(o(),b(f,{key:1,href:`mailto:${t.email[0]}`,size:"small",variant:"text",color:"primary"},{default:s(()=>[l(C,{icon:"mdi-email"})]),_:2},1032,["href"])):i("",!0),(y=t.website)!=null&&y.length&&t.website[0]?(o(),b(f,{key:2,href:`${t.website[0]}`,size:"small",variant:"text",color:"primary"},{default:s(()=>[l(C,{icon:"mdi-web"})]),_:2},1032,["href"])):i("",!0)])]}),"item._id":s(({item:t})=>[l(f,{color:"grey-dakren-2",onClick:n=>e.$router.push(`/organizations/${t.id}`),variant:"tonal",rounded:"1",icon:"mdi-pencil",size:"x-small"},null,8,["onClick"])]),_:2},1032,["button","filters","headers","title"])]),_:1})]),_:1}),H(l(f,{onClick:a[1]||(a[1]=t=>e.$router.push("/organizations/new")),style:{position:"fixed",bottom:"15px",right:"15px"},color:"primary",rounded:"1",icon:"mdi-plus",size:"large"},null,512),[[P,e.$vuetify.display.xs]])])}typeof A=="function"&&A(B);const Pt=F(B,[["render",lt]]);export{Pt as default};

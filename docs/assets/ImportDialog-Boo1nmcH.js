import{p as ge}from"./index-1qao1M8l.js";import{d as W}from"./xlsx-template-browser-scOJpVFS.js";import{a as ye,p as G}from"./importProcessor-BuJ9nfbq.js";import{_ as L,l as Q,t as ve}from"./index-Dr3A69Vy.js";import{a9 as h,a3 as p,u as i,a4 as o,a6 as d,W as r,Q as w,S as k,Y as g,F as H,aa as O,a2 as V,ad as C,a7 as b,ab as ie,ac as ae,a0 as be,$ as z}from"./@vue-CVhpfiSJ.js";import{z as S,A as $,r as oe,$ as q,f as _,l as ne,s as De,m as re,i as we,j as _e,k as ke,n as T,R as X,o as de,p as A,q as K,M as ue,E as B,N as J,O as ce,P as M,I as pe,g as Ve,t as me,G as Ce,H as Se,a3 as xe,a4 as Ie,a5 as E}from"./vuetify-8yKwgmF2.js";import{d as he}from"./debouncer-Whu4ZLob.js";import{_ as Te,a as He,b as Oe}from"./CustomMultipleBundle-B39GX2p6.js";import{_ as $e}from"./CustomBundle-Cn7PVTFG.js";import"./joi-BOBjTjze.js";import{X as Z}from"./xlsx-CILBIiVl.js";import{w as Ne}from"./comlink-B8fJUUNV.js";var ze={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const Me=["address","aor","bundleName","date","publicId","populationType","distributionModality","items","organization","responsibleOrganization","fundedBy","objectives"],Le=["address","aor","bundleName","date","publicId","populationType","distributionModality","organization","responsibleOrganization","fundedBy","objectives"],Ae={props:{modelValue:{type:Array,default:()=>[]},isDonation:{type:Boolean},headers:{type:Array,default:()=>[]},initialData:{type:Object,default:()=>({})}},provide:["$error"],computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data(){return{loading:!1,status:void 0,errors:[]}},methods:{exportData(){this.loading=!0;const e=this.headers.map(l=>l.key);e.splice(1,0,"duplicateResult","duplicateBundle","duplicateDate","duplicateOrganization");const t=this.headers.map(l=>l.title);t.splice(1,0,"Deduplication result","Type of the provided assistance","Date of duplicated assistance","Assistance provider");const u=JSON.parse(JSON.stringify(this.model)).map(l=>{var f,c;return l.duplicateResult=(f=l.duplicate)!=null&&f.length?"Duplicated":"Unique",(c=l.duplicate)!=null&&c.length&&(l.duplicateBundle=l.duplicate[0].bundleName,l.duplicateDate=l.duplicate[0].date,l.duplicateOrganization=l.duplicate[0].organization.name),l}),m=e.reduce((l,f,c)=>(l[c]=u.map(D=>D[f]),l),{}),s={headers:t,columns:m},a=`${ze.FRONT_HOST}/export/export.xlsx`;(async()=>{const l=`${this.initialData.publicId} - Clean data.xlsx`;return await W(a,s,l)})(),this.loading=!1},async importData(){if(this.loading=!0,this.isDonation&&!this.initialData.id){const a=this.initialData,{donations:y}=this.$storage,l=ge[this.table],f=l==null?void 0:l.preprocess;f&&(a=f(a)),a.status="Converted",await this.$nextTick();const c=await y.push(a);this.initialData.id=c.id}let e;if(this.isDonation){const{requests:a}=this.$storage,y=await a.filter({donationId:this.initialData.id}).find();if(!y.count){const l=Q(e||this.initialData,Me);l.donationId=this.initialData.id,l.responsibleOrganization=this.initialData.organization,l.organization=this.initialData.receivingOrganization,l.status="In distribution",l.tags||(l.tags=[]),l.tags.includes("Converted donation")||l.tags.push("Converted donation"),e=await a.push(l)}y.count&&(e=y.items[0])}this.isDonation||(e=this.initialData);const t=Q(e||this.initialData,Le);t.date.toLocaleDateString&&(t.date=t.date.toLocaleDateString("sv").substring(0,10)),t.distributionId=e.id,this.isDonation&&(t.donationId=this.initialData.id);let u=JSON.parse(JSON.stringify(this.model));u=u.map(a=>{const y=Object.assign({},t,a);return y.createdBy=this.appStore.user.id,y.createdByEmail=this.appStore.user.email,delete y.id,delete y.duplicate,delete y.status,delete y.assignees,y});const m=ye(u).map(a=>(a.household&&a.address&&(a.household=Object.assign({},a.address,a.household)),this.isDonation&&(a.donationId=this.initialData.id),a)),{assistances:s}=this.$storage;try{await s.push(m),this.status="success"}catch(a){this.status="error",console.log(a),this.errors=a==null?void 0:a.errors}this.$emit("imported",e==null?void 0:e.id),this.loading=!1}}},Be={class:"h-100"},Ue={class:"text-h4"},Re={class:"mw-40 ml-4 mr-4 pb-10"},Ee={class:"text-center drag-text"},je={class:"text-h5 mb-2"},Fe={class:"mt-8"},Pe={class:"mt-8"},Xe={class:"mt-8"},Ye={class:"ml-8 text-left"},qe={class:"mt-8"};function Je(e,t,u,m,s,a){return p(),h("div",Be,[i($,{class:"pl-4 pr-4"},{default:o(()=>[i(S,{cols:"12"},{default:o(()=>[d("div",Ue,r(e.$t("Import the data")),1)]),_:1})]),_:1}),i($,{class:"pl-4 pr-4"},{default:o(()=>[i(S,{cols:"12",class:"text-center"},{default:o(()=>{var y;return[d("div",Re,[d("div",null,[d("div",Ee,[d("div",null,[d("div",je,r(e.$t("You have successfully checked your data")),1),d("div",null,r(e.$t("You can download the deduplicated dataset of finish your import")),1)]),w(i(oe,{indeterminate:"",color:"primary",size:"64",class:"mt-8"},null,512),[[k,s.loading]]),w(d("div",Fe,[i(q,{color:"success"},{default:o(()=>[g(r(e.$t("Your data is imported. You can close the window.")),1)]),_:1})],512),[[k,s.status==="success"]]),w(d("div",Pe,[i(q,{color:"error"},{default:o(()=>[g(r(e.$t("Your data is not imported. Please check the following errors.")),1)]),_:1})],512),[[k,s.status==="error"]]),w(d("div",Xe,[d("ul",Ye,[(p(!0),h(H,null,O(s.errors,(l,f)=>(p(),h("li",{key:f},[d("strong",null,r(e.$t("Row"))+" "+r(l.index+1)+":",1),g(" "+r(e.$t(l.message)),1)]))),128))])],512),[[k,s.status==="error"&&((y=s.errors)==null?void 0:y.length)]]),w(d("div",qe,[i(_,{onClick:a.exportData,color:"secondary","prepend-icon":"mdi-download"},{default:o(()=>[g(r(e.$t("Download")),1)]),_:1},8,["onClick"]),i(_,{disabled:s.loading||s.status==="success",onClick:a.importData,color:"primary",class:"ml-2","prepend-icon":"mdi-upload"},{default:o(()=>[g(r(e.$t("Import")),1)]),_:1},8,["disabled","onClick"]),i(_,{onClick:t[0]||(t[0]=l=>e.$emit("close")),color:"info",variant:"text",class:"ml-2","prepend-icon":"mdi-close"},{default:o(()=>[g(r(e.$t("Close")),1)]),_:1})],512),[[k,!s.loading]])])])])]}),_:1})]),_:1})])}const We=L(Ae,[["render",Je]]);let j,Y;const Ke={props:{modelValue:{type:Array,default:()=>[]},dialog:{type:Boolean}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data(){return{isDragged:!1,activeIndex:0,draggedIndex:0}},methods:{dragStart(e,t){this.activeIndex=t,j=e.target.parentElement.parentElement,Y=e.y,setTimeout(()=>{this.isDragged=!0},0)},dragMove(e){let t=Math.round((e.y-Y)/68.8)+this.activeIndex;this.draggedIndex=t<0?0:t>this.model.length?this.model.length:t,j.style.zIndex=100;let u=e.y-Y;j.style.transform=`translateY(${u}px)`},dragStop(e){let t=Math.round((e.y-Y)/68.8)+this.activeIndex;this.draggedIndex=t<0?0:t>this.model.length?this.model.length:t,this.isDragged=!1;let u=this.draggedIndex;const m=[...this.model],s=m.splice(this.activeIndex,1)[0];m.splice(u,0,s),this.model=m,setTimeout(()=>{j.style.transform=null,j.style.zIndex=null},100)}}};function Ge(e,t,u,m,s,a){return p(),V(K,{"model-value":u.dialog,width:"600"},{default:o(()=>[i(ne,{width:"600",class:"margin-auto custom-thumb"},{default:o(()=>[i(De,{class:"d-flex align-center justify-space-between mt-4"},{default:o(()=>[g(r(e.$t("Manage columns"))+" ",1),i(_,{onClick:t[0]||(t[0]=y=>e.$emit("close")),icon:"mdi-close",size:"x-small",variant:"text"})]),_:1}),i(re,null,{default:o(()=>[i(we,{density:"compact"},{default:o(()=>[(p(!0),h(H,null,O(a.model,({show:y,header:l},f)=>(p(),V(_e,{class:C([{shiftup:s.isDragged&&f!==s.activeIndex&&f<this.activeIndex&&f>=this.draggedIndex,shiftdown:s.isDragged&&f!==s.activeIndex&&f>this.activeIndex&&f<=this.draggedIndex},"bg-grey-lighten-3 manage-column mb-1"]),key:l.key,style:{width:"100%"},ref_for:!0,ref:"drag"},{prepend:o(()=>[i(X,{"hide-details":"",modelValue:a.model[f].show,"onUpdate:modelValue":c=>a.model[f].show=c},null,8,["modelValue","onUpdate:modelValue"])]),append:o(()=>[i(T,{onDragstart:c=>a.dragStart(c,f),onDrag:a.dragMove,onDragend:a.dragStop,color:"grey-darken-1",draggable:"true",class:"ml-3 mr-0",style:{cursor:"grab"}},{default:o(()=>t[2]||(t[2]=[g("mdi-drag-horizontal-variant")])),_:2},1032,["onDragstart","onDrag","onDragend"])]),default:o(()=>[i(ke,{class:"ml-2"},{default:o(()=>[g(r(l.title),1)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1}),i(de,null,{default:o(()=>[i(A),i(_,{text:e.$t("Close"),onClick:t[1]||(t[1]=y=>e.$emit("close")),color:"primary"},null,8,["text"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const fe=L(Ke,[["render",Ge]]);var Qe={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};let ee,te,F;const Ze={name:"ImportDeduplication",props:{modelValue:{type:Array,default:()=>[]},initialData:{type:Object,default:()=>({})},dialogHeight:{type:Number,default:400},headers:{type:Array,default:()=>[]}},data(){return{currentItem:[],selected:[],selectedHeaders:[],headersDialog:!1,selectedAll:!1,search:void 0,searchInput:void 0,showDuplicationsOnly:!1}},mounted(){this.selectedHeaders=this.headers.map(e=>e.key)},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},dialog(){return this.currentItem.length>0},availableHeaders(){return this.headers.map(e=>e.key)},shownHeaders(){return this.headers.filter(e=>this.selectedHeaders.includes(e.key))},alertType(){return this.duplicationsCount?"error":"success"},duplicationsCount(){return this.model.filter(e=>{var t;return(t=e.duplicate)==null?void 0:t.length}).length},selectedCount(){return this.selected.length},recordsToShow(){return this.showDuplicationsOnly?this.model.filter(e=>{var t;return(t=e.duplicate)==null?void 0:t.length}):this.model}},methods:{setSearch:he(function(e){this.search=e}),initResizer(e){ee=e.clientX,F=e.target.parentElement;const t=window.getComputedStyle(F);te=parseInt(t.width,10)},resize(e){const t=e.clientX-ee;let u=te+t;if(u<0)return!1;u=Math.abs(u)<70?70:u,F.style.width=`${u}px`,F.style.minWidth=`${u}px`,F.style.maxWidth=`${u}px`},highlight(e){if(e instanceof Date&&(e=e.toLocaleDateString(this.$i18n.locale)),typeof e!="string"||!e)return e;if(e=String(e),e=e.replace(/<[^>]+?>/g,""),this.search){let t=this.search.replace(/[^a-zа-яєіїґ\d ]/g,""),u=new RegExp(`(${t})`,"gi");e=e.replace(u,"<strong>$1</strong>")}return e},showDuplications(){if(this.showDuplicationsOnly=!this.showDuplicationsOnly,this.showDuplicationsOnly){let e=this.recordsToShow.map(t=>t.taxId);this.selected=this.selected.filter(t=>e.includes(t))}},selectAll(){this.selected.length!==this.recordsToShow.length?(this.selected=this.recordsToShow.map(e=>e.taxId),console.log(this.recordsToShow)):this.selected=[]},selectAllDuplications(){this.selected=this.model.filter(e=>{var t;return(t=e.duplicate)==null?void 0:t.length}).map(e=>e.id)},deleteSelected(){const e=[...this.selected];this.model=this.model.filter(t=>!e.includes(t.id)),this.selected=[]},exportData(){const e=this.model.filter(l=>this.selected.includes(l.id)),t=this.headers.filter(l=>l.key!=="duplicate").map(l=>l.key),u=this.headers.filter(l=>l.key!=="duplicate").map(l=>l.title),m=t.reduce((l,f,c)=>(l[c]=e.map(D=>D[f]),l),{}),s={headers:u,columns:m},a=`${Qe.FRONT_HOST}/export/export.xlsx`;this.model.date,(async()=>{const l=`${new Date(this.initialData.date).toLocaleDateString("sv-SE")} - ${this.initialData.bundleName} Duplicated records.xlsx`;return await W(a,s,l)})()}}},et={key:0,class:"font-weight-light"},tt=["onClick"],lt={class:"text-caption opacity-06"},st={key:0,class:"ml-4 font-weight-light"},it={class:"d-flex w-100 justify-space-between"},at=["innerHTML"],ot=["innerHTML"],nt={key:2},rt={key:3,class:"ml-4 font-weight-light"},dt={class:"ml-4"},ut={class:"d-flex w-100"},ct={key:0,class:"bg-blue-grey-lighten-1 pa-2"},pt={class:"bg-blue-grey-lighten-5 pa-4 flex-grow-1"},mt={key:0},ht={class:"text-h6 mt-4"},ft={class:"mb-6 mt-2"},gt={class:"mt-2 mb-2"},yt={key:0,class:"mt-2 mb-2"},vt={key:1,class:"mt-2 mb-2"},bt={key:2,class:"mt-2 mb-2"},Dt={key:3,class:"mt-2 mb-2"},wt={class:"mt-2 mb-2"},_t={key:4,class:"mt-2 mb-2"},kt={class:"ml-6"},Vt={key:5,class:"mt-2 mb-2"};function Ct(e,t,u,m,s,a){const y=fe;return p(),h("div",null,[i($,null,{default:o(()=>[i(S,{cols:"12",ref:"mainScreen"},{default:o(()=>[i(ue,{modelValue:s.selected,"onUpdate:modelValue":t[6]||(t[6]=l=>s.selected=l),class:"import-table",headers:u.headers,search:s.search,items:a.recordsToShow,sticky:!0,"item-height":56,"show-select":"","fixed-header":"",height:e.$vuetify.display.height-370,"item-value":"Tax ID"},{top:o(()=>[w(i(J,{flat:"",color:"white"},{default:o(()=>[i(ce,{class:"text-h5",style:{"min-width":"350px"}},{default:o(()=>[g(r(e.$t("Deduplication")),1)]),_:1}),i(M,{class:"mx-4",inset:"",vertical:""}),i(pe,{modelValue:s.searchInput,"onUpdate:modelValue":[t[0]||(t[0]=l=>s.searchInput=l),a.setSearch],label:e.$t("Search"),class:"mr-4 w-100",variant:"outlined",density:"compact","hide-details":"","prepend-icon":"mdi-magnify"},{append:o(()=>[a.duplicationsCount?(p(),h("div",et,[i(_,{onClick:a.showDuplications,color:s.showDuplicationsOnly?"red":"black",size:"small",icon:"mdi-filter"},null,8,["onClick","color"]),i(B,{activator:"parent",location:"start"},{default:o(()=>[g(r(e.$t("Show duplicated records only")),1)]),_:1})])):b("",!0)]),_:1},8,["modelValue","onUpdate:modelValue","label"]),i(A),ae(e.$slots,"action-btn",{},()=>[i(_,{onClick:t[1]||(t[1]=l=>e.$emit("btnClick")),variant:"tonal",class:"ml-2"},{default:o(()=>[i(T,{left:""},{default:o(()=>t[10]||(t[10]=[g("mdi-table-edit")])),_:1})]),_:1})])]),_:3},512),[[k,!e.$vuetify.display.xs]]),i(q,{color:a.alertType,variant:"tonal",class:"mt-2 mb-2"},{default:o(()=>[g(r(e.$t("Number of duplications",a.duplicationsCount))+". "+r(e.$t("Number of selected rows",a.selectedCount))+".",1)]),_:1},8,["color"])]),bottom:o(()=>[i(J,{class:"mt-2 pa-0 ml-0",flat:"",density:"compact",color:"white"},{default:o(()=>[w(i(_,{onClick:a.selectAllDuplications,class:"ml-0",color:"error",variant:"tonal","prepend-icon":"mdi-checkbox-outline"},{default:o(()=>[g(r(e.$t("Select all duplications")),1)]),_:1},8,["onClick"]),[[k,a.duplicationsCount]]),w(i(_,{onClick:a.exportData,class:"ml-2",color:"primary",variant:"tonal","prepend-icon":"mdi-download"},{default:o(()=>[g(r(e.$t("Download")),1)]),_:1},8,["onClick"]),[[k,a.selectedCount]]),w(i(_,{onClick:a.deleteSelected,class:"ml-2",color:"warning",variant:"tonal","prepend-icon":"mdi-delete"},{default:o(()=>[g(r(e.$t("Delete")),1)]),_:1},8,["onClick"]),[[k,a.selectedCount]]),i(A),i(_,{onClick:t[2]||(t[2]=l=>e.$emit("setStep",5)),class:"mr-0",color:"success",variant:"flat","prepend-icon":"mdi-play"},{default:o(()=>[g(r(e.$t("Proceed")),1)]),_:1})]),_:1})]),headers:o(({columns:l,isSorted:f,getSortIcon:c,toggleSort:D})=>[d("tr",null,[(p(!0),h(H,null,O(l,n=>(p(),h("td",{key:n.key,style:ie({"text-align":n.align}),class:C({"custom-check":n.key==="data-table-select","bg-orange-darken-4":typeof n.error<"u"})},[d("div",{class:C(["d-flex text-no-wrap align-center",{"justify-space-between":n.align!=="center","justify-center":n.align==="center"}])},[n.key==="data-table-select"?(p(),V(X,{key:0,onClick:a.selectAll,indeterminate:s.selected.length>0,"hide-details":""},null,8,["onClick","indeterminate"])):(p(),h("div",{key:1,class:C([{"cursor-pointer":n.sortable,"mr-2":n.sortable},"d-flex align-center"]),onClick:()=>D(n)},[d("div",null,[d("div",lt,r(n.key),1),d("div",null,r(e.$t(n.title)),1)]),n.error?(p(),h("div",st,[i(T,{icon:"mdi-information-outline"}),i(B,{activator:"parent",location:"start"},{default:o(()=>[g(r(e.$t(n.error)),1)]),_:2},1024)])):b("",!0)],10,tt)),f(n)?w((p(),V(T,{key:2,icon:c(n)},null,8,["icon"])),[[k,n.sortable]]):b("",!0)],2),d("div",{onDragstart:t[3]||(t[3]=(...v)=>a.initResizer&&a.initResizer(...v)),onDrag:t[4]||(t[4]=(...v)=>a.resize&&a.resize(...v)),draggable:"true",class:"resizer"},null,32)],6))),128))])]),item:o(({item:l,index:f})=>[d("tr",null,[d("td",null,[i(X,{modelValue:s.selected,"onUpdate:modelValue":t[5]||(t[5]=c=>s.selected=c),value:l.id,"hide-details":""},null,8,["modelValue","value"])]),(p(!0),h(H,null,O(a.shownHeaders,({key:c,align:D})=>(p(),h("td",{class:C({[`text-${D}`]:!0,"bg-red-lighten-1":c==="duplicate"&&l[c].length>0})},[d("div",it,[c!=="duplicate"&&l[c]&&typeof l[c]=="string"?(p(),h("div",{key:0,innerHTML:l[c].match(/[a-z]/)===null?a.highlight(l[c]):a.highlight(e.$t(l[c]))},null,8,at)):b("",!0),c!=="duplicate"&&typeof l[c]!="string"?(p(),h("div",{key:1,innerHTML:a.highlight(l[c])},null,8,ot)):b("",!0),c==="duplicate"?(p(),h("div",nt,r(l[c].length>0?e.$t("Duplicated"):e.$t("Unique")),1)):b("",!0),c==="duplicate"&&l[c].length>0?(p(),h("div",rt,[i(T,{onClick:n=>s.currentItem=l[c],icon:"mdi-information-outline",class:"cursor-pointer"},null,8,["onClick"]),i(B,{activator:"parent","max-width":"300",location:"bottom"},{default:o(()=>[d("ul",dt,[(p(!0),h(H,null,O(l[c],n=>(p(),h("li",null,r(new Date(n.date).toLocaleDateString(e.$i18n.locale))+" - "+r(e.$t(n.bundleName)),1))),256))])]),_:2},1024)])):b("",!0)])],2))),256))])]),_:3},8,["modelValue","headers","search","items","height"])]),_:3},512)]),_:3}),i(K,{"model-value":a.dialog},{default:o(()=>[i(ne,{title:e.$t("Duplications"),"max-width":"600",class:"margin-auto custom-thumb"},{default:o(()=>[s.currentItem.length?(p(),V(re,{key:0},{default:o(()=>{var l,f,c,D,n;return[d("div",ut,[(l=s.currentItem[0])!=null&&l.headOfHousehold?(p(),h("div",ct,[i(Ve,{size:"56",color:"blue-grey-lighten-3"},{default:o(()=>{var v;return[i(T,{size:"x-large",icon:((v=s.currentItem[0])==null?void 0:v.headOfHousehold.gender)==="Male"?"mdi-human-male":"mdi-human-female"},null,8,["icon"])]}),_:1})])):b("",!0),d("div",pt,[(f=s.currentItem[0])!=null&&f.headOfHousehold.gender?(p(),h("div",mt,[d("strong",null,r(e.$t("Gender"))+":",1),g(" "+r(e.$t((c=s.currentItem[0])==null?void 0:c.headOfHousehold.gender)),1)])):b("",!0),d("div",null,[d("strong",null,r(e.$t("Birthday"))+":",1),g(" "+r(new Date((D=s.currentItem[0])==null?void 0:D.headOfHousehold.birthday).toLocaleString(e.$i18n.locale,{year:"numeric",month:"numeric",day:"numeric"})),1)]),d("div",null,[d("strong",null,r(e.$t("Current age"))+":",1),g(" "+r((n=s.currentItem[0])==null?void 0:n.headOfHousehold.age),1)]),d("div",ht,r(e.$t("Deduplication results")),1),d("div",ft,[d("div",null,[d("strong",null,r(e.$t("This person has already received the support from humanitarian organizations")),1)])]),(p(!0),h(H,null,O(s.currentItem,v=>{var I,x,N,U;return p(),h("div",{key:v.publicId,class:"mb-7 pl-2",style:{"border-left":"2px solid #039BE5"}},[d("div",gt,[d("strong",null,r(e.$t("Date"))+":",1),g(" "+r(new Date(v.date).toLocaleDateString("uk")),1)]),v.bundleName?(p(),h("div",yt,[d("strong",null,r(e.$t("Assistance type"))+":",1),g(" "+r(e.$t(v.bundleName)),1)])):b("",!0),(I=v.address)!=null&&I.pCode1?(p(),h("div",vt,[d("strong",null,r(e.$t("Oblast"))+":",1),g(" "+r(e.$t(v.address.pCode1)),1)])):b("",!0),(x=v.address)!=null&&x.pCode2?(p(),h("div",bt,[d("strong",null,r(e.$t("Raion"))+":",1),g(" "+r(e.$t(v.address.pCode2)),1)])):b("",!0),(N=v.address)!=null&&N.pCode4?(p(),h("div",Dt,[d("strong",null,r(e.$t("Locality"))+":",1),g(" "+r(e.$t(v.address.pCode4)),1)])):b("",!0),d("div",wt,[d("strong",null,r(e.$t("Organization"))+":",1),g(" "+r((U=v.organization)==null?void 0:U.name),1)]),v.items&&v.items.length?(p(),h("div",_t,[d("div",null,[d("strong",null,r(e.$t("Items"))+":",1)]),d("ul",kt,[(p(!0),h(H,null,O(v.items,R=>w((p(),h("li",null,r(e.$t(R.key))+": "+r(R.value),513)),[[k,R.value]])),256))])])):b("",!0),v.value?(p(),h("div",Vt,[d("strong",null,r(e.$t("Value"))+":",1),g(" "+r(v.value?v.value.toLocaleString("uk-UA",{style:"currency",currency:v.currency||"USD"}):""),1)])):b("",!0)])}),128))])])]}),_:1})):b("",!0),i(de,null,{default:o(()=>[i(A),i(_,{text:e.$t("Close"),color:"primary",onClick:t[7]||(t[7]=l=>s.currentItem=[])},null,8,["text"])]),_:1})]),_:1},8,["title"])]),_:1},8,["model-value"]),i(y,{modelValue:s.selectedHeaders,"onUpdate:modelValue":t[8]||(t[8]=l=>s.selectedHeaders=l),dialog:s.headersDialog,onClose:t[9]||(t[9]=l=>s.headersDialog=!1)},null,8,["modelValue","dialog"])])}const St=L(Ze,[["render",Ct]]),xt={name:"ImportDeduplicationSetup",props:{modelValue:{type:Array,default:()=>[]}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data(){return{filters:{items:{$nested:{key:[]}}}}},methods:{async deduplicateData(){this.$emit("setLoading",!0);for(let l of this.model)delete l.duplicate;const e=[...new Set(this.model.map(l=>l["headOfHousehold.taxId"]).filter(Boolean))],t=[...new Set(this.model.map(l=>l["headOfHousehold.passport"]).filter(Boolean))],u=[...e,...t],{assistances:m}=this.$storage,s=JSON.parse(JSON.stringify(this.filters)),a=[s];if(!s.distributionModality||s.distributionModality.includes("Cash")||s.distributionModality.includes("Voucher")){const l={distributionModality:s.distributionModality,value:{$gt:0}};l.distributionModality||delete l.distributionModality,a.push(l)}let y=await m.useIndex("peopleIds").filter({peopleIds:u}).should(a).include(["headOfHousehold.givenName","headOfHousehold.taxId","headOfHousehold.passport","familyMembers.taxId","familyMembers.passport","date","bundleName","organization.name","admin1","admin2","admin3","admin4","address.pCode1","address.pCode2","address.pCode3","address.pCode4"]).find();y.count||(this.$emit("setLoading",!1),this.$emit("setStep",4)),y.items=y.items.map(l=>(l.taxIds=[l.headOfHousehold.taxId],l.familyMembers&&(l.taxIds=[...l.taxIds,...l.familyMembers.map(f=>f.taxId)]),l));for(let l of this.model){let f=y.items.filter(c=>{var D;return(D=c.taxIds)==null?void 0:D.includes(l["headOfHousehold.taxId"])});l.duplicate=f,f.length&&(l.householdId=f[0].householdId)}this.$emit("setLoading",!1),this.$emit("setStep",4)}},watch:{"filters.bundleName"(){this.filters.items.$nested.key=[]},"filters.distributionModality"(){this.filters.items.$nested.key=[]}}},It={class:"d-flex flex-column h-100"},Tt={class:"text-h5 ml-1"},Ht={class:"ml-1"},Ot={class:"text-h6 mb-4"},$t={class:"text-h6 mb-4"},Nt={class:"text-h6 mb-4"};function zt(e,t,u,m,s,a){const y=Te,l=He,f=Oe;return p(),h("div",It,[i($,null,{default:o(()=>[i(S,{cols:"12",ref:"mainScreen"},{default:o(()=>[i(me,{fluid:""},{default:o(()=>[i($,null,{default:o(()=>[i(S,null,{default:o(()=>[d("div",Tt,r(e.$t("Deduplication setup")),1),d("div",Ht,r(e.$t("Select filters to apply for the following deduplication")),1)]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),i($,{class:"ml-3 mr-3 h-100 flex-grow-1"},{default:o(()=>{var c,D,n,v;return[i(S,{cols:"4"},{default:o(()=>[d("div",Ot,r(e.$t("Define the type of assistance")),1),i(y,{modelValue:s.filters.bundleName,"onUpdate:modelValue":t[0]||(t[0]=I=>s.filters.bundleName=I)},null,8,["modelValue"])]),_:1}),i(S,{cols:"4"},{default:o(()=>[d("div",$t,r(e.$t("Define the assistance modality")),1),i(l,{modelValue:s.filters.distributionModality,"onUpdate:modelValue":t[1]||(t[1]=I=>s.filters.distributionModality=I)},null,8,["modelValue"])]),_:1}),((D=(c=s.filters)==null?void 0:c.bundleName)==null?void 0:D.length)===1&&((v=(n=s.filters)==null?void 0:n.distributionModality)==null?void 0:v.length)===1&&s.filters.distributionModality[0]==="In-kind"?(p(),V(S,{key:0,cols:"4"},{default:o(()=>{var I,x,N,U;return[d("div",Nt,r(e.$t("Define the specific items")),1),((x=(I=s.filters)==null?void 0:I.bundleName)==null?void 0:x.length)===1&&((U=(N=s.filters)==null?void 0:N.distributionModality)==null?void 0:U.length)===1&&s.filters.distributionModality[0]==="In-kind"?(p(),V(f,{key:0,modelValue:s.filters.items.$nested.key,"onUpdate:modelValue":t[2]||(t[2]=R=>s.filters.items.$nested.key=R),bundle:s.filters.bundleName[0],class:"mt-4"},null,8,["modelValue","bundle"])):b("",!0)]}),_:1})):b("",!0)]}),_:1}),i($,{class:"align-center flex-grow-0 mt-2 pl-4 pr-4"},{default:o(()=>[i(S,{cols:"12",class:"text-right"},{default:o(()=>[i(_,{onClick:a.deduplicateData,class:"ml-2",color:"success"},{default:o(()=>[g(r(e.$t("Proceed")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})])}const Mt=L(xt,[["render",zt]]);var Lt={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};let le,se,P;const At={name:"ImportTable",props:{modelValue:{type:Array,default:()=>[]},initialData:{type:Object,default:()=>({})},dialogHeight:{type:Number,default:400},headers:{type:Array,default:()=>[]}},data(){return{selected:[],selectedHeaders:[],headersDialog:!1,selectedAll:!1,search:void 0,searchInput:void 0,showErrorsOnly:!1}},mounted(){this.selectedHeaders=this.headers.map(e=>({show:!0,header:e}))},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},availableHeaders(){return this.headers.map(e=>e.key)},shownHeaders(){return this.selectedHeaders.filter(({show:e})=>e).map(({header:e})=>e)},errorsCount(){return this.model.filter(e=>e.errors).length},blanksCount(){return this.model.filter(e=>{for(let{key:t}of this.headers)if(!["errors","headOfHousehold.taxId","headOfHousehold.passport"].includes(t)&&(typeof e[t]>"u"||e[t]===""))return!0}).length},selectedCount(){return this.selected.length},alertType(){return this.errorsCount?"error":this.blanksCount?"warning":"success"},recordsToShow(){return this.showErrorsOnly?this.model.filter(e=>e.errors):this.model}},methods:{setSearch:he(function(e){this.search=e}),initResizer(e){le=e.clientX,P=e.target.parentElement;const t=window.getComputedStyle(P);se=parseInt(t.width,10)},resize(e){const t=e.clientX-le;let u=se+t;if(u<0)return!1;u=Math.abs(u)<70?70:u,P.style.width=`${u}px`,P.style.minWidth=`${u}px`,P.style.maxWidth=`${u}px`},highlight(e){if(e instanceof Date&&(e=e.toLocaleDateString("uk")),typeof e!="string"||!e)return e;if(e=String(e),e=e.replace(/<[^>]+?>/g,""),this.search){let t=this.search.replace(/[^a-zа-яєіїґ\d ]/g,""),u=new RegExp(`(${t})`,"gi");e=e.replace(u,"<strong>$1</strong>")}return e},showErrors(){if(this.showErrorsOnly=!this.showErrorsOnly,this.showErrorsOnly){let e=this.recordsToShow.map(t=>t.id);this.selected=this.selected.filter(t=>e.includes(t))}},selectAllErrors(){this.selected=this.model.filter(e=>typeof e.errors<"u").map(e=>e.id)},selectAll(){this.selected.length!==this.recordsToShow.length?this.selected=this.recordsToShow.map(e=>e.id):this.selected=[]},deleteSelected(){const e=[...this.selected];this.model=this.model.filter(t=>!e.includes(t.id)),this.selected=[]},exportData(){const e=this.model.filter(l=>this.selected.includes(l.id)),t=this.headers.map(l=>l.key),u=this.headers.map(l=>l.title),m=t.reduce((l,f,c)=>(l[c]=e.map(D=>D[f]),l),{}),s={headers:u,columns:m},a=`${Lt.FRONT_HOST}/export/export.xlsx`;this.model.date,(async()=>{const l=`${new Date(this.initialData.date).toLocaleDateString("sv-SE")} - ${this.initialData.bundleName} Error records.xlsx`;return await W(a,s,l)})()},async proccedToDeduplication(){this.$emit("setStep",3)}},watch:{dialogHeight(e){const t=e-240;this.height=t}}},Bt={class:"font-weight-light"},Ut=["onClick"],Rt={class:"text-caption opacity-06"},Et={key:0,class:"ml-4 font-weight-light"},jt={class:"d-flex w-100 justify-space-between"},Ft=["innerHTML"],Pt={key:1},Xt=["innerHTML"],Yt={key:1,class:"text-start pl-4"},qt={key:2,class:"ml-4 font-weight-light"};function Jt(e,t,u,m,s,a){const y=fe;return p(),V($,null,{default:o(()=>[i(S,{cols:"12",ref:"mainScreen"},{default:o(()=>[i(ue,{modelValue:s.selected,"onUpdate:modelValue":t[5]||(t[5]=l=>s.selected=l),class:"import-table",height:e.$vuetify.display.height-370,headers:a.shownHeaders,search:s.search,items:a.recordsToShow,sticky:!0,"item-height":56,"show-select":"","fixed-header":"","item-value":"Tax ID"},{top:o(()=>[i(J,{flat:"",color:"white",class:"hidden-sm-and-down"},{default:o(()=>[i(ce,{class:"text-h5",style:{"min-width":"350px"}},{default:o(()=>[g(r(e.$t("Check the result")),1)]),_:1}),i(M,{class:"mx-4",inset:"",vertical:""}),i(pe,{modelValue:s.searchInput,"onUpdate:modelValue":[t[0]||(t[0]=l=>s.searchInput=l),a.setSearch],label:e.$t("Search"),class:"mr-4 w-100",variant:"outlined",density:"compact","hide-details":"","prepend-icon":"mdi-magnify"},{append:o(()=>[d("div",Bt,[i(_,{onClick:a.showErrors,color:s.showErrorsOnly?"red":"black",size:"small",icon:"mdi-filter"},null,8,["onClick","color"]),i(B,{activator:"parent",location:"start"},{default:o(()=>[g(r(e.$t("Show errors only")),1)]),_:1})])]),_:1},8,["modelValue","onUpdate:modelValue","label"]),i(A),ae(e.$slots,"action-btn",{},()=>[i(_,{onClick:t[1]||(t[1]=l=>s.headersDialog=!0),variant:"tonal",class:"ml-2"},{default:o(()=>[i(T,{left:""},{default:o(()=>t[8]||(t[8]=[g("mdi-table-edit")])),_:1})]),_:1})])]),_:3}),i(q,{color:a.alertType,variant:"tonal",class:"mt-2 mb-2"},{default:o(()=>[g(r(e.$t("Number of records",a.model.length))+". "+r(e.$t("Number of errors",a.errorsCount))+". "+r(e.$t("Number of blanks",a.blanksCount))+". "+r(e.$t("Number of selected rows",a.selectedCount))+".",1)]),_:1},8,["color"])]),bottom:o(()=>[i(J,{class:"mt-2 pa-0 ml-0",flat:"",density:"compact",color:"white"},{default:o(()=>[w(i(_,{onClick:a.selectAllErrors,class:"ml-0",color:"error",variant:"tonal","prepend-icon":"mdi-checkbox-outline"},{default:o(()=>[g(r(e.$t("Select all errors")),1)]),_:1},8,["onClick"]),[[k,a.errorsCount]]),w(i(_,{onClick:a.exportData,class:"ml-2",color:"primary",variant:"tonal","prepend-icon":"mdi-download"},{default:o(()=>[g(r(e.$t("Download")),1)]),_:1},8,["onClick"]),[[k,a.selectedCount]]),w(i(_,{onClick:a.deleteSelected,class:"ml-2",color:"warning",variant:"tonal","prepend-icon":"mdi-delete"},{default:o(()=>[g(r(e.$t("Delete")),1)]),_:1},8,["onClick"]),[[k,a.selectedCount]]),i(A),i(_,{disabled:a.errorsCount!==0||!this.model.length,onClick:a.proccedToDeduplication,class:"mr-0",color:"success",variant:"flat","prepend-icon":"mdi-play"},{default:o(()=>[g(r(e.$t("Proceed")),1)]),_:1},8,["disabled","onClick"])]),_:1})]),headers:o(({columns:l,isSorted:f,getSortIcon:c,toggleSort:D})=>[d("tr",null,[(p(!0),h(H,null,O(l,n=>(p(),h("td",{key:n.key,style:ie({"text-align":n.align}),class:C({"custom-check":n.key==="data-table-select","bg-orange-darken-4":typeof n.error<"u"})},[d("div",{class:C(["d-flex text-no-wrap align-center",{"justify-space-between":n.align!=="center","justify-center":n.align==="center"}])},[n.key==="data-table-select"?(p(),V(X,{key:0,onClick:a.selectAll,indeterminate:s.selected.length>0,"hide-details":""},null,8,["onClick","indeterminate"])):(p(),h("div",{key:1,class:C([{"cursor-pointer":n.sortable,"mr-2":n.sortable},"d-flex align-center"]),onClick:()=>D(n)},[d("div",null,[d("div",Rt,r(n.key),1),d("div",null,r(e.$t(n.title)),1)]),n.error?(p(),h("div",Et,[i(T,{icon:"mdi-information-outline"}),i(B,{activator:"parent",location:"start"},{default:o(()=>[g(r(e.$t(n.error)),1)]),_:2},1024)])):b("",!0)],10,Ut)),f(n)?w((p(),V(T,{key:2,icon:c(n)},null,8,["icon"])),[[k,n.sortable]]):b("",!0)],2),d("div",{onDragstart:t[2]||(t[2]=(...v)=>a.initResizer&&a.initResizer(...v)),onDrag:t[3]||(t[3]=(...v)=>a.resize&&a.resize(...v)),draggable:"true",class:"resizer"},null,32)],6))),128))])]),item:o(({item:l,index:f})=>[d("tr",null,[d("td",null,[i(X,{modelValue:s.selected,"onUpdate:modelValue":t[4]||(t[4]=c=>s.selected=c),value:l.id,"hide-details":""},null,8,["modelValue","value"])]),(p(!0),h(H,null,O(a.shownHeaders,({key:c,align:D})=>{var n,v,I;return p(),h("td",{class:C({[`text-${D}`]:!0,"bg-yellow-lighten-2":typeof l[c]>"u"&&typeof((n=l.errors)==null?void 0:n[c])>"u","bg-red-lighten-1":typeof((v=l.errors)==null?void 0:v[c])<"u"})},[d("div",jt,[typeof l[c]=="string"&&l[c]&&l[c].match(/[a-z]/ig)?(p(),h("div",{key:0,innerHTML:a.highlight(e.$t(l[c]))},null,8,Ft)):(p(),h("div",Pt,[typeof l[c]=="string"?(p(),h("span",{key:0,innerHTML:a.highlight(l[c])},null,8,Xt)):b("",!0),c==="familyMembers"?(p(),h("ul",Yt,[(p(!0),h(H,null,O(l[c],(x,N)=>(p(),h("li",{key:`fm-${N}`,class:"text-no-wrap"},r([x.taxId,x.passport,e.$t(x.gender),x.birthday].filter(Boolean).join(", ")),1))),128))])):b("",!0)])),(I=l.errors)!=null&&I[c]?(p(),h("div",qt,[i(T,{icon:"mdi-information-outline"}),i(B,{activator:"parent","max-width":"300",location:"bottom"},{default:o(()=>{var x;return[g(r(e.$t((x=l.errors)==null?void 0:x[c])),1)]}),_:2},1024)])):b("",!0)])],2)}),256))])]),_:3},8,["modelValue","height","headers","search","items"])]),_:3},512),i(y,{modelValue:s.selectedHeaders,"onUpdate:modelValue":t[6]||(t[6]=l=>s.selectedHeaders=l),dialog:s.headersDialog,onClose:t[7]||(t[7]=l=>s.headersDialog=!1)},null,8,["modelValue","dialog"])]),_:3})}const Wt=L(At,[["render",Jt]]),{cashAssistances:Kt,inKindAssistances:Gt}=ve,Qt=Ne(new Worker("/import/worker.js")),Zt=e=>new Promise((t,u)=>{const m=new FileReader;m.onerror=()=>u(m.error),m.onload=s=>{t(m.result)},e&&m.readAsArrayBuffer(e)}),el={props:{modelValue:{type:Object,default:()=>[]},initialData:{type:Object,default:()=>({})},disabled:{type:Boolean}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},bundleName:{get(){return this.initialData.bundleName},set(e){this.$emit("setBundle",e)}}},data(){return{isDragover:!1,dialog:!1,importText:void 0}},methods:{resetBundle(){this.model.items=[]},async upload(e){if(typeof this.bundleName>"u")return alert(this.$t("You need to select the bundle"));this.$emit("setLoading",!0);const t=await Zt(e[0]),u=Z.read(t,{cellDates:!0,cellNF:!1,cellText:!1}),m=u.SheetNames,s=u.Sheets[m[0]],a=Z.utils.sheet_to_json(s,{header:1});let y=G(a);y.data=y.data.map(l=>{var f;return l.tags=((f=l.tags)==null?void 0:f.split(","))||[],l.tags=[...l.tags,...this.initialData.tags||[]].join(","),l.tags||delete l.tags,l}),this.isDragover=!1,this.validateData(y),this.$refs.fileInput.value=""},async importTSV(){this.$emit("setLoading",!0);const e=await Qt(this.importText);let t=G(e);t.data=t.data.map(u=>{var m;return u.tags=((m=u.tags)==null?void 0:m.split(","))||[],u.tags=[...u.tags,...this.initialData.tags||[]].join(","),u.tags||delete u.tags,u}),this.validateData(t)},validateData({data:e,headers:t}){const u=this.initialData.distributionModality==="In-kind"?Gt:Kt;e=e.map(m=>{m.id=m["headOfHousehold.taxId"]||m["headOfHousehold.passport"];const s=u.validate(m,{abortEarly:!1});if(!s.error)return m;m.errors={};for(let a of s.error.details)m.errors[a.path[0]]=a.message;return m}),t=t.map(m=>(m.title=m.title.replace(/\*$/,""),m.title=m.title.replace(/^Items - /,""),m.title=m.title.replace(/^Strings - /,""),m)),this.model=e,this.$emit("setHeaders",t),this.$emit("setStep",2)}},watch:{bundleName(e){this.$emit("setBundle",e)}}},tl={class:"h-100 d-flex flex-column mt-4 flex-shrink-1"},ll={class:"text-h5"},sl=["href"],il={class:"v-btn__content","data-no-activator":""},al={class:"import-text flex-grow-1 ml-4 mr-4 mt-4"},ol={class:"text-h5 mb-2"},nl={class:"text-h5 mb-2"},rl={class:"text-h5 mb-2"},dl=["disabled"];function ul(e,t,u,m,s,a){const y=$e;return p(),h("div",tl,[i($,{class:"align-center flex-grow-0 pl-4 pr-4"},{default:o(()=>[i(S,{cols:"4"},{default:o(()=>[d("div",ll,r(e.$t("Upload your data")),1)]),_:1}),i(S,{cols:"4"},{default:o(()=>[i(y,{modelValue:a.bundleName,"onUpdate:modelValue":t[0]||(t[0]=l=>a.bundleName=l),disabled:u.disabled},null,8,["modelValue","disabled"])]),_:1}),i(S,{cols:"4",class:"text-right"},{default:o(()=>[u.initialData.bundleName?(p(),h("a",{key:0,download:"",class:"v-btn v-theme--unhcr text-primary v-btn--density-default v-btn--size-default v-btn--variant-tonal",href:`/import/templates/${u.initialData.bundleName}-${u.initialData.distributionModality}.xlsx`},[t[11]||(t[11]=d("span",{class:"v-btn__overlay"},null,-1)),t[12]||(t[12]=d("span",{class:"v-btn__underlay"},null,-1)),t[13]||(t[13]=d("span",{class:"v-btn__prepend"},[d("i",{class:"mdi-download mdi v-icon notranslate v-theme--unhcr v-icon--size-default","aria-hidden":"true"})],-1)),d("span",il,r(e.$t("Download template")),1)],8,sl)):b("",!0)]),_:1})]),_:1}),d("div",al,[d("div",null,[w(d("div",{class:C(["text-center drag-text",{"drag-over":s.isDragover}])},[w(d("div",null,[d("div",ol,r(e.$t("Select bundle")),1),d("div",null,r(e.$t("To start data import select the bundle, download the relevant template and provide the data")),1)],512),[[k,typeof a.bundleName>"u"]]),w(d("div",null,[d("div",nl,r(e.$t("Add your data here")),1),d("div",null,r(e.$t("To begin, select the table you want to import in Excel, copy it to the clipboard, and the paste here")),1),d("div",null,r(e.$t("or drop the Excel file")),1)],512),[[k,!s.isDragover&&a.bundleName]]),w(d("div",null,[i(T,{size:"x-large",class:"mb-2"},{default:o(()=>t[14]||(t[14]=[g("mdi-upload")])),_:1}),d("div",rl,r(e.$t("Drop your file here")),1)],512),[[k,s.isDragover]])],2),[[k,!s.importText]]),w(d("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.importText=l),disabled:typeof a.bundleName>"u",onDrag:t[2]||(t[2]=z(()=>{},["prevent","stop"])),onDragstart:t[3]||(t[3]=z(()=>{},["prevent","stop"])),onDragover:t[4]||(t[4]=z(l=>s.isDragover=!0,["prevent","stop"])),onDragenter:t[5]||(t[5]=z(l=>s.isDragover=!0,["prevent","stop"])),onDragend:t[6]||(t[6]=z(l=>s.isDragover=!1,["prevent","stop"])),onDragleave:t[7]||(t[7]=z(l=>s.isDragover=!1,["prevent","stop"])),onDrop:t[8]||(t[8]=z(l=>a.upload(l.dataTransfer.files),["prevent","stop"])),class:"w-100 h-100 elevation-2 pa-1","data-gramm":"false",spellcheck:"false",autocapitalize:"none",autocorrect:"off",autocomplete:"off"},null,40,dl),[[be,s.importText]])])]),i($,{class:"align-center flex-grow-0 mt-2 pl-4 pr-4"},{default:o(()=>[i(S,{cols:"12",class:"text-right"},{default:o(()=>[w(i(_,{onClick:t[9]||(t[9]=l=>e.$refs.fileInput.click()),disabled:typeof a.bundleName>"u","prepend-icon":"mdi-upload",color:"success",class:"ml-2"},{default:o(()=>[g(r(e.$t("Upload file")),1)]),_:1},8,["disabled"]),[[k,!s.importText]]),w(i(_,{onClick:a.importTSV,class:"ml-2",color:"success"},{default:o(()=>[g(r(e.$t("Import")),1)]),_:1},8,["onClick"]),[[k,s.importText]])]),_:1})]),_:1}),d("input",{ref:"fileInput",onInput:t[10]||(t[10]=l=>a.upload(l.target.files)),class:"d-none box__file",type:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","data-multiple-caption":"{count} files selected",multiple:""},null,544)])}const cl=L(el,[["render",ul]]),pl={props:{dialog:{type:Boolean},disabled:{type:Boolean},initialData:{type:Object,default:()=>({})},createRequest:{type:Boolean},isDonation:{type:Boolean}},computed:{currentHeaders(){const e=[],t=this.headers.map(m=>m.key);t.includes("headOfHousehold.taxId")&&e.push({key:"headOfHousehold.taxId",title:"Tax ID",value:"headOfHousehold.taxId"}),t.includes("headOfHousehold.passport")&&e.push({key:"headOfHousehold.passport",title:"Passport",value:"headOfHousehold.passport"}),this.step===4&&e.push({key:"duplicate",title:"Deduplication status",align:"start"});const u=this.headers.filter(m=>!["id","duplicate","headOfHousehold.taxId","headOfHousehold.passport"].includes(m.key));return e.push(...u),e}},data(){return{loading:!1,data:[],headers:[],deduplicationFilter:{},step:1}},methods:{resetData(){this.step=1,this.data=[],this.headers=[]},resetValidation(){let e=this.headers.map(t=>t.key).indexOf("duplicate");e>-1&&this.headers.splice(e,1),this.step=2},closeDialog(){this.$emit("close"),this.step=1}},watch:{step(){this.loading=!1}}},ml={class:"ms-2"},hl={key:0,class:"flex-grow-1 h-100 d-flex align-center justify-center"};function fl(e,t,u,m,s,a){const y=cl,l=Wt,f=Mt,c=St,D=We;return p(),V(K,{modelValue:u.dialog,"onUpdate:modelValue":t[18]||(t[18]=n=>e.$emit("close",n)),class:"import-dialog",fullscreen:"",overlay:""},{default:o(()=>[i(Ce,{style:{position:"relative"},ref:"dialogHeight"},{default:o(()=>[i(Se,{window:"",color:"primary",style:{top:"0px"},class:"d-flex justify-space-between"},{default:o(()=>[d("span",ml,r(e.$t("Import dialog")),1),i(T,{onClick:a.closeDialog,color:"white",icon:"mdi-close",class:"ms-2 text-white cursor-pointer"},null,8,["onClick"])]),_:1}),i(me,{class:"h-100 d-flex flex-column pa-lg-4",fluid:""},{default:o(()=>[i(xe,{"model-value":s.step,class:"pt-4 ma-0 flex-shrink-0",flat:""},{default:o(()=>[i(Ie,{flat:"",class:"pa-0 ma-0 elevation-0"},{default:o(()=>[i(E,{onClick:a.resetData,title:e.$t("Upload your data"),value:1,color:"primary",editable:s.step>1,complete:s.step>1},null,8,["onClick","title","editable","complete"]),i(M),i(E,{onClick:a.resetValidation,title:e.$t("Check the result"),value:2,color:"primary",editable:s.step>2,complete:s.step>2},null,8,["onClick","title","editable","complete"]),i(M),i(E,{onClick:t[0]||(t[0]=n=>s.step=3),title:e.$t("Deduplication setup"),value:3,color:"primary",editable:s.step>3,complete:s.step>3},null,8,["title","editable","complete"]),i(M),i(M),i(E,{onClick:t[1]||(t[1]=n=>s.step=4),title:e.$t("Deduplication"),value:4,color:"primary",editable:s.step>4,complete:s.step>4},null,8,["title","editable","complete"]),i(M),i(E,{title:e.$t("Import the data"),value:5,color:"primary",editable:s.step>5,complete:s.step>5},null,8,["title","editable","complete"])]),_:1})]),_:1},8,["model-value"]),s.loading?(p(),h("div",hl,[i(oe,{indeterminate:"",color:"primary",size:"x-large"})])):b("",!0),s.step===1?(p(),V(y,{key:1,modelValue:s.data,"onUpdate:modelValue":t[2]||(t[2]=n=>s.data=n),class:C({"d-none":s.loading}),disabled:u.disabled,"initial-data":u.initialData,onSetLoading:t[3]||(t[3]=n=>s.loading=n),onSetStep:t[4]||(t[4]=n=>s.step=n),onSetHeaders:t[5]||(t[5]=n=>s.headers=n),onSetBundle:t[6]||(t[6]=n=>u.initialData.bundleName=n)},null,8,["modelValue","class","disabled","initial-data"])):b("",!0),s.step===2?(p(),V(l,{key:2,modelValue:s.data,"onUpdate:modelValue":t[7]||(t[7]=n=>s.data=n),headers:a.currentHeaders,"initial-data":u.initialData,class:C({"d-none":s.loading}),"dialog-height":e.$refs.dialogHeight.$el.offsetHeight,onSetLoading:t[8]||(t[8]=n=>s.loading=n),onSetStep:t[9]||(t[9]=n=>s.step=n)},null,8,["modelValue","headers","initial-data","class","dialog-height"])):b("",!0),s.step===3?(p(),V(f,{key:3,modelValue:s.data,"onUpdate:modelValue":t[10]||(t[10]=n=>s.data=n),class:C({"d-none":s.loading}),filter:s.deduplicationFilter,onSetLoading:t[11]||(t[11]=n=>s.loading=n),onSetStep:t[12]||(t[12]=n=>s.step=n)},null,8,["modelValue","class","filter"])):b("",!0),s.step===4?(p(),V(c,{key:4,modelValue:s.data,"onUpdate:modelValue":t[13]||(t[13]=n=>s.data=n),headers:a.currentHeaders,"initial-data":u.initialData,class:C({"d-none":s.loading}),"dialog-height":e.$refs.dialogHeight.$el.offsetHeight,onSetLoading:t[14]||(t[14]=n=>s.loading=n),onSetStep:t[15]||(t[15]=n=>s.step=n)},null,8,["modelValue","headers","initial-data","class","dialog-height"])):b("",!0),s.step===5?(p(),V(D,{key:5,modelValue:s.data,"onUpdate:modelValue":t[16]||(t[16]=n=>s.data=n),headers:a.currentHeaders,"initial-data":u.initialData,"is-donation":u.isDonation,class:C({"d-none":s.loading}),onClose:a.closeDialog,onImported:t[17]||(t[17]=n=>e.$emit("imported",n))},null,8,["modelValue","headers","initial-data","is-donation","class","onClose"])):b("",!0)]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}const Il=L(pl,[["render",fl]]);export{Il as _};

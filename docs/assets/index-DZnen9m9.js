import{_ as $}from"./CustomTable-Bsru2z3s.js";import{d as O}from"./index-D0pvfY44.js";import{_ as V,a6 as L,v as M,F as h,a as r,w as a,x as w,y as C,o as i,z as g,C as y,A as l,B as c,c as v,G as U,H as B}from"./index-BYWsBYtF.js";import{b as T}from"./route-block-B_A1xBdJ.js";import{a as z,V as E}from"./VRow-D5QUgmxK.js";import{V as _}from"./VBtn-DEU8AXzn.js";import{V as R}from"./VAvatar-Bm8XvpvO.js";import{V as D}from"./VImg-wiXIkP7s.js";import{V as S}from"./index-CqdMy8lr.js";import{V as H}from"./VChip-BnTEbD1P.js";import"./CustomDate-BvE_k-Ie.js";import"./VMenu-BAWQ3Wct.js";import"./VOverlay-uyg0Ioz0.js";import"./forwardRefs-D3j0TLhE.js";import"./dialog-transition-CdzLxCw9.js";import"./VSpacer-D4hnwTqC.js";/* empty css              */import"./index-bmXFo_Al.js";import"./VTextField-CLSPMm7c.js";import"./VInput-CwTs2RKk.js";import"./debouncer-Whu4ZLob.js";import"./VCard-C8It3tDs.js";import"./VContainer-rOsYQHyZ.js";import"./VList-wnBQ6eUC.js";import"./searchProcessor-BfIe0Ps2.js";import"./VDataTable-DS7yi-Dm.js";import"./VPagination-BBLVO-bG.js";import"./filter-5KaMYqe0.js";import"./VCheckboxBtn-B1hdxoeT.js";import"./VToolbar-Jw3O4Zrq.js";import"./group-BcbT0sDe.js";var I={IS_TEST:!0,FRONT_HOST:"https://raisplus-test.unhcr.in.ua",STATIC_ASSETS_PATH:"http://localhost:3000/static/",MS_APP_CLIENT_ID:"4f92930c-13d8-4c36-95d6-2f2d31727e6e",MS_APP_AUTHORITY:"https://login.microsoftonline.com/e5c37981-6664-4134-8a0c-6543d2af80be",BYPASS_MSAL:!0,LOCALE:"uk-ua",LANGUAGE:"uk",BACKEND_HOST:"http://localhost:3000/api/v1",APP_NAME:"rais-plus",APP_SHORTNAME:"RAIS+",APP_FULLNAME:"RAIS+ Ukraine Assistance Monitoring System",APP_DEFAULT_THEME:"gsc",APP_KEY:"UicablEChAKeyNOmerYONYmIkIMELACIstioNIUMItIcARterm"};const P={name:"ManageUsers",mounted(){this.appStore.loading=!1},computed:{filters(){return[]},isAdmin(){var t,o,n;return(n=(o=(t=this.appStore)==null?void 0:t.user)==null?void 0:o.role)==null?void 0:n.includes("Admin")},staticPath(){return I.STATIC_ASSETS_PATH},headers(){var o,n,p;const t=[{title:"",align:"center",sortable:!1,value:"image"},{title:"User name",align:"start",sortable:!0,value:"person.fullName"},{title:"Organization",align:"start",sortable:!0,value:"organization.name",filterable:!0},{title:"Role",align:"start",value:"role",filterable:!0},{title:"Email",align:"start",value:"email"},{title:"Status",align:"start",value:"status"},{title:"Contacts",align:"center",value:"contacts"}];return(p=(n=(o=this.appStore)==null?void 0:o.user)==null?void 0:n.role)!=null&&p.includes("Admin")&&t.unshift({title:"Edit",align:"center",value:"_id"}),t}},data(){return{showAcrhive:!1,exportLoading:!1}},methods:{getInitials(t){if(!t.person)return t.email.slice(0,1);const{person:o}=t;let{familyName:n,givenName:p}=o;return[p,n].filter(Boolean).map(A=>A[0]).join("")||t.email.slice(0,1)},async exportData(){this.exportLoading=!0;const{users:t}=this.$storage,o=`${I.FRONT_HOST}/export/export.xlsx`,n=`${new Date().toISOString().substring(0,10)} - RAIS+ Users.xlsx`,p=["id","email","status","person.familyName","person.givenName","person.additionalName","person.gender","person.phone","person.email","role","organization.code","organization.name","jobTitle","responsibleOrganization.name","privacyConsent","termsConsent","tags"],A=["ID","Email for authentication","Status","Family Name","Given Name","Additional Name","Gender","Phones","Emails","Roles","Organization Code","Organization Name","Position","Available For","Privacy Consent","Terms Consent","Tags"];let b=(await t.include(p).slice(0,1e4).find()).items;b=b.map(e=>{var s,m,d;return e.responsibleOrganization&&(e.responsibleOrganization=e.responsibleOrganization.map(f=>f.name).join(", ")),(s=e.person)!=null&&s.email&&(e.email=e.person.email.join(", ")),(m=e.person)!=null&&m.phone&&(e.phone=e.person.phone.join(", ")),(d=e.person)!=null&&d.website&&(e.website=e.person.website.join(", ")),e.tags&&(e.tags=e.tags.join(", ")),e});const k=p.map(e=>b.map(s=>L(e,s)));await O(o,{headers:A,columns:k},n),this.exportLoading=!1}}},j={class:"distribution-points pa-2"},F={class:"text-h4 font-weight-bold"},G={key:0},Y={class:"mt-4 mb-4"},K={class:"text-subtitle-1 text-no-wrap title-link"},X={key:0,class:"text-caption"},q={key:1},J={key:0,class:"text-no-wrap"},Q={class:"text-no-wrap"},W={class:"text-no-wrap"},Z={class:"text-no-wrap"};function ee(t,o,n,p,A,u){const b=M("router-link"),k=$;return i(),h("div",j,[r(z,{class:"mb-0 mt-0"},{default:a(()=>[r(E,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[g("div",F,[y(l(t.$t("Manage users"))+" ",1),u.isAdmin?(i(),h("span",G,[r(_,{onClick:u.exportData,loading:A.exportLoading,size:"small",color:"grey-dakren-4",variant:"tonal"},{default:a(()=>[y(l(t.$t("Export")),1)]),_:1},8,["onClick","loading"])])):c("",!0)])]),_:1})]),_:1}),r(z,{class:"mb-0 mt-0"},{default:a(()=>[r(E,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[r(k,{class:"pa-6",onBtnClick:o[0]||(o[0]=e=>t.$router.push("/users/new")),button:t.$t("Add"),"sort-by":{key:"person.fullName",order:"desc"},"search-keys":["person.fullName","person.translation.uk.fullName","email"],filters:u.filters,headers:u.headers,title:t.$t("Users"),table:"users"},{"item.image":a(({item:e})=>[r(R,{size:"42px",color:"grey-darken-3"},{default:a(()=>{var s,m,d,f;return[(m=(s=e.image)==null?void 0:s[0])!=null&&m.path?(i(),v(D,{key:0,alt:"User Image",src:u.staticPath+e.image[0].path},null,8,["src"])):c("",!0),w(g("span",{class:"text-h6 primary--text"},l(u.getInitials(e)),513),[[C,!((f=(d=e.image)==null?void 0:d[0])!=null&&f.path)]])]}),_:2},1024)]),"item.person.fullName":a(({item:e})=>[g("div",Y,[g("div",K,[r(b,{to:`/users/${e.id}`,tag:"a"},{default:a(()=>[y(l(e.person.fullName||e.email),1)]),_:2},1032,["to"])]),e.person.fullName?(i(),h("div",X,l(e.email),1)):c("",!0),e.tags?(i(),h("div",q,[(i(!0),h(U,null,B(e.person.tags,s=>(i(),v(H,{key:s,size:"x-small",color:"primary",label:"",class:"mr-2"},{default:a(()=>[y(l(s),1)]),_:2},1024))),128))])):c("",!0)])]),"item.organization.name":a(({item:e})=>[e.organization?(i(),h("span",J,l(t.$_translate(e.organization).name),1)):c("",!0)]),"item.status":a(({item:e})=>[g("span",Q,l(t.$t(e.status)),1)]),"item.role":a(({item:e})=>[g("span",W,l(e.role&&e.role.map(s=>t.$t(s)).join(", ")),1)]),"item.contacts":a(({item:e})=>{var s,m,d,f,N,x;return[g("div",Z,[(m=(s=e.person)==null?void 0:s.phone)!=null&&m.length&&e.person.phone[0]?(i(),v(_,{key:0,href:`tel:${e.person.phone[0]}`,size:"small",variant:"text",color:"primary"},{default:a(()=>[r(S,{icon:"mdi-phone"})]),_:2},1032,["href"])):c("",!0),(f=(d=e.person)==null?void 0:d.email)!=null&&f.length&&e.person.email[0]?(i(),v(_,{key:1,href:`mailto:${e.person.email[0]}`,size:"small",variant:"text",color:"primary"},{default:a(()=>[r(S,{icon:"mdi-email"})]),_:2},1032,["href"])):c("",!0),(x=(N=e.person)==null?void 0:N.website)!=null&&x.length&&e.person.website[0]?(i(),v(_,{key:2,href:`${e.person.website[0]}`,size:"small",variant:"text",color:"primary"},{default:a(()=>[r(S,{icon:"mdi-web"})]),_:2},1032,["href"])):c("",!0)])]}),"item._id":a(({item:e})=>[r(_,{onClick:s=>t.$router.push(`/users/${e.id}`),color:"grey-dakren-2",variant:"tonal",rounded:"1",icon:"mdi-pencil",size:"x-small"},null,8,["onClick"])]),_:2},1032,["button","filters","headers","title"])]),_:1})]),_:1}),w(r(_,{onClick:o[1]||(o[1]=e=>t.$router.push("/users/new")),style:{position:"fixed",bottom:"15px",right:"15px"},color:"primary",rounded:"1",icon:"mdi-plus",size:"large"},null,512),[[C,t.$vuetify.display.xs]])])}typeof T=="function"&&T(P);const Pe=V(P,[["render",ee]]);export{Pe as default};

import{_ as V}from"./ReportsIndicators-VUt3YENQ.js";import{_ as w}from"./CustomDate-BvE_k-Ie.js";import{_ as v}from"./CustomBundle-pHbbXnxx.js";import{_ as k,a5 as C,ab as I,F as _,a as o,w as u,o as D,z as f,A as c,C as h}from"./index-BYWsBYtF.js";import{b as $}from"./route-block-B_A1xBdJ.js";import{a as N,V as m}from"./VRow-D5QUgmxK.js";import{V as F,a as z}from"./VCard-C8It3tDs.js";import{V as y}from"./VChip-BnTEbD1P.js";import"./CustomTableHeaderStatic--V9Vxjnk.js";import"./debouncer-Whu4ZLob.js";import"./index-CqdMy8lr.js";import"./VMenu-BAWQ3Wct.js";import"./VOverlay-uyg0Ioz0.js";import"./forwardRefs-D3j0TLhE.js";import"./dialog-transition-CdzLxCw9.js";import"./VBtn-DEU8AXzn.js";import"./group-BcbT0sDe.js";import"./VContainer-rOsYQHyZ.js";/* empty css              */import"./VTextField-CLSPMm7c.js";import"./index-bmXFo_Al.js";import"./VInput-CwTs2RKk.js";import"./VImg-wiXIkP7s.js";import"./VList-wnBQ6eUC.js";import"./VAvatar-Bm8XvpvO.js";import"./VSpacer-D4hnwTqC.js";import"./index-D0pvfY44.js";import"./VDataTableVirtual-BO58bCzO.js";import"./VDataTable-DS7yi-Dm.js";import"./VPagination-BBLVO-bG.js";import"./filter-5KaMYqe0.js";import"./VCheckboxBtn-B1hdxoeT.js";import"./VToolbar-Jw3O4Zrq.js";import"./VTooltip-CKohhaj7.js";const l=["organization.name","date$month","address.pCode4","collectiveCenter.name","populationType"],d={households:{operation:"count",variable:"id"},familySize:{variable:"familyMembersIds",operation:"countDistinct"},girls:{variable:"familyMembersIds",filter:"Female;(children|NA)",operation:"countDistinct"},boys:{variable:"familyMembersIds",filter:"Male;(children|NA)",operation:"countDistinct"},women:{variable:"familyMembersIds",filter:"Female;adult",operation:"countDistinct"},men:{variable:"familyMembersIds",filter:"Male;adult",operation:"countDistinct"},seniorWomen:{variable:"familyMembersIds",filter:"Female;senior",operation:"countDistinct"},seniorMen:{variable:"familyMembersIds",filter:"Male;senior",operation:"countDistinct"},disabled:{variable:"familyMembersIds",filter:";DS",operation:"countDistinct"}},S={"SN101-2024":[async(e,a)=>{const s="Shelter",n="# supported with emergency shelter kits",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN101-2024",distributionModality:["Cash","Voucher"],value:{$gt:0}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"Cash-Voucher"})),t},async(e,a)=>{const s="Shelter",n="# supported with emergency shelter kits",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN101-2024",distributionModality:["In-kind"],items:{$nested:{key:["Emergency Shelter Kit"],value:{$gt:0}}}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind"})),t},async(e,a)=>{const s="Shelter",n="# supported with emergency construction materials",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN101-2024",distributionModality:["In-kind"],items:{$nested:{key:["Tarpaulin (separate)","Transparent plastic sheeting, 3x10m (separate)","OSB (separate)"],value:{$gt:0}}}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind"})),t}],"SN102-2024":[async(e,a)=>{const s="Shelter",n="# supported with emergency construction materials",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN102-2024",distributionModality:["In-kind"],items:{$nested:{value:{$gt:0}}}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind"})),t}],"SN104-2024":[async(e,a)=>{const s="NFI",n="# supported with household NFI",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN104-2024",date:{$gte:"2025-03-01"},distributionModality:["Cash","Voucher"],value:{$gt:0}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"Cash-Voucher"})),t},async(e,a)=>{const s="NFI",n="# supported with household NFI",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN104-2024",distributionModality:["In-kind"],date:{$gte:"2025-03-01"},items:{$nested:{value:{$gt:0}}}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind"})),t},async(e,a)=>{const s="NFI",n="# supported with NFIs for winter",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN104-2024",date:{$lt:"2025-03-01"},distributionModality:["Cash","Voucher"],value:{$gt:0}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"Cash-Voucher"})),t},async(e,a)=>{const s="NFI",n="# supported with NFIs for winter",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN104-2024",distributionModality:["In-kind"],date:{$gte:"2025-03-01"},items:{$nested:{value:{$gt:0}}}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind"})),t}],"SN105-2024":[async(e,a)=>{const s="Shelter",n="# supported through insulation of substandard houses",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN105-2024",distributionModality:["Cash","Voucher"],value:{$gt:0}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"Cash-Voucher"})),t},async(e,a)=>{const s="Shelter Insulation",n="# supported through insulation of substandard houses",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN105-2024",distributionModality:["In-kind"],items:{$nested:{key:["Emergency Shelter Kit"],value:{$gt:0}}}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind"})),t}],"SN106-2024":[async(e,a)=>{const s="NFI",n="# supported with cash for utilities",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN106-2024",distributionModality:["Cash","Voucher"],value:{$gt:0}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"Cash-Voucher"})),t}],"SN107-2024":[async(e,a)=>{const s="NFI",n="# supported with winter heating appliances",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN107-2024",distributionModality:["Cash","Voucher"],value:{$gt:0}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"Cash-Voucher"})),t},async(e,a)=>{const s="NFIa",n="# supported with winter heating appliances",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN107-2024",distributionModality:["In-kind"],items:{$nested:{value:{$gt:0}}}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind"})),t}],"SN108-2024":[async(e,a)=>{const s="NFI",n="# supported with winter energy",{assistances:r}=e;let t=await r.filter({...a,bundleName:"SN108-2024",distributionModality:["Cash","Voucher"],value:{$gt:0}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"Cash-Voucher"})),t},async(e,a)=>{const s="NFI",n="# supported with winter energy",{assistances:r}=e;let t=await r.filter({...a,bundleName:"SN108-2024",distributionModality:["In-kind"]}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind",items:{$nested:{value:{$gt:0}}}})),t}],"SN109-2024":[async(e,a)=>{const s="NFI",n="# supported with winter clothes",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN109-2024",distributionModality:["Cash","Voucher"],value:{$gt:0}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"Cash-Voucher"})),t},async(e,a)=>{const s="NFI",n="# supported with winter clothes",{assistances:r}=e;let t=await r.useIndex("bundleName").filter({...a,bundleName:"SN109-2024",distributionModality:["In-kind"],items:{$nested:{value:{$gt:0}}}}).aggregate({groupBy:l,aggs:d});return t=t.map(i=>({...i,indicator:n,output:s,distributionModality:"In-kind"})),t}]},M={name:"indicators",beforeMount(){var a,s;const e=localStorage.getItem("unhcr-rais-plus-recent-indicators");e||(this.filters={date:{$gte:new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),$lte:new Date().toLocaleDateString("sv-SE")}}),this.organizations=[(s=(a=this.appStore)==null?void 0:a.user)==null?void 0:s.organization].filter(Boolean),e&&Object.assign(this.filters,JSON.parse(e)),this.getFiltersData(),this.appStore.loading=!1},computed:{isAdmin(){var e,a,s;return(s=(a=(e=this.appStore)==null?void 0:e.user)==null?void 0:a.role)==null?void 0:s.includes("Admin")}},data:()=>({organizations:[],filters:{bundleName:"SN101-2024",date:{$lte:void 0,$gte:void 0}},indicators:[],indicatorsLoading:!0}),methods:{async getFiltersData(){const{organizations:e}=this.$storage,a=await e.slice(0,500).filter({functionalType:["UN Agency","Operational partner","Implementing partner"]}).include(["id","name","translation.uk.name"]).sort([{name:"asc"}]).find();this.organizations=a.items},async getIndicators(){if(this.indicatorsLoading=!0,!this.filters.bundleName||!S[this.filters.bundleName])return this.indicators=[],this.indicatorsLoading=!1;let e;try{e=await Promise.all(S[this.filters.bundleName].map(s=>s(this.$storage,this.filters)))}catch(s){console.log(s)}const a=e.flat().map(s=>{var n,r,t,i,p,b;return s=C.object(s),s.items&&(s.items=I(s.items)),s.strings&&(s.strings=I(s.strings)),s.address.pCode1=(r=(n=s.address)==null?void 0:n.pCode4)==null?void 0:r.substring(0,4),s.address.pCode2=(i=(t=s.address)==null?void 0:t.pCode4)==null?void 0:i.substring(0,6),s.address.pCode3=(b=(p=s.address)==null?void 0:p.pCode4)==null?void 0:b.substring(0,9),s});this.indicators=a,this.indicatorsLoading=!1},getData(){this.getIndicators()}},watch:{filters:{deep:!0,handler(e){localStorage.setItem("unhcr-rais-plus-recent-indicators",JSON.stringify(e)),this.getData()}}}},x={class:"indicators pa-2"},A={class:"text-h5 mb-2 offset-md1 black--text"},L={class:"mb-4"},T={class:"text-h5 mb-2 offset-md1 black--text"};function B(e,a,s,n,r,t){const i=v,p=w,b=V;return D(),_("div",x,[o(N,{class:"mb-0 mt-0"},{default:u(()=>[o(m,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:u(()=>[o(F,null,{default:u(()=>[o(z,null,{default:u(()=>[o(N,null,{default:u(()=>[o(m,{cols:"12",md:"3",class:"pl-md-4"},{default:u(()=>[f("div",A,c(e.$t("Filters")),1),f("div",L,c(e.$t("Define the filters for your report")),1),f("div",null,[o(i,{modelValue:e.filters.bundleName,"onUpdate:modelValue":a[0]||(a[0]=g=>e.filters.bundleName=g)},null,8,["modelValue"]),o(p,{modelValue:e.filters.date.$gte,"onUpdate:modelValue":a[1]||(a[1]=g=>e.filters.date.$gte=g),label:e.$t("Start of report period"),class:"mt-4"},null,8,["modelValue","label"]),o(p,{modelValue:e.filters.date.$lte,"onUpdate:modelValue":a[2]||(a[2]=g=>e.filters.date.$lte=g),label:e.$t("End of report period")},null,8,["modelValue","label"])])]),_:1}),o(m,{cols:"12",md:"9",class:"pr-md-4"},{default:u(()=>[o(N,null,{default:u(()=>[o(m,{cols:"12"},{default:u(()=>[o(y,{link:"",to:"/reports",class:"mr-2"},{default:u(()=>[h(c(e.$t("Summaries")),1)]),_:1}),o(y,{color:"primary",class:"mr-2"},{default:u(()=>[h(c(e.$t("Indicators")),1)]),_:1}),o(y,{link:"",to:"/custom-indicators"},{default:u(()=>[h(c(e.$t("Custom indicators")),1)]),_:1})]),_:1}),o(m,{cols:"12"},{default:u(()=>[f("div",T,c(e.$t("Indicators")),1)]),_:1}),o(m,null,{default:u(()=>[o(b,{data:e.indicators,filters:e.filters,startDate:e.filters.date.$gte,endDate:e.filters.date.$lte,loading:e.indicatorsLoading},null,8,["data","filters","startDate","endDate","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof $=="function"&&$(M);const Nt=k(M,[["render",B]]);export{Nt as default};

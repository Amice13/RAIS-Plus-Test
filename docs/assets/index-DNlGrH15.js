import{_ as I}from"./CustomTable-CzX_aHyy.js";import{d as B}from"./index-T2HRTWtS.js";import{_ as j,v as E,F as h,o as i,a as r,z as C,w as a,x as g,C as x,A as u,y as l,c as y,G as D,H as P,B as S,ab as F}from"./index-BtIo2-Z_.js";import{b as $}from"./route-block-B_A1xBdJ.js";import{V as A,a as V}from"./VRow-9vAZildp.js";import{V as _}from"./VBtn--bGuKZaN.js";import{V as w}from"./index-SDX8Otz2.js";import{V as R}from"./VChip-CKNl8kC9.js";import{V as H}from"./VAvatar-l5UJO0sV.js";import{V as L}from"./VImg-FY_z5S7Z.js";import"./CustomDate-CLArRqjL.js";import"./VMenu-Cs322VI3.js";import"./VOverlay-BnbjS8dz.js";import"./forwardRefs--KQCZfKO.js";import"./dialog-transition-Dq7CKyny.js";import"./VSpacer-bp7-SSB-.js";/* empty css              */import"./index-C5-hvfiu.js";import"./VTextField-Bn35T3UG.js";import"./VInput-CRZE-Mt3.js";import"./debouncer-Whu4ZLob.js";import"./VCard-DNHZbZ5d.js";import"./VContainer-BFGIFtcM.js";import"./VProgressCircular-DNPB7izS.js";import"./VList-Cnqqz-5U.js";import"./searchProcessor-BfIe0Ps2.js";import"./VDataTable-BrBBORsC.js";import"./VPagination-zp71F-1D.js";import"./filter-ahsWVyiP.js";import"./VCheckboxBtn-DQUGWCnj.js";import"./VToolbar-o4oksDe3.js";import"./group-DgRBM2CV.js";var T={FRONT_HOST:"https://raisplus-test.unhcr.in.ua",STATIC_ASSETS_PATH:"http://localhost:3000/static/"};const O={name:"ManageUsers",mounted(){this.appStore.loading=!1},computed:{filters(){return[]},isAdmin(){var t,o,n;return(n=(o=(t=this.appStore)==null?void 0:t.user)==null?void 0:o.role)==null?void 0:n.includes("Admin")},staticPath(){return T.STATIC_ASSETS_PATH},headers(){var o,n,p;const t=[{title:"",align:"center",sortable:!1,value:"image"},{title:"User name",align:"start",sortable:!0,value:"person.fullName"},{title:"Organization",align:"start",sortable:!0,value:"organization.name",filterable:!0},{title:"Role",align:"start",value:"role",filterable:!0},{title:"Email",align:"start",value:"email"},{title:"Status",align:"start",value:"status"},{title:"Contacts",align:"center",value:"contacts"}];return(p=(n=(o=this.appStore)==null?void 0:o.user)==null?void 0:n.role)!=null&&p.includes("Admin")&&t.unshift({title:"Edit",align:"center",value:"_id"}),t}},data(){return{showAcrhive:!1,exportLoading:!1}},methods:{getInitials(t){if(!t.person)return t.email.slice(0,1);const{person:o}=t;let{familyName:n,givenName:p}=o;return[p,n].filter(Boolean).map(b=>b[0]).join("")||t.email.slice(0,1)},async exportData(){this.exportLoading=!0;const{users:t}=this.$storage,o=`${T.FRONT_HOST}/export/export.xlsx`,n=`${new Date().toISOString().substring(0,10)} - RAIS+ Users.xlsx`,p=["id","email","status","person.familyName","person.givenName","person.additionalName","person.gender","person.phone","person.email","role","organization.code","organization.name","jobTitle","responsibleOrganization.name","privacyConsent","termsConsent","tags"],b=["ID","Email for authentication","Status","Family Name","Given Name","Additional Name","Gender","Phones","Emails","Roles","Organization Code","Organization Name","Position","Available For","Privacy Consent","Terms Consent","Tags"];let v=(await t.include(p).slice(0,1e4).find()).items;v=v.map(e=>{var s,m,d;return e.responsibleOrganization&&(e.responsibleOrganization=e.responsibleOrganization.map(f=>f.name).join(", ")),(s=e.person)!=null&&s.email&&(e.email=e.person.email.join(", ")),(m=e.person)!=null&&m.phone&&(e.phone=e.person.phone.join(", ")),(d=e.person)!=null&&d.website&&(e.website=e.person.website.join(", ")),e.tags&&(e.tags=e.tags.join(", ")),e});const k=p.map(e=>v.map(s=>F(e,s)));await B(o,{headers:b,columns:k},n),this.exportLoading=!1}}},U={class:"distribution-points pa-2"},G={class:"text-h4 font-weight-bold"},M={key:0},X={class:"mt-4 mb-4"},q={class:"text-subtitle-1 text-no-wrap title-link"},J={key:0,class:"text-caption"},K={key:1},Q={key:0,class:"text-no-wrap"},W={class:"text-no-wrap"},Y={class:"text-no-wrap"},Z={class:"text-no-wrap"};function ee(t,o,n,p,b,c){const v=E("router-link"),k=I;return i(),h("div",U,[r(V,{class:"mb-0 mt-0"},{default:a(()=>[r(A,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[g("div",G,[x(l(t.$t("Manage users"))+" ",1),c.isAdmin?(i(),h("span",M,[r(_,{onClick:c.exportData,loading:b.exportLoading,size:"small",color:"grey-dakren-4",variant:"tonal"},{default:a(()=>[x(l(t.$t("Export")),1)]),_:1},8,["onClick","loading"])])):u("",!0)])]),_:1})]),_:1}),r(V,{class:"mb-0 mt-0"},{default:a(()=>[r(A,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[r(k,{class:"pa-6",onBtnClick:o[0]||(o[0]=e=>t.$router.push("/users/new")),button:t.$t("Add"),"sort-by":{key:"person.fullName",order:"desc"},"search-keys":["person.fullName","person.translation.uk.fullName","email"],filters:c.filters,headers:c.headers,title:t.$t("Users"),table:"users"},{"item.image":a(({item:e})=>[r(H,{size:"42px",color:"grey-darken-3"},{default:a(()=>{var s,m,d,f;return[(m=(s=e.image)==null?void 0:s[0])!=null&&m.path?(i(),y(L,{key:0,alt:"User Image",src:c.staticPath+e.image[0].path},null,8,["src"])):u("",!0),C(g("span",{class:"text-h6 primary--text"},l(c.getInitials(e)),513),[[S,!((f=(d=e.image)==null?void 0:d[0])!=null&&f.path)]])]}),_:2},1024)]),"item.person.fullName":a(({item:e})=>[g("div",X,[g("div",q,[r(v,{to:`/users/${e.id}`,tag:"a"},{default:a(()=>[x(l(e.person.fullName||e.email),1)]),_:2},1032,["to"])]),e.person.fullName?(i(),h("div",J,l(e.email),1)):u("",!0),e.tags?(i(),h("div",K,[(i(!0),h(D,null,P(e.person.tags,s=>(i(),y(R,{key:s,size:"x-small",color:"primary",label:"",class:"mr-2"},{default:a(()=>[x(l(s),1)]),_:2},1024))),128))])):u("",!0)])]),"item.organization.name":a(({item:e})=>[e.organization?(i(),h("span",Q,l(t.$_translate(e.organization).name),1)):u("",!0)]),"item.status":a(({item:e})=>[g("span",W,l(t.$t(e.status)),1)]),"item.role":a(({item:e})=>[g("span",Y,l(e.role&&e.role.map(s=>t.$t(s)).join(", ")),1)]),"item.contacts":a(({item:e})=>{var s,m,d,f,z,N;return[g("div",Z,[(m=(s=e.person)==null?void 0:s.phone)!=null&&m.length&&e.person.phone[0]?(i(),y(_,{key:0,href:`tel:${e.person.phone[0]}`,size:"small",variant:"text",color:"primary"},{default:a(()=>[r(w,{icon:"mdi-phone"})]),_:2},1032,["href"])):u("",!0),(f=(d=e.person)==null?void 0:d.email)!=null&&f.length&&e.person.email[0]?(i(),y(_,{key:1,href:`mailto:${e.person.email[0]}`,size:"small",variant:"text",color:"primary"},{default:a(()=>[r(w,{icon:"mdi-email"})]),_:2},1032,["href"])):u("",!0),(N=(z=e.person)==null?void 0:z.website)!=null&&N.length&&e.person.website[0]?(i(),y(_,{key:2,href:`${e.person.website[0]}`,size:"small",variant:"text",color:"primary"},{default:a(()=>[r(w,{icon:"mdi-web"})]),_:2},1032,["href"])):u("",!0)])]}),"item._id":a(({item:e})=>[r(_,{onClick:s=>t.$router.push(`/users/${e.id}`),color:"grey-dakren-2",variant:"tonal",rounded:"1",icon:"mdi-pencil",size:"x-small"},null,8,["onClick"])]),_:2},1032,["button","filters","headers","title"])]),_:1})]),_:1}),C(r(_,{onClick:o[1]||(o[1]=e=>t.$router.push("/users/new")),style:{position:"fixed",bottom:"15px",right:"15px"},color:"primary",rounded:"1",icon:"mdi-plus",size:"large"},null,512),[[S,t.$vuetify.display.xs]])])}typeof $=="function"&&$(O);const Ie=j(O,[["render",ee]]);export{Ie as default};

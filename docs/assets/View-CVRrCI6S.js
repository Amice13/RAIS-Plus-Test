import{_ as U,a as N,b as L,c as P,d as B,e as E,f as j}from"./DistributionFormDocument-hthCb9m0.js";import{_ as R}from"./DistributionFormCash-Cfj8YSJm.js";import{_ as k,Z as x,$ as H,a0 as W,a1 as $,a2 as z,a3 as C,o as h,c as _,w as l,a as i,C as n,A as o,F as b,B as f,z as r,a8 as q,a9 as Y,Y as G,aa as Z,H as I,G as J}from"./index-BYWsBYtF.js";import{V as K,c as Q,a as X,b as ee}from"./VCard-C8It3tDs.js";import{a as V,V as v}from"./VRow-D5QUgmxK.js";import{V as te}from"./VTextarea-CGO06-dG.js";import{V as w}from"./VBtn-DEU8AXzn.js";import{V as ae}from"./VSpacer-D4hnwTqC.js";import{V as se}from"./VDialog-DkfmLzLV.js";import{_ as le}from"./CustomTable-Bsru2z3s.js";import{b as D}from"./route-block-B_A1xBdJ.js";import"./index-CqdMy8lr.js";import"./CustomDate-BvE_k-Ie.js";import"./VMenu-BAWQ3Wct.js";import"./VOverlay-uyg0Ioz0.js";import"./forwardRefs-D3j0TLhE.js";import"./dialog-transition-CdzLxCw9.js";import"./index-bmXFo_Al.js";import"./VAvatar-Bm8XvpvO.js";import"./VImg-wiXIkP7s.js";import"./VTextField-CLSPMm7c.js";import"./VInput-CwTs2RKk.js";import"./CustomGender-2pTOXWap.js";import"./filter-5KaMYqe0.js";import"./VList-wnBQ6eUC.js";import"./VCheckboxBtn-B1hdxoeT.js";import"./VChip-BnTEbD1P.js";import"./group-BcbT0sDe.js";import"./index-D0cxP7tL.js";import"./VDataTable-DS7yi-Dm.js";import"./VPagination-BBLVO-bG.js";import"./CustomTextFieldTranslit-DAGdx7D0.js";import"./CustomPhone-JFRV9tiP.js";import"./CustomTag-DNZukCra.js";import"./debouncer-Whu4ZLob.js";import"./data-BLrW_n9l.js";import"./CustomPopulationType-qKzO5os5.js";import"./VAlert-BA1FNbYI.js";import"./VCheckbox-CLjkCuK4.js";/* empty css              */import"./VContainer-rOsYQHyZ.js";import"./searchProcessor-BfIe0Ps2.js";import"./VToolbar-Jw3O4Zrq.js";const oe={name:"DistributionPocDialow",inject:["$confirm","$error","$loading","$showResult"],props:{modelValue:{type:Object,default:()=>({})},items:{type:Array,default:()=>[]}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},canEdit(){var e,s,m;if((m=(s=(e=this.appStore)==null?void 0:e.user)==null?void 0:s.role)!=null&&m.includes("Admin")||!this.model.id||new Date-new Date(this.model.date)<30*1e3*60*60*24||new Date-new Date(this.model.createdAt)<7*1e3*60*60*24)return!0},dialog(){const e=document.querySelector("html"),s=Object.keys(this.model).length>0;return e.classList[s?"add":"remove"]("overflow-hidden"),s}},methods:{countFamilyStats(){this.model.familyStats=x([...this.model.familyMembers,this.model.headOfHousehold])},formatAddress:H,createFamilyMembersIds(){var c;const e=this.model.taxId||this.model.passport||W(),s=$(this.model,e);let m=[];return(c=this.model)!=null&&c.familyMembers&&(m=this.model.familyMembers.map(y=>$(y,e))),[s,...m]},async removeData(){if(!await this.$confirm({title:"Delete assistance",description:"Would you like to delete data about the assistance?"}))return!1;this.$loading(!0);const{assistances:s}=this.$storage;let m;try{m=await delete s[this.model.id]}catch(c){await this.$error(c)}if(this.$loading(!1),!m)return!1;await this.$showResult(),this.model={},this.$emit("loadItems")},async saveData(){var m,c,y,a,p;if(!await this.$confirm({title:"Save assistance",description:"Would you like to save data about the assistance?"}))return!1;(m=this.model)!=null&&m.headOfHousehold&&(this.model.headOfHousehold=z(this.model.headOfHousehold)),(c=this.model)!=null&&c.headOfHousehold&&this.model.household&&((a=(y=this.model)==null?void 0:y.address)!=null&&a.pCode4&&(this.model.household.pCode4=this.model.address.pCode4,this.model.household.admin4=this.model.address.admin4),this.model.household.fullAddress=this.formatAddress(this.model.household,"en"),this.model.household.translation.uk.fullAddress=this.formatAddress(this.model.household,"uk")),this.countFamilyStats(),this.model.familyMembersIds=this.createFamilyMembersIds(),this.model.taxIds=[C((p=this.model)==null?void 0:p.headOfHousehold),...(this.model.familyMembers||[]).map(C)].filter(Boolean);let s;try{if(!this.model.id){const{assistances:t}=this.$storage;s=await t.push(this.model)}this.model.id&&(s=await database.update(this.model.id,this.model))}catch(t){return this.$loading(!1),await this.$error(t)}this.$loading(!1),await this.$showResult(),this.model={},this.$emit("loadItems")}}},ie={key:0,class:"main-part"},de={class:"text-h5 mb-2 offset-md1 black--text"},re={class:"text-h5 mb-2 offset-md1 black--text"};function ne(e,s,m,c,y,a){const p=U,t=N,u=L,g=P,S=B,M=E,F=R,T=j;return h(),_(se,{"model-value":a.dialog,class:q(["assistance-dialog",{"poc-dialog":e.$vuetify.display.xs}]),"content-class":"poc-dialog",scrollable:"",persistent:"",overlay:!1,"max-width":"500px",transition:"slide-x-reverse-transition"},{default:l(()=>[i(K,{tile:"",class:"fill-height"},{default:l(()=>[i(Q,{"primary-title":""},{default:l(()=>[n(o(e.$t("Add")),1)]),_:1}),a.model.headOfHousehold?(h(),_(X,{key:0,class:"pt-4",style:{"font-size":"0.875rem"}},{default:l(()=>[i(p,{modelValue:a.model.headOfHousehold,"onUpdate:modelValue":s[0]||(s[0]=d=>a.model.headOfHousehold=d),onSetId:s[1]||(s[1]=d=>a.model.householdId=d),onSetFamilyMembers:s[2]||(s[2]=d=>a.model.familyMembers=d),onSetHousehold:s[3]||(s[3]=d=>a.model.household=d),householdId:a.model.householdId},null,8,["modelValue","householdId"]),a.model.householdId?(h(),b("div",ie,[i(t,{modelValue:a.model,"onUpdate:modelValue":s[4]||(s[4]=d=>a.model=d)},null,8,["modelValue"]),i(u,{modelValue:a.model.address,"onUpdate:modelValue":s[5]||(s[5]=d=>a.model.address=d)},null,8,["modelValue"]),a.model.headOfHousehold?(h(),_(g,{key:0,modelValue:a.model.headOfHousehold,"onUpdate:modelValue":s[6]||(s[6]=d=>a.model.headOfHousehold=d)},null,8,["modelValue"])):f("",!0),a.model.household?(h(),_(S,{key:1,modelValue:a.model.household,"onUpdate:modelValue":s[7]||(s[7]=d=>a.model.household=d),householdId:a.model.householdId},null,8,["modelValue","householdId"])):f("",!0),i(M,{modelValue:a.model.familyMembers,"onUpdate:modelValue":s[8]||(s[8]=d=>a.model.familyMembers=d)},null,8,["modelValue"]),i(F,{modelValue:a.model,"onUpdate:modelValue":s[9]||(s[9]=d=>a.model=d)},null,8,["modelValue"]),i(V,{class:"mb-4 mt-4"},{default:l(()=>[i(v,{cols:"12"},{default:l(()=>[r("div",de,o(e.$t("Signature")),1),r("div",null,o(e.$t("Please sign the completed form")),1)]),_:1}),i(v,{cols:"12"},{default:l(()=>[i(T,{modelValue:a.model.signature,"onUpdate:modelValue":s[10]||(s[10]=d=>a.model.signature=d),mode:"edit"},null,8,["modelValue"])]),_:1})]),_:1}),i(V,{class:"mb-4 mt-4"},{default:l(()=>[i(v,{cols:"12"},{default:l(()=>[r("div",re,o(e.$t("Comment")),1),r("div",null,o(e.$t("You can add any additional comment")),1)]),_:1}),i(v,{cols:"12"},{default:l(()=>[i(te,{modelValue:a.model.comment,"onUpdate:modelValue":s[11]||(s[11]=d=>a.model.comment=d),variant:"underlined"},null,8,["modelValue"])]),_:1})]),_:1})])):f("",!0)]),_:1})):f("",!0),i(ee,null,{default:l(()=>[a.canEdit&&a.model.id?(h(),_(w,{key:0,onClick:a.removeData,color:"error",variant:"tonal",class:"ml-4"},{default:l(()=>[n(o(e.$t("Delete")),1)]),_:1},8,["onClick"])):f("",!0),i(ae),i(w,{onClick:s[12]||(s[12]=d=>this.model={}),color:"orange darken-2",variant:"text"},{default:l(()=>[n(o(e.$t("Cancel")),1)]),_:1}),a.canEdit?(h(),_(w,{key:1,onClick:a.saveData,color:"primary",variant:"tonal",class:"mr-4"},{default:l(()=>[n(o(e.$t("Save")),1)]),_:1},8,["onClick"])):f("",!0)]),_:1})]),_:1})]),_:1},8,["model-value","class"])}const me=k(oe,[["render",ne]]),O={New:"green-darken-2",Duplicated:"red-darken-2"},ue=e=>O[e]?O[e]:"grey-darken-2",he={name:"CashCustomTable",props:{items:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},hasAddress:{type:Boolean},publicId:{type:String}},computed:{itemList(){return this.items?this.items.map((e,s)=>({title:e.key,value:`item.${e.key}`,align:"center"})):[]},headers(){const e=[{title:"",align:"center",value:"synced"},{title:"Tax ID",align:"start",value:"taxId",sortable:!0},{title:"Name",align:"start",value:"name",sortable:!0},{title:"Place of Origin",align:"start",value:"origin",sortable:!0},{title:"Phone",align:"start",value:"phone"},this.hasAddress?{title:"Address",align:"start",value:"household"}:!1,{title:"Male, <18",align:"center",value:"familyStats.boys"},{title:"Female, <18",align:"center",value:"familyStats.girls"},{title:"Male, 18-60",align:"center",value:"familyStats.men"},{title:"Female, 18-60",align:"center",value:"familyStats.women"},{title:"Male, 60+",align:"center",value:"familyStats.seniorMen"},{title:"Female, 60+",align:"center",value:"familyStats.seniorWomen"},{title:"People with disabilities",align:"center",value:"familyStats.disabled"},{title:"Value",align:"center",value:"value"},{title:"Currency",align:"center",value:"currency"},{title:"Start date",align:"start",value:"attendedFrom"},{title:"End date",align:"start",value:"attendedTo"},{title:"Comment",align:"start",value:"comment"}].filter(Boolean);return e.push(...this.itemList),e}},methods:{getChipColor:ue,async loadItems(){this.$refs.mainTable.loadItems()},formatAddress:H,formatPrice:Y,formatDate:G}},fe=["onClick"],ce={class:"text-no-wrap"},pe={class:"text-no-wrap"},_e={class:"text-no-wrap"},ye={class:"text-no-wrap"},ge={key:0,class:"text-no-wrap"},be=["href"],ve={class:"text-no-wrap"},Ve={key:0,class:"text-no-wrap"},we={key:0,class:"text-no-wrap"};function Se(e,s,m,c,y,a){const p=le;return e.appStore.loading?f("",!0):(h(),_(p,{key:0,title:e.$t("Receivers"),headers:a.headers,filters:m.filters,"sort-by":{key:"createdAt",sort:"asc"},"search-keys":["headOfHousehold.fullName","headOfHousehold.translation.uk.fullName","headOfHousehold.taxId","headOfHousehold.passport"],index:"date",class:"cash-custom-table",ref:"mainTable",table:"assistances"},Z({"item.synced":l(({item:t})=>[r("div",null,[r("div",{onClick:u=>e.$emit("editData",t)},[i(w,{icon:"mdi-pencil",size:"x-small",color:"grey",variant:"tonal"})],8,fe)])]),"item.taxId":l(({item:t})=>{var u;return[n(o((u=t.headOfHousehold)!=null&&u.taxId?t.headOfHousehold.taxId:t.headOfHousehold.passport),1)]}),"item.value":l(({item:t})=>[r("span",ce,o(a.formatPrice(t.value)),1)]),"item.attendedFrom":l(({item:t})=>[r("span",pe,o(a.formatDate(t.attendedFrom)),1)]),"item.attendedTo":l(({item:t})=>[r("span",_e,o(a.formatDate(t.attendedTo)),1)]),"item.name":l(({item:t})=>[r("span",ye,o(t.headOfHousehold?e.$_translate(t.headOfHousehold).fullName:""),1)]),"item.origin":l(({item:t})=>{var u,g;return[(u=t.headOfHousehold)!=null&&u.origin?(h(),b("span",ge,o(e.$t(((g=t.headOfHousehold)==null?void 0:g.origin)||""))+" "+o(["UA80","UA01"].includes(t.origin)?"":e.$t("oblast")),1)):f("",!0)]}),"item.phone":l(({item:t})=>[(h(!0),b(J,null,I(t.headOfHousehold.phone,u=>(h(),b("div",null,[r("a",{href:`tel:${u}`,class:"text-no-wrap"},o(u),9,be)]))),256))]),"item.household":l(({item:t})=>[r("span",ve,o(a.formatAddress(t.household)),1)]),"item.familyStats.girls":l(({item:t})=>[n(o(t.familyStats.girls),1)]),"item.familyStats.boys":l(({item:t})=>[n(o(t.familyStats.boys),1)]),"item.familyStats.men":l(({item:t})=>[n(o(t.familyStats.men),1)]),"item.familyStats.women":l(({item:t})=>[n(o(t.familyStats.women),1)]),"item.familyStats.seniorMen":l(({item:t})=>[n(o(t.familyStats.seniorMen),1)]),"item.familyStats.seniorWomen":l(({item:t})=>[n(o(t.familyStats.seniorWomen),1)]),"item.familyStats.disabled":l(({item:t})=>[n(o(t.familyStats.disabled),1)]),"item.attendedFrom":l(({item:t})=>[t.attendedFrom?(h(),b("span",Ve,o(new Date(t.attendedFrom).toLocaleDateString("uk")),1)):f("",!0)]),"item.attendedTo":l(({item:t})=>[t.attendedTo?(h(),b("span",we,o(new Date(t.attendedTo).toLocaleDateString("uk")),1)):f("",!0)]),_:2},[I(m.items,t=>({name:`item.item.${t.key}`,fn:l(({item:u})=>{var g;return[n(o(Array.isArray(u.items)?(g=u.items.find(S=>S.key===t.key))==null?void 0:g.value:0),1)]})}))]),1032,["title","headers","filters"]))}const ke=k(he,[["render",Se]]),A={name:"request",inject:["$confirm","$error","$loading","$showResult"],data:()=>({filters:void 0,assistance:void 0}),created(){this.init()},computed:{title(){this.filters||(this.appStore.breadcrumb="New cash intervention");const{date:e}=this.filters;return this.appStore.breadcrumb="Cash interventions",this.$t("Cash intervention",{date:new Date(e).toLocaleDateString("uk")})}},methods:{async init(){const e=this.$route.query;e["address.pCode4"]=e.pCode4,delete e.pCode4,this.filters=e,this.appStore.loading=!1},loadItems(){this.$refs.cashTable.loadItems()},editData(e){this.assistance=e}}},$e={class:"report pa-2"},Ce={class:"text-h4 font-weight-bold"},Ie={class:"bg-grey-lighten-4 pa-4 d-flex w-100 justify-space-between"},De={class:"mb-1"},Oe={class:"mb-1"},He={class:"mb-1"};function Ae(e,s,m,c,y,a){const p=ke,t=me;return h(),b("div",$e,[i(V,{class:"mb-0 mt-0"},{default:l(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:l(()=>[r("div",Ce,o(a.title||e.$t("Cash interventions")),1)]),_:1})]),_:1}),i(V,{class:"mb-0 mt-0"},{default:l(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:l(()=>[r("div",Ie,[r("div",null,[r("p",De,[r("strong",null,o(e.$t("Assistance type"))+":",1),n(" "+o(e.$t(e.filters.bundleName)),1)]),r("p",Oe,[r("strong",null,o(e.$t("Distribution modality"))+":",1),n(" "+o(e.$t(e.filters.distributionModality)),1)]),r("p",He,[r("strong",null,o(e.$t("Population type"))+":",1),n(" "+o(e.$t(e.filters.populationType)),1)]),r("p",null,[r("strong",null,o(e.$t("Locality"))+":",1),n(" "+o(e.$t(e.filters["address.pCode4"])),1)])]),r("div",null,[i(w,{to:"/cash",color:"primary"},{default:l(()=>[n(o(e.$t("Close")),1)]),_:1})])])]),_:1})]),_:1}),i(V,{class:"mb-0 mt-0"},{default:l(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:l(()=>[e.filters?(h(),_(p,{key:0,ref:"cashTable",onEditData:a.editData,filters:e.filters},null,8,["onEditData","filters"])):f("",!0)]),_:1})]),_:1}),i(t,{modelValue:e.assistance,"onUpdate:modelValue":s[0]||(s[0]=u=>e.assistance=u),onLoadItems:a.loadItems},null,8,["modelValue","onLoadItems"])])}typeof D=="function"&&D(A);const Vt=k(A,[["render",Ae]]);export{Vt as default};

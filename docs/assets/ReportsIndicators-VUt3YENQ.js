import{_ as A}from"./CustomTableHeaderStatic--V9Vxjnk.js";import{d as T}from"./debouncer-Whu4ZLob.js";import{_ as $,a6 as k,o as r,F as m,c as h,w as s,a as n,B as u,aa as N,x as P,C as y,A as p,y as V,z as C,G as D,H as _,n as I,a4 as E,aL as L,aM as O}from"./index-BYWsBYtF.js";import{d as B}from"./index-D0pvfY44.js";import{a as R,b as M,V as S}from"./VBtn-DEU8AXzn.js";import{V as v}from"./VRow-D5QUgmxK.js";import{V as x}from"./VDataTableVirtual-BO58bCzO.js";import{V as F,a as U}from"./VToolbar-Jw3O4Zrq.js";import{d as H}from"./VList-wnBQ6eUC.js";import{V as z}from"./VTextField-CLSPMm7c.js";import{V as G}from"./VTooltip-CKohhaj7.js";var J={IS_TEST:!0,FRONT_HOST:"https://raisplus-test.unhcr.in.ua",STATIC_ASSETS_PATH:"http://localhost:3000/static/",MS_APP_CLIENT_ID:"4f92930c-13d8-4c36-95d6-2f2d31727e6e",MS_APP_AUTHORITY:"https://login.microsoftonline.com/e5c37981-6664-4134-8a0c-6543d2af80be",BYPASS_MSAL:!0,LOCALE:"uk-ua",LANGUAGE:"uk",BACKEND_HOST:"http://localhost:3000/api/v1",APP_NAME:"rais-plus",APP_SHORTNAME:"RAIS+",APP_FULLNAME:"RAIS+ Ukraine Assistance Monitoring System",APP_DEFAULT_THEME:"gsc",APP_KEY:"UicablEChAKeyNOmerYONYmIkIMELACIstioNIUMItIcARterm"};const Y={name:"ReportsIndicators",mounted(){},props:{data:{type:Array,default:()=>[]},loading:{type:Boolean}},computed:{filteredData(){if(!this.search)return this.data;const t=new RegExp(this.search.replace(/[.?*{}\[\]()<>]/g,""),"gi");return this.data.filter(i=>{const l=JSON.parse(JSON.stringify(i));return l.admin1=this.$t(l.pCode4.substring(0,4)),l.admin2=this.$t(l.pCode4.substring(0,6)),l.admin3=this.$t(l.pCode4.substring(0,9)),l.admin4=this.$t(l.pCode4),JSON.stringify(l).match(t)})},headers(){return[{title:"Organisation name",align:"left",value:"organization.name",sortable:!1},{title:"Location Oblast",align:"left",value:"address.pCode1",sortable:!0,filterable:!0,type:"term"},{title:"Location Raion",align:"left",value:"address.pCode2",sortable:!0,filterable:!0,type:"term"},{title:"Location Hromada",align:"left",value:"address.pCode3",sortable:!0,filterable:!0,type:"term"},{title:"Location Settlement",align:"left",value:"address.pCode4",sortable:!0,filterable:!0,type:"term"},{title:"Location Site",align:"left",value:"collectiveCenter.name",sortable:!1},{title:"Reporting Month",align:"left",value:"date",sortable:!1},{title:"Indicators Output",align:"left",value:"output",sortable:!1},{title:"Indicators Indicator",align:"left",value:"indicator",sortable:!1},{title:"PoC Category",align:"left",value:"populationType",sortable:!1},{title:"Modality",align:"left",value:"distributionModality",sortable:!1},{title:"Households",align:"center",value:"households",sortable:!1},{title:"Total Individuals",align:"center",value:"familySize",sortable:!1},{title:"Girls (<18)",align:"center",value:"girls",sortable:!1},{title:"Boys (<18)",align:"center",value:"boys",sortable:!1},{title:"Women (18-59)",align:"center",value:"women",sortable:!1},{title:"Men (18-59)",align:"center",value:"men",sortable:!1},{title:"Elderly women (60+)",align:"center",value:"seniorWomen",sortable:!1},{title:"Elderly men (60+)",align:"center",value:"seniorMen",sortable:!1},{title:"People with disabilities",align:"center",value:"disabled",sortable:!1}]}},data:()=>({search:void 0,searchInput:void 0,datatable:{search:"",searchKeys:[],start:void 0,end:void 0,filters:{},sortBy:[{date:"asc"}]}}),methods:{setSearch:T(function(t){this.search=t}),getFileName(){var f,g,o,c;const t=((g=(f=this.appStore)==null?void 0:f.user)==null?void 0:g.name)||"User",i=((c=(o=this.appStore)==null?void 0:o.user)==null?void 0:c.email)||"no@email";return`${new Date().toLocaleDateString("sv")} - Distribution indicators ${t} (${i}).xlsx`},exportData(){const t={IDPs:"IDP","Non-displaced":"Non-displaced person",Returnees:"Returnee"};let i=JSON.parse(JSON.stringify(this.filteredData));const l=`${J.FRONT_HOST}/export/export.xlsx`,f=this.getFileName(),g=this.headers.map(e=>e.title).filter(e=>e!=="Download"),o=this.headers.map(e=>e.value).filter(e=>e!=="_id");i=i.map(e=>{var d;return e.populationType=t[e.populationType],(d=e==null?void 0:e.collectiveCenter)!=null&&d.code&&(e.collectiveCenter.name=[e.collectiveCenter.name,e.collectiveCenter.code].join("_")),e.collectiveCenter.code||(e.collectiveCenter={name:"N/A"}),e.address.pCode1=this.$t(e.address.pCode1,"en")+"_"+this.$t(e.address.pCode1,"uk"),e.address.pCode2=this.$t(e.address.pCode2,"en")+"_"+this.$t(e.address.pCode2,"uk"),e.address.pCode3=this.$t(e.address.pCode3,"en")+"_"+e.address.pCode3+"_"+this.$t(e.address.pCode3,"uk"),e.address.pCode4=this.$t(e.address.pCode4,"en")+"_"+e.address.pCode4+"_"+this.$t(e.address.pCode4,"uk"),e});const c=o.map(e=>i.map(d=>k(e,d)));(async()=>await B(l,{headers:g,columns:c},f))()}}},K={class:"report-summary"},X={class:"text-no-wrap"},W={key:0},j={key:0},q={key:0},Q={key:0};function Z(t,i,l,f,g,o){const c=A;return r(),m("div",K,[l.loading?(r(),h(v,{key:0,class:"text-center"},{default:s(()=>[n(R,{size:"48",indeterminate:"",color:"primary"})]),_:1})):u("",!0),l.loading?u("",!0):(r(),h(v,{key:1},{default:s(()=>[n(x,{"sort-by":t.datatable.sortBy,"onUpdate:sortBy":i[3]||(i[3]=a=>t.datatable.sortBy=a),"items-per-page":0,height:t.$vuetify.display.height-390<320?320:t.$vuetify.display.height-390,headers:o.headers,items:o.filteredData,loading:l.loading,"loading-text":t.$t("Loading... Please wait"),"items-per-page-text":t.$t("Records per page"),"item-value":"_id","hide-default-footer":""},N({top:s(()=>[P(n(F,{flat:"",color:"white"},{default:s(()=>[n(U,{style:{"min-width":"150px"}},{default:s(()=>[y(p(t.$t("Summary")),1)]),_:1}),n(H,{class:"mx-4",inset:"",vertical:""}),n(z,{modelValue:t.search,"onUpdate:modelValue":[i[0]||(i[0]=a=>t.search=a),o.setSearch],class:"mr-4 w-100",variant:"outlined",density:"compact",label:t.$t("Search"),"hide-details":"","prepend-icon":"mdi-magnify"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:1},512),[[V,!t.$vuetify.display.xs]])]),headers:s(({columns:a,toggleSort:e})=>[C("tr",null,[(r(!0),m(D,null,_(a,d=>(r(),h(c,{key:d.key,onSetSort:i[1]||(i[1]=b=>t.datatable.sortBy=[b]),onSetFilter:i[2]||(i[2]=b=>t.setFilter(b)),column:d,"parent-items":o.filteredData,datatable:t.datatable},null,8,["column","parent-items","datatable"]))),128))])]),"item._id":s(({item:a})=>[n(M,null,{default:s(()=>[n(G,{text:t.$t("Export to Excel")},{activator:s(({props:e})=>[a.isDonnation?u("",!0):(r(),h(S,I({key:0},e,{onClick:d=>t.createXLSX(a),size:"small",rounded:"2",variant:"text",color:"green-darken-2",icon:"mdi-file-excel-box"}),null,16,["onClick"]))]),_:2},1032,["text"])]),_:2},1024)]),"item.publicId":s(({item:a})=>[C("strong",X,p(a.publicId),1)]),"item.address.pCode1":s(({item:a})=>{var e;return[(e=a.address)!=null&&e.pCode4?(r(),m("span",W,p(t.$t(a.address.pCode4.substring(0,4))),1)):u("",!0)]}),"item.address.pCode2":s(({item:a})=>{var e;return[(e=a.address)!=null&&e.pCode4?(r(),m("span",j,p(t.$t(a.address.pCode4.substring(0,6))),1)):u("",!0)]}),"item.address.pCode3":s(({item:a})=>{var e;return[(e=a.address)!=null&&e.pCode4?(r(),m("span",q,p(t.$t(a.address.pCode4.substring(0,9))),1)):u("",!0)]}),"item.address.pCode4":s(({item:a})=>{var e;return[(e=a.address)!=null&&e.pCode4?(r(),m("span",Q,p(t.$t(a.address.pCode4)),1)):u("",!0)]}),"item.date":s(({item:a})=>[y(p(new Date(a.date).toLocaleDateString("sv").substring(0,7)),1)]),"no-data":s(()=>[C("div",null,p(t.$t("No data found")),1)]),_:2},[_(t.$slots,(a,e)=>({name:e,fn:s(d=>[E(t.$slots,e,L(O(d||{})))])}))]),1032,["sort-by","height","headers","items","loading","loading-text","items-per-page-text"])]),_:3})),l.loading?u("",!0):(r(),h(v,{key:2,class:"text-right"},{default:s(()=>[n(S,{onClick:o.exportData,color:"primary"},{default:s(()=>[y(p(t.$t("Export")),1)]),_:1},8,["onClick"])]),_:1}))])}const pe=$(Y,[["render",Z]]);export{pe as _};

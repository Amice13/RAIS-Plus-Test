import{_ as Ve}from"./CustomDate-BvE_k-Ie.js";import{d as X}from"./debouncer-Whu4ZLob.js";import{_ as Y,o as u,F as _,z as v,A as h,c as f,w as n,a as i,C as m,B as b,x as S,y as x,G as I,H as O,a8 as Se,p as xe,h as we,aG as Pe,b as T,t as k,ai as Be,L as Ie,l as Fe,n as C,aa as Te,a4 as K,aL as Ce,aM as De}from"./index-BYWsBYtF.js";import{V,o as _e}from"./index-CqdMy8lr.js";import{V as Oe}from"./VMenu-BAWQ3Wct.js";import{V as Z,a as $,b as je}from"./VCard-C8It3tDs.js";import{V as w,a as Ue}from"./VBtn-DEU8AXzn.js";import{V as Re}from"./VContainer-rOsYQHyZ.js";import{a as Ne,V as q}from"./VRow-D5QUgmxK.js";import{V as j}from"./VTextField-CLSPMm7c.js";import{V as Ae,a as Ee,b as Le,d as ee}from"./VList-wnBQ6eUC.js";import{V as Ge}from"./VChip-BnTEbD1P.js";import{V as te}from"./VSpacer-D4hnwTqC.js";import{d as ze}from"./searchProcessor-BfIe0Ps2.js";import{q as He,m as Ke,r as qe,c as Je,d as Me,s as We,e as Qe,u as Xe,p as Ye,f as Ze,t as $e,h as et,i as tt,j as at,k as lt,v as J,l as M,n as W,a as Q}from"./VDataTable-DS7yi-Dm.js";import{V as st,a as rt}from"./VToolbar-Jw3O4Zrq.js";const D=e=>{const[t,a]=e.split(/\./g);return a==="0"||t.length===3?t:e},it=e=>e/10**9>1?D((e/10**9).toFixed(1))+"B":e/10**6>1?D((e/10**6).toFixed(1))+"M":e/10**3>1?D((e/10**3).toFixed(1))+"K":e,nt={name:"CustomTableHeader",props:{table:{type:String},index:{type:String},column:{type:Object,default:{}},datatable:{type:Object,default:{}}},data(){return{loading:!1,search:void 0,items:[],menu:!1}},computed:{title(){let e=this.column.value;return this.column.translated&&this.$i18n.locale!=="en"&&(e=this.column.translated),e},key(){return this.column.filterId||this.column.value},startDate:{get(){return this.datatable.start},set(e){this.$emit("setStart",e)}},endDate:{get(){return this.datatable.end},set(e){this.$emit("setEnd",e)}},showItems(){if(!this.search)return this.items;const e=new RegExp(this.search.replace(/[|\\{}()[\]^$+*?.]/g,".").replace(/-/g,"\\-"),"gi");return this.items.filter(t=>{var l;let a=t.title.replace("@","＠");return this.$i18n.locale!=="en"&&((l=this.column)!=null&&l.translated)?a.match(e):this.$t(a).match(e)})},filterIsSet(){var e,t,a,l;return(t=(e=this.datatable)==null?void 0:e.filters)!=null&&t[this.key]?(l=(a=this.datatable)==null?void 0:a.filters)==null?void 0:l[this.key].length:!1}},methods:{setSearch:X(function(e){if(!menu)return!1;this.loadItems()}),async loadItems(){var o,g,s;if(!((o=this.column)!=null&&o.filterable)||this.column.type==="date")return!1;this.loading=!0;let e=this.$storage[this.table];if(this.index&&(e=e.useIndex(this.index)),this.datatable.filters){const d={...this.datatable.filters};delete d[this.key],Object.keys(d).length&&(e=e.filter(d))}if(this.search&&(e=e.should({[this.title]:{$regex:this.search}})),this.datatable.end||this.datatable.start){const d=Object.fromEntries([["$lte",this.datatable.end],["$gte",this.datatable.start]].filter(([,c])=>c));e=e.filter({date:d})}e=e.sort([{value:"desc"},{[this.key]:"asc"}]);const t={groupBy:[this.key],aggs:{value:{variable:"id",operation:"count"}}};this.column.filterId&&t.groupBy.push(this.title);let a=await e.aggregate(t);a=a.map(d=>(d.key||(d.key=d[this.key],d.title=d[this.title]),d));const l=a.map(d=>d.key),r=((s=(g=this.datatable)==null?void 0:g.filters)==null?void 0:s[this.key])||[];for(let d of r)l.includes(d)||a.push({key:d,value:0});this.items=a,this.loading=!1},isSorted({value:e}){var a,l,r,o;return(a=this.datatable)!=null&&a.sortBy?(Array.isArray((l=this.datatable)==null?void 0:l.sortBy)?(r=this.datatable)==null?void 0:r.sortBy[0]:(o=this.datatable)==null?void 0:o.sortBy).key===e:!1},isFiltered({value:e}){var t;if(!((t=this.datatable)!=null&&t.filters))return!1;for(let[a,l]of Object.entries(this.datatable.filters))if(a===e&&l.length)return!0},getIcon(e){var t,a;return this.isSorted(e)?(Array.isArray(this.datatable.sortBy)?(t=this.datatable)==null?void 0:t.sortBy[0]:(a=this.datatable)==null?void 0:a.sortBy).order==="desc"?"mdi-sort-descending":"mdi-sort-ascending":this.isFiltered(e)?"mdi-filter":"mdi-chevron-down"},setSort(e){this.$emit("setSort",{key:this.title,order:e}),this.menu=!1},hasFilter(e){var t,a,l,r;return(a=(t=this.datatable)==null?void 0:t.filters)!=null&&a[this.key]?(r=(l=this.datatable)==null?void 0:l.filters)==null?void 0:r[this.key].includes(e):!1},switchFilter(e){const t={...this.datatable.filters};t[this.key]=t[this.key]||[];let a=t[this.key].indexOf(e);return a>=0?(t[this.key].splice(a,1),t[this.key].length||delete t[this.key],this.$emit("setFilter",t)):(t[this.key].push(e),this.$emit("setFilter",t))},resetAllFilters(){const e=JSON.parse(JSON.stringify(this.datatable.filters));return delete e[this.key],this.$emit("setFilter",e)},simplifyCount:it},watch:{menu(e){this.search=void 0,e&&this.loadItems()}}},ot={class:"text-no-wrap bg-grey-lighten-3"},dt={class:"font-weight-bold"},ut={class:"mb-2"},mt={class:"text-center"},ft={style:{width:"36px"}};function ht(e,t,a,l,r,o){const g=Ve;return u(),_("td",ot,[v("div",{class:Se(["w-100 d-flex align-center",{"justify-center":a.column.align==="center","justify-end":a.column.align==="right"}])},[v("span",dt,h(e.$t(a.column.title)),1),a.column.sortable||a.column.filterable?(u(),f(w,{key:0,style:{"min-width":"0px"},class:"ml-2 pa-2",size:"small",variant:"text",elevation:"0",color:o.isFiltered(a.column)?"primary":"black"},{default:n(()=>[i(V,null,{default:n(()=>[m(h(o.getIcon(a.column)),1)]),_:1}),i(Oe,{modelValue:r.menu,"onUpdate:modelValue":t[7]||(t[7]=s=>r.menu=s),"close-on-content-click":!1,activator:"parent",transition:"slide-y-transition"},{default:n(()=>[i(Z,{"max-width":"350",width:"350"},{default:n(()=>[i($,{class:"pa-0"},{default:n(()=>[a.column.sortable?(u(),f(w,{key:0,onClick:t[0]||(t[0]=s=>o.setSort("asc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:n(()=>[i(V,{class:"mr-2"},{default:n(()=>t[8]||(t[8]=[m("mdi-sort-ascending")])),_:1}),m(" "+h(e.$t("Sort ascending")),1)]),_:1})):b("",!0),a.column.sortable?(u(),f(w,{key:1,onClick:t[1]||(t[1]=s=>o.setSort("desc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:n(()=>[i(V,{class:"mr-2"},{default:n(()=>t[9]||(t[9]=[m("mdi-sort-descending")])),_:1}),m(" "+h(e.$t("Sort descending")),1)]),_:1})):b("",!0),a.column.filterable?(u(),f(Re,{key:2},{default:n(()=>[i(Ne,null,{default:n(()=>[i(q,{cols:"12"},{default:n(()=>[v("div",ut,[v("strong",null,h(e.$t("Filter").toUpperCase()),1)]),a.column.type==="date"?(u(),f(g,{key:0,modelValue:o.startDate,"onUpdate:modelValue":t[2]||(t[2]=s=>o.startDate=s),label:e.$t("Start date"),clearable:"",class:"mt-4"},null,8,["modelValue","label"])):b("",!0),a.column.type==="date"?(u(),f(g,{key:1,modelValue:o.endDate,"onUpdate:modelValue":t[3]||(t[3]=s=>o.endDate=s),clearable:"",label:e.$t("End date")},null,8,["modelValue","label"])):b("",!0),a.column.type==="term"?(u(),f(j,{key:2,modelValue:r.search,"onUpdate:modelValue":t[4]||(t[4]=s=>r.search=s),label:e.$t("Search"),variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue","label"])):b("",!0),a.column.type==="string"?(u(),f(j,{key:3,modelValue:r.search,"onUpdate:modelValue":[t[5]||(t[5]=s=>r.search=s),o.setSearch],label:e.$t("Search"),variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])):b("",!0)]),_:1}),a.column.type!=="date"?(u(),f(q,{key:0,cols:"12",class:"pa-0"},{default:n(()=>[S(v("div",mt,[i(Ue,{indeterminate:"",color:"primary"})],512),[[x,r.loading]]),S(i(Ae,{class:"custom-thumb",nav:"",density:"compact",lines:!1,"max-height":"200"},{default:n(()=>[(u(!0),_(I,null,O(o.showItems,s=>(u(),f(Ee,{onClick:d=>o.switchFilter(s.key),key:s.key,density:"compact"},{prepend:n(()=>[v("div",ft,[S(i(V,null,{default:n(()=>t[10]||(t[10]=[m("mdi-checkbox-blank-outline")])),_:2},1536),[[x,!o.hasFilter(s.key)]]),S(i(V,null,{default:n(()=>t[11]||(t[11]=[m("mdi-checkbox-outline")])),_:2},1536),[[x,o.hasFilter(s.key)]])])]),append:n(()=>[i(Ge,{size:"x-small"},{default:n(()=>[m(h(o.simplifyCount(s.value)),1)]),_:2},1024)]),default:n(()=>[i(Le,{class:"pr-2"},{default:n(()=>{var d;return[m(h(a.column.type==="term"?e.$t((d=s==null?void 0:s.title)==null?void 0:d.replace("@","＠")):s==null?void 0:s.title),1)]}),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},512),[[x,!r.loading]])]),_:1})):b("",!0)]),_:1})]),_:1})):b("",!0)]),_:1}),a.column.filterable?(u(),f(je,{key:0},{default:n(()=>[S(i(w,{onClick:o.resetAllFilters,size:"x-small"},{default:n(()=>[i(V,{class:"mr-2"},{default:n(()=>t[12]||(t[12]=[m("mdi-checkbox-blank-outline")])),_:1}),m(" "+h(e.$t("Reset all")),1)]),_:1},8,["onClick"]),[[x,o.filterIsSet]]),i(te),i(w,{onClick:t[6]||(t[6]=s=>r.menu=!1),size:"x-small"},{default:n(()=>[m(h(e.$t("Close")),1)]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["color"])):b("",!0)],2)])}const ct=Y(nt,[["render",ht]]),yt=xe({itemsLength:{type:[Number,String],required:!0},...He(),...Ke(),...qe()},"VDataTableServer"),bt=we()({name:"VDataTableServer",props:yt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,t){let{attrs:a,slots:l}=t;const{groupBy:r}=Je(e),{sortBy:o,multiSort:g,mustSort:s}=Me(e),{page:d,itemsPerPage:c}=We(e),{disableSort:p}=Pe(e),ae=T(()=>parseInt(e.itemsLength,10)),{columns:U,headers:le}=Qe(e,{groupBy:r,showSelect:k(e,"showSelect"),showExpand:k(e,"showExpand")}),{items:B}=Xe(e,U),{toggleSort:R}=Ye({sortBy:o,multiSort:g,mustSort:s,page:d}),{opened:se,isGroupOpen:re,toggleGroup:ie,extractRows:ne}=Ze({groupBy:r,sortBy:o,disableSort:p}),{pageCount:oe,setItemsPerPage:de}=$e({page:d,itemsPerPage:c,itemsLength:ae}),{flatItems:N}=et(B,r,se),{isSelected:ue,select:me,selectAll:fe,toggleSelect:he,someSelected:ce,allSelected:ye}=tt(e,{allItems:B,currentPage:B}),{isExpanded:be,toggleExpand:ge}=at(e),A=T(()=>ne(B.value));lt({page:d,itemsPerPage:c,sortBy:o,groupBy:r,search:k(e,"search")}),Be("v-data-table",{toggleSort:R,sortBy:o}),Ie({VDataTableRows:{hideNoData:k(e,"hideNoData"),noDataText:k(e,"noDataText"),loading:k(e,"loading"),loadingText:k(e,"loadingText")}});const y=T(()=>({page:d.value,itemsPerPage:c.value,sortBy:o.value,pageCount:oe.value,toggleSort:R,setItemsPerPage:de,someSelected:ce.value,allSelected:ye.value,isSelected:ue,select:me,selectAll:fe,toggleSelect:he,isExpanded:be,toggleExpand:ge,isGroupOpen:re,toggleGroup:ie,items:A.value.map(F=>F.raw),internalItems:A.value,groupedItems:N.value,columns:U.value,headers:le.value}));Fe(()=>{const F=J.filterProps(e),pe=M.filterProps(e),ve=W.filterProps(e),ke=Q.filterProps(e);return i(Q,C({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ke),{top:()=>{var P;return(P=l.top)==null?void 0:P.call(l,y.value)},default:()=>{var P,E,L,G,z,H;return l.default?l.default(y.value):i(I,null,[(P=l.colgroup)==null?void 0:P.call(l,y.value),!e.hideDefaultHeader&&i("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[i(M,C(pe,{sticky:e.fixedHeader}),l)]),(E=l.thead)==null?void 0:E.call(l,y.value),!e.hideDefaultBody&&i("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(L=l["body.prepend"])==null?void 0:L.call(l,y.value),l.body?l.body(y.value):i(W,C(a,ve,{items:N.value}),l),(G=l["body.append"])==null?void 0:G.call(l,y.value)]),(z=l.tbody)==null?void 0:z.call(l,y.value),(H=l.tfoot)==null?void 0:H.call(l,y.value)])},bottom:()=>l.bottom?l.bottom(y.value):!e.hideDefaultFooter&&i(I,null,[i(ee,null,null),i(J,F,{prepend:l["footer.prepend"]})])})})}}),gt={name:"CustomTable",props:{table:{type:String},index:{type:String},filters:{type:Object,default:()=>({})},sortBy:{type:Object},searchKeys:{type:Array,default:[]},title:{type:String,default:"Table"},headers:{type:Array,default:()=>[]},buttonIcon:{type:String},button:{type:String}},created(){let{query:e}=this.$route.query;if(e)return e=JSON.parse(atob(e)),this.datatable=e,!1;this.filters&&Object.keys(this.filters).length&&(this.datatable.filters=this.filters),this.datatable.searchKeys=this.searchKeys,this.sortBy&&(this.datatable.sortBy=[this.sortBy])},data(){return{datatable:{search:"",searchKeys:[],start:void 0,end:void 0,filters:{},page:1,itemsPerPage:20,totalItems:0,sortBy:void 0},search:void 0,loading:!1,items:[]}},computed:{translated(){return this.items.map(e=>this.$_translate(e))}},methods:{setSearch:X(function(e){this.datatable.search=e}),async loadItems(){this.loading=!0;let e=this.$storage[this.table];this.index&&(e=e.useIndex(this.index)),e=ze(e,this.datatable,this.searchKeys);const t=await e.find();t&&(this.items=t.items,this.datatable.totalItems=t.count),this.appStore.loading=!1,this.loading=!1},isSorted({value:e}){return this.sortBy.key===e},isFiltered({value:e}){if(!this.filters)return!1;for(let[t,a]of Object.entries(this.filters))if(t===e&&a.length)return!0},getIcon(e){return this.isSorted(e)?this.sortBy==="desc"?"mdi-sort-descending":"mdi-sort-ascending":this.isFiltered(e)?"mdi-filter":"mdi-chevron-down"},setFilter(e){this.datatable.filters=e,this.loadItems()}},watch:{filters:{handler(e){this.datatable.filters=e,this.loadItems()},deep:!0},"datatable.start"(){this.loadItems()},"datatable.end"(){this.loadItems()}}},pt={slot:"progress"};function vt(e,t,a,l,r,o){const g=ct;return u(),f(Z,{class:"custom-table"},{default:n(()=>[v("template",pt,[i(_e,{color:"blue",height:"10",indeterminate:""})]),i($,{class:"pa-0"},{default:n(()=>[i(bt,{"items-per-page":r.datatable.itemsPerPage,"onUpdate:itemsPerPage":t[6]||(t[6]=s=>r.datatable.itemsPerPage=s),"sort-by":r.datatable.sortBy,"onUpdate:sortBy":t[7]||(t[7]=s=>r.datatable.sortBy=s),page:r.datatable.page,"onUpdate:page":t[8]||(t[8]=s=>r.datatable.page=s),search:r.datatable.search,headers:a.headers,"items-length":r.datatable.totalItems,items:o.translated,loading:r.loading,"loading-text":e.$t("Loading... Please wait"),"items-per-page-text":e.$t("Records per page"),"item-value":"_id","onUpdate:options":o.loadItems},Te({top:n(()=>[S(i(st,{flat:"",color:"white"},{default:n(()=>[i(rt,{style:{"min-width":"150px"}},{default:n(()=>[m(h(a.title),1)]),_:1}),i(ee,{class:"mx-4",inset:"",vertical:""}),i(j,{modelValue:r.search,"onUpdate:modelValue":[t[0]||(t[0]=s=>r.search=s),o.setSearch],class:"mr-4 w-100",variant:"outlined",density:"compact",label:e.$t("Search"),"hide-details":"","prepend-icon":"mdi-magnify"},null,8,["modelValue","onUpdate:modelValue","label"]),i(te),K(e.$slots,"action-btn",{},()=>[S(i(w,{onClick:t[1]||(t[1]=s=>e.$emit("btnClick")),color:"primary",variant:"flat"},{default:n(()=>[i(V,{left:""},{default:n(()=>t[9]||(t[9]=[m("mdi-plus")])),_:1}),m(" "+h(a.button),1)]),_:1},512),[[x,a.button]])])]),_:3},512),[[x,!e.$vuetify.display.xs]])]),headers:n(({columns:s,toggleSort:d})=>[v("tr",null,[(u(!0),_(I,null,O(s,c=>(u(),f(g,{key:c.key,onSetSort:t[2]||(t[2]=p=>r.datatable.sortBy=[p]),onSetFilter:t[3]||(t[3]=p=>o.setFilter(p)),onSetStart:t[4]||(t[4]=p=>r.datatable.start=p),onSetEnd:t[5]||(t[5]=p=>r.datatable.end=p),table:a.table,column:c,index:a.index,datatable:r.datatable},null,8,["table","column","index","datatable"]))),128))])]),"no-data":n(()=>[v("div",null,h(e.$t("No data found")),1)]),_:2},[O(e.$slots,(s,d)=>({name:d,fn:n(c=>[K(e.$slots,d,Ce(De(c||{})))])}))]),1032,["items-per-page","sort-by","page","search","headers","items-length","items","loading","loading-text","items-per-page-text","onUpdate:options"])]),_:3})]),_:3})}const Rt=Y(gt,[["render",vt]]);export{Rt as _};

import{_,a as $}from"./CustomDistributionModality-DJ1Ty53G.js";import{_ as C}from"./ReportsLinks-CiinT4Th.js";import{_ as N}from"./CustomDate-CfhxorUI.js";import{_ as I}from"./CustomBundle-Cn7PVTFG.js";import{_ as L,d as M,x as y}from"./index-Dr3A69Vy.js";import{d as O}from"./xlsx-template-browser-scOJpVFS.js";import{d as z}from"./dot-object-sCKibp8s.js";import{a9 as E,a3 as k,u as i,a4 as m,a6 as g,W as b,Q as R,S as B}from"./@vue-CVhpfiSJ.js";import{b as D}from"./route-block-B_A1xBdJ.js";import{z as f,l as T,m as U,A as h,Q as A,R as W}from"./vuetify-8yKwgmF2.js";import"./CustomTableHeaderStatic-BjFfQxyZ.js";import"./debouncer-Whu4ZLob.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@turf-BykKS3Vs.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./uuid-C6aID195.js";import"./jszip-B9I6jZYU.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";var F={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const V={name:"reports",beforeMount(){var e,n,a,l,o;const t=localStorage.getItem("unhcr-rais-plus-recent-report");t||(this.filters["organization.id"]=(a=(n=(e=this.appStore)==null?void 0:e.user)==null?void 0:n.organization)==null?void 0:a.id,this.filters.date.$gte=new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),this.filters.date.$lte=new Date().toLocaleDateString("sv-SE")),this.organizations=[(o=(l=this.appStore)==null?void 0:l.user)==null?void 0:o.organization].filter(Boolean),t&&Object.assign(this.filters,JSON.parse(t)),this.getFiltersData(),this.appStore.loading=!1},computed:{isAdmin(){var t,e,n;return(n=(e=(t=this.appStore)==null?void 0:t.user)==null?void 0:e.role)==null?void 0:n.includes("Admin")},summaryHeaders(){return[]},indicatorsHeaders(){return[]},requiredFiltersAreSet(){return this.isAdmin?!0:[this.filters["organization.id"],this.filters.bundleName,this.filters.distributionModality].filter(Boolean).length===3}},data:()=>({organizations:[],filters:{"organization.id":void 0,bundleName:"SN101-2024",aor:[],distributionModality:"In-kind",populationType:[],date:{$lte:void 0,$gte:void 0},pCode1:void 0,pCode2:void 0,pCode3:void 0,pCode4:void 0},includeDonations:!1,summary:[],summaryLoading:!0,indicators:[],indicatorsLoading:!0}),methods:{async getFiltersData(){const{organizations:t}=this.$storage,e=await t.slice(0,500).filter({functionalType:["UN Agency","Operational partner","Implementing partner"]}).include(["id","name","translation.uk.name"]).sort([{name:"asc"}]).find();this.organizations=e.items},async getSummary(){if(this.summaryLoading=!0,!this.requiredFiltersAreSet)return this.summaryLoading=!1;let{assistances:t}=this.$storage;t=t.useIndex("bundleName");const e=Object.fromEntries(Object.entries(this.filters).filter(([,a])=>a));t.filter(e);let n=await t.aggregate({groupBy:["date","address.pCode4","collectiveCenter.name","organization.name","publicId"],aggs:{"familyStats.households":{variable:"address.pCode1",operation:"count"},"familyStats.all":{variable:"familyStats.all",operation:"sum"},"familyStats.girls":{variable:"familyStats.girls",operation:"sum"},"familyStats.boys":{variable:"familyStats.boys",operation:"sum"},"familyStats.men":{variable:"familyStats.men",operation:"sum"},"familyStats.women":{variable:"familyStats.women",operation:"sum"},"familyStats.seniorMen":{variable:"familyStats.seniorMen",operation:"sum"},"familyStats.seniorWomen":{variable:"familyStats.seniorWomen",operation:"sum"},"familyStats.disabled":{variable:"familyStats.disabled",operation:"sum"},"familyStats.vulnerable":{variable:"familyStats.vulnerable",operation:"sum"},items:{variable:"items",operation:"nested",nested:{groupBy:["key"],aggs:{value:{variable:"value",operation:"sum"}}}},strings:{variable:"strings",operation:"nested",nested:{groupBy:["key"],aggs:{value:{variable:"value",operation:"count"}}}},value:{variable:"value",operation:"sum"}}});if(n=n.map(a=>{var l,o,s,u,p,d;return a=z.object(a),a.items&&(a.items=y(a.items)),a.strings&&(a.strings=y(a.strings)),a.address.pCode1=(o=(l=a.address)==null?void 0:l.pCode4)==null?void 0:o.substring(0,4),a.address.pCode2=(u=(s=a.address)==null?void 0:s.pCode4)==null?void 0:u.substring(0,6),a.address.pCode3=(d=(p=a.address)==null?void 0:p.pCode4)==null?void 0:d.substring(0,9),a}),this.includeDonations){const a=Object.fromEntries([["bundleName",this.filters.bundleName],["distributionModality",this.filters.distributionModality],["organization.id",this.filters["organization.id"]]].filter(([,s])=>s)),{donations:l}=this.$storage,o=await l.useIndex("bundleName").filter({...a,date:{$lte:this.endDate,$gte:this.startDate}}).include(["publicId","familyStats","items","households","date","address","collectiveCenter"]).find();n.push(...o.items.map(s=>(s.isDonnation=!0,s.items=y(s.items),s.familyStats.households=s.households,s)))}this.summary=n,this.summaryLoading=!1},async getIndicators(){this.indicatorsLoading=!0;let e=(await this.$api.data.getIndicators({startDate:this.startDate,endDate:this.endDate})).data;e=e.map(d=>d);const n=`${F.FRONT_HOST}/export/export.xlsx`,a="Indicators report.xlsx",l=[["orangization","Organisation Name"],["region","Location Region"],["raion","Location Raion"],["hromada","Location Hromada"],["settlement","Location Settlement"],["collectiveCenter","Location Site"],["month","Reporting Month"],["output","Indicators Output"],["indicator","Indicators Indicator"],["nonKit","Kit-NonKit Kit-NonKit"],["populationType","PoC Category PoC Category"],["modality","Modality Modality"],["households","Households"],["girls","GIRLS (<18 years)"],["boys","BOYS (<18 years)"],["women","WOMEN (18-59 years)"],["men","MEN (18-59 years)"],["seniorWomen","ELDERLY WOMEN (60+)"],["seniorMen","ELDERLY MEN (60+)"],["disabled","PEOPLE WITH DISABILITIES"]];this.filters.distributionModality!=="In-kind"&&l.push(["value","Value"]);const o=l.map(d=>d[1]),u=l.map(d=>d[0]).map(d=>e.map(c=>M(d,c)));(async()=>await O(n,{headers:o,columns:u},a))(),this.indicatorsLoading=!1},getData(){this.getSummary()}},watch:{filters:{deep:!0,handler(t){localStorage.setItem("unhcr-rais-plus-recent-report",JSON.stringify(t)),this.getData()}}}},H={class:"reports pa-2"},j={class:"text-h5 mb-2 offset-md1 black--text"},K={class:"text-h5 mb-2 offset-md1 black--text"};function w(t,e,n,a,l,o){const s=I,u=_,p=N,d=C,c=$;return k(),E("div",H,[i(h,{class:"mb-0 mt-0"},{default:m(()=>[i(f,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:m(()=>[i(T,null,{default:m(()=>[i(U,null,{default:m(()=>[i(h,null,{default:m(()=>[i(f,{cols:"12",md:"3",class:"pl-md-4"},{default:m(()=>[g("div",j,b(t.$t("Filters")),1),g("div",null,b(t.$t("Define the filters for your report")),1),g("div",null,[i(A,{modelValue:t.filters["organization.id"],"onUpdate:modelValue":e[0]||(e[0]=r=>t.filters["organization.id"]=r),label:t.$t("Organization"),items:t.organizations,"item-title":r=>{var S,v;return t.$i18n.locale==="en"?r.name:((v=(S=r.translation)==null?void 0:S[t.$i18n.locale])==null?void 0:v.name)||""},clearable:o.isAdmin,"item-value":"id",class:"mt-4",variant:"underlined"},null,8,["modelValue","label","items","item-title","clearable"]),i(s,{modelValue:t.filters.bundleName,"onUpdate:modelValue":e[1]||(e[1]=r=>t.filters.bundleName=r)},null,8,["modelValue"]),i(u,{class:"mt-4",modelValue:t.filters.distributionModality,"onUpdate:modelValue":e[2]||(e[2]=r=>t.filters.distributionModality=r)},null,8,["modelValue"]),i(p,{modelValue:t.filters.date.$gte,"onUpdate:modelValue":[e[3]||(e[3]=r=>t.filters.date.$gte=r),o.getData],label:t.$t("Start of report period"),class:"mt-4"},null,8,["modelValue","onUpdate:modelValue","label"]),i(p,{modelValue:t.filters.date.$lte,"onUpdate:modelValue":[e[4]||(e[4]=r=>t.filters.date.$lte=r),o.getData],label:t.$t("End of report period")},null,8,["modelValue","onUpdate:modelValue","label"]),R(i(W,{modelValue:t.includeDonations,"onUpdate:modelValue":[e[5]||(e[5]=r=>t.includeDonations=r),o.getData],label:t.$t("Include donations")},null,8,["modelValue","onUpdate:modelValue","label"]),[[B,t.filters.distributionModality==="In-kind"]])])]),_:1}),i(f,{cols:"12",md:"9",class:"pr-md-4"},{default:m(()=>[i(h,null,{default:m(()=>[i(d),i(f,{cols:"12"},{default:m(()=>[g("div",K,b(t.$t("Distribution summary")),1)]),_:1}),i(f,null,{default:m(()=>[i(c,{data:t.summary,filters:t.filters,startDate:t.filters.date.$gte,endDate:t.filters.date.$lte,loading:t.summaryLoading},null,8,["data","filters","startDate","endDate","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof D=="function"&&D(V);const Et=L(V,[["render",w]]);export{Et as default};

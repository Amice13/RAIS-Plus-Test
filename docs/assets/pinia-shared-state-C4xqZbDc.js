import{B as O}from"./broadcast-channel-TeH36tNo.js";function b(i,t={serialize:JSON.stringify,deserialize:JSON.parse}){return t.deserialize(t.serialize(i))}function M(i,t){return Object.keys(t).includes(i)}function x({enable:i=!0,initialize:t=!0,type:z,serializer:u}){return({store:s,options:e})=>{var d,f,m;const $=((d=e==null?void 0:e.share)==null?void 0:d.enable)??i,g=((f=e==null?void 0:e.share)==null?void 0:f.omit)??[];if(!$)return;const l=new O(s.$id,{type:z});let r=0,c=!1;const y=Object.keys(s.$state).filter(a=>!g.includes(a)&&M(a,s.$state));l.onmessage=a=>{if(a===void 0){l.postMessage({timestamp:r,state:b(s.$state,u)});return}a.timestamp<=r||(c=!0,r=a.timestamp,s.$patch(n=>{y.forEach(h=>{n[h]=a.state[h]})}))},(((m=e==null?void 0:e.share)==null?void 0:m.initialize)??t)&&l.postMessage(void 0),s.$subscribe((a,n)=>{c||(r=Date.now(),l.postMessage({timestamp:r,state:b(n,u)})),c=!1})}}export{x as P};

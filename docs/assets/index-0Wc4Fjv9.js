import{_ as y,F as _,o as m,a as i,x as u,w as a,z as $,B as x,Z as S,$ as z,c as w,y as f,C}from"./index-BtIo2-Z_.js";import{V as b}from"./index-C5-hvfiu.js";import{V as D}from"./VProgressCircular-DNPB7izS.js";import{a as L,V as O}from"./VCard-DNHZbZ5d.js";import{a as h,V as d}from"./VRow-9vAZildp.js";import{V as j}from"./index-SDX8Otz2.js";import{V as k}from"./VSkeletonLoader-BkKepelc.js";import{V as A}from"./VTooltip-DXl_TsVy.js";import{b as N}from"./route-block-B_A1xBdJ.js";import"./VAvatar-l5UJO0sV.js";import"./VImg-FY_z5S7Z.js";/* empty css              */import"./VOverlay-BnbjS8dz.js";import"./forwardRefs--KQCZfKO.js";let V={};const F=({title:t,description:o,color:e,data:n,$t:s})=>({title:{text:s(t),subtext:s(o),left:"left"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:n.map(r=>r.name)},yAxis:{type:"value"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{show:!0,left:"right",top:"top",feature:{restore:{},saveAsImage:{}}},series:[{color:e,data:n.map(r=>r.value),type:"line"}]}),I={name:"SingleMap",props:{entity:{type:String,default:"assistances"},title:{type:String,default:"Barchart"},filter:{type:Object},description:{type:String,default:""},groupBy:{type:Array,default(){return["address.pCode1"]}},value:{type:Object,default(){return{variable:"address.pCode1",operation:"count"}}}},mounted(){this.id="div"+Math.random();const t=this.$refs.chart;V[this.id]=S(t),this.getData()},data(){return{id:null,isLoading:!0}},methods:{async getData(){const t=this.$vuetify.theme.current.colors.primary;let e=this.$storage[this.entity];this.filter&&(e=e.filter(this.filter)),e=await e.sort([{date:"asc"}]).aggregate({groupBy:this.groupBy,aggs:{value:this.value}}),e=e.map(s=>{let r=this.groupBy.map(l=>s[l.replace(/\$.*/,"")]).filter(Boolean).map(l=>this.$t(l)).join(" - ");return r.length>18&&(r=r.slice(0,18)+"..."),s.name=r,s});const n=F({title:this.title,description:this.description,color:t,data:e,$t:this.$t});V[this.id].setOption(n),this.isLoading=!1}}},T={class:"single-map align-center justify-center custom-chart align-center",style:{"aspect-ratio":"8/3",position:"relative"}},R={"leave-absolute":"",class:"chart-loader text-center w-100 h-100"},q={ref:"chart",class:"h-100"};function E(t,o,e,n,s,r){return m(),_("div",T,[i(b,null,{default:a(()=>[$(u("div",R,[i(D,{color:"primary",size:"56",indeterminate:""})],512),[[x,s.isLoading]])]),_:1}),u("div",q,null,512)])}const H=y(I,[["render",E]]);let g={};const J=({title:t,description:o,color:e,data:n,$t:s})=>({responsive:!0,maintainAspectRatio:!1,title:{text:s(t),subtext:s(o),left:"left"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",axisLabel:{formatter:r=>{let l=s(r);return l.length>18&&(l=l.slice(0,18)+"..."),l}},data:n.map(r=>r.name)},toolbox:{show:!0,left:"right",top:"top",feature:{restore:{},saveAsImage:{}}},series:[{name:"Direct",type:"bar",color:e,label:{show:!0},emphasis:{focus:"series"},data:n.map(r=>r.value)}]}),K={name:"SingleBar",props:{entity:{type:String,default:"assistances"},title:{type:String,default:"Barchart"},filter:{type:Object},description:{type:String,default:"Custom barchart"},groupBy:{type:Array,default(){return["address.pCode1"]}},value:{type:Object,default(){return{variable:"address.pCode1",operation:"count"}}}},mounted(){this.id="div"+Math.random();const t=this.$refs.chart;g[this.id]=S(t),this.getData()},data(){return{id:null,height:"250px",isLoading:!0}},methods:{async getData(){const t=this.$vuetify.theme.current.colors.primary;let e=this.$storage[this.entity];this.filter&&(e=e.filter(this.filter)),e=await e.sort([{value:"asc"}]).aggregate({groupBy:this.groupBy,aggs:{value:this.value}}),e=e.map(r=>{let l=this.groupBy.map(c=>r[c]).filter(Boolean).map(c=>this.$t(c)).join(" - ");return r.name=l,r});const n=e.length*26;this.height=(n>240?n:240)+"px",g[this.id].resize({height:this.height});const s=J({title:this.title,description:this.description,color:t,data:e,$t:this.$t});g[this.id].setOption(s),this.isLoading=!1},changeParams(){const t=g[this.id].getOption();t.title.text=this.$t(this.title),t.title.subtext=this.$t(this.description),g[this.id].setOption(t,{notMerge:!1,replaceMerge:[]})}},watch:{"$i18n.locale"(){this.changeParams()}}},U={"leave-absolute":"",class:"chart-loader text-center w-100 h-100"},W={ref:"chart",class:"h-100"};function Z(t,o,e,n,s,r){return m(),_("div",{class:"single-barchart align-center justify-center custom-chart align-center",style:z({height:s.height})},[i(b,null,{default:a(()=>[$(u("div",U,[i(D,{color:"primary",size:"56",indeterminate:""})],512),[[x,s.isLoading]])]),_:1}),u("div",W,null,512)],4)}const G=y(K,[["render",Z]]);let v={};const B={adm1:"address.pCode1",adm2:"address.pCode2",adm3:"address.pCode3"},Q={adm1:"admin1Pcode",adm2:"admin2Pcode",adm3:"admin3Pcode"},X=({title:t,description:o,map:e,min:n,max:s,color:r,data:l,$t:c})=>({title:{text:c(t),subtext:c(o),left:"left"},tooltip:{trigger:"item",showDelay:0,transitionDuration:.2,backgroundColor:"rgba(50, 50, 50, 0.9)",borderWidth:0,textStyle:{color:"#DDD"},formatter:p=>p.data?`
          <strong>${c(p.name)}</strong><br/>
          ${c("Number")}: ${p.data.value||0}
        `:"No data"},visualMap:{type:"continuous",left:"right",seriesIndex:0,realtime:!0,min:n,max:s,range:null,inRange:{color:r},outOfRange:{color:"#eee"},calculable:!0},toolbox:{show:!0,left:"right",top:"top",feature:{restore:{},saveAsImage:{}}},series:[{name:t,type:"map",center:void 0,roam:!0,nameProperty:Q[e],map:e,label:{formatter:p=>c(p.data.name)},emphasis:{label:{show:!0}},data:l}]}),Y={name:"SingleMap",props:{entity:{type:String,required:!0},title:{type:String,default:"Map"},description:{type:String,default:"Map subtitle"},filter:{type:Object},map:{type:String,default:"adm1"},value:{type:Object,default(){return{variable:"address.pCode1",operation:"count"}}}},mounted(){this.id="div"+Math.random();const t=this.$refs.chart;v[this.id]=S(t),this.getData()},data(){return{id:null,isLoading:!0}},methods:{async getData(){const t=[this.$vuetify.theme.current.colors["primary-lighten-4"],this.$vuetify.theme.current.colors.primary];let e=this.$storage[this.entity];this.filter&&(e=e.filter(this.filter)),e=await e.aggregate({groupBy:[B[this.map]],aggs:{value:this.value}}),e=e.map(c=>(c.name=c[B[this.map]],c));const n=e.map(c=>c.value),s=Math.max(...n),r=Math.min(...n),l=X({title:this.title,description:this.description,map:this.map,min:r,max:s,color:t,data:e,$t:this.$t});v[this.id].setOption(l),this.isLoading=!1},changeParams(){const t=v[this.id].getOption();t.title.text=this.$t(this.title),t.title.subtext=this.$t(this.description),v[this.id].setOption(t,{notMerge:!1,replaceMerge:[]})}},watch:{"$i18n.locale"(){this.changeParams()}}},tt={class:"single-map align-center justify-center custom-chart align-center",style:{"aspect-ratio":"4/3",position:"relative"}},et={"leave-absolute":"",class:"chart-loader text-center w-100 h-100"},it={ref:"chart",class:"h-100"};function at(t,o,e,n,s,r){return m(),_("div",tt,[i(b,null,{default:a(()=>[$(u("div",et,[i(D,{color:"primary",size:"56",indeterminate:""})],512),[[x,s.isLoading]])]),_:1}),u("div",it,null,512)])}const st=y(Y,[["render",at]]),rt=t=>isNaN(t)?"-":(t=parseFloat(t),t<1e3?t.toString():t<1e6?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t<1e9?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":(t/1e9).toFixed(1).replace(/\.0$/,"")+"B"),ot=t=>isNaN(t)?"-":(t=parseFloat(t),t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:1})),nt={props:{entity:{type:String,required:!0},filter:{type:Object},description:{type:String},valuePrefix:{type:String,default:""},valueSuffix:{type:String,default:""},icon:{type:String},aggs:{type:Object,required:!0}},mounted(){this.getData()},data(){return{instance:null,isLoading:!0,formattedNumber:"-",number:"-",tooltipValue:"-"}},methods:{async getData(){var n;let o=this.$storage[this.entity];this.filter&&(o=o.filter(this.filter)),o=await o.aggregate(this.aggs);const e=(n=o==null?void 0:o[0])==null?void 0:n.value;this.number=e||"-",this.formattedNumber=rt(this.number),this.tooltipValue=ot(this.number),this.isLoading=!1}},watch:{aggs:{deep:!0,handler(){this.getData()}}}},lt={class:"scorecard-description"},ct={key:1,class:"font-weight-black text-primary scorecard-number"};function dt(t,o,e,n,s,r){return m(),w(O,{class:"h-100 align-content-center"},{default:a(()=>[i(L,{class:"scorecard align-center align-content-center"},{default:a(()=>[i(h,{class:"h-100"},{default:a(()=>[i(d,{cols:"5",class:"text-center h-100"},{default:a(()=>[i(j,{icon:e.icon,size:36,color:"primary"},null,8,["icon"]),u("div",lt,f(e.description),1)]),_:1}),i(d,{cols:"7",class:"text-center align-center justify-center align-self-center h-100"},{default:a(()=>[i(b,{"hide-on-leave":""},{default:a(()=>[s.isLoading?(m(),w(k,{key:0,type:"chip"})):(m(),_("div",ct,[C(f(e.valuePrefix)+f(s.formattedNumber)+f(e.valueSuffix)+" ",1),i(A,{activator:"parent",location:"top"},{default:a(()=>[C(f(s.tooltipValue),1)]),_:1})]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const ut=y(nt,[["render",dt]]),P={name:"analytics",beforeMount(){var o,e,n,s,r;const t=localStorage.getItem("unhcr-rais-plus-recent-report");t||(this.filters["organization.id"]=(n=(e=(o=this.appStore)==null?void 0:o.user)==null?void 0:e.organization)==null?void 0:n.id,this.filters.date.$gte=new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),this.filters.date.$lte=new Date().toLocaleDateString("sv-SE")),this.organizations=[(r=(s=this.appStore)==null?void 0:s.user)==null?void 0:r.organization].filter(Boolean),t&&Object.assign(this.filters,JSON.parse(t)),this.appStore.loading=!1},computed:{isAdmin(){var t,o,e;return(e=(o=(t=this.appStore)==null?void 0:t.user)==null?void 0:o.role)==null?void 0:e.includes("Admin")}},data:()=>({organizations:[],filters:{"organization.id":void 0,bundleName:"SN101-2024",aor:[],distributionModality:"In-kind",populationType:[],date:{$lte:void 0,$gte:void 0},pCode1:void 0,pCode2:void 0,pCode3:void 0,pCode4:void 0},includeDonations:!1,summary:[],summaryLoading:!0,indicators:[],indicatorsLoading:!0}),methods:{}},pt={class:"reports pa-2"},ht={class:"text-h5 mb-2 offset-md1 black--text"};function ft(t,o,e,n,s,r){const l=ut,c=st,p=G,M=H;return m(),_("div",pt,[i(h,{class:"mb-0 mt-0"},{default:a(()=>[i(d,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:a(()=>[i(O,null,{default:a(()=>[i(L,null,{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"12",md:"3",class:"pl-md-4"},{default:a(()=>[u("div",ht,f(t.$t("Filters")),1),u("div",null,f(t.$t("Define the filters for your report")),1)]),_:1}),i(d,{cols:"12",md:"9",class:"pr-md-4"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"12"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"3"},{default:a(()=>[i(l,{entity:"assistances",aggs:{aggs:{value:{variable:"familyStats.all",operation:"sum"}}},description:t.$t("People reached"),icon:"mdi-account"},null,8,["description"])]),_:1}),i(d,{cols:"3"},{default:a(()=>[i(l,{entity:"assistances",aggs:{aggs:{value:{variable:"address.pCode1",operation:"count"}}},description:t.$t("Households"),icon:"mdi-home-city"},null,8,["description"])]),_:1}),i(d,{cols:"3"},{default:a(()=>[i(l,{entity:"assistances",aggs:{aggs:{value:{variable:"organization.id",operation:"countDistinct"}}},description:t.$t("Partners"),icon:"mdi-domain"},null,8,["description"])]),_:1}),i(d,{cols:"3"},{default:a(()=>[i(l,{entity:"assistances",aggs:{aggs:{value:{variable:"value",operation:"sum"}}},"value-prefix":"$",description:t.$t("Cash"),icon:"mdi-cash-check"},null,8,["description"])]),_:1})]),_:1})]),_:1}),i(d,{cols:"12"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"6"},{default:a(()=>[i(c,{entity:"assistances",title:"Partner presence",description:"Number of partners per region",map:"adm2",value:{variable:"organization.name",operation:"countDistinct"}})]),_:1}),i(d,{cols:"6"},{default:a(()=>[i(c,{entity:"assistances",title:"Activity coverage",description:"Types of activites per region",map:"adm3",value:{variable:"bundleName",operation:"countDistinct"}})]),_:1})]),_:1})]),_:1}),i(d,{cols:"12"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"6"},{default:a(()=>[i(p,{entity:"assistances",title:"People assisted by partner",description:"Number of people","group-by":["organization.name"],value:{variable:"organization.name",operation:"count"}})]),_:1}),i(d,{cols:"6"},{default:a(()=>[i(p,{entity:"assistances",title:"People assisted per activity",description:"Number of people","group-by":["bundleName"],value:{variable:"bundleName",operation:"count"}})]),_:1})]),_:1})]),_:1}),i(d,{cols:"12"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"12"},{default:a(()=>[i(M,{entity:"assistances",title:"Number of assistances","group-by":["date$day"],value:{variable:"familyMembersIds",operation:"count"}})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof N=="function"&&N(P);const Bt=y(P,[["render",ft]]);export{Bt as default};

import{i as $}from"./echarts-B3RPNoSA.js";import{a9 as y,a3 as g,u as i,a6 as p,a4 as a,Q as x,S,ab as V,a2 as w,W as m,Y as C}from"./@vue-CVhpfiSJ.js";import{_}from"./index-Dr3A69Vy.js";import{r as D,w as b,m as B,A as h,z as d,n as j,D as k,E as A,l as P}from"./vuetify-8yKwgmF2.js";import"./md5-Ct8Y5Pza.js";import"./jszip-B9I6jZYU.js";import"./dot-object-sCKibp8s.js";import{b as N}from"./route-block-B_A1xBdJ.js";import"./zrender-BxIUiisS.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@turf-BykKS3Vs.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./uuid-C6aID195.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";let L={};const F=({title:t,description:o,color:e,data:n,$t:s})=>({title:{text:s(t),subtext:s(o),left:"left"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:n.map(r=>r.name)},yAxis:{type:"value"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{show:!0,left:"right",top:"top",feature:{restore:{},saveAsImage:{}}},series:[{color:e,data:n.map(r=>r.value),type:"line"}]}),I={name:"SingleMap",props:{entity:{type:String,default:"assistances"},title:{type:String,default:"Barchart"},filter:{type:Object},description:{type:String,default:""},groupBy:{type:Array,default(){return["address.pCode1"]}},value:{type:Object,default(){return{variable:"address.pCode1",operation:"count"}}}},mounted(){this.id="div"+Math.random();const t=this.$refs.chart;L[this.id]=$(t),this.getData()},data(){return{id:null,isLoading:!0}},methods:{async getData(){const t=this.$vuetify.theme.current.colors.primary;let e=this.$storage[this.entity];this.filter&&(e=e.filter(this.filter)),e=await e.sort([{date:"asc"}]).aggregate({groupBy:this.groupBy,aggs:{value:this.value}}),e=e.map(s=>{let r=this.groupBy.map(l=>s[l.replace(/\$.*/,"")]).filter(Boolean).map(l=>this.$t(l)).join(" - ");return r.length>18&&(r=r.slice(0,18)+"..."),s.name=r,s});const n=F({title:this.title,description:this.description,color:t,data:e,$t:this.$t});L[this.id].setOption(n),this.isLoading=!1}}},T={class:"single-map align-center justify-center custom-chart align-center",style:{"aspect-ratio":"8/3",position:"relative"}},E={"leave-absolute":"",class:"chart-loader text-center w-100 h-100"},R={ref:"chart",class:"h-100"};function q(t,o,e,n,s,r){return g(),y("div",T,[i(b,null,{default:a(()=>[x(p("div",E,[i(D,{color:"primary",size:"56",indeterminate:""})],512),[[S,s.isLoading]])]),_:1}),p("div",R,null,512)])}const W=_(I,[["render",q]]);let f={};const H=({title:t,description:o,color:e,data:n,$t:s})=>({responsive:!0,maintainAspectRatio:!1,title:{text:s(t),subtext:s(o),left:"left"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",axisLabel:{formatter:r=>{let l=s(r);return l.length>18&&(l=l.slice(0,18)+"..."),l}},data:n.map(r=>r.name)},toolbox:{show:!0,left:"right",top:"top",feature:{restore:{},saveAsImage:{}}},series:[{name:"Direct",type:"bar",color:e,label:{show:!0},emphasis:{focus:"series"},data:n.map(r=>r.value)}]}),J={name:"SingleBar",props:{entity:{type:String,default:"assistances"},title:{type:String,default:"Barchart"},filter:{type:Object},description:{type:String,default:"Custom barchart"},groupBy:{type:Array,default(){return["address.pCode1"]}},value:{type:Object,default(){return{variable:"address.pCode1",operation:"count"}}}},mounted(){this.id="div"+Math.random();const t=this.$refs.chart;f[this.id]=$(t),this.getData()},data(){return{id:null,height:"250px",isLoading:!0}},methods:{async getData(){const t=this.$vuetify.theme.current.colors.primary;let e=this.$storage[this.entity];this.filter&&(e=e.filter(this.filter)),e=await e.sort([{value:"asc"}]).aggregate({groupBy:this.groupBy,aggs:{value:this.value}}),e=e.map(r=>{let l=this.groupBy.map(c=>r[c]).filter(Boolean).map(c=>this.$t(c)).join(" - ");return r.name=l,r});const n=e.length*26;this.height=(n>240?n:240)+"px",f[this.id].resize({height:this.height});const s=H({title:this.title,description:this.description,color:t,data:e,$t:this.$t});f[this.id].setOption(s),this.isLoading=!1},changeParams(){const t=f[this.id].getOption();t.title.text=this.$t(this.title),t.title.subtext=this.$t(this.description),f[this.id].setOption(t,{notMerge:!1,replaceMerge:[]})}},watch:{"$i18n.locale"(){this.changeParams()}}},K={"leave-absolute":"",class:"chart-loader text-center w-100 h-100"},Q={ref:"chart",class:"h-100"};function U(t,o,e,n,s,r){return g(),y("div",{class:"single-barchart align-center justify-center custom-chart align-center",style:V({height:s.height})},[i(b,null,{default:a(()=>[x(p("div",K,[i(D,{color:"primary",size:"56",indeterminate:""})],512),[[S,s.isLoading]])]),_:1}),p("div",Q,null,512)],4)}const Y=_(J,[["render",U]]);let v={};const O={adm1:"address.pCode1",adm2:"address.pCode2",adm3:"address.pCode3"},G={adm1:"admin1Pcode",adm2:"admin2Pcode",adm3:"admin3Pcode"},X=({title:t,description:o,map:e,min:n,max:s,color:r,data:l,$t:c})=>({title:{text:c(t),subtext:c(o),left:"left"},tooltip:{trigger:"item",showDelay:0,transitionDuration:.2,backgroundColor:"rgba(50, 50, 50, 0.9)",borderWidth:0,textStyle:{color:"#DDD"},formatter:u=>u.data?`
          <strong>${c(u.name)}</strong><br/>
          ${c("Number")}: ${u.data.value||0}
        `:"No data"},visualMap:{type:"continuous",left:"right",seriesIndex:0,realtime:!0,min:n,max:s,range:null,inRange:{color:r},outOfRange:{color:"#eee"},calculable:!0},toolbox:{show:!0,left:"right",top:"top",feature:{restore:{},saveAsImage:{}}},series:[{name:t,type:"map",center:void 0,roam:!0,nameProperty:G[e],map:e,label:{formatter:u=>c(u.data.name)},emphasis:{label:{show:!0}},data:l}]}),Z={name:"SingleMap",props:{entity:{type:String,required:!0},title:{type:String,default:"Map"},description:{type:String,default:"Map subtitle"},filter:{type:Object},map:{type:String,default:"adm1"},value:{type:Object,default(){return{variable:"address.pCode1",operation:"count"}}}},mounted(){this.id="div"+Math.random();const t=this.$refs.chart;v[this.id]=$(t),this.getData()},data(){return{id:null,isLoading:!0}},methods:{async getData(){const t=[this.$vuetify.theme.current.colors["primary-lighten-4"],this.$vuetify.theme.current.colors.primary];let e=this.$storage[this.entity];this.filter&&(e=e.filter(this.filter)),e=await e.aggregate({groupBy:[O[this.map]],aggs:{value:this.value}}),e=e.map(c=>(c.name=c[O[this.map]],c));const n=e.map(c=>c.value),s=Math.max(...n),r=Math.min(...n),l=X({title:this.title,description:this.description,map:this.map,min:r,max:s,color:t,data:e,$t:this.$t});v[this.id].setOption(l),this.isLoading=!1},changeParams(){const t=v[this.id].getOption();t.title.text=this.$t(this.title),t.title.subtext=this.$t(this.description),v[this.id].setOption(t,{notMerge:!1,replaceMerge:[]})}},watch:{"$i18n.locale"(){this.changeParams()}}},tt={class:"single-map align-center justify-center custom-chart align-center",style:{"aspect-ratio":"4/3",position:"relative"}},et={"leave-absolute":"",class:"chart-loader text-center w-100 h-100"},it={ref:"chart",class:"h-100"};function at(t,o,e,n,s,r){return g(),y("div",tt,[i(b,null,{default:a(()=>[x(p("div",et,[i(D,{color:"primary",size:"56",indeterminate:""})],512),[[S,s.isLoading]])]),_:1}),p("div",it,null,512)])}const st=_(Z,[["render",at]]),rt=t=>isNaN(t)?"-":(t=parseFloat(t),t<1e3?t.toString():t<1e6?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t<1e9?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":(t/1e9).toFixed(1).replace(/\.0$/,"")+"B"),ot=t=>isNaN(t)?"-":(t=parseFloat(t),t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:1})),nt={props:{entity:{type:String,required:!0},filter:{type:Object},description:{type:String},valuePrefix:{type:String,default:""},valueSuffix:{type:String,default:""},icon:{type:String},aggs:{type:Object,required:!0}},mounted(){this.getData()},data(){return{instance:null,isLoading:!0,formattedNumber:"-",number:"-",tooltipValue:"-"}},methods:{async getData(){var n;let o=this.$storage[this.entity];this.filter&&(o=o.filter(this.filter)),o=await o.aggregate(this.aggs);const e=(n=o==null?void 0:o[0])==null?void 0:n.value;this.number=e||"-",this.formattedNumber=rt(this.number),this.tooltipValue=ot(this.number),this.isLoading=!1}},watch:{aggs:{deep:!0,handler(){this.getData()}}}},lt={class:"scorecard-description"},ct={key:1,class:"font-weight-black text-primary scorecard-number"};function dt(t,o,e,n,s,r){return g(),w(P,{class:"h-100 align-content-center"},{default:a(()=>[i(B,{class:"scorecard align-center align-content-center"},{default:a(()=>[i(h,{class:"h-100"},{default:a(()=>[i(d,{cols:"5",class:"text-center h-100"},{default:a(()=>[i(j,{icon:e.icon,size:36,color:"primary"},null,8,["icon"]),p("div",lt,m(e.description),1)]),_:1}),i(d,{cols:"7",class:"text-center align-center justify-center align-self-center h-100"},{default:a(()=>[i(b,{"hide-on-leave":""},{default:a(()=>[s.isLoading?(g(),w(k,{key:0,type:"chip"})):(g(),y("div",ct,[C(m(e.valuePrefix)+m(s.formattedNumber)+m(e.valueSuffix)+" ",1),i(A,{activator:"parent",location:"top"},{default:a(()=>[C(m(s.tooltipValue),1)]),_:1})]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const pt=_(nt,[["render",dt]]),M={name:"analytics",beforeMount(){var o,e,n,s,r;const t=localStorage.getItem("unhcr-rais-plus-recent-report");t||(this.filters["organization.id"]=(n=(e=(o=this.appStore)==null?void 0:o.user)==null?void 0:e.organization)==null?void 0:n.id,this.filters.date.$gte=new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),this.filters.date.$lte=new Date().toLocaleDateString("sv-SE")),this.organizations=[(r=(s=this.appStore)==null?void 0:s.user)==null?void 0:r.organization].filter(Boolean),t&&Object.assign(this.filters,JSON.parse(t)),this.appStore.loading=!1},computed:{isAdmin(){var t,o,e;return(e=(o=(t=this.appStore)==null?void 0:t.user)==null?void 0:o.role)==null?void 0:e.includes("Admin")}},data:()=>({organizations:[],filters:{"organization.id":void 0,bundleName:"SN101-2024",aor:[],distributionModality:"In-kind",populationType:[],date:{$lte:void 0,$gte:void 0},pCode1:void 0,pCode2:void 0,pCode3:void 0,pCode4:void 0},includeDonations:!1,summary:[],summaryLoading:!0,indicators:[],indicatorsLoading:!0}),methods:{}},ut={class:"reports pa-2"},ht={class:"text-h5 mb-2 offset-md1 black--text"};function mt(t,o,e,n,s,r){const l=pt,c=st,u=Y,z=W;return g(),y("div",ut,[i(h,{class:"mb-0 mt-0"},{default:a(()=>[i(d,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:a(()=>[i(P,null,{default:a(()=>[i(B,null,{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"12",md:"3",class:"pl-md-4"},{default:a(()=>[p("div",ht,m(t.$t("Filters")),1),p("div",null,m(t.$t("Define the filters for your report")),1)]),_:1}),i(d,{cols:"12",md:"9",class:"pr-md-4"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"12"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"3"},{default:a(()=>[i(l,{entity:"assistances",aggs:{aggs:{value:{variable:"familyStats.all",operation:"sum"}}},description:t.$t("People reached"),icon:"mdi-account"},null,8,["description"])]),_:1}),i(d,{cols:"3"},{default:a(()=>[i(l,{entity:"assistances",aggs:{aggs:{value:{variable:"address.pCode1",operation:"count"}}},description:t.$t("Households"),icon:"mdi-home-city"},null,8,["description"])]),_:1}),i(d,{cols:"3"},{default:a(()=>[i(l,{entity:"assistances",aggs:{aggs:{value:{variable:"organization.id",operation:"countDistinct"}}},description:t.$t("Partners"),icon:"mdi-domain"},null,8,["description"])]),_:1}),i(d,{cols:"3"},{default:a(()=>[i(l,{entity:"assistances",aggs:{aggs:{value:{variable:"value",operation:"sum"}}},"value-prefix":"$",description:t.$t("Cash"),icon:"mdi-cash-check"},null,8,["description"])]),_:1})]),_:1})]),_:1}),i(d,{cols:"12"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"6"},{default:a(()=>[i(c,{entity:"assistances",title:"Partner presence",description:"Number of partners per region",map:"adm2",value:{variable:"organization.name",operation:"countDistinct"}})]),_:1}),i(d,{cols:"6"},{default:a(()=>[i(c,{entity:"assistances",title:"Activity coverage",description:"Types of activites per region",map:"adm3",value:{variable:"bundleName",operation:"countDistinct"}})]),_:1})]),_:1})]),_:1}),i(d,{cols:"12"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"6"},{default:a(()=>[i(u,{entity:"assistances",title:"People assisted by partner",description:"Number of people","group-by":["organization.name"],value:{variable:"organization.name",operation:"count"}})]),_:1}),i(d,{cols:"6"},{default:a(()=>[i(u,{entity:"assistances",title:"People assisted per activity",description:"Number of people","group-by":["bundleName"],value:{variable:"bundleName",operation:"count"}})]),_:1})]),_:1})]),_:1}),i(d,{cols:"12"},{default:a(()=>[i(h,null,{default:a(()=>[i(d,{cols:"12"},{default:a(()=>[i(z,{entity:"assistances",title:"Number of assistances","group-by":["date$day"],value:{variable:"familyMembersIds",operation:"count"}})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof N=="function"&&N(M);const Ut=_(M,[["render",mt]]);export{Ut as default};

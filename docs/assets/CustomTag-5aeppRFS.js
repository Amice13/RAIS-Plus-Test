import{d as Pe}from"./debouncer-Whu4ZLob.js";import{h as _e,p as Ae,aA as Re,r as K,s as P,u as ee,aB as Te,b as k,t as Ee,e as _,bb as le,W as te,au as Me,m as Be,a as s,G as H,bZ as Ke,q as D,bV as Le,C as N,S as Ne,bW as ae,b_ as Oe,_ as Ue,F as qe,o as ze,w as G,ac as We,z as ne,B as ue,x as oe,y as L,E as je}from"./index-BtIo2-Z_.js";import{u as He,t as A,V as Ge,a as Z,b as Ze}from"./VList-Cnqqz-5U.js";import{V as $e}from"./VProgressCircular-DNPB7izS.js";import{u as Je,d as Qe,e as Xe,h as Ye,f as el,m as ll}from"./filter-ahsWVyiP.js";import{V as ie,c as tl}from"./VTextField-Bn35T3UG.js";import{a as al,V as se,g as nl,s as ul}from"./index-SDX8Otz2.js";import{d as ol}from"./VInput-CRZE-Mt3.js";import{f as il}from"./forwardRefs--KQCZfKO.js";import{V as sl}from"./VMenu-Cs322VI3.js";import{a as rl}from"./VCheckboxBtn-DQUGWCnj.js";import{V as cl}from"./VAvatar-l5UJO0sV.js";import{V as vl}from"./VChip-CKNl8kC9.js";const dl=Ae({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...ll({filterKeys:["title"]}),...el({hideNoData:!0,returnObject:!0}),...Ne(tl({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...ul({transition:!1})},"VCombobox"),fl=_e()({name:"VCombobox",props:dl(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,V){var Q;let{emit:F,slots:o}=V;const{t:m}=Re(),f=K(),b=P(!1),y=P(!0),O=P(!1),$=K(),U=K(),i=P(-1);let q=!1;const{items:re,transformIn:ce,transformOut:ve}=He(e),{textColorClasses:de,textColorStyles:fe}=al(()=>{var l;return(l=f.value)==null?void 0:l.color}),n=ee(e,"modelValue",[],l=>ce(Te(l)),l=>{const t=ve(l);return e.multiple?t:t[0]??null}),R=ol(e),T=k(()=>!!(e.chips||o.chip)),C=k(()=>T.value||!!o.selection),w=P(!e.multiple&&!C.value?((Q=n.value[0])==null?void 0:Q.title)??"":""),d=k({get:()=>w.value,set:l=>{var t;if(w.value=l??"",!e.multiple&&!C.value&&(n.value=[A(e,l)]),l&&e.multiple&&((t=e.delimiters)!=null&&t.length)){const r=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));r.length>1&&(r.forEach(a=>{a=a.trim(),a&&p(A(e,a))}),w.value="")}l||(i.value=-1),y.value=!l}}),me=k(()=>typeof e.counterValue=="function"?e.counterValue(n.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?n.value.length:d.value.length),{filteredItems:E,getMatches:he}=Je(e,re,()=>y.value?"":d.value),S=k(()=>e.hideSelected?E.value.filter(l=>!n.value.some(t=>t.value===l.value)):E.value),M=k(()=>e.hideNoData&&!S.value.length||R.isReadonly.value||R.isDisabled.value),z=ee(e,"menu"),c=k({get:()=>z.value,set:l=>{var t;z.value&&!l&&((t=$.value)!=null&&t.Î¨openChildren.size)||l&&M.value||(z.value=l)}}),J=Ee(()=>c.value?e.closeText:e.openText);_(w,l=>{q?te(()=>q=!1):b.value&&!c.value&&(c.value=!0),F("update:search",l)}),_(n,l=>{var t;!e.multiple&&!C.value&&(w.value=((t=l[0])==null?void 0:t.title)??"")});const ge=k(()=>n.value.map(l=>l.value)),W=k(()=>{var t;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&d.value===((t=S.value[0])==null?void 0:t.title))&&S.value.length>0&&!y.value&&!O.value}),j=K(),be=Qe(j,f);function ye(l){q=!0,e.openOnClear&&(c.value=!0)}function Ve(){M.value||(c.value=!0)}function pe(l){M.value||(b.value&&(l.preventDefault(),l.stopPropagation()),c.value=!c.value)}function xe(l){var t;l.key!==" "&&ae(l)&&((t=f.value)==null||t.focus())}function Ce(l){var a,v,h,x;if(Oe(l)||R.isReadonly.value)return;const t=(a=f.value)==null?void 0:a.selectionStart,r=n.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(c.value=!0),["Escape"].includes(l.key)&&(c.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(W.value&&["Enter","Tab"].includes(l.key)&&!n.value.some(u=>{let{value:I}=u;return I===S.value[0].value})&&p(E.value[0]),y.value=!0),l.key==="ArrowDown"&&W.value&&((v=j.value)==null||v.focus("next")),l.key==="Enter"&&d.value&&(p(A(e,d.value)),C.value&&(w.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&C.value&&n.value.length>0&&!d.value)return p(n.value[0],!1);if(~i.value){l.preventDefault();const u=i.value;p(n.value[i.value],!1),i.value=u>=r-1?r-2:u}else l.key==="Backspace"&&!d.value&&(i.value=r-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(i.value<0&&t&&t>0)return;const u=i.value>-1?i.value-1:r-1;n.value[u]?i.value=u:(i.value=-1,(h=f.value)==null||h.setSelectionRange(d.value.length,d.value.length))}else if(l.key==="ArrowRight"){if(i.value<0)return;const u=i.value+1;n.value[u]?i.value=u:(i.value=-1,(x=f.value)==null||x.setSelectionRange(0,0))}else~i.value&&ae(l)&&(i.value=-1)}function ke(){var l;e.eager&&((l=U.value)==null||l.calculateVisibleItems())}function we(){var l;b.value&&(y.value=!0,(l=f.value)==null||l.focus())}function p(l){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const r=n.value.findIndex(v=>(e.valueComparator||le)(v.value,l.value)),a=t??!~r;if(~r){const v=a?[...n.value,l]:[...n.value];v.splice(r,1),n.value=v}else a&&(n.value=[...n.value,l]);e.clearOnSelect&&(d.value="")}else{const r=t!==!1;n.value=r?[l]:[],w.value=r&&!C.value?l.title:"",te(()=>{c.value=!1,y.value=!0})}}function Se(l){b.value=!0,setTimeout(()=>{O.value=!0})}function Ie(l){O.value=!1}function De(l){(l==null||l===""&&!e.multiple&&!C.value)&&(n.value=[])}return _(b,(l,t)=>{if(!(l||l===t)&&(i.value=-1,c.value=!1,d.value)){if(e.multiple){p(A(e,d.value));return}if(!C.value)return;n.value.some(r=>{let{title:a}=r;return a===d.value})?w.value="":p(A(e,d.value))}}),_(c,()=>{if(!e.hideSelected&&c.value&&n.value.length){const l=S.value.findIndex(t=>n.value.some(r=>(e.valueComparator||le)(r.value,t.value)));Me&&window.requestAnimationFrame(()=>{var t;l>=0&&((t=U.value)==null||t.scrollToIndex(l))})}}),_(()=>e.items,(l,t)=>{c.value||b.value&&!t.length&&l.length&&(c.value=!0)}),Be(()=>{const l=!!(!e.hideNoData||S.value.length||o["prepend-item"]||o["append-item"]||o["no-data"]),t=n.value.length>0,r=ie.filterProps(e);return s(ie,D({ref:f},r,{modelValue:d.value,"onUpdate:modelValue":[a=>d.value=a,De],focused:b.value,"onUpdate:focused":a=>b.value=a,validationValue:n.externalValue,counterValue:me.value,dirty:t,class:["v-combobox",{"v-combobox--active-menu":c.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!C.value,"v-combobox--selecting-index":i.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:R.isReadonly.value,placeholder:t?void 0:e.placeholder,"onClick:clear":ye,"onMousedown:control":Ve,onKeydown:Ce}),{...o,default:()=>s(H,null,[s(sl,D({ref:$,modelValue:c.value,"onUpdate:modelValue":a=>c.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:M.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:ke,onAfterLeave:we},e.menuProps),{default:()=>[l&&s(Ge,D({ref:j,selected:ge.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),onKeydown:xe,onFocusin:Se,onFocusout:Ie,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},be,e.listProps),{default:()=>{var a,v,h;return[(a=o["prepend-item"])==null?void 0:a.call(o),!S.value.length&&!e.hideNoData&&(((v=o["no-data"])==null?void 0:v.call(o))??s(Z,{key:"no-data",title:m(e.noDataText)},null)),s(Xe,{ref:U,renderless:!0,items:S.value,itemKey:"value"},{default:x=>{var Y;let{item:u,index:I,itemRef:g}=x;const X=D(u.props,{ref:g,key:u.value,active:W.value&&I===0?!0:void 0,onClick:()=>p(u,null)});return((Y=o.item)==null?void 0:Y.call(o,{item:u,index:I,props:X}))??s(Z,D(X,{role:"option"}),{prepend:B=>{let{isSelected:Fe}=B;return s(H,null,[e.multiple&&!e.hideSelected?s(rl,{key:u.value,modelValue:Fe,ripple:!1,tabindex:"-1"},null):void 0,u.props.prependAvatar&&s(cl,{image:u.props.prependAvatar},null),u.props.prependIcon&&s(se,{icon:u.props.prependIcon},null)])},title:()=>{var B;return y.value?u.title:Ye("v-combobox",u.title,(B=he(u))==null?void 0:B.title)}})}}),(h=o["append-item"])==null?void 0:h.call(o)]}})]}),n.value.map((a,v)=>{function h(g){g.stopPropagation(),g.preventDefault(),p(a,!1)}const x={"onClick:close":h,onKeydown(g){g.key!=="Enter"&&g.key!==" "||(g.preventDefault(),g.stopPropagation(),h(g))},onMousedown(g){g.preventDefault(),g.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},u=T.value?!!o.chip:!!o.selection,I=u?Le(T.value?o.chip({item:a,index:v,props:x}):o.selection({item:a,index:v})):void 0;if(!(u&&!I))return s("div",{key:a.value,class:["v-combobox__selection",v===i.value&&["v-combobox__selection--selected",de.value]],style:v===i.value?fe.value:{}},[T.value?o.chip?s(nl,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[I]}):s(vl,D({key:"chip",closable:e.closableChips,size:"small",text:a.title,disabled:a.props.disabled},x),null):I??s("span",{class:"v-combobox__selection-text"},[a.title,e.multiple&&v<n.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[N(",")])])])})]),"append-inner":function(){var x,u;for(var a=arguments.length,v=new Array(a),h=0;h<a;h++)v[h]=arguments[h];return s(H,null,[(x=o["append-inner"])==null?void 0:x.call(o,...v),(!e.hideNoData||e.items.length)&&e.menuIcon?s(se,{class:"v-combobox__menu-icon",color:(u=f.value)==null?void 0:u.fieldIconColor,icon:e.menuIcon,onMousedown:pe,onClick:Ke,"aria-label":m(J.value),title:m(J.value),tabindex:"-1"},null):void 0])}})}),il({isFocused:b,isPristine:y,menu:c,search:d,selectionIndex:i,filteredItems:E,select:p},f)}}),ml=Pe(function(e){this.getTags()}),hl={name:"CustomTag",props:{modelValue:{type:Array,default:()=>[]},entity:{type:String},field:{type:String,default:"tags"},label:{type:String},hint:{type:String}},data(){return{search:"",tags:[],loading:!1}},methods:{remove(e){this.search||(this.model.splice(this.model.length-1,1),this.$refs.tag.$el.querySelector("input").focus())},async getTags(){if(this.search.length<3)return[];this.loading=!0;const V=await this.$storage[this.entity].include(["tags"]).filter({tags:{$contains:this.search}}).find();this.tags=V.items.map(F=>F.tags).flat(),this.loading=!1}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},translatedLabel(){return this.label||this.$t("Tags")}},watch:{search:ml}},gl={class:"tag"};function bl(e,V,F,o,m,f){var b;return ze(),qe("div",gl,[s(fl,{modelValue:f.model,"onUpdate:modelValue":V[0]||(V[0]=y=>f.model=y),ref:"tag",search:m.search,"onUpdate:search":V[1]||(V[1]=y=>m.search=y),onKeyup:je(f.remove,["delete"]),items:m.tags,"hide-no-data":!((b=m.search)!=null&&b.length),hint:F.hint,label:f.translatedLabel,loading:m.loading,variant:"underlined",clearable:"",chips:"",multiple:"","hide-selected":""},{"no-data":G(()=>[s(Z,{class:We({"text-center":m.loading})},{default:G(()=>[ne(s($e,{class:"margin-auto",indeterminate:"",color:"primary"},null,512),[[ue,m.loading]]),ne(s(Ze,null,{default:G(()=>[N(L(e.$t("No results matching"))+' "',1),oe("strong",null,L(m.search),1),N('". '+L(e.$t("Press"))+" ",1),V[2]||(V[2]=oe("kbd",null,"Enter",-1)),N(" "+L(e.$t("to create a new one")),1)]),_:1},512),[[ue,!m.loading]])]),_:1},8,["class"])]),_:1},8,["modelValue","search","onKeyup","items","hide-no-data","hint","label","loading"])])}const Al=Ue(hl,[["render",bl]]);export{fl as V,Al as _};

import{_ as O}from"./CustomTable-CzX_aHyy.js";import{_ as C}from"./ImportUploadBox-0LEvgHz0.js";import{_ as D}from"./CustomDate-CLArRqjL.js";import{p as N,a as R}from"./importProcessor-Cg8urtX2.js";import{b as v}from"./route-block-B_A1xBdJ.js";import{_ as S,F as b,o as u,a as s,w as t,x as n,y as o,c as _,A as c,a8 as p,C as i}from"./index-BtIo2-Z_.js";import{V as r,a as m}from"./VRow-9vAZildp.js";import{V as $,a as k}from"./VCard-DNHZbZ5d.js";import{V as g}from"./VBtn--bGuKZaN.js";import"./debouncer-Whu4ZLob.js";import"./index-SDX8Otz2.js";import"./VMenu-Cs322VI3.js";import"./VOverlay-BnbjS8dz.js";import"./forwardRefs--KQCZfKO.js";import"./dialog-transition-Dq7CKyny.js";import"./VContainer-BFGIFtcM.js";/* empty css              */import"./VTextField-Bn35T3UG.js";import"./index-C5-hvfiu.js";import"./VInput-CRZE-Mt3.js";import"./VImg-FY_z5S7Z.js";import"./VProgressCircular-DNPB7izS.js";import"./VList-Cnqqz-5U.js";import"./VAvatar-l5UJO0sV.js";import"./VChip-CKNl8kC9.js";import"./group-DgRBM2CV.js";import"./VSpacer-bp7-SSB-.js";import"./searchProcessor-BfIe0Ps2.js";import"./VDataTable-BrBBORsC.js";import"./VPagination-zp71F-1D.js";import"./filter-ahsWVyiP.js";import"./VCheckboxBtn-DQUGWCnj.js";import"./VToolbar-o4oksDe3.js";import"./xlsx-CILBIiVl.js";import"./index-CebfcyPH.js";const y={created(){this.appStore.breadcrumb="Delete cash assistances"},name:"deleteCash",inject:["$confirm","$error","$loading","$showResult"],data:()=>({loading:!1,date:void 0,rows:[],hashes:void 0,headers:[{title:"",align:"center",value:"synced"},{title:"Tax ID",align:"start",value:"headOfHousehold.taxId",sortable:!0},{title:"Passport",align:"start",value:"headOfHousehold.passport",sortable:!0},{title:"Name",align:"start",value:"headOfHousehold.fullName",sortable:!0},{title:"Phone",align:"start",value:"headOfHousehold.phone"},{title:"Value",align:"center",value:"value",sortable:!0,align:"end"},{title:"Currency",align:"center",value:"currency"},{title:"Start date",align:"start",value:"attendedFrom"},{title:"End date",align:"start",value:"attendedTo"},{title:"Comment",align:"start",value:"comment"}]}),methods:{processRecords(){if(!this.date)return!1;let e=N(this.rows);e.data.map(d=>(d.date=this.date,d.organization=this.appStore.user.organization,d)),e=R(e.data);const l=e.map(d=>d.hash);this.hashes=l},formatNumber(e){return new Intl.NumberFormat("fr-FR").format(e)},formatPhone(e){return e?e==null?void 0:e.join(", "):""},async deleteRecords(){if(!await this.$confirm({title:"Delete entity",description:"Would you like to save the entity?"}))return!1;let l;try{const{assistances:d}=this.$storage;l=await d.useIndex("hash").filter({hash:this.hashes}).delete()}catch(d){return console.log(d),await this.$error(d),!1}if(this.$loading(!1),!l)return!1;await this.$showResult(),this.$router.push("/cash")}}},I={class:"report pa-2"},F={class:"text-h4 font-weight-bold"},T={class:"text-h5 mb-2 offset-md1 black--text"},P={class:"text-h5 mb-2 offset-md1 black--text"},B={class:"text-no-wrap"},A={class:"text-no-wrap"},U={class:"text-no-wrap"},j={key:0,class:"text-no-wrap"},z={key:0,class:"text-no-wrap"},E={class:"text-h5 mb-2 offset-md1 black--text"};function L(e,l,d,K,W,f){const w=D,V=C,H=O;return u(),b("div",I,[s(m,{class:"mb-0 mt-0"},{default:t(()=>[s(r,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:t(()=>[n("div",F,o(e.$t("Delete cash assistances")),1)]),_:1})]),_:1}),s(m,{class:"mb-0 mt-0"},{default:t(()=>[s(r,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:t(()=>[s($,{class:"pt-sm-4 pb-sm-4 pt-md-16 data-block remove-cash-basic",rounded:"0"},{default:t(()=>[s(k,null,{default:t(()=>[s(m,{class:"mb-4 mt-4"},{default:t(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:t(()=>[n("div",T,[p(e.$slots,"itemset-header",{},()=>[i(o(e.$t("Select assistances")),1)])]),n("div",null,[p(e.$slots,"itemset-description",{},()=>[i(o(e.$t("Please specify the date of the distribution and upload the same file you originally used for the import to delete the corresponding records")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:t(()=>[s(m,null,{default:t(()=>[s(r,{cols:"12",lg:"6"},{default:t(()=>[s(w,{modelValue:e.date,"onUpdate:modelValue":l[0]||(l[0]=a=>e.date=a),disabled:Array.isArray(e.hashes),label:e.$t("Date of distribution"),hint:e.$t("Indicate the distribution date"),"persistent-hint":""},null,8,["modelValue","disabled","label","hint"])]),_:1}),e.hashes?c("",!0):(u(),_(r,{key:0,cols:"12"},{default:t(()=>[s(V,{modelValue:e.rows,"onUpdate:modelValue":[l[1]||(l[1]=a=>e.rows=a),f.processRecords],"bundle-name":"none"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}))]),_:1})]),_:1})]),_:3})]),_:3})]),_:3}),e.hashes?(u(),_($,{key:0,class:"pt-sm-4 pb-sm-4 data-block block-cash-basic",rounded:"0"},{default:t(()=>[s(k,null,{default:t(()=>[s(m,{class:"mb-4 mt-4"},{default:t(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:t(()=>[n("div",P,[p(e.$slots,"itemset-header",{},()=>[i(o(e.$t("Check records")),1)])]),n("div",null,[p(e.$slots,"itemset-description",{},()=>[i(o(e.$t("Review the records before proceeding with the deletion")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:t(()=>[s(m,null,{default:t(()=>[s(r,{cols:"12"},{default:t(()=>[s(H,{table:"assistances",ref:"assistances",index:"hash",filters:{hash:e.hashes},searchKeys:["headOfHousehold.translation.uk.fullName","headOfHousehold.fullName","headOfHousehold.taxId","headOfHousehold.passport"],title:e.$t("Records"),headers:e.headers},{"item.headOfHousehold.taxId":t(({item:a})=>[i(o(a.headOfHousehold.taxId),1)]),"item.headOfHousehold.passport":t(({item:a})=>[i(o(a.headOfHousehold.passport),1)]),"item.headOfHousehold.fullName":t(({item:a})=>{var h;return[n("span",B,o((h=a.headOfHousehold)==null?void 0:h.fullName),1)]}),"item.headOfHousehold.phone":t(({item:a})=>{var h;return[n("span",A,o(f.formatPhone((h=a.headOfHousehold)==null?void 0:h.phone)),1)]}),"item.value":t(({item:a})=>[n("span",U,o(f.formatNumber(a.value)),1)]),"item.attendedFrom":t(({item:a})=>[a.attendedFrom?(u(),b("span",j,o(new Date(a.attendedFrom).toLocaleDateString("uk")),1)):c("",!0)]),"item.attendedTo":t(({item:a})=>[a.attendedTo?(u(),b("span",z,o(new Date(a.attendedTo).toLocaleDateString("uk")),1)):c("",!0)]),_:2},1032,["filters","title","headers"])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3})]),_:3})):c("",!0),e.hashes?(u(),_($,{key:1,class:"pt-sm-4 pb-sm-4 pb-md-16 data-block block-cash-basic",rounded:"0"},{default:t(()=>[s(k,null,{default:t(()=>[s(m,{class:"mb-4 mt-4"},{default:t(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:t(()=>[n("div",E,[p(e.$slots,"itemset-header",{},()=>[i(o(e.$t("Delete records")),1)])]),n("div",null,[p(e.$slots,"itemset-description",{},()=>[i(o(e.$t("Submit the records to delete")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:t(()=>[s(m,null,{default:t(()=>[s(r,{cols:"12"},{default:t(()=>[s(g,{onClick:l[2]||(l[2]=a=>e.hashes=void 0),block:e.$vuetify.display.xs,color:"primary","prepend-icon":"mdi-pencil",class:"mb-2 mr-4"},{default:t(()=>[i(o(e.$t("Reset")),1)]),_:1},8,["block"]),s(g,{onClick:f.deleteRecords,block:e.$vuetify.display.xs,color:"error","prepend-icon":"mdi-delete",class:"mb-2 mr-4"},{default:t(()=>[i(o(e.$t("Delete")),1)]),_:1},8,["onClick","block"]),s(g,{onClick:l[3]||(l[3]=a=>e.$router.push("/cash")),block:e.$vuetify.display.xs,variant:"text",color:"warning","prepend-icon":"mdi-close",class:"mb-sm-2 mr-4"},{default:t(()=>[i(o(e.$t("Cancel")),1)]),_:1},8,["block"])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3})]),_:3})):c("",!0)]),_:3})]),_:3})])}typeof v=="function"&&v(y);const Oe=S(y,[["render",L]]);export{Oe as default};

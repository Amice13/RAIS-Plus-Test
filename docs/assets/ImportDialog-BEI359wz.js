import{p as at}from"./index-CebfcyPH.js";import{d as ce}from"./index-T2HRTWtS.js";import{a as nt,p as ge}from"./importProcessor-Cg8urtX2.js";import{_ as X,F as v,o as f,a,w as d,x as h,y as m,z as V,B as _,C as y,G as E,H as L,aa as ye,c as T,ac as $,A as k,$ as $e,a8 as Oe,ag as ot,ah as j,aC as rt,ai as dt,h as F,p as R,aA as Be,m as Y,b as C,ak as ze,L as W,aD as Ne,O as ut,aE as ct,r as be,s as de,e as mt,t as we,T as ht,J as pt,I as Me,am as ft,P as Ae,u as vt,q as me,S as gt,k as yt,W as bt,aF as ke,aG as wt,aH as kt,aI as Ve,K as Vt,an as Dt,aJ as St}from"./index-BtIo2-Z_.js";import{V as z,a as P}from"./VRow-9vAZildp.js";import{V as Ee}from"./VProgressCircular-DNPB7izS.js";import{V as ne}from"./VAlert-Or5Mzxjd.js";import{V as D}from"./VBtn--bGuKZaN.js";import{V as Le,c as _t,a as Pe,b as Re}from"./VCard-DNHZbZ5d.js";import{V as xt,a as Ct,b as It,d as U}from"./VList-Cnqqz-5U.js";import{V as A,g as De,R as Tt,n as Ht,M as $t}from"./index-SDX8Otz2.js";import{V as se}from"./VCheckbox-Berrf7y1.js";import{V as K}from"./VSpacer-bp7-SSB-.js";import{V as he}from"./VDialog-CNptTdRK.js";import{d as Ue}from"./debouncer-Whu4ZLob.js";import{V as je}from"./VDataTableVirtual-Cqes2yZi.js";import{V as Q}from"./VTooltip-DXl_TsVy.js";import{V as oe,a as We}from"./VToolbar-o4oksDe3.js";import{V as Xe}from"./VTextField-Bn35T3UG.js";import{V as Fe,c as Ot}from"./VAvatar-l5UJO0sV.js";import{_ as Bt,a as zt,b as Nt}from"./CustomMultipleBundle-DHoJd0Qs.js";import{V as Ye}from"./VContainer-BFGIFtcM.js";import{_ as Mt}from"./CustomBundle-HZg5QtVE.js";import{X as Se}from"./xlsx-CILBIiVl.js";import{V as ue,m as At}from"./CustomDate-CLArRqjL.js";import{V as Et}from"./VSystemBar-Cr7lwDBT.js";import{u as Ge,m as Je,a as qe,b as Lt}from"./group-DgRBM2CV.js";import{a as Pt,b as Rt}from"./VOverlay-BnbjS8dz.js";var Ut={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const jt=["address","aor","bundleName","date","publicId","populationType","distributionModality","items","organization","responsibleOrganization","fundedBy","objectives"],Wt=["address","aor","bundleName","date","publicId","populationType","distributionModality","organization","responsibleOrganization","fundedBy","objectives"],Xt={props:{modelValue:{type:Array,default:()=>[]},isDonation:{type:Boolean},headers:{type:Array,default:()=>[]},initialData:{type:Object,default:()=>({})}},provide:["$error"],computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data(){return{loading:!1,status:void 0,errors:[]}},methods:{exportData(){this.loading=!0;const e=this.headers.map(l=>l.key);e.splice(1,0,"duplicateResult","duplicateBundle","duplicateDate","duplicateOrganization");const t=this.headers.map(l=>l.title);t.splice(1,0,"Deduplication result","Type of the provided assistance","Date of duplicated assistance","Assistance provider");const i=JSON.parse(JSON.stringify(this.model)).map(l=>{var p,u;return l.duplicateResult=(p=l.duplicate)!=null&&p.length?"Duplicated":"Unique",(u=l.duplicate)!=null&&u.length&&(l.duplicateBundle=l.duplicate[0].bundleName,l.duplicateDate=l.duplicate[0].date,l.duplicateOrganization=l.duplicate[0].organization.name),l}),o=e.reduce((l,p,u)=>(l[u]=i.map(b=>b[p]),l),{}),s={headers:t,columns:o},n=`${Ut.FRONT_HOST}/export/export.xlsx`;(async()=>{const l=`${this.initialData.publicId} - Clean data.xlsx`;return await ce(n,s,l)})(),this.loading=!1},async importData(){if(this.loading=!0,this.isDonation&&!this.initialData.id){const n=this.initialData,{donations:c}=this.$storage,l=at[this.table],p=l==null?void 0:l.preprocess;p&&(n=p(n)),n.status="Converted",await this.$nextTick();const u=await c.push(n);this.initialData.id=u.id}let e;if(this.isDonation){const{requests:n}=this.$storage,c=await n.filter({donationId:this.initialData.id}).find();if(!c.count){const l=ye(e||this.initialData,jt);l.donationId=this.initialData.id,l.responsibleOrganization=this.initialData.organization,l.organization=this.initialData.receivingOrganization,l.status="In distribution",l.tags||(l.tags=[]),l.tags.includes("Converted donation")||l.tags.push("Converted donation"),e=await n.push(l)}c.count&&(e=c.items[0])}this.isDonation||(e=this.initialData);const t=ye(e||this.initialData,Wt);t.date.toLocaleDateString&&(t.date=t.date.toLocaleDateString("sv").substring(0,10)),t.distributionId=e.id,this.isDonation&&(t.donationId=this.initialData.id);let i=JSON.parse(JSON.stringify(this.model));i=i.map(n=>{const c=Object.assign({},t,n);return c.createdBy=this.appStore.user.id,c.createdByEmail=this.appStore.user.email,delete c.id,delete c.duplicate,delete c.status,delete c.assignees,c});const o=nt(i).map(n=>(n.household&&n.address&&(n.household=Object.assign({},n.address,n.household)),this.isDonation&&(n.donationId=this.initialData.id),n)),{assistances:s}=this.$storage;try{await s.push(o),this.status="success"}catch(n){this.status="error",console.log(n),this.errors=n==null?void 0:n.errors}this.$emit("imported",e==null?void 0:e.id),this.loading=!1}}},Ft={class:"h-100"},Yt={class:"text-h4"},Gt={class:"mw-40 ml-4 mr-4 pb-10"},Jt={class:"text-center drag-text"},qt={class:"text-h5 mb-2"},Kt={class:"mt-8"},Qt={class:"mt-8"},Zt={class:"mt-8"},el={class:"ml-8 text-left"},tl={class:"mt-8"};function ll(e,t,i,o,s,n){return f(),v("div",Ft,[a(P,{class:"pl-4 pr-4"},{default:d(()=>[a(z,{cols:"12"},{default:d(()=>[h("div",Yt,m(e.$t("Import the data")),1)]),_:1})]),_:1}),a(P,{class:"pl-4 pr-4"},{default:d(()=>[a(z,{cols:"12",class:"text-center"},{default:d(()=>{var c;return[h("div",Gt,[h("div",null,[h("div",Jt,[h("div",null,[h("div",qt,m(e.$t("You have successfully checked your data")),1),h("div",null,m(e.$t("You can download the deduplicated dataset of finish your import")),1)]),V(a(Ee,{indeterminate:"",color:"primary",size:"64",class:"mt-8"},null,512),[[_,s.loading]]),V(h("div",Kt,[a(ne,{color:"success"},{default:d(()=>[y(m(e.$t("Your data is imported. You can close the window.")),1)]),_:1})],512),[[_,s.status==="success"]]),V(h("div",Qt,[a(ne,{color:"error"},{default:d(()=>[y(m(e.$t("Your data is not imported. Please check the following errors.")),1)]),_:1})],512),[[_,s.status==="error"]]),V(h("div",Zt,[h("ul",el,[(f(!0),v(E,null,L(s.errors,(l,p)=>(f(),v("li",{key:p},[h("strong",null,m(e.$t("Row"))+" "+m(l.index+1)+":",1),y(" "+m(e.$t(l.message)),1)]))),128))])],512),[[_,s.status==="error"&&((c=s.errors)==null?void 0:c.length)]]),V(h("div",tl,[a(D,{onClick:n.exportData,color:"secondary","prepend-icon":"mdi-download"},{default:d(()=>[y(m(e.$t("Download")),1)]),_:1},8,["onClick"]),a(D,{disabled:s.loading||s.status==="success",onClick:n.importData,color:"primary",class:"ml-2","prepend-icon":"mdi-upload"},{default:d(()=>[y(m(e.$t("Import")),1)]),_:1},8,["disabled","onClick"]),a(D,{onClick:t[0]||(t[0]=l=>e.$emit("close")),color:"info",variant:"text",class:"ml-2","prepend-icon":"mdi-close"},{default:d(()=>[y(m(e.$t("Close")),1)]),_:1})],512),[[_,!s.loading]])])])])]}),_:1})]),_:1})])}const sl=X(Xt,[["render",ll]]);let ee,ae;const il={props:{modelValue:{type:Array,default:()=>[]},dialog:{type:Boolean}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data(){return{isDragged:!1,activeIndex:0,draggedIndex:0}},methods:{dragStart(e,t){this.activeIndex=t,ee=e.target.parentElement.parentElement,ae=e.y,setTimeout(()=>{this.isDragged=!0},0)},dragMove(e){let t=Math.round((e.y-ae)/68.8)+this.activeIndex;this.draggedIndex=t<0?0:t>this.model.length?this.model.length:t,ee.style.zIndex=100;let i=e.y-ae;ee.style.transform=`translateY(${i}px)`},dragStop(e){let t=Math.round((e.y-ae)/68.8)+this.activeIndex;this.draggedIndex=t<0?0:t>this.model.length?this.model.length:t,this.isDragged=!1;let i=this.draggedIndex;const o=[...this.model],s=o.splice(this.activeIndex,1)[0];o.splice(i,0,s),this.model=o,setTimeout(()=>{ee.style.transform=null,ee.style.zIndex=null},100)}}};function al(e,t,i,o,s,n){return f(),T(he,{"model-value":i.dialog,width:"600"},{default:d(()=>[a(Le,{width:"600",class:"margin-auto custom-thumb"},{default:d(()=>[a(_t,{class:"d-flex align-center justify-space-between mt-4"},{default:d(()=>[y(m(e.$t("Manage columns"))+" ",1),a(D,{onClick:t[0]||(t[0]=c=>e.$emit("close")),icon:"mdi-close",size:"x-small",variant:"text"})]),_:1}),a(Pe,null,{default:d(()=>[a(xt,{density:"compact"},{default:d(()=>[(f(!0),v(E,null,L(n.model,({show:c,header:l},p)=>(f(),T(Ct,{class:$([{shiftup:s.isDragged&&p!==s.activeIndex&&p<this.activeIndex&&p>=this.draggedIndex,shiftdown:s.isDragged&&p!==s.activeIndex&&p>this.activeIndex&&p<=this.draggedIndex},"bg-grey-lighten-3 manage-column mb-1"]),key:l.key,style:{width:"100%"},ref_for:!0,ref:"drag"},{prepend:d(()=>[a(se,{"hide-details":"",modelValue:n.model[p].show,"onUpdate:modelValue":u=>n.model[p].show=u},null,8,["modelValue","onUpdate:modelValue"])]),append:d(()=>[a(A,{onDragstart:u=>n.dragStart(u,p),onDrag:n.dragMove,onDragend:n.dragStop,color:"grey-darken-1",draggable:"true",class:"ml-3 mr-0",style:{cursor:"grab"}},{default:d(()=>t[2]||(t[2]=[y("mdi-drag-horizontal-variant")])),_:2},1032,["onDragstart","onDrag","onDragend"])]),default:d(()=>[a(It,{class:"ml-2"},{default:d(()=>[y(m(l.title),1)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1}),a(Re,null,{default:d(()=>[a(K),a(D,{text:e.$t("Close"),onClick:t[1]||(t[1]=c=>e.$emit("close")),color:"primary"},null,8,["text"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Ke=X(il,[["render",al]]);var nl={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};let _e,xe,te;const ol={name:"ImportDeduplication",props:{modelValue:{type:Array,default:()=>[]},initialData:{type:Object,default:()=>({})},dialogHeight:{type:Number,default:400},headers:{type:Array,default:()=>[]}},data(){return{currentItem:[],selected:[],selectedHeaders:[],headersDialog:!1,selectedAll:!1,search:void 0,searchInput:void 0,showDuplicationsOnly:!1}},mounted(){this.selectedHeaders=this.headers.map(e=>e.key)},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},dialog(){return this.currentItem.length>0},availableHeaders(){return this.headers.map(e=>e.key)},shownHeaders(){return this.headers.filter(e=>this.selectedHeaders.includes(e.key))},alertType(){return this.duplicationsCount?"error":"success"},duplicationsCount(){return this.model.filter(e=>{var t;return(t=e.duplicate)==null?void 0:t.length}).length},selectedCount(){return this.selected.length},recordsToShow(){return this.showDuplicationsOnly?this.model.filter(e=>{var t;return(t=e.duplicate)==null?void 0:t.length}):this.model}},methods:{setSearch:Ue(function(e){this.search=e}),initResizer(e){_e=e.clientX,te=e.target.parentElement;const t=window.getComputedStyle(te);xe=parseInt(t.width,10)},resize(e){const t=e.clientX-_e;let i=xe+t;if(i<0)return!1;i=Math.abs(i)<70?70:i,te.style.width=`${i}px`,te.style.minWidth=`${i}px`,te.style.maxWidth=`${i}px`},highlight(e){if(e instanceof Date&&(e=e.toLocaleDateString(this.$i18n.locale)),typeof e!="string"||!e)return e;if(e=String(e),e=e.replace(/<[^>]+?>/g,""),this.search){let t=this.search.replace(/[^a-zа-яєіїґ\d ]/g,""),i=new RegExp(`(${t})`,"gi");e=e.replace(i,"<strong>$1</strong>")}return e},showDuplications(){if(this.showDuplicationsOnly=!this.showDuplicationsOnly,this.showDuplicationsOnly){let e=this.recordsToShow.map(t=>t.taxId);this.selected=this.selected.filter(t=>e.includes(t))}},selectAll(){this.selected.length!==this.recordsToShow.length?(this.selected=this.recordsToShow.map(e=>e.taxId),console.log(this.recordsToShow)):this.selected=[]},selectAllDuplications(){this.selected=this.model.filter(e=>{var t;return(t=e.duplicate)==null?void 0:t.length}).map(e=>e.id)},deleteSelected(){const e=[...this.selected];this.model=this.model.filter(t=>!e.includes(t.id)),this.selected=[]},exportData(){const e=this.model.filter(l=>this.selected.includes(l.id)),t=this.headers.filter(l=>l.key!=="duplicate").map(l=>l.key),i=this.headers.filter(l=>l.key!=="duplicate").map(l=>l.title),o=t.reduce((l,p,u)=>(l[u]=e.map(b=>b[p]),l),{}),s={headers:i,columns:o},n=`${nl.FRONT_HOST}/export/export.xlsx`;this.model.date,(async()=>{const l=`${new Date(this.initialData.date).toLocaleDateString("sv-SE")} - ${this.initialData.bundleName} Duplicated records.xlsx`;return await ce(n,s,l)})()}}},rl={key:0,class:"font-weight-light"},dl=["onClick"],ul={class:"text-caption opacity-06"},cl={key:0,class:"ml-4 font-weight-light"},ml={class:"d-flex w-100 justify-space-between"},hl=["innerHTML"],pl=["innerHTML"],fl={key:2},vl={key:3,class:"ml-4 font-weight-light"},gl={class:"ml-4"},yl={class:"d-flex w-100"},bl={key:0,class:"bg-blue-grey-lighten-1 pa-2"},wl={class:"bg-blue-grey-lighten-5 pa-4 flex-grow-1"},kl={key:0},Vl={class:"text-h6 mt-4"},Dl={class:"mb-6 mt-2"},Sl={class:"mt-2 mb-2"},_l={key:0,class:"mt-2 mb-2"},xl={key:1,class:"mt-2 mb-2"},Cl={key:2,class:"mt-2 mb-2"},Il={key:3,class:"mt-2 mb-2"},Tl={class:"mt-2 mb-2"},Hl={key:4,class:"mt-2 mb-2"},$l={class:"ml-6"},Ol={key:5,class:"mt-2 mb-2"};function Bl(e,t,i,o,s,n){const c=Ke;return f(),v("div",null,[a(P,null,{default:d(()=>[a(z,{cols:"12",ref:"mainScreen"},{default:d(()=>[a(je,{modelValue:s.selected,"onUpdate:modelValue":t[6]||(t[6]=l=>s.selected=l),class:"import-table",headers:i.headers,search:s.search,items:n.recordsToShow,sticky:!0,"item-height":56,"show-select":"","fixed-header":"",height:e.$vuetify.display.height-370,"item-value":"Tax ID"},{top:d(()=>[V(a(oe,{flat:"",color:"white"},{default:d(()=>[a(We,{class:"text-h5",style:{"min-width":"350px"}},{default:d(()=>[y(m(e.$t("Deduplication")),1)]),_:1}),a(U,{class:"mx-4",inset:"",vertical:""}),a(Xe,{modelValue:s.searchInput,"onUpdate:modelValue":[t[0]||(t[0]=l=>s.searchInput=l),n.setSearch],label:e.$t("Search"),class:"mr-4 w-100",variant:"outlined",density:"compact","hide-details":"","prepend-icon":"mdi-magnify"},{append:d(()=>[n.duplicationsCount?(f(),v("div",rl,[a(D,{onClick:n.showDuplications,color:s.showDuplicationsOnly?"red":"black",size:"small",icon:"mdi-filter"},null,8,["onClick","color"]),a(Q,{activator:"parent",location:"start"},{default:d(()=>[y(m(e.$t("Show duplicated records only")),1)]),_:1})])):k("",!0)]),_:1},8,["modelValue","onUpdate:modelValue","label"]),a(K),Oe(e.$slots,"action-btn",{},()=>[a(D,{onClick:t[1]||(t[1]=l=>e.$emit("btnClick")),variant:"tonal",class:"ml-2"},{default:d(()=>[a(A,{left:""},{default:d(()=>t[10]||(t[10]=[y("mdi-table-edit")])),_:1})]),_:1})])]),_:3},512),[[_,!e.$vuetify.display.xs]]),a(ne,{color:n.alertType,variant:"tonal",class:"mt-2 mb-2"},{default:d(()=>[y(m(e.$t("Number of duplications",n.duplicationsCount))+". "+m(e.$t("Number of selected rows",n.selectedCount))+".",1)]),_:1},8,["color"])]),bottom:d(()=>[a(oe,{class:"mt-2 pa-0 ml-0",flat:"",density:"compact",color:"white"},{default:d(()=>[V(a(D,{onClick:n.selectAllDuplications,class:"ml-0",color:"error",variant:"tonal","prepend-icon":"mdi-checkbox-outline"},{default:d(()=>[y(m(e.$t("Select all duplications")),1)]),_:1},8,["onClick"]),[[_,n.duplicationsCount]]),V(a(D,{onClick:n.exportData,class:"ml-2",color:"primary",variant:"tonal","prepend-icon":"mdi-download"},{default:d(()=>[y(m(e.$t("Download")),1)]),_:1},8,["onClick"]),[[_,n.selectedCount]]),V(a(D,{onClick:n.deleteSelected,class:"ml-2",color:"warning",variant:"tonal","prepend-icon":"mdi-delete"},{default:d(()=>[y(m(e.$t("Delete")),1)]),_:1},8,["onClick"]),[[_,n.selectedCount]]),a(K),a(D,{onClick:t[2]||(t[2]=l=>e.$emit("setStep",5)),class:"mr-0",color:"success",variant:"flat","prepend-icon":"mdi-play"},{default:d(()=>[y(m(e.$t("Proceed")),1)]),_:1})]),_:1})]),headers:d(({columns:l,isSorted:p,getSortIcon:u,toggleSort:b})=>[h("tr",null,[(f(!0),v(E,null,L(l,r=>(f(),v("td",{key:r.key,style:$e({"text-align":r.align}),class:$({"custom-check":r.key==="data-table-select","bg-orange-darken-4":typeof r.error<"u"})},[h("div",{class:$(["d-flex text-no-wrap align-center",{"justify-space-between":r.align!=="center","justify-center":r.align==="center"}])},[r.key==="data-table-select"?(f(),T(se,{key:0,onClick:n.selectAll,indeterminate:s.selected.length>0,"hide-details":""},null,8,["onClick","indeterminate"])):(f(),v("div",{key:1,class:$([{"cursor-pointer":r.sortable,"mr-2":r.sortable},"d-flex align-center"]),onClick:()=>b(r)},[h("div",null,[h("div",ul,m(r.key),1),h("div",null,m(e.$t(r.title)),1)]),r.error?(f(),v("div",cl,[a(A,{icon:"mdi-information-outline"}),a(Q,{activator:"parent",location:"start"},{default:d(()=>[y(m(e.$t(r.error)),1)]),_:2},1024)])):k("",!0)],10,dl)),p(r)?V((f(),T(A,{key:2,icon:u(r)},null,8,["icon"])),[[_,r.sortable]]):k("",!0)],2),h("div",{onDragstart:t[3]||(t[3]=(...g)=>n.initResizer&&n.initResizer(...g)),onDrag:t[4]||(t[4]=(...g)=>n.resize&&n.resize(...g)),draggable:"true",class:"resizer"},null,32)],6))),128))])]),item:d(({item:l,index:p})=>[h("tr",null,[h("td",null,[a(se,{modelValue:s.selected,"onUpdate:modelValue":t[5]||(t[5]=u=>s.selected=u),value:l.id,"hide-details":""},null,8,["modelValue","value"])]),(f(!0),v(E,null,L(n.shownHeaders,({key:u,align:b})=>(f(),v("td",{class:$({[`text-${b}`]:!0,"bg-red-lighten-1":u==="duplicate"&&l[u].length>0})},[h("div",ml,[u!=="duplicate"&&l[u]&&typeof l[u]=="string"?(f(),v("div",{key:0,innerHTML:l[u].match(/[a-z]/)===null?n.highlight(l[u]):n.highlight(e.$t(l[u]))},null,8,hl)):k("",!0),u!=="duplicate"&&typeof l[u]!="string"?(f(),v("div",{key:1,innerHTML:n.highlight(l[u])},null,8,pl)):k("",!0),u==="duplicate"?(f(),v("div",fl,m(l[u].length>0?e.$t("Duplicated"):e.$t("Unique")),1)):k("",!0),u==="duplicate"&&l[u].length>0?(f(),v("div",vl,[a(A,{onClick:r=>s.currentItem=l[u],icon:"mdi-information-outline",class:"cursor-pointer"},null,8,["onClick"]),a(Q,{activator:"parent","max-width":"300",location:"bottom"},{default:d(()=>[h("ul",gl,[(f(!0),v(E,null,L(l[u],r=>(f(),v("li",null,m(new Date(r.date).toLocaleDateString(e.$i18n.locale))+" - "+m(e.$t(r.bundleName)),1))),256))])]),_:2},1024)])):k("",!0)])],2))),256))])]),_:3},8,["modelValue","headers","search","items","height"])]),_:3},512)]),_:3}),a(he,{"model-value":n.dialog},{default:d(()=>[a(Le,{title:e.$t("Duplications"),"max-width":"600",class:"margin-auto custom-thumb"},{default:d(()=>[s.currentItem.length?(f(),T(Pe,{key:0},{default:d(()=>{var l,p,u,b,r;return[h("div",yl,[(l=s.currentItem[0])!=null&&l.headOfHousehold?(f(),v("div",bl,[a(Fe,{size:"56",color:"blue-grey-lighten-3"},{default:d(()=>{var g;return[a(A,{size:"x-large",icon:((g=s.currentItem[0])==null?void 0:g.headOfHousehold.gender)==="Male"?"mdi-human-male":"mdi-human-female"},null,8,["icon"])]}),_:1})])):k("",!0),h("div",wl,[(p=s.currentItem[0])!=null&&p.headOfHousehold.gender?(f(),v("div",kl,[h("strong",null,m(e.$t("Gender"))+":",1),y(" "+m(e.$t((u=s.currentItem[0])==null?void 0:u.headOfHousehold.gender)),1)])):k("",!0),h("div",null,[h("strong",null,m(e.$t("Birthday"))+":",1),y(" "+m(new Date((b=s.currentItem[0])==null?void 0:b.headOfHousehold.birthday).toLocaleString(e.$i18n.locale,{year:"numeric",month:"numeric",day:"numeric"})),1)]),h("div",null,[h("strong",null,m(e.$t("Current age"))+":",1),y(" "+m((r=s.currentItem[0])==null?void 0:r.headOfHousehold.age),1)]),h("div",Vl,m(e.$t("Deduplication results")),1),h("div",Dl,[h("div",null,[h("strong",null,m(e.$t("This person has already received the support from humanitarian organizations")),1)])]),(f(!0),v(E,null,L(s.currentItem,g=>{var S,w,H,O;return f(),v("div",{key:g.publicId,class:"mb-7 pl-2",style:{"border-left":"2px solid #039BE5"}},[h("div",Sl,[h("strong",null,m(e.$t("Date"))+":",1),y(" "+m(new Date(g.date).toLocaleDateString("uk")),1)]),g.bundleName?(f(),v("div",_l,[h("strong",null,m(e.$t("Assistance type"))+":",1),y(" "+m(e.$t(g.bundleName)),1)])):k("",!0),(S=g.address)!=null&&S.pCode1?(f(),v("div",xl,[h("strong",null,m(e.$t("Oblast"))+":",1),y(" "+m(e.$t(g.address.pCode1)),1)])):k("",!0),(w=g.address)!=null&&w.pCode2?(f(),v("div",Cl,[h("strong",null,m(e.$t("Raion"))+":",1),y(" "+m(e.$t(g.address.pCode2)),1)])):k("",!0),(H=g.address)!=null&&H.pCode4?(f(),v("div",Il,[h("strong",null,m(e.$t("Locality"))+":",1),y(" "+m(e.$t(g.address.pCode4)),1)])):k("",!0),h("div",Tl,[h("strong",null,m(e.$t("Organization"))+":",1),y(" "+m((O=g.organization)==null?void 0:O.name),1)]),g.items&&g.items.length?(f(),v("div",Hl,[h("div",null,[h("strong",null,m(e.$t("Items"))+":",1)]),h("ul",$l,[(f(!0),v(E,null,L(g.items,B=>V((f(),v("li",null,m(e.$t(B.key))+": "+m(B.value),513)),[[_,B.value]])),256))])])):k("",!0),g.value?(f(),v("div",Ol,[h("strong",null,m(e.$t("Value"))+":",1),y(" "+m(g.value?g.value.toLocaleString("uk-UA",{style:"currency",currency:g.currency||"USD"}):""),1)])):k("",!0)])}),128))])])]}),_:1})):k("",!0),a(Re,null,{default:d(()=>[a(K),a(D,{text:e.$t("Close"),color:"primary",onClick:t[7]||(t[7]=l=>s.currentItem=[])},null,8,["text"])]),_:1})]),_:1},8,["title"])]),_:1},8,["model-value"]),a(c,{modelValue:s.selectedHeaders,"onUpdate:modelValue":t[8]||(t[8]=l=>s.selectedHeaders=l),dialog:s.headersDialog,onClose:t[9]||(t[9]=l=>s.headersDialog=!1)},null,8,["modelValue","dialog"])])}const zl=X(ol,[["render",Bl]]),Nl={name:"ImportDeduplicationSetup",props:{modelValue:{type:Array,default:()=>[]}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data(){return{filters:{items:{$nested:{key:[]}}}}},methods:{async deduplicateData(){this.$emit("setLoading",!0);for(let l of this.model)delete l.duplicate;const e=[...new Set(this.model.map(l=>l["headOfHousehold.taxId"]).filter(Boolean))],t=[...new Set(this.model.map(l=>l["headOfHousehold.passport"]).filter(Boolean))],i=[...e,...t],{assistances:o}=this.$storage,s=JSON.parse(JSON.stringify(this.filters)),n=[s];if(!s.distributionModality||s.distributionModality.includes("Cash")||s.distributionModality.includes("Voucher")){const l={distributionModality:s.distributionModality,value:{$gt:0}};l.distributionModality||delete l.distributionModality,n.push(l)}let c=await o.useIndex("peopleIds").filter({peopleIds:i}).should(n).include(["headOfHousehold.givenName","headOfHousehold.taxId","headOfHousehold.passport","familyMembers.taxId","familyMembers.passport","date","bundleName","organization.name","admin1","admin2","admin3","admin4","address.pCode1","address.pCode2","address.pCode3","address.pCode4"]).find();c.count||(this.$emit("setLoading",!1),this.$emit("setStep",4)),c.items=c.items.map(l=>(l.taxIds=[l.headOfHousehold.taxId],l.familyMembers&&(l.taxIds=[...l.taxIds,...l.familyMembers.map(p=>p.taxId)]),l));for(let l of this.model){let p=c.items.filter(u=>{var b;return(b=u.taxIds)==null?void 0:b.includes(l["headOfHousehold.taxId"])});l.duplicate=p,p.length&&(l.householdId=p[0].householdId)}this.$emit("setLoading",!1),this.$emit("setStep",4)}},watch:{"filters.bundleName"(){this.filters.items.$nested.key=[]},"filters.distributionModality"(){this.filters.items.$nested.key=[]}}},Ml={class:"d-flex flex-column h-100"},Al={class:"text-h5 ml-1"},El={class:"ml-1"},Ll={class:"text-h6 mb-4"},Pl={class:"text-h6 mb-4"},Rl={class:"text-h6 mb-4"};function Ul(e,t,i,o,s,n){const c=Bt,l=zt,p=Nt;return f(),v("div",Ml,[a(P,null,{default:d(()=>[a(z,{cols:"12",ref:"mainScreen"},{default:d(()=>[a(Ye,{fluid:""},{default:d(()=>[a(P,null,{default:d(()=>[a(z,null,{default:d(()=>[h("div",Al,m(e.$t("Deduplication setup")),1),h("div",El,m(e.$t("Select filters to apply for the following deduplication")),1)]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),a(P,{class:"ml-3 mr-3 h-100 flex-grow-1"},{default:d(()=>{var u,b,r,g;return[a(z,{cols:"4"},{default:d(()=>[h("div",Ll,m(e.$t("Define the type of assistance")),1),a(c,{modelValue:s.filters.bundleName,"onUpdate:modelValue":t[0]||(t[0]=S=>s.filters.bundleName=S)},null,8,["modelValue"])]),_:1}),a(z,{cols:"4"},{default:d(()=>[h("div",Pl,m(e.$t("Define the assistance modality")),1),a(l,{modelValue:s.filters.distributionModality,"onUpdate:modelValue":t[1]||(t[1]=S=>s.filters.distributionModality=S)},null,8,["modelValue"])]),_:1}),((b=(u=s.filters)==null?void 0:u.bundleName)==null?void 0:b.length)===1&&((g=(r=s.filters)==null?void 0:r.distributionModality)==null?void 0:g.length)===1&&s.filters.distributionModality[0]==="In-kind"?(f(),T(z,{key:0,cols:"4"},{default:d(()=>{var S,w,H,O;return[h("div",Rl,m(e.$t("Define the specific items")),1),((w=(S=s.filters)==null?void 0:S.bundleName)==null?void 0:w.length)===1&&((O=(H=s.filters)==null?void 0:H.distributionModality)==null?void 0:O.length)===1&&s.filters.distributionModality[0]==="In-kind"?(f(),T(p,{key:0,modelValue:s.filters.items.$nested.key,"onUpdate:modelValue":t[2]||(t[2]=B=>s.filters.items.$nested.key=B),bundle:s.filters.bundleName[0],class:"mt-4"},null,8,["modelValue","bundle"])):k("",!0)]}),_:1})):k("",!0)]}),_:1}),a(P,{class:"align-center flex-grow-0 mt-2 pl-4 pr-4"},{default:d(()=>[a(z,{cols:"12",class:"text-right"},{default:d(()=>[a(D,{onClick:n.deduplicateData,class:"ml-2",color:"success"},{default:d(()=>[y(m(e.$t("Proceed")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})])}const jl=X(Nl,[["render",Ul]]);var Wl={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};let Ce,Ie,le;const Xl={name:"ImportTable",props:{modelValue:{type:Array,default:()=>[]},initialData:{type:Object,default:()=>({})},dialogHeight:{type:Number,default:400},headers:{type:Array,default:()=>[]}},data(){return{selected:[],selectedHeaders:[],headersDialog:!1,selectedAll:!1,search:void 0,searchInput:void 0,showErrorsOnly:!1}},mounted(){this.selectedHeaders=this.headers.map(e=>({show:!0,header:e}))},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},availableHeaders(){return this.headers.map(e=>e.key)},shownHeaders(){return this.selectedHeaders.filter(({show:e})=>e).map(({header:e})=>e)},errorsCount(){return this.model.filter(e=>e.errors).length},blanksCount(){return this.model.filter(e=>{for(let{key:t}of this.headers)if(!["errors","headOfHousehold.taxId","headOfHousehold.passport"].includes(t)&&(typeof e[t]>"u"||e[t]===""))return!0}).length},selectedCount(){return this.selected.length},alertType(){return this.errorsCount?"error":this.blanksCount?"warning":"success"},recordsToShow(){return this.showErrorsOnly?this.model.filter(e=>e.errors):this.model}},methods:{setSearch:Ue(function(e){this.search=e}),initResizer(e){Ce=e.clientX,le=e.target.parentElement;const t=window.getComputedStyle(le);Ie=parseInt(t.width,10)},resize(e){const t=e.clientX-Ce;let i=Ie+t;if(i<0)return!1;i=Math.abs(i)<70?70:i,le.style.width=`${i}px`,le.style.minWidth=`${i}px`,le.style.maxWidth=`${i}px`},highlight(e){if(e instanceof Date&&(e=e.toLocaleDateString("uk")),typeof e!="string"||!e)return e;if(e=String(e),e=e.replace(/<[^>]+?>/g,""),this.search){let t=this.search.replace(/[^a-zа-яєіїґ\d ]/g,""),i=new RegExp(`(${t})`,"gi");e=e.replace(i,"<strong>$1</strong>")}return e},showErrors(){if(this.showErrorsOnly=!this.showErrorsOnly,this.showErrorsOnly){let e=this.recordsToShow.map(t=>t.id);this.selected=this.selected.filter(t=>e.includes(t))}},selectAllErrors(){this.selected=this.model.filter(e=>typeof e.errors<"u").map(e=>e.id)},selectAll(){this.selected.length!==this.recordsToShow.length?this.selected=this.recordsToShow.map(e=>e.id):this.selected=[]},deleteSelected(){const e=[...this.selected];this.model=this.model.filter(t=>!e.includes(t.id)),this.selected=[]},exportData(){const e=this.model.filter(l=>this.selected.includes(l.id)),t=this.headers.map(l=>l.key),i=this.headers.map(l=>l.title),o=t.reduce((l,p,u)=>(l[u]=e.map(b=>b[p]),l),{}),s={headers:i,columns:o},n=`${Wl.FRONT_HOST}/export/export.xlsx`;this.model.date,(async()=>{const l=`${new Date(this.initialData.date).toLocaleDateString("sv-SE")} - ${this.initialData.bundleName} Error records.xlsx`;return await ce(n,s,l)})()},async proccedToDeduplication(){this.$emit("setStep",3)}},watch:{dialogHeight(e){const t=e-240;this.height=t}}},Fl={class:"font-weight-light"},Yl=["onClick"],Gl={class:"text-caption opacity-06"},Jl={key:0,class:"ml-4 font-weight-light"},ql={class:"d-flex w-100 justify-space-between"},Kl=["innerHTML"],Ql={key:1},Zl=["innerHTML"],es={key:1,class:"text-start pl-4"},ts={key:2,class:"ml-4 font-weight-light"};function ls(e,t,i,o,s,n){const c=Ke;return f(),T(P,null,{default:d(()=>[a(z,{cols:"12",ref:"mainScreen"},{default:d(()=>[a(je,{modelValue:s.selected,"onUpdate:modelValue":t[5]||(t[5]=l=>s.selected=l),class:"import-table",height:e.$vuetify.display.height-370,headers:n.shownHeaders,search:s.search,items:n.recordsToShow,sticky:!0,"item-height":56,"show-select":"","fixed-header":"","item-value":"Tax ID"},{top:d(()=>[a(oe,{flat:"",color:"white",class:"hidden-sm-and-down"},{default:d(()=>[a(We,{class:"text-h5",style:{"min-width":"350px"}},{default:d(()=>[y(m(e.$t("Check the result")),1)]),_:1}),a(U,{class:"mx-4",inset:"",vertical:""}),a(Xe,{modelValue:s.searchInput,"onUpdate:modelValue":[t[0]||(t[0]=l=>s.searchInput=l),n.setSearch],label:e.$t("Search"),class:"mr-4 w-100",variant:"outlined",density:"compact","hide-details":"","prepend-icon":"mdi-magnify"},{append:d(()=>[h("div",Fl,[a(D,{onClick:n.showErrors,color:s.showErrorsOnly?"red":"black",size:"small",icon:"mdi-filter"},null,8,["onClick","color"]),a(Q,{activator:"parent",location:"start"},{default:d(()=>[y(m(e.$t("Show errors only")),1)]),_:1})])]),_:1},8,["modelValue","onUpdate:modelValue","label"]),a(K),Oe(e.$slots,"action-btn",{},()=>[a(D,{onClick:t[1]||(t[1]=l=>s.headersDialog=!0),variant:"tonal",class:"ml-2"},{default:d(()=>[a(A,{left:""},{default:d(()=>t[8]||(t[8]=[y("mdi-table-edit")])),_:1})]),_:1})])]),_:3}),a(ne,{color:n.alertType,variant:"tonal",class:"mt-2 mb-2"},{default:d(()=>[y(m(e.$t("Number of records",n.model.length))+". "+m(e.$t("Number of errors",n.errorsCount))+". "+m(e.$t("Number of blanks",n.blanksCount))+". "+m(e.$t("Number of selected rows",n.selectedCount))+".",1)]),_:1},8,["color"])]),bottom:d(()=>[a(oe,{class:"mt-2 pa-0 ml-0",flat:"",density:"compact",color:"white"},{default:d(()=>[V(a(D,{onClick:n.selectAllErrors,class:"ml-0",color:"error",variant:"tonal","prepend-icon":"mdi-checkbox-outline"},{default:d(()=>[y(m(e.$t("Select all errors")),1)]),_:1},8,["onClick"]),[[_,n.errorsCount]]),V(a(D,{onClick:n.exportData,class:"ml-2",color:"primary",variant:"tonal","prepend-icon":"mdi-download"},{default:d(()=>[y(m(e.$t("Download")),1)]),_:1},8,["onClick"]),[[_,n.selectedCount]]),V(a(D,{onClick:n.deleteSelected,class:"ml-2",color:"warning",variant:"tonal","prepend-icon":"mdi-delete"},{default:d(()=>[y(m(e.$t("Delete")),1)]),_:1},8,["onClick"]),[[_,n.selectedCount]]),a(K),a(D,{disabled:n.errorsCount!==0||!this.model.length,onClick:n.proccedToDeduplication,class:"mr-0",color:"success",variant:"flat","prepend-icon":"mdi-play"},{default:d(()=>[y(m(e.$t("Proceed")),1)]),_:1},8,["disabled","onClick"])]),_:1})]),headers:d(({columns:l,isSorted:p,getSortIcon:u,toggleSort:b})=>[h("tr",null,[(f(!0),v(E,null,L(l,r=>(f(),v("td",{key:r.key,style:$e({"text-align":r.align}),class:$({"custom-check":r.key==="data-table-select","bg-orange-darken-4":typeof r.error<"u"})},[h("div",{class:$(["d-flex text-no-wrap align-center",{"justify-space-between":r.align!=="center","justify-center":r.align==="center"}])},[r.key==="data-table-select"?(f(),T(se,{key:0,onClick:n.selectAll,indeterminate:s.selected.length>0,"hide-details":""},null,8,["onClick","indeterminate"])):(f(),v("div",{key:1,class:$([{"cursor-pointer":r.sortable,"mr-2":r.sortable},"d-flex align-center"]),onClick:()=>b(r)},[h("div",null,[h("div",Gl,m(r.key),1),h("div",null,m(e.$t(r.title)),1)]),r.error?(f(),v("div",Jl,[a(A,{icon:"mdi-information-outline"}),a(Q,{activator:"parent",location:"start"},{default:d(()=>[y(m(e.$t(r.error)),1)]),_:2},1024)])):k("",!0)],10,Yl)),p(r)?V((f(),T(A,{key:2,icon:u(r)},null,8,["icon"])),[[_,r.sortable]]):k("",!0)],2),h("div",{onDragstart:t[2]||(t[2]=(...g)=>n.initResizer&&n.initResizer(...g)),onDrag:t[3]||(t[3]=(...g)=>n.resize&&n.resize(...g)),draggable:"true",class:"resizer"},null,32)],6))),128))])]),item:d(({item:l,index:p})=>[h("tr",null,[h("td",null,[a(se,{modelValue:s.selected,"onUpdate:modelValue":t[4]||(t[4]=u=>s.selected=u),value:l.id,"hide-details":""},null,8,["modelValue","value"])]),(f(!0),v(E,null,L(n.shownHeaders,({key:u,align:b})=>{var r,g,S;return f(),v("td",{class:$({[`text-${b}`]:!0,"bg-yellow-lighten-2":typeof l[u]>"u"&&typeof((r=l.errors)==null?void 0:r[u])>"u","bg-red-lighten-1":typeof((g=l.errors)==null?void 0:g[u])<"u"})},[h("div",ql,[typeof l[u]=="string"&&l[u]&&l[u].match(/[a-z]/ig)?(f(),v("div",{key:0,innerHTML:n.highlight(e.$t(l[u]))},null,8,Kl)):(f(),v("div",Ql,[typeof l[u]=="string"?(f(),v("span",{key:0,innerHTML:n.highlight(l[u])},null,8,Zl)):k("",!0),u==="familyMembers"?(f(),v("ul",es,[(f(!0),v(E,null,L(l[u],(w,H)=>(f(),v("li",{key:`fm-${H}`,class:"text-no-wrap"},m([w.taxId,w.passport,e.$t(w.gender),w.birthday].filter(Boolean).join(", ")),1))),128))])):k("",!0)])),(S=l.errors)!=null&&S[u]?(f(),v("div",ts,[a(A,{icon:"mdi-information-outline"}),a(Q,{activator:"parent","max-width":"300",location:"bottom"},{default:d(()=>{var w;return[y(m(e.$t((w=l.errors)==null?void 0:w[u])),1)]}),_:2},1024)])):k("",!0)])],2)}),256))])]),_:3},8,["modelValue","height","headers","search","items"])]),_:3},512),a(c,{modelValue:s.selectedHeaders,"onUpdate:modelValue":t[6]||(t[6]=l=>s.selectedHeaders=l),dialog:s.headersDialog,onClose:t[7]||(t[7]=l=>s.headersDialog=!1)},null,8,["modelValue","dialog"])]),_:3})}const ss=X(Xl,[["render",ls]]),{cashAssistances:is,inKindAssistances:as}=rt,ns=dt(new Worker("/import/worker.js")),os=e=>new Promise((t,i)=>{const o=new FileReader;o.onerror=()=>i(o.error),o.onload=s=>{t(o.result)},e&&o.readAsArrayBuffer(e)}),rs={props:{modelValue:{type:Object,default:()=>[]},initialData:{type:Object,default:()=>({})},disabled:{type:Boolean}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},bundleName:{get(){return this.initialData.bundleName},set(e){this.$emit("setBundle",e)}}},data(){return{isDragover:!1,dialog:!1,importText:void 0}},methods:{resetBundle(){this.model.items=[]},async upload(e){if(typeof this.bundleName>"u")return alert(this.$t("You need to select the bundle"));this.$emit("setLoading",!0);const t=await os(e[0]),i=Se.read(t,{cellDates:!0,cellNF:!1,cellText:!1}),o=i.SheetNames,s=i.Sheets[o[0]],n=Se.utils.sheet_to_json(s,{header:1});let c=ge(n);c.data=c.data.map(l=>{var p;return l.tags=((p=l.tags)==null?void 0:p.split(","))||[],l.tags=[...l.tags,...this.initialData.tags||[]].join(","),l.tags||delete l.tags,l}),this.isDragover=!1,this.validateData(c),this.$refs.fileInput.value=""},async importTSV(){this.$emit("setLoading",!0);const e=await ns(this.importText);let t=ge(e);t.data=t.data.map(i=>{var o;return i.tags=((o=i.tags)==null?void 0:o.split(","))||[],i.tags=[...i.tags,...this.initialData.tags||[]].join(","),i.tags||delete i.tags,i}),this.validateData(t)},validateData({data:e,headers:t}){const i=this.initialData.distributionModality==="In-kind"?as:is;e=e.map(o=>{o.id=o["headOfHousehold.taxId"]||o["headOfHousehold.passport"];const s=i.validate(o,{abortEarly:!1});if(!s.error)return o;o.errors={};for(let n of s.error.details)o.errors[n.path[0]]=n.message;return o}),t=t.map(o=>(o.title=o.title.replace(/\*$/,""),o.title=o.title.replace(/^Items - /,""),o.title=o.title.replace(/^Strings - /,""),o)),this.model=e,this.$emit("setHeaders",t),this.$emit("setStep",2)}},watch:{bundleName(e){this.$emit("setBundle",e)}}},ds={class:"h-100 d-flex flex-column mt-4 flex-shrink-1"},us={class:"text-h5"},cs=["href"],ms={class:"v-btn__content","data-no-activator":""},hs={class:"import-text flex-grow-1 ml-4 mr-4 mt-4"},ps={class:"text-h5 mb-2"},fs={class:"text-h5 mb-2"},vs={class:"text-h5 mb-2"},gs=["disabled"];function ys(e,t,i,o,s,n){const c=Mt;return f(),v("div",ds,[a(P,{class:"align-center flex-grow-0 pl-4 pr-4"},{default:d(()=>[a(z,{cols:"4"},{default:d(()=>[h("div",us,m(e.$t("Upload your data")),1)]),_:1}),a(z,{cols:"4"},{default:d(()=>[a(c,{modelValue:n.bundleName,"onUpdate:modelValue":t[0]||(t[0]=l=>n.bundleName=l),disabled:i.disabled},null,8,["modelValue","disabled"])]),_:1}),a(z,{cols:"4",class:"text-right"},{default:d(()=>[i.initialData.bundleName?(f(),v("a",{key:0,download:"",class:"v-btn v-theme--unhcr text-primary v-btn--density-default v-btn--size-default v-btn--variant-tonal",href:`/import/templates/${i.initialData.bundleName}-${i.initialData.distributionModality}.xlsx`},[t[11]||(t[11]=h("span",{class:"v-btn__overlay"},null,-1)),t[12]||(t[12]=h("span",{class:"v-btn__underlay"},null,-1)),t[13]||(t[13]=h("span",{class:"v-btn__prepend"},[h("i",{class:"mdi-download mdi v-icon notranslate v-theme--unhcr v-icon--size-default","aria-hidden":"true"})],-1)),h("span",ms,m(e.$t("Download template")),1)],8,cs)):k("",!0)]),_:1})]),_:1}),h("div",hs,[h("div",null,[V(h("div",{class:$(["text-center drag-text",{"drag-over":s.isDragover}])},[V(h("div",null,[h("div",ps,m(e.$t("Select bundle")),1),h("div",null,m(e.$t("To start data import select the bundle, download the relevant template and provide the data")),1)],512),[[_,typeof n.bundleName>"u"]]),V(h("div",null,[h("div",fs,m(e.$t("Add your data here")),1),h("div",null,m(e.$t("To begin, select the table you want to import in Excel, copy it to the clipboard, and the paste here")),1),h("div",null,m(e.$t("or drop the Excel file")),1)],512),[[_,!s.isDragover&&n.bundleName]]),V(h("div",null,[a(A,{size:"x-large",class:"mb-2"},{default:d(()=>t[14]||(t[14]=[y("mdi-upload")])),_:1}),h("div",vs,m(e.$t("Drop your file here")),1)],512),[[_,s.isDragover]])],2),[[_,!s.importText]]),V(h("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.importText=l),disabled:typeof n.bundleName>"u",onDrag:t[2]||(t[2]=j(()=>{},["prevent","stop"])),onDragstart:t[3]||(t[3]=j(()=>{},["prevent","stop"])),onDragover:t[4]||(t[4]=j(l=>s.isDragover=!0,["prevent","stop"])),onDragenter:t[5]||(t[5]=j(l=>s.isDragover=!0,["prevent","stop"])),onDragend:t[6]||(t[6]=j(l=>s.isDragover=!1,["prevent","stop"])),onDragleave:t[7]||(t[7]=j(l=>s.isDragover=!1,["prevent","stop"])),onDrop:t[8]||(t[8]=j(l=>n.upload(l.dataTransfer.files),["prevent","stop"])),class:"w-100 h-100 elevation-2 pa-1","data-gramm":"false",spellcheck:"false",autocapitalize:"none",autocorrect:"off",autocomplete:"off"},null,40,gs),[[ot,s.importText]])])]),a(P,{class:"align-center flex-grow-0 mt-2 pl-4 pr-4"},{default:d(()=>[a(z,{cols:"12",class:"text-right"},{default:d(()=>[V(a(D,{onClick:t[9]||(t[9]=l=>e.$refs.fileInput.click()),disabled:typeof n.bundleName>"u","prepend-icon":"mdi-upload",color:"success",class:"ml-2"},{default:d(()=>[y(m(e.$t("Upload file")),1)]),_:1},8,["disabled"]),[[_,!s.importText]]),V(a(D,{onClick:n.importTSV,class:"ml-2",color:"success"},{default:d(()=>[y(m(e.$t("Import")),1)]),_:1},8,["onClick"]),[[_,s.importText]])]),_:1})]),_:1}),h("input",{ref:"fileInput",onInput:t[10]||(t[10]=l=>n.upload(l.target.files)),class:"d-none box__file",type:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","data-multiple-caption":"{count} files selected",multiple:""},null,544)])}const bs=X(rs,[["render",ys]]),pe=Symbol.for("vuetify:v-stepper"),Qe=R({color:String,disabled:{type:[Boolean,String],default:!1},prevText:{type:String,default:"$vuetify.stepper.prev"},nextText:{type:String,default:"$vuetify.stepper.next"}},"VStepperActions"),ws=F()({name:"VStepperActions",props:Qe(),emits:{"click:prev":()=>!0,"click:next":()=>!0},setup(e,t){let{emit:i,slots:o}=t;const{t:s}=Be();function n(){i("click:prev")}function c(){i("click:next")}return Y(()=>{const l={onClick:n},p={onClick:c};return a("div",{class:"v-stepper-actions"},[a(De,{defaults:{VBtn:{disabled:["prev",!0].includes(e.disabled),text:s(e.prevText),variant:"text"}}},{default:()=>{var u;return[((u=o.prev)==null?void 0:u.call(o,{props:l}))??a(D,l,null)]}}),a(De,{defaults:{VBtn:{color:e.color,disabled:["next",!0].includes(e.disabled),text:s(e.nextText),variant:"tonal"}}},{default:()=>{var u;return[((u=o.next)==null?void 0:u.call(o,{props:p}))??a(D,p,null)]}})])}),{}}}),Ze=Ot("v-stepper-header"),ks=R({color:String,title:String,subtitle:String,complete:Boolean,completeIcon:{type:W,default:"$complete"},editable:Boolean,editIcon:{type:W,default:"$edit"},error:Boolean,errorIcon:{type:W,default:"$error"},icon:W,ripple:{type:[Boolean,Object],default:!0},rules:{type:Array,default:()=>[]}},"StepperItem"),Vs=R({...ks(),...Je()},"VStepperItem"),q=F()({name:"VStepperItem",directives:{Ripple:Tt},props:Vs(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:i}=t;const o=Ge(e,pe,!0),s=C(()=>(o==null?void 0:o.value.value)??e.value),n=C(()=>e.rules.every(g=>g()===!0)),c=C(()=>!e.disabled&&e.editable),l=C(()=>!e.disabled&&e.editable),p=C(()=>e.error||!n.value),u=C(()=>e.complete||e.rules.length>0&&n.value),b=C(()=>p.value?e.errorIcon:u.value?e.completeIcon:o.isSelected.value&&e.editable?e.editIcon:e.icon),r=C(()=>({canEdit:l.value,hasError:p.value,hasCompleted:u.value,title:e.title,subtitle:e.subtitle,step:s.value,value:e.value}));return Y(()=>{var O,B,G;const g=(!o||o.isSelected.value||u.value||l.value)&&!p.value&&!e.disabled,S=!!(e.title!=null||i.title),w=!!(e.subtitle!=null||i.subtitle);function H(){o==null||o.toggle()}return V(a("button",{class:["v-stepper-item",{"v-stepper-item--complete":u.value,"v-stepper-item--disabled":e.disabled,"v-stepper-item--error":p.value},o==null?void 0:o.selectedClass.value],disabled:!e.editable,type:"button",onClick:H},[c.value&&Ht(!0,"v-stepper-item"),a(Fe,{key:"stepper-avatar",class:"v-stepper-item__avatar",color:g?e.color:void 0,size:24},{default:()=>{var N;return[((N=i.icon)==null?void 0:N.call(i,r.value))??(b.value?a(A,{icon:b.value},null):s.value)]}}),a("div",{class:"v-stepper-item__content"},[S&&a("div",{key:"title",class:"v-stepper-item__title"},[((O=i.title)==null?void 0:O.call(i,r.value))??e.title]),w&&a("div",{key:"subtitle",class:"v-stepper-item__subtitle"},[((B=i.subtitle)==null?void 0:B.call(i,r.value))??e.subtitle]),(G=i.default)==null?void 0:G.call(i,r.value)])]),[[ze("ripple"),e.ripple&&e.editable,null]])}),{}}}),Ds=e=>{const{touchstartX:t,touchendX:i,touchstartY:o,touchendY:s}=e,n=.5,c=16;e.offsetX=i-t,e.offsetY=s-o,Math.abs(e.offsetY)<n*Math.abs(e.offsetX)&&(e.left&&i<t-c&&e.left(e),e.right&&i>t+c&&e.right(e)),Math.abs(e.offsetX)<n*Math.abs(e.offsetY)&&(e.up&&s<o-c&&e.up(e),e.down&&s>o+c&&e.down(e))};function Ss(e,t){var o;const i=e.changedTouches[0];t.touchstartX=i.clientX,t.touchstartY=i.clientY,(o=t.start)==null||o.call(t,{originalEvent:e,...t})}function _s(e,t){var o;const i=e.changedTouches[0];t.touchendX=i.clientX,t.touchendY=i.clientY,(o=t.end)==null||o.call(t,{originalEvent:e,...t}),Ds(t)}function xs(e,t){var o;const i=e.changedTouches[0];t.touchmoveX=i.clientX,t.touchmoveY=i.clientY,(o=t.move)==null||o.call(t,{originalEvent:e,...t})}function Cs(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:e.left,right:e.right,up:e.up,down:e.down,start:e.start,move:e.move,end:e.end};return{touchstart:i=>Ss(i,t),touchend:i=>_s(i,t),touchmove:i=>xs(i,t)}}function Is(e,t){var l;const i=t.value,o=i!=null&&i.parent?e.parentElement:e,s=(i==null?void 0:i.options)??{passive:!0},n=(l=t.instance)==null?void 0:l.$.uid;if(!o||!n)return;const c=Cs(t.value);o._touchHandlers=o._touchHandlers??Object.create(null),o._touchHandlers[n]=c,Ne(c).forEach(p=>{o.addEventListener(p,c[p],s)})}function Ts(e,t){var n,c;const i=(n=t.value)!=null&&n.parent?e.parentElement:e,o=(c=t.instance)==null?void 0:c.$.uid;if(!(i!=null&&i._touchHandlers)||!o)return;const s=i._touchHandlers[o];Ne(s).forEach(l=>{i.removeEventListener(l,s[l])}),delete i._touchHandlers[o]}const et={mounted:Is,unmounted:Ts},tt=Symbol.for("vuetify:v-window"),lt=Symbol.for("vuetify:v-window-group"),st=R({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||e==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...Me(),...pt(),...ht()},"VWindow"),Te=F()({name:"VWindow",directives:{Touch:et},props:st(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:i}=t;const{themeClasses:o}=ut(e),{isRtl:s}=ct(),{t:n}=Be(),c=qe(e,lt),l=be(),p=C(()=>s.value?!e.reverse:e.reverse),u=de(!1),b=C(()=>{const x=e.direction==="vertical"?"y":"x",M=(p.value?!u.value:u.value)?"-reverse":"";return`v-window-${x}${M}-transition`}),r=de(0),g=be(void 0),S=C(()=>c.items.value.findIndex(x=>c.selected.value.includes(x.id)));mt(S,(x,I)=>{const M=c.items.value.length,Z=M-1;M<=2?u.value=x<I:x===Z&&I===0?u.value=!0:x===0&&I===Z?u.value=!1:u.value=x<I}),ft(tt,{transition:b,isReversed:u,transitionCount:r,transitionHeight:g,rootRef:l});const w=we(()=>e.continuous||S.value!==0),H=we(()=>e.continuous||S.value!==c.items.value.length-1);function O(){w.value&&c.prev()}function B(){H.value&&c.next()}const G=C(()=>{const x=[],I={icon:s.value?e.nextIcon:e.prevIcon,class:`v-window__${p.value?"right":"left"}`,onClick:c.prev,"aria-label":n("$vuetify.carousel.prev")};x.push(w.value?i.prev?i.prev({props:I}):a(D,I,null):a("div",null,null));const M={icon:s.value?e.prevIcon:e.nextIcon,class:`v-window__${p.value?"left":"right"}`,onClick:c.next,"aria-label":n("$vuetify.carousel.next")};return x.push(H.value?i.next?i.next({props:M}):a(D,M,null):a("div",null,null)),x}),N=C(()=>e.touch===!1?e.touch:{...{left:()=>{p.value?O():B()},right:()=>{p.value?B():O()},start:I=>{let{originalEvent:M}=I;M.stopPropagation()}},...e.touch===!0?{}:e.touch});return Y(()=>V(a(e.tag,{ref:l,class:["v-window",{"v-window--show-arrows-on-hover":e.showArrows==="hover"},o.value,e.class],style:e.style},{default:()=>{var x,I;return[a("div",{class:"v-window__container",style:{height:g.value}},[(x=i.default)==null?void 0:x.call(i,{group:c}),e.showArrows!==!1&&a("div",{class:"v-window__controls"},[G.value])]),(I=i.additional)==null?void 0:I.call(i,{group:c})]}}),[[ze("touch"),N.value]])),{group:c}}}),Hs=R({...gt(st(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VStepperWindow"),$s=F()({name:"VStepperWindow",props:Hs(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:i}=t;const o=Ae(pe,null),s=vt(e,"modelValue"),n=C({get(){var c;return s.value!=null||!o?s.value:(c=o.items.value.find(l=>o.selected.value.includes(l.id)))==null?void 0:c.value},set(c){s.value=c}});return Y(()=>{const c=Te.filterProps(e);return a(Te,me({_as:"VStepperWindow"},c,{modelValue:n.value,"onUpdate:modelValue":l=>n.value=l,class:["v-stepper-window",e.class],style:e.style,mandatory:!1,touch:!1}),i)}),{}}}),it=R({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...Me(),...Je(),...Rt()},"VWindowItem"),He=F()({name:"VWindowItem",directives:{Touch:et},props:it(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:i}=t;const o=Ae(tt),s=Ge(e,lt),{isBooted:n}=yt();if(!o||!s)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const c=de(!1),l=C(()=>n.value&&(o.isReversed.value?e.reverseTransition!==!1:e.transition!==!1));function p(){!c.value||!o||(c.value=!1,o.transitionCount.value>0&&(o.transitionCount.value-=1,o.transitionCount.value===0&&(o.transitionHeight.value=void 0)))}function u(){var w;c.value||!o||(c.value=!0,o.transitionCount.value===0&&(o.transitionHeight.value=ke((w=o.rootRef.value)==null?void 0:w.clientHeight)),o.transitionCount.value+=1)}function b(){p()}function r(w){c.value&&bt(()=>{!l.value||!c.value||!o||(o.transitionHeight.value=ke(w.clientHeight))})}const g=C(()=>{const w=o.isReversed.value?e.reverseTransition:e.transition;return l.value?{name:typeof w!="string"?o.transition.value:w,onBeforeEnter:u,onAfterEnter:p,onEnterCancelled:b,onBeforeLeave:u,onAfterLeave:p,onLeaveCancelled:b,onEnter:r}:!1}),{hasContent:S}=Pt(e,s.isSelected);return Y(()=>a($t,{transition:g.value,disabled:!n.value},{default:()=>{var w;return[V(a("div",{class:["v-window-item",s.selectedClass.value,e.class],style:e.style},[S.value&&((w=i.default)==null?void 0:w.call(i))]),[[_,s.isSelected.value]])]}})),{groupItem:s}}}),Os=R({...it()},"VStepperWindowItem"),Bs=F()({name:"VStepperWindowItem",props:Os(),setup(e,t){let{slots:i}=t;return Y(()=>{const o=He.filterProps(e);return a(He,me({_as:"VStepperWindowItem"},o,{class:["v-stepper-window-item",e.class],style:e.style}),i)}),{}}}),zs=R({altLabels:Boolean,bgColor:String,completeIcon:W,editIcon:W,editable:Boolean,errorIcon:W,hideActions:Boolean,items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},nonLinear:Boolean,flat:Boolean,...St()},"Stepper"),Ns=R({...zs(),...Lt({mandatory:"force",selectedClass:"v-stepper-item--selected"}),...At(),...Dt(Qe(),["prevText","nextText"])},"VStepper"),Ms=F()({name:"VStepper",props:Ns(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:i}=t;const{items:o,next:s,prev:n,selected:c}=qe(e,pe),{displayClasses:l,mobile:p}=wt(e),{completeIcon:u,editIcon:b,errorIcon:r,color:g,editable:S,prevText:w,nextText:H}=kt(e),O=C(()=>e.items.map((N,x)=>{const I=Ve(N,e.itemTitle,N),M=Ve(N,e.itemValue,x+1);return{title:I,value:M,raw:N}})),B=C(()=>o.value.findIndex(N=>c.value.includes(N.id))),G=C(()=>e.disabled?e.disabled:B.value===0?"prev":B.value===o.value.length-1?"next":!1);return Vt({VStepperItem:{editable:S,errorIcon:r,completeIcon:u,editIcon:b,prevText:w,nextText:H},VStepperActions:{color:g,disabled:G,prevText:w,nextText:H}}),Y(()=>{const N=ue.filterProps(e),x=!!(i.header||e.items.length),I=e.items.length>0,M=!e.hideActions&&!!(I||i.actions);return a(ue,me(N,{color:e.bgColor,class:["v-stepper",{"v-stepper--alt-labels":e.altLabels,"v-stepper--flat":e.flat,"v-stepper--non-linear":e.nonLinear,"v-stepper--mobile":p.value},l.value,e.class],style:e.style}),{default:()=>{var Z,fe;return[x&&a(Ze,{key:"stepper-header"},{default:()=>[O.value.map((J,ie)=>{let{raw:re,...ve}=J;return a(E,null,[!!ie&&a(U,null,null),a(q,ve,{default:i[`header-item.${ve.value}`]??i.header,icon:i.icon,title:i.title,subtitle:i.subtitle})])})]}),I&&a($s,{key:"stepper-window"},{default:()=>[O.value.map(J=>a(Bs,{value:J.value},{default:()=>{var ie,re;return((ie=i[`item.${J.value}`])==null?void 0:ie.call(i,J))??((re=i.item)==null?void 0:re.call(i,J))}}))]}),(Z=i.default)==null?void 0:Z.call(i,{prev:n,next:s}),M&&(((fe=i.actions)==null?void 0:fe.call(i,{next:s,prev:n}))??a(ws,{key:"stepper-actions","onClick:prev":n,"onClick:next":s},i))]}})}),{prev:n,next:s}}}),As={props:{dialog:{type:Boolean},disabled:{type:Boolean},initialData:{type:Object,default:()=>({})},createRequest:{type:Boolean},isDonation:{type:Boolean}},computed:{currentHeaders(){const e=[],t=this.headers.map(o=>o.key);t.includes("headOfHousehold.taxId")&&e.push({key:"headOfHousehold.taxId",title:"Tax ID",value:"headOfHousehold.taxId"}),t.includes("headOfHousehold.passport")&&e.push({key:"headOfHousehold.passport",title:"Passport",value:"headOfHousehold.passport"}),this.step===4&&e.push({key:"duplicate",title:"Deduplication status",align:"start"});const i=this.headers.filter(o=>!["id","duplicate","headOfHousehold.taxId","headOfHousehold.passport"].includes(o.key));return e.push(...i),e}},data(){return{loading:!1,data:[],headers:[],deduplicationFilter:{},step:1}},methods:{resetData(){this.step=1,this.data=[],this.headers=[]},resetValidation(){let e=this.headers.map(t=>t.key).indexOf("duplicate");e>-1&&this.headers.splice(e,1),this.step=2},closeDialog(){this.$emit("close"),this.step=1}},watch:{step(){this.loading=!1}}},Es={class:"ms-2"},Ls={key:0,class:"flex-grow-1 h-100 d-flex align-center justify-center"};function Ps(e,t,i,o,s,n){const c=bs,l=ss,p=jl,u=zl,b=sl;return f(),T(he,{modelValue:i.dialog,"onUpdate:modelValue":t[18]||(t[18]=r=>e.$emit("close",r)),class:"import-dialog",fullscreen:"",overlay:""},{default:d(()=>[a(ue,{style:{position:"relative"},ref:"dialogHeight"},{default:d(()=>[a(Et,{window:"",color:"primary",style:{top:"0px"},class:"d-flex justify-space-between"},{default:d(()=>[h("span",Es,m(e.$t("Import dialog")),1),a(A,{onClick:n.closeDialog,color:"white",icon:"mdi-close",class:"ms-2 text-white cursor-pointer"},null,8,["onClick"])]),_:1}),a(Ye,{class:"h-100 d-flex flex-column pa-lg-4",fluid:""},{default:d(()=>[a(Ms,{"model-value":s.step,class:"pt-4 ma-0 flex-shrink-0",flat:""},{default:d(()=>[a(Ze,{flat:"",class:"pa-0 ma-0 elevation-0"},{default:d(()=>[a(q,{onClick:n.resetData,title:e.$t("Upload your data"),value:1,color:"primary",editable:s.step>1,complete:s.step>1},null,8,["onClick","title","editable","complete"]),a(U),a(q,{onClick:n.resetValidation,title:e.$t("Check the result"),value:2,color:"primary",editable:s.step>2,complete:s.step>2},null,8,["onClick","title","editable","complete"]),a(U),a(q,{onClick:t[0]||(t[0]=r=>s.step=3),title:e.$t("Deduplication setup"),value:3,color:"primary",editable:s.step>3,complete:s.step>3},null,8,["title","editable","complete"]),a(U),a(U),a(q,{onClick:t[1]||(t[1]=r=>s.step=4),title:e.$t("Deduplication"),value:4,color:"primary",editable:s.step>4,complete:s.step>4},null,8,["title","editable","complete"]),a(U),a(q,{title:e.$t("Import the data"),value:5,color:"primary",editable:s.step>5,complete:s.step>5},null,8,["title","editable","complete"])]),_:1})]),_:1},8,["model-value"]),s.loading?(f(),v("div",Ls,[a(Ee,{indeterminate:"",color:"primary",size:"x-large"})])):k("",!0),s.step===1?(f(),T(c,{key:1,modelValue:s.data,"onUpdate:modelValue":t[2]||(t[2]=r=>s.data=r),class:$({"d-none":s.loading}),disabled:i.disabled,"initial-data":i.initialData,onSetLoading:t[3]||(t[3]=r=>s.loading=r),onSetStep:t[4]||(t[4]=r=>s.step=r),onSetHeaders:t[5]||(t[5]=r=>s.headers=r),onSetBundle:t[6]||(t[6]=r=>i.initialData.bundleName=r)},null,8,["modelValue","class","disabled","initial-data"])):k("",!0),s.step===2?(f(),T(l,{key:2,modelValue:s.data,"onUpdate:modelValue":t[7]||(t[7]=r=>s.data=r),headers:n.currentHeaders,"initial-data":i.initialData,class:$({"d-none":s.loading}),"dialog-height":e.$refs.dialogHeight.$el.offsetHeight,onSetLoading:t[8]||(t[8]=r=>s.loading=r),onSetStep:t[9]||(t[9]=r=>s.step=r)},null,8,["modelValue","headers","initial-data","class","dialog-height"])):k("",!0),s.step===3?(f(),T(p,{key:3,modelValue:s.data,"onUpdate:modelValue":t[10]||(t[10]=r=>s.data=r),class:$({"d-none":s.loading}),filter:s.deduplicationFilter,onSetLoading:t[11]||(t[11]=r=>s.loading=r),onSetStep:t[12]||(t[12]=r=>s.step=r)},null,8,["modelValue","class","filter"])):k("",!0),s.step===4?(f(),T(u,{key:4,modelValue:s.data,"onUpdate:modelValue":t[13]||(t[13]=r=>s.data=r),headers:n.currentHeaders,"initial-data":i.initialData,class:$({"d-none":s.loading}),"dialog-height":e.$refs.dialogHeight.$el.offsetHeight,onSetLoading:t[14]||(t[14]=r=>s.loading=r),onSetStep:t[15]||(t[15]=r=>s.step=r)},null,8,["modelValue","headers","initial-data","class","dialog-height"])):k("",!0),s.step===5?(f(),T(b,{key:5,modelValue:s.data,"onUpdate:modelValue":t[16]||(t[16]=r=>s.data=r),headers:n.currentHeaders,"initial-data":i.initialData,"is-donation":i.isDonation,class:$({"d-none":s.loading}),onClose:n.closeDialog,onImported:t[17]||(t[17]=r=>e.$emit("imported",r))},null,8,["modelValue","headers","initial-data","is-donation","class","onClose"])):k("",!0)]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}const fi=X(As,[["render",Ps]]);export{fi as _};

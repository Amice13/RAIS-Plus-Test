import{h as U,p as R,K as se,t as V,m as N,a as s,I as J,_ as K,a2 as Ve,v as xe,c as y,o as m,w as i,x as c,F as x,A as b,C as f,y as u,z as k,B as S,Y as ie,G as T,H as O,ac as re,P as ne,aj as Se,b as $,ak as Ie,al as Ce,L as le,J as de,am as Fe,O as _e,T as Pe,an as De}from"./index-BtIo2-Z_.js";import{a as X,b as oe,V as L}from"./VCard-DNHZbZ5d.js";import{V as q}from"./VChip-CKNl8kC9.js";import{j as we,V as C,R as Be,b as ue,g as me,p as Ee,d as Te,e as Oe,q as Ae}from"./index-SDX8Otz2.js";import{V as M}from"./VSpacer-bp7-SSB-.js";import{V as _}from"./VBtn--bGuKZaN.js";import{_ as fe}from"./CustomDate-CLArRqjL.js";import{d as Z}from"./debouncer-Whu4ZLob.js";import{V as ze}from"./VMenu-Cs322VI3.js";import{V as ce}from"./VContainer-BFGIFtcM.js";import{a as D,V as F}from"./VRow-9vAZildp.js";import{V as A}from"./VTextField-Bn35T3UG.js";import{V as ee}from"./VProgressCircular-DNPB7izS.js";import{V as he,a as pe,b as be}from"./VList-Cnqqz-5U.js";import{V as Ue,a as Re}from"./VToolbar-o4oksDe3.js";import{a as Ne}from"./index-C5-hvfiu.js";import{a as je,b as $e}from"./VOverlay-BnbjS8dz.js";import{u as Le,m as qe,a as Me,b as Je}from"./group-DgRBM2CV.js";import{V as Ke}from"./VDialog-CNptTdRK.js";import{d as Ge}from"./searchProcessor-BfIe0Ps2.js";import{b as ae}from"./route-block-B_A1xBdJ.js";import{V as He}from"./VPagination-zp71F-1D.js";import"./VAvatar-l5UJO0sV.js";import"./VImg-FY_z5S7Z.js";/* empty css              */import"./forwardRefs--KQCZfKO.js";import"./dialog-transition-Dq7CKyny.js";import"./VInput-CRZE-Mt3.js";const Ye=R({...J(),...we({variant:"text"})},"VToolbarItems"),Qe=U()({name:"VToolbarItems",props:Ye(),setup(e,t){let{slots:l}=t;return se({VBtn:{color:V(()=>e.color),height:"inherit",variant:V(()=>e.variant)}}),N(()=>{var d;return s("div",{class:["v-toolbar-items",e.class],style:e.style},[(d=l.default)==null?void 0:d.call(l)])}),{}}}),We={name:"DistributionCard",props:{mode:{type:String,default:"edit"},modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},translated(){return this.$_translate(this.modelValue)}},methods:{formatAddress:Ve}},Xe={class:"text-h6 mt-2 title-link",style:{"font-size":"120% !important"}},Ze={class:"text-caption mb-2",style:{"font-size":"80% !important"}},et={class:"text-caption"},tt={class:"cursor-pointer flip-url"},lt={class:"mb-4"},at={key:0},st={key:1};function it(e,t,l,d,r,a){const p=xe("router-link");return m(),y(L,{class:"pa-0 flip-card-front h-100 d-flex flex-column border-left-primary distribution-card"},{default:i(()=>[s(X,{class:"pb-0"},{default:i(()=>{var n;return[c("div",null,[s(q,{size:"x-small",label:"",color:"primary",variant:"flat",class:"mr-1"},{default:i(()=>[f(u(e.$t("Distribution")),1)]),_:1}),s(q,{size:"x-small",label:"",color:a.model.status==="Requested"?"orange-darken-2":"green",variant:"tonal"},{default:i(()=>[f(u(e.$t(a.model.status)),1)]),_:1},8,["color"])]),c("div",Xe,[s(p,{to:`/distributions/${a.model.id}`,tag:"a"},{default:i(()=>[f(u(e.$t(a.model.bundleName)),1)]),_:1},8,["to"])]),c("div",Ze,u(a.model.publicId),1),c("div",et,[c("span",tt,[s(C,{size:"small"},{default:i(()=>t[1]||(t[1]=[f("mdi-calendar")])),_:1}),f(" "+u(new Date(a.model.date).toLocaleDateString("uk")),1)]),f(" · "+u(e.$t(a.model.aor)),1)]),t[3]||(t[3]=c("hr",{class:"mb-4"},null,-1)),c("div",lt,[c("strong",null,u(e.$t("Items"))+":",1),t[2]||(t[2]=c("br",null,null,-1)),f(" "+u(a.model.items.map(o=>e.$t(o.key)).join(", ")),1)]),(n=a.model.address)!=null&&n.street?(m(),x("div",at,[c("strong",null,u(e.$t("Address"))+":",1),f(" "+u(a.formatAddress(a.model.address)),1)])):b("",!0),a.model.address.pCode4?(m(),x("div",st,[c("div",null,[c("strong",null,u(e.$t("Municipality"))+":",1),f(" "+u(e.$t(a.model.address.pCode4)),1)]),c("div",null,[c("strong",null,u(e.$t("Hromada"))+":",1),f(" "+u(e.$t(a.model.address.pCode4.substring(0,9))),1)]),c("div",null,[c("strong",null,u(e.$t("Raion"))+":",1),f(" "+u(e.$t(a.model.address.pCode4.substring(0,6))),1)]),c("div",null,[c("strong",null,u(e.$t("Oblast"))+":",1),f(" "+u(e.$t(a.model.address.pCode4.substring(0,4))),1)])])):b("",!0)]}),_:1}),s(M),s(oe,null,{default:i(()=>[s(M),k(s(_,{onClick:t[0]||(t[0]=n=>e.$router.push(`/distributions/${a.model.id}`)),color:"primary","prepend-icon":"mdi-play",variant:"tonal",class:"pl-3 pr-3"},{default:i(()=>[f(u(e.$t("Start")),1)]),_:1},512),[[S,l.mode==="view"]])]),_:1})]),_:1})}const rt=K(We,[["render",it]]),H=e=>{const[t,l]=e.split(/\./g);return l==="0"||t.length===3?t:e},nt=e=>e/10**9>1?H((e/10**9).toFixed(1))+"B":e/10**6>1?H((e/10**6).toFixed(1))+"M":e/10**3>1?H((e/10**3).toFixed(1))+"K":e,dt={name:"CustomFilterButton",props:{table:{type:String},field:{type:Object,default:{}},datatable:{type:Object,default:{}}},data(){return{loading:!1,search:void 0,items:[],menu:!1}},computed:{singleName(){var t,l;return this.field.type==="term"?this.$t((l=(t=this.datatable)==null?void 0:t.filters)==null?void 0:l[this.title][0]):this.items.find(d=>{var r;return d.key===((r=this.datatable)==null?void 0:r.filters[this.key][0])})[this.title]||this.$t("Multiple")},title(){let e=this.field.value;return this.field.translated&&this.$i18n.locale!=="en"&&(e=this.field.translated),e},key(){return this.field.filterId||this.field.value},startDate:{get(){return this.datatable.start},set(e){this.$emit("setStart",e)}},endDate:{get(){return this.datatable.end},set(e){this.$emit("setEnd",e)}},showItems(){if(!this.search)return this.items;const e=new RegExp(this.search.replace(/[|\\{}()[\]^$+*?.]/g,".").replace(/-/g,"\\-"),"gi");return this.items.filter(t=>{var d;let l=t.title.replace("@","＠");return this.$i18n.locale!=="en"&&((d=this.field)!=null&&d.translated)?l.match(e):this.$t(l).match(e)})},filterIsSet(){var e,t,l,d,r;return(t=(e=this.datatable)==null?void 0:e.filters)!=null&&t[this.key]?((r=(d=(l=this.datatable)==null?void 0:l.filters)==null?void 0:d[this.key])==null?void 0:r.length)>0:!1},filterIsSorted(){var e,t;return(e=this.datatable.sortBy)!=null&&e[0]?((t=this.datatable.sortBy)==null?void 0:t[0].key)===this.key:!1},numberOfFilters(){var e,t,l;return((l=(t=(e=this.datatable)==null?void 0:e.filters)==null?void 0:t[this.key])==null?void 0:l.length)||0}},methods:{setSearch:Z(function(){if(!this.menu)return!1;this.loadItems()}),async loadItems(){var a,p,n;if(!((a=this.field)!=null&&a.filterable)||this.field.type==="date")return!1;this.loading=!0;let e=this.$storage[this.table];if(this.index&&(e=e.useIndex(this.index)),this.datatable.filters){const o={...this.datatable.filters};delete o[this.key],e=e.filter(o)}if(this.search&&(e=e.should({[this.title]:{$regex:this.search}})),this.datatable.end||this.datatable.start){const o=Object.fromEntries([["$lte",this.datatable.end],["$gte",this.datatable.start]].filter(([,h])=>h));e=e.filter({date:o})}e=e.sort([{value:"desc"},{[this.key]:"asc"}]);const t={groupBy:[this.key],aggs:{value:{variable:"id",operation:"count"}}};this.field.filterId&&t.groupBy.push(this.title);let l=await e.aggregate(t);l=l.map(o=>(o.key||(o.key=o[this.key],o.title=o[this.title]),o));const d=l.map(o=>o.key),r=((n=(p=this.datatable)==null?void 0:p.filters)==null?void 0:n[this.key])||[];for(let o of r)d.includes(o)||l.push({key:o,value:0});this.items=l,this.loading=!1},isSorted({value:e}){var l,d,r,a;return(l=this.datatable)!=null&&l.sortBy?(Array.isArray((d=this.datatable)==null?void 0:d.sortBy)?(r=this.datatable)==null?void 0:r.sortBy[0]:(a=this.datatable)==null?void 0:a.sortBy).key===e:!1},isFiltered({value:e}){var t;if(!((t=this.datatable)!=null&&t.filters))return!1;for(let[l,d]of Object.entries(this.datatable.filters))if(l===e&&d.length)return!0},getIcon(e){var t,l;return this.isSorted(e)?(Array.isArray(this.datatable.sortBy)?(t=this.datatable)==null?void 0:t.sortBy[0]:(l=this.datatable)==null?void 0:l.sortBy).order==="desc"?"mdi-sort-descending":"mdi-sort-ascending":this.isFiltered(e)?"mdi-filter":"mdi-chevron-down"},setSort(e){this.$emit("setSort",{key:this.title,order:e}),this.menu=!1},hasFilter(e){var t,l,d,r;return(l=(t=this.datatable)==null?void 0:t.filters)!=null&&l[this.key]?(r=(d=this.datatable)==null?void 0:d.filters)==null?void 0:r[this.key].includes(e):!1},switchFilter(e){const t={...this.datatable.filters};t[this.key]=t[this.key]||[];let l=t[this.key].indexOf(e);return l>=0?(t[this.key].splice(l,1),t[this.key].length||delete t[this.key],this.$emit("setFilter",t)):(t[this.key].push(e),this.$emit("setFilter",t))},resetAllFilters(){const e=JSON.parse(JSON.stringify(this.datatable.filters));return delete e[this.key],this.$emit("setFilter",e)},simplifyCount:nt,formatDate:ie},watch:{menu(e){e&&this.loadItems()}}},ot={key:0},ut={key:0,class:"mr-1"},mt={key:1,class:"mr-1"},ft={key:2},ct={key:3},ht={key:4},pt={key:1},bt={key:2},yt={class:"mb-2"},vt={class:"text-center"},gt={style:{width:"36px"}};function kt(e,t,l,d,r,a){const p=fe;return m(),y(_,{class:re(["filter-button mr-2 mb-2",{"is-sorted":a.filterIsSorted}]),size:"small",color:a.filterIsSet?"grey-lighten-2":"grey-darken-1","prepend-icon":l.field.icon,variant:a.filterIsSet?"flat":"tonal"},{default:i(()=>[f(u(e.$t(l.field.title))+" ",1),l.field.type==="date"&&(a.startDate||a.endDate)?(m(),x("span",ot,[t[8]||(t[8]=c("span",null,": ",-1)),a.startDate?b("",!0):(m(),x("span",ut,u(e.$t("before")),1)),a.endDate?b("",!0):(m(),x("span",mt,u(e.$t("after")),1)),a.startDate?(m(),x("span",ft,u(a.formatDate(a.startDate).toLocaleDateString("uk")),1)):b("",!0),a.startDate&&a.endDate?(m(),x("span",ct," - ")):b("",!0),a.endDate?(m(),x("span",ht,u(a.formatDate(a.endDate).toLocaleDateString("uk")),1)):b("",!0)])):b("",!0),a.numberOfFilters===1?(m(),x("span",pt,": "+u(a.singleName),1)):b("",!0),a.numberOfFilters>1?(m(),x("span",bt,": "+u(e.$t("Multiple")),1)):b("",!0),s(ze,{activator:"parent",transition:"slide-y-transition","close-on-content-click":!1,modelValue:r.menu,"onUpdate:modelValue":t[7]||(t[7]=n=>r.menu=n)},{default:i(()=>[s(L,{"max-width":"350",width:"350"},{default:i(()=>[s(X,{class:"pa-0"},{default:i(()=>[l.field.sortable?(m(),y(_,{key:0,onClick:t[0]||(t[0]=n=>a.setSort("asc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:i(()=>[s(C,{class:"mr-2"},{default:i(()=>t[9]||(t[9]=[f("mdi-sort-ascending")])),_:1}),f(" "+u(e.$t("Sort ascending")),1)]),_:1})):b("",!0),l.field.sortable?(m(),y(_,{key:1,onClick:t[1]||(t[1]=n=>a.setSort("desc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:i(()=>[s(C,{class:"mr-2"},{default:i(()=>t[10]||(t[10]=[f("mdi-sort-descending")])),_:1}),f(" "+u(e.$t("Sort descending")),1)]),_:1})):b("",!0),l.field.filterable?(m(),y(ce,{key:2},{default:i(()=>[s(D,null,{default:i(()=>[s(F,{cols:"12"},{default:i(()=>[c("div",yt,[c("strong",null,u(e.$t("Filter").toUpperCase()),1)]),l.field.type==="date"?(m(),y(p,{key:0,modelValue:a.startDate,"onUpdate:modelValue":t[2]||(t[2]=n=>a.startDate=n),clearable:"",label:e.$t("Start date"),class:"mt-4"},null,8,["modelValue","label"])):b("",!0),l.field.type==="date"?(m(),y(p,{key:1,modelValue:a.endDate,"onUpdate:modelValue":t[3]||(t[3]=n=>a.endDate=n),clearable:"",label:e.$t("End date")},null,8,["modelValue","label"])):b("",!0),l.field.type==="term"?(m(),y(A,{key:2,modelValue:r.search,"onUpdate:modelValue":[t[4]||(t[4]=n=>r.search=n),a.setSearch],label:e.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])):b("",!0),l.field.type==="string"?(m(),y(A,{key:3,modelValue:r.search,"onUpdate:modelValue":t[5]||(t[5]=n=>r.search=n),label:e.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","label"])):b("",!0)]),_:1}),l.field.type!=="date"?(m(),y(F,{key:0,cols:"12",class:"pa-0"},{default:i(()=>[k(c("div",vt,[s(ee,{indeterminate:"",color:"primary"})],512),[[S,r.loading]]),k(s(he,{class:"custom-thumb",nav:"",density:"compact",lines:!1,"max-height":"200"},{default:i(()=>[(m(!0),x(T,null,O(a.showItems,n=>(m(),y(pe,{onClick:o=>a.switchFilter(n.key),key:n.key,density:"compact"},{prepend:i(()=>[c("div",gt,[k(s(C,null,{default:i(()=>t[11]||(t[11]=[f("mdi-checkbox-blank-outline")])),_:2},1536),[[S,!a.hasFilter(n.key)]]),k(s(C,null,{default:i(()=>t[12]||(t[12]=[f("mdi-checkbox-outline")])),_:2},1536),[[S,a.hasFilter(n.key)]])])]),append:i(()=>[s(q,{size:"x-small"},{default:i(()=>[f(u(a.simplifyCount(n.value)),1)]),_:2},1024)]),default:i(()=>[s(be,{class:"pr-2"},{default:i(()=>{var o;return[f(u(l.field.type==="term"?e.$t((o=n==null?void 0:n.title)==null?void 0:o.replace("@","＠")):n==null?void 0:n.title),1)]}),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},512),[[S,!r.loading]])]),_:1})):b("",!0)]),_:1})]),_:1})):b("",!0)]),_:1}),l.field.filterable?(m(),y(oe,{key:0},{default:i(()=>[k(s(_,{onClick:a.resetAllFilters,size:"x-small"},{default:i(()=>[s(C,{class:"mr-2"},{default:i(()=>t[13]||(t[13]=[f("mdi-checkbox-blank-outline")])),_:1}),f(" "+u(e.$t("Reset all")),1)]),_:1},8,["onClick"]),[[S,a.filterIsSet]]),s(M),s(_,{onClick:t[6]||(t[6]=n=>r.menu=!1),size:"x-small"},{default:i(()=>[f(u(e.$t("Close")),1)]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class","color","prepend-icon","variant"])}const Vt=K(dt,[["render",kt]]),z=Symbol.for("vuetify:v-expansion-panel"),ye=R({...J(),...$e()},"VExpansionPanelText"),Q=U()({name:"VExpansionPanelText",props:ye(),setup(e,t){let{slots:l}=t;const d=ne(z);if(!d)throw new Error("[Vuetify] v-expansion-panel-text needs to be placed inside v-expansion-panel");const{hasContent:r,onAfterLeave:a}=je(e,d.isSelected);return N(()=>s(Ne,{onAfterLeave:a},{default:()=>{var p;return[k(s("div",{class:["v-expansion-panel-text",e.class],style:e.style},[l.default&&r.value&&s("div",{class:"v-expansion-panel-text__wrapper"},[(p=l.default)==null?void 0:p.call(l)])]),[[S,d.isSelected.value]])]}})),{}}}),ve=R({color:String,expandIcon:{type:le,default:"$expand"},collapseIcon:{type:le,default:"$collapse"},hideActions:Boolean,focusable:Boolean,static:Boolean,ripple:{type:[Boolean,Object],default:!1},readonly:Boolean,...J(),...Ce()},"VExpansionPanelTitle"),W=U()({name:"VExpansionPanelTitle",directives:{Ripple:Be},props:ve(),setup(e,t){let{slots:l}=t;const d=ne(z);if(!d)throw new Error("[Vuetify] v-expansion-panel-title needs to be placed inside v-expansion-panel");const{backgroundColorClasses:r,backgroundColorStyles:a}=ue(()=>e.color),{dimensionStyles:p}=Se(e),n=$(()=>({collapseIcon:e.collapseIcon,disabled:d.disabled.value,expanded:d.isSelected.value,expandIcon:e.expandIcon,readonly:e.readonly})),o=V(()=>d.isSelected.value?e.collapseIcon:e.expandIcon);return N(()=>{var h;return k(s("button",{class:["v-expansion-panel-title",{"v-expansion-panel-title--active":d.isSelected.value,"v-expansion-panel-title--focusable":e.focusable,"v-expansion-panel-title--static":e.static},r.value,e.class],style:[a.value,p.value,e.style],type:"button",tabindex:d.disabled.value?-1:void 0,disabled:d.disabled.value,"aria-expanded":d.isSelected.value,onClick:e.readonly?void 0:d.toggle},[s("span",{class:"v-expansion-panel-title__overlay"},null),(h=l.default)==null?void 0:h.call(l,n.value),!e.hideActions&&s(me,{defaults:{VIcon:{icon:o.value}}},{default:()=>{var g;return[s("span",{class:"v-expansion-panel-title__icon"},[((g=l.actions)==null?void 0:g.call(l,n.value))??s(C,null,null)])]}})]),[[Ie("ripple"),e.ripple]])}),{}}}),ge=R({title:String,text:String,bgColor:String,...Ae(),...qe(),...Oe(),...de(),...ve(),...ye()},"VExpansionPanel"),xt=U()({name:"VExpansionPanel",props:ge(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:l}=t;const d=Le(e,z),{backgroundColorClasses:r,backgroundColorStyles:a}=ue(()=>e.bgColor),{elevationClasses:p}=Ee(e),{roundedClasses:n}=Te(e),o=V(()=>(d==null?void 0:d.disabled.value)||e.disabled),h=$(()=>d.group.items.value.reduce((P,I,B)=>(d.group.selected.value.includes(I.id)&&P.push(B),P),[])),g=$(()=>{const P=d.group.items.value.findIndex(I=>I.id===d.id);return!d.isSelected.value&&h.value.some(I=>I-P===1)}),w=$(()=>{const P=d.group.items.value.findIndex(I=>I.id===d.id);return!d.isSelected.value&&h.value.some(I=>I-P===-1)});return Fe(z,d),N(()=>{const P=!!(l.text||e.text),I=!!(l.title||e.title),B=W.filterProps(e),j=Q.filterProps(e);return s(e.tag,{class:["v-expansion-panel",{"v-expansion-panel--active":d.isSelected.value,"v-expansion-panel--before-active":g.value,"v-expansion-panel--after-active":w.value,"v-expansion-panel--disabled":o.value},n.value,r.value,e.class],style:[a.value,e.style]},{default:()=>[s("div",{class:["v-expansion-panel__shadow",...p.value]},null),s(me,{defaults:{VExpansionPanelTitle:{...B},VExpansionPanelText:{...j}}},{default:()=>{var E;return[I&&s(W,{key:"title"},{default:()=>[l.title?l.title():e.title]}),P&&s(Q,{key:"text"},{default:()=>[l.text?l.text():e.text]}),(E=l.default)==null?void 0:E.call(l)]}})]})}),{groupItem:d}}}),St=["default","accordion","inset","popout"],It=R({flat:Boolean,...Je(),...De(ge(),["bgColor","collapseIcon","color","eager","elevation","expandIcon","focusable","hideActions","readonly","ripple","rounded","tile","static"]),...Pe(),...J(),...de(),variant:{type:String,default:"default",validator:e=>St.includes(e)}},"VExpansionPanels"),Ct=U()({name:"VExpansionPanels",props:It(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:l}=t;const{next:d,prev:r}=Me(e,z),{themeClasses:a}=_e(e),p=V(()=>e.variant&&`v-expansion-panels--variant-${e.variant}`);return se({VExpansionPanel:{bgColor:V(()=>e.bgColor),collapseIcon:V(()=>e.collapseIcon),color:V(()=>e.color),eager:V(()=>e.eager),elevation:V(()=>e.elevation),expandIcon:V(()=>e.expandIcon),focusable:V(()=>e.focusable),hideActions:V(()=>e.hideActions),readonly:V(()=>e.readonly),ripple:V(()=>e.ripple),rounded:V(()=>e.rounded),static:V(()=>e.static)}}),N(()=>s(e.tag,{class:["v-expansion-panels",{"v-expansion-panels--flat":e.flat,"v-expansion-panels--tile":e.tile},a.value,p.value,e.class],style:e.style},{default:()=>{var n;return[(n=l.default)==null?void 0:n.call(l,{prev:r,next:d})]}})),{next:d,prev:r}}}),Y=e=>{const[t,l]=e.split(/\./g);return l==="0"||t.length===3?t:e},Ft=e=>e/10**9>1?Y((e/10**9).toFixed(1))+"B":e/10**6>1?Y((e/10**6).toFixed(1))+"M":e/10**3>1?Y((e/10**3).toFixed(1))+"K":e,_t={props:{fields:{type:Array,default:()=>[]},table:{type:String},datatable:{type:Object,default:{}}},data(){return{filter:void 0,dialog:!1,loading:!1,search:void 0,items:[],menu:!1}},computed:{currentFilter(){return this.fields[this.filter]},startDate:{get(){return this.datatable.start},set(e){this.$emit("setStart",e)}},endDate:{get(){return this.datatable.end},set(e){this.$emit("setEnd",e)}},showItems(){if(!this.search)return this.items;const e=new RegExp(this.search.replace(/[|\\{}()[\]^$+*?.]/g,".").replace(/-/g,"\\-"),"gi");return this.items.filter(t=>{var d;let l=t.title.replace("@","＠");return this.$i18n.locale!=="en"&&((d=this.currentFilter)!=null&&d.translated)?l.match(e):this.$t(l).match(e)})},filterIsSet(){var e,t,l,d;return(t=(e=this.datatable)==null?void 0:e.filters)!=null&&t[this.key]?(d=(l=this.datatable)==null?void 0:l.filters)==null?void 0:d[this.key].length:!1},filterIsSorted(){var e,t;return(e=this.datatable.sortBy)!=null&&e[0]?((t=this.datatable.sortBy)==null?void 0:t[0].key)===this.field.value:!1},numberOfFilters(){var e,t,l;return((l=(t=(e=this.datatable)==null?void 0:e.filters)==null?void 0:t[this.field.value])==null?void 0:l.length)||0}},methods:{setSearch:Z(function(){this.loadItems()}),async loadItems(){var a,p,n;if(!this.currentFilter||!((a=this.currentFilter)!=null&&a.filterable)||this.currentFilter.type==="date")return!1;this.loading=!0;let e=this.$storage[this.table];if(this.index&&(e=e.useIndex(this.index)),this.datatable.filters){const o={...this.datatable.filters};delete o[this.key],e=e.filter(o)}if(this.search&&(e=e.should({[this.title]:{$regex:this.search}})),this.datatable.end||this.datatable.start){const o=Object.fromEntries([["$lte",this.datatable.end],["$gte",this.datatable.start]].filter(([,h])=>h));e=e.filter({date:o})}e=e.sort([{value:"desc"},{[this.key]:"asc"}]);const t={groupBy:[this.key],aggs:{value:{variable:"id",operation:"count"}}};this.currentFilter.filterId&&t.groupBy.push(this.title);let l=await e.aggregate(t);l=l.map(o=>(o.key||(o.key=o[this.key],o.title=o[this.title]),o));const d=l.map(o=>o.key),r=((n=(p=this.datatable)==null?void 0:p.filters)==null?void 0:n[this.key])||[];for(let o of r)d.includes(o)||l.push({key:o,value:0});this.items=l,this.loading=!1},setSort(e){this.$emit("setSort",{key:this.currentFilter.value,order:e}),this.menu=!1},isFiltered(e){},hasFilter(e){var t,l,d,r,a,p;return(d=(t=this.datatable)==null?void 0:t.filters)!=null&&d[(l=this.currentFilter)==null?void 0:l.value]?(p=(r=this.datatable)==null?void 0:r.filters)==null?void 0:p[(a=this.currentFilter)==null?void 0:a.value].includes(e):!1},switchFilter(e){var d,r,a,p,n,o,h;const t=JSON.parse(JSON.stringify(this.datatable.filters));t[(d=this.currentFilter)==null?void 0:d.value]||(t[(r=this.currentFilter)==null?void 0:r.value]=[]);let l=t[(a=this.currentFilter)==null?void 0:a.value].indexOf(e);return l>=0?(t[(p=this.currentFilter)==null?void 0:p.value].splice(l,1),t[(n=this.currentFilter)==null?void 0:n.value].length||delete t[(o=this.currentFilter)==null?void 0:o.value],this.$emit("setFilter",t)):(t[(h=this.currentFilter)==null?void 0:h.value].push(e),this.$emit("setFilter",t))},resetAllFilters(){var t;const e=JSON.parse(JSON.stringify(this.datatable.filters));return delete e[(t=this.currentFilter)==null?void 0:t.value],this.$emit("setFilter",e)},simplifyCount:Ft,formatDate:ie},watch:{filter(){this.loadItems()}}},Pt={class:"mt-1"},Dt={class:"text-center"},wt={style:{width:"36px"}},Bt={class:"mr-2 ml-2 mt-8"};function Et(e,t,l,d,r,a){const p=fe;return m(),x("div",null,[s(_,{onClick:t[0]||(t[0]=n=>r.dialog=!0),class:"custom-fab",location:"bottom right",position:"fixed",color:"primary",icon:"mdi-filter"}),s(Ke,{modelValue:r.dialog,"onUpdate:modelValue":t[8]||(t[8]=n=>r.dialog=n),transition:"dialog-bottom-transition",fullscreen:""},{default:i(()=>[s(L,{class:"custom-filter-dialog h-100"},{default:i(()=>[s(Ue,{color:"primary",density:"compact"},{default:i(()=>[s(C,{class:"ml-4"},{default:i(()=>t[9]||(t[9]=[f(" mdi-filter ")])),_:1}),s(Re,null,{default:i(()=>[f(u(e.$t("Filters")),1)]),_:1}),s(M),s(Qe,null,{default:i(()=>[s(_,{icon:"mdi-close",onClick:t[1]||(t[1]=n=>r.dialog=!1)})]),_:1})]),_:1}),s(Ct,{modelValue:r.filter,"onUpdate:modelValue":t[6]||(t[6]=n=>r.filter=n)},{default:i(()=>[(m(!0),x(T,null,O(l.fields,n=>(m(),y(xt,{key:n.value,elevation:"0"},{default:i(()=>{var o,h,g,w,P,I;return[s(W,{class:re({"text-primary-lighten-1":((g=(h=(o=l.datatable)==null?void 0:o.filters)==null?void 0:h[n==null?void 0:n.value])==null?void 0:g.length)>0,"font-weight-bold":((I=(P=(w=l.datatable)==null?void 0:w.filters)==null?void 0:P[n==null?void 0:n.value])==null?void 0:I.length)>0})},{default:i(()=>[s(C,{class:"mr-4"},{default:i(()=>[f(u(n.icon),1)]),_:2},1024),c("div",Pt,u(e.$t(n.title)),1)]),_:2},1032,["class"]),s(Q,null,{default:i(()=>[s(L,{elevation:"0"},{default:i(()=>[s(X,{class:"pa-0"},{default:i(()=>[n.filterable?(m(),y(ce,{key:0},{default:i(()=>{var B,j,E,te;return[s(D,null,{default:i(()=>[s(F,{cols:"12"},{default:i(()=>[n.type==="date"?(m(),y(p,{key:0,modelValue:a.startDate,"onUpdate:modelValue":t[2]||(t[2]=v=>a.startDate=v),clearable:"",label:e.$t("Start date"),class:"mt-4"},null,8,["modelValue","label"])):b("",!0),n.type==="date"?(m(),y(p,{key:1,modelValue:a.endDate,"onUpdate:modelValue":t[3]||(t[3]=v=>a.endDate=v),clearable:"",label:e.$t("End date")},null,8,["modelValue","label"])):b("",!0),n.type==="term"?(m(),y(A,{key:2,modelValue:r.search,"onUpdate:modelValue":t[4]||(t[4]=v=>r.search=v),label:e.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","label"])):b("",!0),n.type==="string"?(m(),y(A,{key:3,modelValue:r.search,"onUpdate:modelValue":[t[5]||(t[5]=v=>r.search=v),a.setSearch],label:e.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])):b("",!0)]),_:2},1024),n.type!=="date"?(m(),y(F,{key:0,cols:"12",class:"pa-0"},{default:i(()=>[k(c("div",Dt,[s(ee,{indeterminate:"",color:"primary"})],512),[[S,r.loading]]),k(s(he,{class:"custom-thumb",nav:"",lines:!1,"max-height":"200"},{default:i(()=>[(m(!0),x(T,null,O(a.showItems,v=>(m(),y(pe,{onClick:G=>a.switchFilter(v.key),key:v.key,density:"compact"},{prepend:i(()=>[c("div",wt,[k(s(C,null,{default:i(()=>t[10]||(t[10]=[f("mdi-checkbox-blank-outline")])),_:2},1536),[[S,!a.hasFilter(v.key)]]),k(s(C,null,{default:i(()=>t[11]||(t[11]=[f("mdi-checkbox-outline")])),_:2},1536),[[S,a.hasFilter(v.key)]])])]),append:i(()=>[s(q,{size:"small"},{default:i(()=>[f(u(a.simplifyCount(v.value)),1)]),_:2},1024)]),default:i(()=>[s(be,{class:"pr-2 f-100"},{default:i(()=>{var G;return[f(u(a.currentFilter.type==="term"?e.$t((G=v==null?void 0:v.title)==null?void 0:G.replace("@","＠")):v==null?void 0:v.title),1)]}),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},512),[[S,!r.loading]])]),_:1})):b("",!0)]),_:2},1024),k(s(_,{onClick:a.resetAllFilters,size:"x-small"},{default:i(()=>[s(C,{class:"mr-2"},{default:i(()=>t[12]||(t[12]=[f("mdi-checkbox-blank-outline")])),_:1}),f(" "+u(e.$t("Reset all")),1)]),_:1},8,["onClick"]),[[S,a.filterIsSet]]),a.currentFilter&&((B=a.currentFilter)==null?void 0:B.type)!=="date"&&!r.loading&&((te=(E=(j=l.datatable)==null?void 0:j.filters)==null?void 0:E[n==null?void 0:n.value])!=null&&te.length)?(m(),y(_,{key:0,onClick:a.resetAllFilters,color:"primary-lighten-4",class:"mt-6",size:"small",elevation:"0"},{default:i(()=>[s(C,{class:"mr-2",size:"large"},{default:i(()=>t[13]||(t[13]=[f("mdi-checkbox-blank-outline")])),_:1}),f(" "+u(e.$t("Reset all")),1)]),_:1},8,["onClick"])):b("",!0)]}),_:2},1024)):b("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]}),_:2},1024))),128))]),_:1},8,["modelValue"]),t[14]||(t[14]=c("div",{class:"h-100"},null,-1)),c("div",Bt,[s(_,{onClick:t[7]||(t[7]=n=>r.dialog=!1),color:"primary",block:"",class:"mr-2 mb-2"},{default:i(()=>[f(u(e.$t("Apply")),1)]),_:1})])]),_:1})]),_:1},8,["modelValue"])])}const Tt=K(_t,[["render",Et]]),ke={name:"Distributions",computed:{debouncedSearch:{get(){return this.search},set(e){this.search=e,this.setSearch(e)}},numberOfPages(){return this.datatable.totalItems?Math.ceil(this.datatable.totalItems/this.datatable.itemsPerPage):0},isDistributor(){var t;let e=(t=this.appStore.user)==null?void 0:t.role;return e!=null&&e.length?e.length===1&&e[0]==="Distributor":!1},searchKeys(){const e=["publicId","address.admin1","address.admin2","address.admin3","address.admin4"];return this.$i18n.locale!=="en"&&e.push(`address.translation.${this.$i18n.locale}.admin1`,`address.translation.${this.$i18n.locale}.admin2`,`address.translation.${this.$i18n.locale}.admin3`,`address.translation.${this.$i18n.locale}.admin4`),e},fields(){return[{icon:"mdi-calendar",title:"Distribution date",value:"date",align:"start",sortable:!0,filterable:!0,type:"date"},{icon:"mdi-domain",title:"Organization",value:"organization.name",filterId:"organization.id",translated:["organization.translation",this.$i18n.locale,"name"].join("."),align:"start",filterable:!0,sortable:!0,type:"string"},{icon:"mdi-list-box",title:"Bundle name",value:"bundleName",align:"start",filterable:!0,sortable:!0,type:"term"},{icon:"mdi-map",title:"Oblast",value:"address.pCode1",align:"start",filterable:!0,type:"term"},{icon:"mdi-map-search",title:"Raion",value:"address.pCode2",align:"start",filterable:!0,type:"term"},{icon:"mdi-map-marker",title:"Hromada",value:"address.pCode3",align:"start",filterable:!0,type:"term"},{icon:"mdi-home-map-marker",title:"Locality",value:"address.pCode4",align:"start",filterable:!0,type:"term"},{icon:"mdi-list-status",title:"Status",value:"status",align:"start",filterable:!0,type:"term"}]}},data(){return{search:void 0,datatable:{search:void 0,filters:{distributionModality:["In-kind"],status:["In distribution","Requested"]},page:1,itemsPerPage:12,totalItems:0,sortBy:[{key:"date",order:"desc"}]},loading:!1,items:[]}},mounted(){this.loadItems()},methods:{setSearch:Z(function(e){this.datatable.search=e}),async loadItems(){this.loading=!0;let e=this.$storage.requests;e=e.useIndex("publicId"),e=Ge(e,this.datatable,this.searchKeys);const t=await e.find();t&&(this.items=t.items,this.datatable.totalItems=t.count),this.loading=!1,await this.$nextTick(),this.appStore.loading=!1},setFilter(e){this.datatable.filters=e,this.loadItems()}},watch:{datatable:{async handler(){await this.loadItems()},deep:!0}}},Ot={class:"distributions pa-2"},At={class:"text-h4 font-weight-bold"},zt={class:"mb-4"},Ut={class:"mb-4"};function Rt(e,t,l,d,r,a){const p=Tt,n=Vt,o=rt;return m(),x("div",Ot,[s(p,{class:"hidden-md-and-up",onSetSort:t[0]||(t[0]=h=>r.datatable.sortBy=[h]),onSetFilter:t[1]||(t[1]=h=>a.setFilter(h)),onSetStart:t[2]||(t[2]=h=>r.datatable.start=h),onSetEnd:t[3]||(t[3]=h=>r.datatable.end=h),table:"requests",fields:a.fields,datatable:r.datatable},null,8,["fields","datatable"]),s(D,{class:"mb-0 mt-0"},{default:i(()=>[s(F,{cols:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[c("div",At,u(e.$t("Distribute items")),1)]),_:1})]),_:1}),s(D,null,{default:i(()=>[s(F,{cols:"12",class:"pl-md-8 pr-md-8 d-flex"},{default:i(()=>[s(A,{modelValue:a.debouncedSearch,"onUpdate:modelValue":t[4]||(t[4]=h=>a.debouncedSearch=h),placeholder:e.$t("Search by id"),"prepend-icon":e.$vuetify.display.mobile?void 0:"mdi-magnify",variant:"solo","hide-details":"",clearable:"",name:"search",id:"search"},null,8,["modelValue","placeholder","prepend-icon"])]),_:1})]),_:1}),s(D,{class:"hidden-sm-and-down"},{default:i(()=>[s(F,{cols:"12",class:"pl-md-8 pr-md-8 d-flex"},{default:i(()=>[s(C,{icon:"mdi-filter",class:"mr-4"}),c("div",null,[(m(!0),x(T,null,O(a.fields,h=>(m(),y(n,{onSetSort:t[5]||(t[5]=g=>r.datatable.sortBy=[g]),onSetFilter:t[6]||(t[6]=g=>a.setFilter(g)),onSetStart:t[7]||(t[7]=g=>r.datatable.start=g),onSetEnd:t[8]||(t[8]=g=>r.datatable.end=g),table:"requests",field:h,datatable:r.datatable},null,8,["field","datatable"]))),256))])]),_:1})]),_:1}),s(D,{class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[k(s(F,{cols:"12",class:"text-center"},{default:i(()=>[s(ee,{indeterminate:"",color:"primary",size:"large"})]),_:1},512),[[S,r.loading]]),(m(!0),x(T,null,O(r.items,(h,g)=>k((m(),y(F,{cols:"12",lg:"4"},{default:i(()=>[s(o,{modelValue:r.items[g],"onUpdate:modelValue":w=>r.items[g]=w,mode:"view"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)),[[S,!r.loading]])),256)),k(s(F,{cols:"12",class:"text-center"},{default:i(()=>[c("div",zt,u(e.$t("You haven't created any requests yet")),1),s(_,{color:"primary","prepend-icon":"mdi-plus",onClick:t[9]||(t[9]=h=>e.$router.push("./requests/new"))},{default:i(()=>[f(u(e.$t("Add")),1)]),_:1})]),_:1},512),[[S,!r.items.length&&!a.isDistributor]]),k(s(F,{cols:"12",class:"text-center"},{default:i(()=>[c("div",Ut,u(e.$t("You haven't been assigned to any distribution yet")),1)]),_:1},512),[[S,!r.items.length&&a.isDistributor]])]),_:1}),s(D,{class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[s(F,{cols:"12"},{default:i(()=>[k(s(He,{modelValue:r.datatable.page,"onUpdate:modelValue":t[10]||(t[10]=h=>r.datatable.page=h),color:"primary",length:a.numberOfPages,"total-visible":e.$vuetify.display.mobile?3:8},null,8,["modelValue","length","total-visible"]),[[S,a.numberOfPages>1]])]),_:1})]),_:1})])}typeof ae=="function"&&ae(ke);const cl=K(ke,[["render",Rt]]);export{cl as default};

import{_ as O}from"./CustomTable-B09n9Rt0.js";import{_ as D}from"./ImportUploadBox-Cei2uRrf.js";import{_ as C}from"./CustomDate-CfhxorUI.js";import{p as N,a as R}from"./importProcessor-BuJ9nfbq.js";import{b as v}from"./route-block-B_A1xBdJ.js";import{_ as S}from"./index-Dr3A69Vy.js";import{z as r,A as m,l as b,m as _,f as $}from"./vuetify-8yKwgmF2.js";import{a9 as k,a3 as u,u as s,a4 as t,a6 as n,W as o,a2 as g,a7 as c,ac as p,Y as i}from"./@vue-CVhpfiSJ.js";import"./debouncer-Whu4ZLob.js";import"./searchProcessor-BfIe0Ps2.js";import"./joi-BOBjTjze.js";import"./@turf-BykKS3Vs.js";import"./xlsx-CILBIiVl.js";import"./comlink-B8fJUUNV.js";import"./dot-object-sCKibp8s.js";import"./index-1qao1M8l.js";import"./arabic-transliterate-CaB0grAR.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./uuid-C6aID195.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./jszip-B9I6jZYU.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";const y={created(){this.appStore.breadcrumb="Delete cash assistances"},name:"deleteCash",inject:["$confirm","$error","$loading","$showResult"],data:()=>({loading:!1,date:void 0,rows:[],hashes:void 0,headers:[{title:"",align:"center",value:"synced"},{title:"Tax ID",align:"start",value:"headOfHousehold.taxId",sortable:!0},{title:"Passport",align:"start",value:"headOfHousehold.passport",sortable:!0},{title:"Name",align:"start",value:"headOfHousehold.fullName",sortable:!0},{title:"Phone",align:"start",value:"headOfHousehold.phone"},{title:"Value",align:"center",value:"value",sortable:!0,align:"end"},{title:"Currency",align:"center",value:"currency"},{title:"Start date",align:"start",value:"attendedFrom"},{title:"End date",align:"start",value:"attendedTo"},{title:"Comment",align:"start",value:"comment"}]}),methods:{processRecords(){if(!this.date)return!1;let e=N(this.rows);e.data.map(d=>(d.date=this.date,d.organization=this.appStore.user.organization,d)),e=R(e.data);const l=e.map(d=>d.hash);this.hashes=l},formatNumber(e){return new Intl.NumberFormat("fr-FR").format(e)},formatPhone(e){return e?e==null?void 0:e.join(", "):""},async deleteRecords(){if(!await this.$confirm({title:"Delete entity",description:"Would you like to save the entity?"}))return!1;let l;try{const{assistances:d}=this.$storage;l=await d.useIndex("hash").filter({hash:this.hashes}).delete()}catch(d){return console.log(d),await this.$error(d),!1}if(this.$loading(!1),!l)return!1;await this.$showResult(),this.$router.push("/cash")}}},I={class:"report pa-2"},T={class:"text-h4 font-weight-bold"},F={class:"text-h5 mb-2 offset-md1 black--text"},P={class:"text-h5 mb-2 offset-md1 black--text"},B={class:"text-no-wrap"},z={class:"text-no-wrap"},A={class:"text-no-wrap"},U={key:0,class:"text-no-wrap"},j={key:0,class:"text-no-wrap"},E={class:"text-h5 mb-2 offset-md1 black--text"};function L(e,l,d,W,K,f){const w=C,V=D,H=O;return u(),k("div",I,[s(m,{class:"mb-0 mt-0"},{default:t(()=>[s(r,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:t(()=>[n("div",T,o(e.$t("Delete cash assistances")),1)]),_:1})]),_:1}),s(m,{class:"mb-0 mt-0"},{default:t(()=>[s(r,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:t(()=>[s(b,{class:"pt-sm-4 pb-sm-4 pt-md-16 data-block remove-cash-basic",rounded:"0"},{default:t(()=>[s(_,null,{default:t(()=>[s(m,{class:"mb-4 mt-4"},{default:t(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:t(()=>[n("div",F,[p(e.$slots,"itemset-header",{},()=>[i(o(e.$t("Select assistances")),1)])]),n("div",null,[p(e.$slots,"itemset-description",{},()=>[i(o(e.$t("Please specify the date of the distribution and upload the same file you originally used for the import to delete the corresponding records")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:t(()=>[s(m,null,{default:t(()=>[s(r,{cols:"12",lg:"6"},{default:t(()=>[s(w,{modelValue:e.date,"onUpdate:modelValue":l[0]||(l[0]=a=>e.date=a),disabled:Array.isArray(e.hashes),label:e.$t("Date of distribution"),hint:e.$t("Indicate the distribution date"),"persistent-hint":""},null,8,["modelValue","disabled","label","hint"])]),_:1}),e.hashes?c("",!0):(u(),g(r,{key:0,cols:"12"},{default:t(()=>[s(V,{modelValue:e.rows,"onUpdate:modelValue":[l[1]||(l[1]=a=>e.rows=a),f.processRecords],"bundle-name":"none"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}))]),_:1})]),_:1})]),_:3})]),_:3})]),_:3}),e.hashes?(u(),g(b,{key:0,class:"pt-sm-4 pb-sm-4 data-block block-cash-basic",rounded:"0"},{default:t(()=>[s(_,null,{default:t(()=>[s(m,{class:"mb-4 mt-4"},{default:t(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:t(()=>[n("div",P,[p(e.$slots,"itemset-header",{},()=>[i(o(e.$t("Check records")),1)])]),n("div",null,[p(e.$slots,"itemset-description",{},()=>[i(o(e.$t("Review the records before proceeding with the deletion")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:t(()=>[s(m,null,{default:t(()=>[s(r,{cols:"12"},{default:t(()=>[s(H,{table:"assistances",ref:"assistances",index:"hash",filters:{hash:e.hashes},searchKeys:["headOfHousehold.translation.uk.fullName","headOfHousehold.fullName","headOfHousehold.taxId","headOfHousehold.passport"],title:e.$t("Records"),headers:e.headers},{"item.headOfHousehold.taxId":t(({item:a})=>[i(o(a.headOfHousehold.taxId),1)]),"item.headOfHousehold.passport":t(({item:a})=>[i(o(a.headOfHousehold.passport),1)]),"item.headOfHousehold.fullName":t(({item:a})=>{var h;return[n("span",B,o((h=a.headOfHousehold)==null?void 0:h.fullName),1)]}),"item.headOfHousehold.phone":t(({item:a})=>{var h;return[n("span",z,o(f.formatPhone((h=a.headOfHousehold)==null?void 0:h.phone)),1)]}),"item.value":t(({item:a})=>[n("span",A,o(f.formatNumber(a.value)),1)]),"item.attendedFrom":t(({item:a})=>[a.attendedFrom?(u(),k("span",U,o(new Date(a.attendedFrom).toLocaleDateString("uk")),1)):c("",!0)]),"item.attendedTo":t(({item:a})=>[a.attendedTo?(u(),k("span",j,o(new Date(a.attendedTo).toLocaleDateString("uk")),1)):c("",!0)]),_:2},1032,["filters","title","headers"])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3})]),_:3})):c("",!0),e.hashes?(u(),g(b,{key:1,class:"pt-sm-4 pb-sm-4 pb-md-16 data-block block-cash-basic",rounded:"0"},{default:t(()=>[s(_,null,{default:t(()=>[s(m,{class:"mb-4 mt-4"},{default:t(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:t(()=>[n("div",E,[p(e.$slots,"itemset-header",{},()=>[i(o(e.$t("Delete records")),1)])]),n("div",null,[p(e.$slots,"itemset-description",{},()=>[i(o(e.$t("Submit the records to delete")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:t(()=>[s(m,null,{default:t(()=>[s(r,{cols:"12"},{default:t(()=>[s($,{onClick:l[2]||(l[2]=a=>e.hashes=void 0),block:e.$vuetify.display.xs,color:"primary","prepend-icon":"mdi-pencil",class:"mb-2 mr-4"},{default:t(()=>[i(o(e.$t("Reset")),1)]),_:1},8,["block"]),s($,{onClick:f.deleteRecords,block:e.$vuetify.display.xs,color:"error","prepend-icon":"mdi-delete",class:"mb-2 mr-4"},{default:t(()=>[i(o(e.$t("Delete")),1)]),_:1},8,["onClick","block"]),s($,{onClick:l[3]||(l[3]=a=>e.$router.push("/cash")),block:e.$vuetify.display.xs,variant:"text",color:"warning","prepend-icon":"mdi-close",class:"mb-sm-2 mr-4"},{default:t(()=>[i(o(e.$t("Cancel")),1)]),_:1},8,["block"])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3})]),_:3})):c("",!0)]),_:3})]),_:3})])}typeof v=="function"&&v(y);const Fe=S(y,[["render",L]]);export{Fe as default};

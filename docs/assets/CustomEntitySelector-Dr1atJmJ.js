import{d as k}from"./debouncer-Whu4ZLob.js";import{d as x}from"./dot-object-sCKibp8s.js";import{_ as E,d as f}from"./index-Dr3A69Vy.js";import{a9 as m,a3 as a,a7 as h,Q as g,a6 as r,W as u,a2 as w,a4 as n,u as d,Y as y,F as L,aa as N,ad as v,S as _}from"./@vue-CVhpfiSJ.js";import{n as p,f as V,j as B,r as C,k as S,a1 as j}from"./vuetify-8yKwgmF2.js";const A=k(function(e){this.getEntities()}),D={name:"CustomEntitySelector",props:{modelValue:{type:[Array,Object]},disabled:{type:Boolean},multiple:{type:Boolean},entity:{type:String},field:{type:String,default:"name"},fields:{type:Array},label:{type:String},hint:{type:String}},data(){return{search:void 0,currentEntity:void 0,items:[],loading:!1}},methods:{async getEntities(){if(!this.search||this.search.length<3)return[];this.loading=!0;const i=(await this.$storage[this.entity].include(this.fields).filter({[this.field]:{$regex:this.search}}).find()).items.map(c=>x.object(c));this.items=i,this.loading=!1},async addEntity(e){if(!e)return!1;this.multiple?(this.model&&this.model.push(e),this.model||(this.model=[e])):this.model=e,await this.$nextTick(),this.currentEntity=void 0,this.search=void 0},removeEntity(e){if(e===null)return this.model={},!1;this.model.splice(e,1)},translateName(e){return f(this.field,e)}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},translatedLabel(){return this.label?this.label:this.$t("Entity")},selected(){return this.model?this.multiple?this.model.map(e=>f(this.field,e)):[]:[]},itemList(){var l;return(l=this.selected)!=null&&l.length?this.items.filter(i=>{const c=f(this.field,i);return!this.selected.includes(c)}):this.items},showAutocomplete(){if(this.multiple||!this.model||Object.keys(this.model).length===0)return!0}},watch:{search:A}},I={class:"entity-selector"},T={key:0,class:"d-flex align-center"},U={class:"flex-grow-1 mb-2"},q={class:"text-caption"},F={class:"text-h6"},O={key:1},z={class:"text-caption"},P={class:"flex-grow-1 pb-2 pt-2"},Q={class:"text-h6"},W={key:0};function Y(e,l,i,c,s,t){return a(),m("div",I,[!i.multiple&&t.model&&t.translateName(t.model)?(a(),m("div",T,[r("div",U,[r("div",q,u(t.translatedLabel),1),r("div",F,u(t.translateName(t.model)),1)]),r("div",null,[i.disabled?h("",!0):(a(),w(V,{key:0,variant:"tonal",color:"primary",onClick:l[0]||(l[0]=o=>t.removeEntity(null))},{default:n(()=>[d(p,null,{default:n(()=>l[3]||(l[3]=[y("mdi-delete")])),_:1})]),_:1}))])])):h("",!0),i.multiple&&t.model&&t.model.length?(a(),m("div",O,[r("div",z,u(t.translatedLabel),1),(a(!0),m(L,null,N(t.model,(o,b)=>(a(),m("div",{class:v(["d-flex align-center mb-1 mt-1 pl-2 pr-2",{darken:b%2===0}])},[r("div",P,[r("div",Q,u(t.translateName(o)),1)]),i.disabled?h("",!0):(a(),m("div",W,[d(V,{variant:"tonal",color:"primary",onClick:G=>t.removeEntity(b)},{default:n(()=>[d(p,null,{default:n(()=>l[4]||(l[4]=[y("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]))],2))),256))])):h("",!0),g(d(j,{modelValue:s.currentEntity,"onUpdate:modelValue":[l[1]||(l[1]=o=>s.currentEntity=o),t.addEntity],search:s.search,"onUpdate:search":l[2]||(l[2]=o=>s.search=o),"search-input":s.search,items:t.itemList,"hide-no-data":!s.search||s.search.length===0,hint:i.hint?i.hint:"",label:t.translatedLabel,loading:s.loading,"item-title":i.field,disabled:i.disabled,"return-object":"",variant:"underlined","clear-on-select":i.multiple,clearable:"","hide-selected":""},{"no-data":n(()=>[d(B,{class:v({"text-center":s.loading})},{default:n(()=>[g(d(C,{class:"margin-auto",indeterminate:"",color:"primary"},null,512),[[_,s.loading]]),g(d(S,null,{default:n(()=>[y(u(e.$t("No results matching")),1)]),_:1},512),[[_,!s.loading]])]),_:1},8,["class"])]),_:1},8,["modelValue","search","search-input","onUpdate:modelValue","items","hide-no-data","hint","label","loading","item-title","disabled","clear-on-select"]),[[_,t.showAutocomplete]])])}const X=E(D,[["render",Y]]);export{X as _};

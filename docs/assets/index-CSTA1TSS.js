import{_ as w}from"./CustomTable-Bsru2z3s.js";import{d as S}from"./index-D0pvfY44.js";import{_ as I,Y as N,am as O,a6 as E,v as P,F as g,a as o,w as a,o as m,z as r,C as l,A as s,G as A,H as v,n as V,B,c as D}from"./index-BYWsBYtF.js";import{b as k}from"./route-block-B_A1xBdJ.js";import{a as z,V as h}from"./VRow-D5QUgmxK.js";import{V as y}from"./VBtn-DEU8AXzn.js";import{V as _}from"./VChip-BnTEbD1P.js";import{V as L}from"./VTooltip-CKohhaj7.js";import{V as R}from"./VCheckbox-CLjkCuK4.js";import"./CustomDate-BvE_k-Ie.js";import"./VMenu-BAWQ3Wct.js";import"./VOverlay-uyg0Ioz0.js";import"./forwardRefs-D3j0TLhE.js";import"./index-CqdMy8lr.js";import"./dialog-transition-CdzLxCw9.js";import"./VSpacer-D4hnwTqC.js";/* empty css              */import"./VAvatar-Bm8XvpvO.js";import"./VImg-wiXIkP7s.js";import"./index-bmXFo_Al.js";import"./VTextField-CLSPMm7c.js";import"./VInput-CwTs2RKk.js";import"./debouncer-Whu4ZLob.js";import"./VCard-C8It3tDs.js";import"./VContainer-rOsYQHyZ.js";import"./VList-wnBQ6eUC.js";import"./searchProcessor-BfIe0Ps2.js";import"./VDataTable-DS7yi-Dm.js";import"./VPagination-BBLVO-bG.js";import"./filter-5KaMYqe0.js";import"./VCheckboxBtn-B1hdxoeT.js";import"./VToolbar-Jw3O4Zrq.js";import"./group-BcbT0sDe.js";var M={IS_TEST:!0,FRONT_HOST:"https://raisplus-test.unhcr.in.ua",STATIC_ASSETS_PATH:"http://localhost:3000/static/",MS_APP_CLIENT_ID:"4f92930c-13d8-4c36-95d6-2f2d31727e6e",MS_APP_AUTHORITY:"https://login.microsoftonline.com/e5c37981-6664-4134-8a0c-6543d2af80be",BYPASS_MSAL:!0,LOCALE:"uk-ua",LANGUAGE:"uk",BACKEND_HOST:"http://localhost:3000/api/v1",APP_NAME:"rais-plus",APP_SHORTNAME:"RAIS+",APP_FULLNAME:"RAIS+ Ukraine Assistance Monitoring System",APP_DEFAULT_THEME:"gsc",APP_KEY:"UicablEChAKeyNOmerYONYmIkIMELACIstioNIUMItIcARterm"};const T={name:"manage-requests",computed:{searchKeys(){const e=["publicId","address.admin1","address.admin2","address.admin3","address.admin4"];return this.$i18n.locale!=="en"&&e.push(`address.translation.${this.$i18n.locale}.admin1`,`address.translation.${this.$i18n.locale}.admin2`,`address.translation.${this.$i18n.locale}.admin3`,`address.translation.${this.$i18n.locale}.admin4`),e},headers(){return[{title:"Edit",align:"center",value:"id"},{title:"Distribution date",align:"start",sortable:!0,filterable:!0,value:"date",type:"date"},{title:"Public ID",align:"start",sortable:!0,value:"publicId"},{title:"Bundle name",align:"start",value:"bundleName",filterable:!0,sortable:!0,type:"term"},{title:"Oblast",align:"start",value:"address.pCode1",filterable:!0,type:"term"},{title:"Raion",align:"start",value:"address.pCode2",filterable:!0,type:"term"},{title:"Hromada",align:"start",value:"address.pCode3",filterable:!0,type:"term"},{title:"Locality",align:"start",value:"address.pCode4",filterable:!0,type:"term"},{title:"Status",align:"start",value:"status",filterable:!0,type:"term"},{title:"Population type",align:"start",value:"populationType",filterable:!0,type:"term"},{title:"Author",align:"start",value:"createdByEmail",filterable:!0,type:"string"},{title:"Organizations",value:"organization.name",filterId:"organization.id",translated:["organization.translation",this.$i18n.locale,"name"].join("."),align:"start",filterable:!0,sortable:!0,type:"string"},{title:"Assignees",align:"center",value:"assignees"}]}},data(){return{filters:{status:["In distribution","Requested"],distributionModality:["In-kind"]},exportLoading:!1}},methods:{formatDate:N,async exportData(){this.exportLoading=!0;const{requests:e}=this.$storage,d=`${M.FRONT_HOST}/export/export.xlsx`,C=`${new Date().toISOString().substring(0,10)} - RAIS+ Requests.xlsx`,b=["date","publicId","bundleName","address.admin1","address.admin2","address.admin3","address.admin4","status","populationType","createdByEmail","organization","responsibleOrganization","fundingOrganization","assignees","tags"],p=["Distribution date","Public ID","Bundle name","Oblast","Raion","Hromada","Locality","Status","Population type","Created by","Organization","Responsible organization","Funding organization","Assignees","Tags"];let c=(await e.include([...b,"address"]).filter(this.filters).slice(0,1e4).sort("date").reverse().find()).items;c=c.map(t=>{var i;if(t.date=new Date(new Date(t.date)+60*60*1e3*2),(i=t==null?void 0:t.address)!=null&&i.pCode4){const n=O(t.address.pCode4);Object.assign(t.address,n)}return t.bundleName&&(t.bundleName=this.$t(t.bundleName,"en")),t.organization&&(t.organization=t.organization.name),t.responsibleOrganization&&(t.responsibleOrganization=t.responsibleOrganization.name),t.fundingOrganization&&(t.fundingOrganization=t.fundingOrganization.name),t.assignees&&(t.assignees=t.assignees.map(n=>{var $;return(($=n==null?void 0:n.person)==null?void 0:$.fullName)||""}).join(", ")),t.tags&&(t.tags=t.tags.join(", ")),t});const f=b.map(t=>c.map(i=>E(t,i)));await S(d,{headers:p,columns:f},C),this.exportLoading=!1}}},q={class:"distributions pa-2"},x={class:"text-h4 font-weight-bold"},H={class:"text-no-wrap"},U={class:"text-no-wrap font-weight-bold mb-1 mt-3 title-link",style:{"white-space":"nowrap"}},F={class:"mb-2"},Y={style:{"white-space":"nowrap"}},K={style:{"white-space":"nowrap"}},j={style:{"white-space":"nowrap"}},G=["href"],X={style:{"white-space":"nowrap"}},J={key:0};function Q(e,d,C,b,p,u){const c=P("router-link"),f=w;return m(),g("div",q,[o(z,{class:"mb-0 mt-0"},{default:a(()=>[o(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[r("div",x,[l(s(e.$t("Manage requests"))+" ",1),o(y,{onClick:u.exportData,loading:p.exportLoading,size:"small",color:"grey-dakren-4",variant:"tonal"},{default:a(()=>[l(s(e.$t("Export")),1)]),_:1},8,["onClick","loading"])])]),_:1})]),_:1}),o(z,{class:"mb-0 mt-0"},{default:a(()=>[o(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[o(f,{class:"pa-6",onBtnClick:d[0]||(d[0]=t=>e.$router.push("/requests/new")),button:e.$t("Add"),"sort-by":{key:"date",order:"desc"},filters:p.filters,headers:u.headers,"search-keys":u.searchKeys,title:e.$t("Requests"),index:"status",table:"requests"},{"item.date":a(({item:t})=>[r("span",H,s(u.formatDate(t.date).toLocaleDateString("uk")),1)]),"item.publicId":a(({item:t})=>[r("div",U,[o(c,{to:`/requests/${t.id}`,tag:"a"},{default:a(()=>[l(s(t.publicId),1)]),_:2},1032,["to"])]),r("div",F,[o(_,{class:"mr-2 mb-2",size:"small",label:""},{default:a(()=>[r("strong",null,s(e.$t("Modality")),1),l(": "+s(e.$t(t.distributionModality)),1)]),_:2},1024),o(_,{class:"mr-2 mb-2",size:"small",label:""},{default:a(()=>[r("strong",null,s(e.$t("Population Type")),1),l(": "+s(e.$t(t.populationType)),1)]),_:2},1024),(m(!0),g(A,null,v(t.tags,i=>(m(),D(_,{key:i,size:"small",label:"",class:"mr-2 mb-2"},{default:a(()=>[l(s(i),1)]),_:2},1024))),128))])]),"item.bundleName":a(({item:t})=>[r("span",Y,s(e.$t(t.bundleName)),1)]),"item.status":a(({item:t})=>[r("span",K,s(e.$t(t.status)),1)]),"item.populationType":a(({item:t})=>[r("span",j,s(e.$t(t.populationType)),1)]),"item.createdByEmail":a(({item:t})=>[r("a",{href:`mailto:${t.createdByEmail}`,class:"text-decoration-none"},s(t.createdByEmail),9,G)]),"item.organization.name":a(({item:t})=>{var i;return[r("span",X,s((i=t.organization)==null?void 0:i.name),1)]}),"item.address.pCode1":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,4))),1)]),"item.address.pCode2":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,6))),1)]),"item.address.pCode3":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,9))),1)]),"item.address.pCode4":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4)),1)]),"item.assignees":a(({item:t})=>[o(L,{location:"bottom"},{activator:a(({props:i})=>{var n;return[r("span",V(i,{class:"text-decoration-underline cursor-pointer"}),s(((n=t.assignees)==null?void 0:n.length)||0),17)]}),default:a(()=>{var i;return[(m(!0),g(A,null,v(t.assignees,n=>(m(),g("div",null,s(e.$_translate(n).person.fullName),1))),256)),(i=t.assignees)!=null&&i.length?B("",!0):(m(),g("div",J,s(e.$t("No one is assigned")),1))]}),_:2},1024)]),"item.id":a(({item:t})=>[o(y,{color:"grey-dakren-2",onClick:i=>e.$router.push(`/requests/${t.id}`),variant:"tonal",rounded:"1",icon:"mdi-pencil",size:"x-small"},null,8,["onClick"])]),_:2},1032,["button","filters","headers","search-keys","title"])]),_:1}),o(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[o(R,{modelValue:p.filters.status,"onUpdate:modelValue":d[1]||(d[1]=t=>p.filters.status=t),label:e.$t("Show archived"),value:"Archived"},null,8,["modelValue","label"])]),_:1})]),_:1}),o(y,{onClick:d[2]||(d[2]=t=>e.$router.push("/requests/new")),class:"hidden-sm-and-up",style:{position:"fixed",bottom:"15px",right:"15px"},color:"primary",rounded:"1",icon:"mdi-plus",size:"large"})])}typeof k=="function"&&k(T);const Ot=I(T,[["render",Q]]);export{Ot as default};

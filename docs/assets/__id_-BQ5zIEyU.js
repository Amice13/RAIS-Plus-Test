import{_ as Z,a as ee,b as te,c as se,d as le,e as ie,f as J}from"./DistributionFormDocument-hthCb9m0.js";import{_ as ae}from"./CustomTextFieldTranslit-DAGdx7D0.js";import{_ as w,ak as P,al as oe,o as f,F as V,a,w as i,z as h,A as d,G as F,H as D,x as Y,y as ne,c as g,B as S,ah as re,Z as de,$ as W,a0 as ue,a1 as x,a2 as me,a3 as B,C as y,a8 as ce,am as he,an as G,ao as pe,aa as fe}from"./index-BYWsBYtF.js";import{V as b,a as v}from"./VRow-D5QUgmxK.js";import{V as be}from"./VCheckbox-CLjkCuK4.js";import{a as ye}from"./VDataTable-DS7yi-Dm.js";import{V as ge}from"./VToolbar-Jw3O4Zrq.js";import{V as A}from"./VTextField-CLSPMm7c.js";import{V as N,c as _e,a as T,b as Se}from"./VCard-C8It3tDs.js";import{V as ke}from"./VTextarea-CGO06-dG.js";import{V as $}from"./VBtn-DEU8AXzn.js";import{V as ve}from"./VSpacer-D4hnwTqC.js";import{V as Ve}from"./VDialog-DkfmLzLV.js";import{d as Ie}from"./index-D0pvfY44.js";import{_ as Ae}from"./ImportDialog-BvsFXiNi.js";import{_ as $e}from"./CustomTable-Bsru2z3s.js";import{b as R}from"./route-block-B_A1xBdJ.js";import"./index-CqdMy8lr.js";import"./CustomDate-BvE_k-Ie.js";import"./VMenu-BAWQ3Wct.js";import"./VOverlay-uyg0Ioz0.js";import"./forwardRefs-D3j0TLhE.js";import"./dialog-transition-CdzLxCw9.js";import"./index-bmXFo_Al.js";import"./VAvatar-Bm8XvpvO.js";import"./VImg-wiXIkP7s.js";import"./CustomGender-2pTOXWap.js";import"./filter-5KaMYqe0.js";import"./VInput-CwTs2RKk.js";import"./VList-wnBQ6eUC.js";import"./VCheckboxBtn-B1hdxoeT.js";import"./VChip-BnTEbD1P.js";import"./group-BcbT0sDe.js";import"./index-D0cxP7tL.js";import"./CustomPhone-JFRV9tiP.js";import"./CustomTag-DNZukCra.js";import"./debouncer-Whu4ZLob.js";import"./data-BLrW_n9l.js";import"./CustomPopulationType-qKzO5os5.js";import"./VAlert-BA1FNbYI.js";/* empty css              */import"./VPagination-BBLVO-bG.js";import"./importProcessor-8a6EwQZQ.js";import"./VDataTableVirtual-BO58bCzO.js";import"./VTooltip-CKohhaj7.js";import"./CustomMultipleBundle-D5JEGacT.js";import"./VContainer-rOsYQHyZ.js";import"./CustomBundle-pHbbXnxx.js";import"./comlink-DRT95HA4.js";import"./VSystemBar-D2w16SNc.js";import"./searchProcessor-BfIe0Ps2.js";const z={"SN101-2024":[{key:"Person needs technical assistance",values:[{value:"Person needs technical assistance"}]},{key:"Assistance status",values:[{value:"Assisted by partner",filter:{"Person needs technical assistance":"Person needs technical assistance"}},{value:"Assisted by authority or other party",filter:{"Person needs technical assistance":"Person needs technical assistance"}}]}],"SN105-2024":[{key:"Selection criteria",values:[{value:"Houses with wooden windows"},{value:"Houses with heating system installed more than 20 years ago"},{value:"Houses without facade insulation"}]},{key:"Installation service is provided",values:[{value:"Installation service is provided"}]}]},we={name:"DistributionFormAdditional",props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},currentStrings:{get(){return this.model.strings?P(this.model.strings):{}},set(e){return!1}},questions(){return z[this.model.bundleName]?z[this.model.bundleName]:[]}},methods:{getOptions(e){let t=e.values;return t?(t=t.map(({value:l,filter:r})=>{if(!r)return l;for(let[m,s]of Object.entries(r))if(this.currentStrings[m]!==s)return!1;return l}).filter(Boolean),t):[]},setKey(e,t){const l=JSON.parse(JSON.stringify(this.currentStrings));t?l[e]=t:delete l[e],this.model.strings=oe(l)}}},Oe={key:0},Ne={class:"text-h5 mb-2 offset-md1 black--text"},Te={class:"mb-2"};function De(e,t,l,r,m,s){const u=ae;return s.questions.length?(f(),V("div",Oe,[a(v,{class:"mb-2 mt-2"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[h("div",Ne,d(e.$t("Additional data")),1),h("div",Te,d(e.$t("Please provide the information related to the current distribution")),1)]),_:1})]),_:1}),(f(!0),V(F,null,D(s.questions,(o,n)=>Y((f(),g(v,{class:"mb-0 mt-2 pb-0",key:n},{default:i(()=>[o.values.length===1?(f(),g(b,{key:0,cols:"12"},{default:i(()=>[a(be,{modelValue:s.currentStrings[o.key],"onUpdate:modelValue":[c=>s.currentStrings[o.key]=c,c=>s.setKey(o.key,c)],value:s.getOptions(o)[0],label:e.$t(o.key),"hide-details":""},null,8,["modelValue","onUpdate:modelValue","value","label"])]),_:2},1024)):(f(),g(b,{key:1,cols:"12"},{default:i(()=>[a(u,{modelValue:s.currentStrings[o.key],"onUpdate:modelValue":[c=>s.currentStrings[o.key]=c,c=>s.setKey(o.key,c)],label:e.$t(o.key),items:s.getOptions(o)},null,8,["modelValue","onUpdate:modelValue","label","items"])]),_:2},1024))]),_:2},1024)),[[ne,s.getOptions(o).length]])),128))])):S("",!0)}const Ce=w(we,[["render",De]]),U={"SN101-2024-01":[{key:"Emergency Shelter Kit",title:"Emergency Shelter Kit"},{key:"Timber Batten, 25x100x2000mm",title:"Timber Batten, 25x100x2000mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0,coefficient:20},{key:"Nails 20",title:"Nails 20",unit:"kg",depends:"Emergency Shelter Kit",disabled:!0,coefficient:.05},{key:"Nails 60",title:"Nails 60",unit:"kg",depends:"Emergency Shelter Kit",disabled:!0,coefficient:.1},{key:"Screws 4.8x100",title:"Screws 4.8x100",unit:"boxes",depends:"Emergency Shelter Kit",disabled:!0,coefficient:2},{key:"Mounting foam, 850ml",title:"Mounting foam, 850ml",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0},{key:"Tape, adhesive 100m x 45mm",title:"Tape, adhesive 100m x 45mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0},{key:"Lath 25x20x2000mm",title:"Lath 25x20x2000mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0,coefficient:20},{key:"Tarpaulin",title:"Tarpaulin",unit:"sheets",depends:"Emergency Shelter Kit",coefficient:3},{key:"Transparent plastic sheeting, 3x10m",title:"Transparent plastic sheeting, 3x10m",unit:"sheets",depends:"Emergency Shelter Kit"},{key:"OSB",title:"OSB",unit:"EA",depends:"Emergency Shelter Kit"}],"SN101-2024":[{key:"Emergency Shelter Kit",title:"Emergency Shelter Kit"},{key:"Timber Batten, 25x100x2000mm",title:"Timber Batten, 25x100x2000mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0,coefficient:20},{key:"Nails 20",title:"Nails 20",unit:"kg",depends:"Emergency Shelter Kit",disabled:!0,coefficient:.05},{key:"Nails 60",title:"Nails 60",unit:"kg",depends:"Emergency Shelter Kit",disabled:!0,coefficient:.1},{key:"Screws 4.8x100",title:"Screws 4.8x100",unit:"boxes",depends:"Emergency Shelter Kit",disabled:!0,coefficient:2},{key:"Mounting foam, 850ml",title:"Mounting foam, 850ml",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0},{key:"Tape, adhesive 100m x 45mm",title:"Tape, adhesive 100m x 45mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0},{key:"Lath 25x20x2000mm",title:"Lath 25x20x2000mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0,coefficient:20},{key:"Tarpaulin",title:"Tarpaulin",unit:"sheets",depends:"Emergency Shelter Kit",disabled:!0,coefficient:2},{key:"Transparent plastic sheeting, 3x10m",title:"Transparent plastic sheeting, 3x10m",unit:"sheets",disabled:!0,depends:"Emergency Shelter Kit"},{key:"OSB",title:"OSB",unit:"EA",disabled:!0,depends:"Emergency Shelter Kit"},{key:"Tarpaulin (separate)",title:"Tarpaulin (separate)",unit:"sheets"},{key:"Transparent plastic sheeting, 3x10m (separate)",title:"Transparent plastic sheeting, 3x10m (separate)",unit:"sheets"},{key:"OSB (separate)",title:"OSB (separate)",unit:"EA"}],"SN105-2024":[{key:"Rapid Thermal Kit",title:"Rapid Thermal Kit"},{key:"Reflective insulation screen",title:"Reflective insulation screen",unit:"rolls",depends:"Rapid Thermal Kit",disabled:!0,coefficient:2},{key:"Polyethylene film for construction",title:"Polyethylene film for construction",unit:"pcs",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Double-sided adhesive tape",title:"Double-sided adhesive tape",unit:"meters",depends:"Rapid Thermal Kit",disabled:!0,coefficient:2},{key:"Construction tape",title:"Construction tape",unit:"meters",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Masking tape",title:"Masking tape",unit:"meters",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Polyurethane foam stripes",title:"Polyurethane foam stripes",unit:"rolls",depends:"Rapid Thermal Kit",disabled:!0,coefficient:20},{key:"All season mounting foam",title:"All season mounting foam",unit:"pcs",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Box",title:"Box",unit:"pcs",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Wall mounted electrical heater",title:"Wall mounted electrical heater",unit:"pcs"}],"SN108-2024":[{key:"Coal",title:"Coal",unit:"metric ton"},{key:"Firewood",title:"Firewood",unit:"stacked m³"},{key:"Briquettes",title:"Briquettes",unit:"metric ton"},{key:"Pellets",title:"Pellets",unit:"metric ton"},{key:"Liquefied propane butane gas",title:"Liquefied propane butane gas",unit:"litres"}]},j={"SN104-2024"(e,t){const r=["Bed linen set","Towels","Blankets/Quilts","Jerrycans","Kitchen set","Mattress","Pillow","Reinforced bag","Sleeping bag","Solar / Power bank lamp","Thermos"].reduce((s,u)=>(e&&parseFloat(e[u])>0&&s++,s),0),m=parseFloat(e["Bed linen set"]||0)*11+parseFloat(e.Towels||0)*2+parseFloat(e["Blankets/Quilts"]||0)*18+parseFloat(e.Jerrycans||0)*2+parseFloat(e["Kitchen set"]||0)*10+parseFloat(e.Mattress||0)*40+parseFloat(e.Pillow||0)*3+parseFloat(e["Reinforced bag"]||0)*3+parseFloat(e["Sleeping bag"]||0)*35+parseFloat(e["Solar / Power bank lamp"]||0)*24+parseFloat(e.Thermos||0)*10;return e["NFI kit"]=r>=5||m/t>=70?1:0,e}},Ee={name:"DistributionFormItems",props:{modelValue:{type:Array,default:()=>[]},familyMembers:{type:Number,default:1},itemsList:{type:Array},bundle:{type:String}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},availableItems(){if(!U[this.bundle])return this.itemsList;const e=this.itemsList.map(t=>t.key);return U[this.bundle].filter(({key:t})=>e.includes(t))},dependents(){return this.availableItems.filter(e=>e.depends)},items(){let e=this.availableItems&&this.availableItems.length?this.availableItems:[];if(!this.itemsFilter)return this.availableItems;let t=new RegExp(this.itemsFilter.replace(/[^a-zа-яєіїґ -]/gi,""),"i");return e.filter(l=>this.$t(l.key).match(t))}},data(){return{itemsFilter:void 0,currentItems:{},oldItems:{},numberMask:{mask:"ADA",tokens:{D:{pattern:/\./,optional:!0},A:{pattern:/\d/,multiple:!0}}}}},mounted(){var t;if(!Array.isArray(this.modelValue)||!((t=this.modelValue)!=null&&t.length))return!1;const e=Object.fromEntries(this.modelValue.map(l=>[l.key,l.value]));Object.assign(this.oldItems,e),Object.assign(this.currentItems,e)},methods:{addItem(e){if(e.disabled)return!1;this.currentItems[e.key]||(this.currentItems[e.key]=0);const t=e.coefficient?Math.min(e.coefficient,1):1;this.currentItems[e.key]=parseFloat(this.currentItems[e.key])+t},recalculate(e){if(this.currentItems[e.key]===this.oldItems[e.key])return!1;const t=parseFloat(this.oldItems[e.key])||0,l=parseFloat(this.currentItems[e.key]||0),r=this.dependents.filter(s=>s.depends===e.key);let m=JSON.parse(JSON.stringify(this.currentItems));for(let s of r){parseFloat(this.oldItems[s.key]||0);const u=s.coefficient||1,o=Math.round(t*u*100),n=Math.round(l*u*100),c=parseFloat(this.oldItems[s.key]||0)*100-o+n;m[s.key]=c<0?0:c/100}j[this.bundle]&&(m=j[this.bundle](m,this.familyMembers)),Object.assign(this.oldItems,m),Object.assign(this.currentItems,m),this.setModel()},setModel(){const e=Object.entries(this.currentItems).map(([t,l])=>({key:t,value:parseFloat(l)})).filter(t=>t.value);this.model=e}}},Me={class:"text-h5 mb-2 offset-md1 black--text"},He={class:"mb-2"},Fe={class:"pl-2 text-left"},Pe={class:"text-left"},Ke=["ind"],xe=["onClick"],Be={class:"non-selectable"},Re={style:{width:"30%",cursor:"pointer"},class:"pt-6"};function ze(e,t,l,r,m,s){const u=re("maska");return f(),V(F,null,[a(v,{class:"mb-2 mt-2"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[h("div",Me,d(e.$t("Distributed items")),1),h("div",He,d(e.$t("Check the distributed items")),1)]),_:1})]),_:1}),a(v,{class:"mb-2 mt-2"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[a(ye,null,{top:i(()=>[a(ge,{flat:"",color:"white"},{default:i(()=>[a(A,{modelValue:m.itemsFilter,"onUpdate:modelValue":t[0]||(t[0]=o=>m.itemsFilter=o),class:"w-100 mr-4",variant:"outlined",density:"compact",label:e.$t("Filter"),"hide-details":"","prepend-icon":"mdi-magnify"},null,8,["modelValue","label"])]),_:1})]),default:i(()=>[h("thead",null,[h("tr",null,[h("th",Fe,d(e.$t("Item")),1),h("th",Pe,d(e.$t("Amount")),1)])]),h("tbody",null,[(f(!0),V(F,null,D(s.items,(o,n)=>(f(),V("tr",{key:"item-"+n,ind:n},[h("td",{class:"pl-2 text-left",onClick:c=>s.addItem(o),style:{width:"70%",cursor:"pointer"}},[t[1]||(t[1]=h("div",null,null,-1)),h("div",Be,d(e.$t(o.key)),1)],8,xe),h("td",Re,[Y(a(A,{modelValue:m.currentItems[o.key],"onUpdate:modelValue":[c=>m.currentItems[o.key]=c,c=>s.recalculate(o)],type:"number",readonly:o.disabled,label:o.unit?e.$t(o.unit):e.$t("Amount"),density:"compact",variant:"outlined",inputmode:"numeric"},null,8,["modelValue","onUpdate:modelValue","readonly","label"]),[[u,void 0,m.numberMask]])])],8,Ke))),128))])]),_:1})]),_:1})]),_:1})],64)}const Ue=w(Ee,[["render",ze]]),je={name:"DistributionPocDialow",inject:["$confirm","$error","$loading","$showResult"],props:{modelValue:{type:Object,default:()=>({})},items:{type:Array,default:()=>[]}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},canEdit(){var e,t,l;if((l=(t=(e=this.appStore)==null?void 0:e.user)==null?void 0:t.role)!=null&&l.includes("Admin")||!this.model.id||new Date-new Date(this.model.date)<30*1e3*60*60*24||new Date-new Date(this.model.createdAt)<7*1e3*60*60*24)return!0},dialog(){const e=document.querySelector("html"),t=Object.keys(this.model).length>0;return e.classList[t?"add":"remove"]("overflow-hidden"),t}},methods:{countFamilyStats(){this.model.familyStats=de([...this.model.familyMembers,this.model.headOfHousehold])},formatAddress:W,createFamilyMembersIds(){var r;const e=this.model.taxId||this.model.passport||ue(),t=x(this.model,e);let l=[];return(r=this.model)!=null&&r.familyMembers&&(l=this.model.familyMembers.map(m=>x(m,e))),[t,...l]},async removeData(){if(!await this.$confirm({title:"Delete assistance",description:"Would you like to delete data about the assistance?"}))return!1;this.$loading(!0);let t;try{const l=this.$storage.assistances;t=await delete l[this.model.id]}catch(l){return t=!1,await this.$error(l),!1}if(this.$loading(!1),!t)return!1;await this.$showResult(),this.model={},this.$emit("loadItems")},async saveData(){var l,r,m,s,u,o,n;if(!await this.$confirm({title:"Save assistance",description:"Would you like to save data about the assistance?"}))return!1;(l=this.model)!=null&&l.headOfHousehold&&(this.model.headOfHousehold=me(this.model.headOfHousehold)),(r=this.model)!=null&&r.headOfHousehold&&this.model.household&&((s=(m=this.model)==null?void 0:m.address)!=null&&s.pCode4&&(this.model.household.pCode4=this.model.address.pCode4,this.model.household.admin4=this.model.address.admin4),this.model.household.fullAddress=this.formatAddress(this.model.household,"en"),(o=(u=this.model.household.translation)==null?void 0:u.uk)!=null&&o.fullAddress&&(this.model.household.translation.uk.fullAddress=this.formatAddress(this.model.household,"uk"))),this.countFamilyStats(),this.model.familyMembersIds=this.createFamilyMembersIds(),this.model.taxIds=[B((n=this.model)==null?void 0:n.headOfHousehold),...(this.model.familyMembers||[]).map(B)].filter(Boolean);let t;try{const{assistances:c}=this.$storage;this.model.id||(t=await c.push(this.model)),this.model.id&&(t=await c.update(this.model.id,this.model))}catch(c){return t=!1,await this.$error(c)}if(this.$loading(!1),!t)return!1;await this.$showResult(),this.model={},this.$emit("loadItems")}}},Le={key:0,class:"main-part"},qe={class:"text-h5 mb-2 offset-md1 black--text"},Je={class:"text-h5 mb-2 offset-md1 black--text"};function Ye(e,t,l,r,m,s){const u=Z,o=ee,n=te,c=se,I=le,_=ie,C=Ue,E=Ce,M=J;return f(),g(Ve,{"model-value":s.dialog,class:ce(["assistance-dialog",{"poc-dialog":e.$vuetify.display.xs}]),"content-class":"poc-dialog",scrollable:"",persistent:"",overlay:!1,"max-width":"500px",transition:"slide-x-reverse-transition"},{default:i(()=>[a(N,{tile:"",class:"fill-height"},{default:i(()=>[a(_e,{"primary-title":""},{default:i(()=>[y(d(e.$t("Add")),1)]),_:1}),s.model.headOfHousehold?(f(),g(T,{key:0,class:"pt-4",style:{"font-size":"0.875rem"}},{default:i(()=>{var O;return[a(u,{modelValue:s.model.headOfHousehold,"onUpdate:modelValue":t[0]||(t[0]=p=>s.model.headOfHousehold=p),onSetId:t[1]||(t[1]=p=>s.model.householdId=p),onSetFamilyMembers:t[2]||(t[2]=p=>s.model.familyMembers=p),onSetHousehold:t[3]||(t[3]=p=>s.model.household=p),onSetDistribution:t[4]||(t[4]=p=>s.model=p),id:s.model.id,date:s.model.date,"distribution-id":s.model.distributionId,"household-id":s.model.householdId},null,8,["modelValue","id","date","distribution-id","household-id"]),s.model.householdId||s.model.id?(f(),V("div",Le,[a(o,{modelValue:s.model,"onUpdate:modelValue":t[5]||(t[5]=p=>s.model=p)},null,8,["modelValue"]),a(n,{modelValue:s.model.address,"onUpdate:modelValue":t[6]||(t[6]=p=>s.model.address=p)},null,8,["modelValue"]),a(c,{modelValue:s.model.headOfHousehold,"onUpdate:modelValue":t[7]||(t[7]=p=>s.model.headOfHousehold=p)},null,8,["modelValue"]),s.model.household?(f(),g(I,{key:0,modelValue:s.model.household,"onUpdate:modelValue":t[8]||(t[8]=p=>s.model.household=p),householdId:s.model.householdId},null,8,["modelValue","householdId"])):S("",!0),a(_,{modelValue:s.model.familyMembers,"onUpdate:modelValue":t[9]||(t[9]=p=>s.model.familyMembers=p),hh:s.model.headOfHousehold,date:s.model.date,"allow-simplified":(O=s.model.bundleName)==null?void 0:O.includes("SN101")},null,8,["modelValue","hh","date","allow-simplified"]),a(C,{modelValue:s.model.items,"onUpdate:modelValue":t[10]||(t[10]=p=>s.model.items=p),"items-list":l.items,bundle:s.model.bundleName},null,8,["modelValue","items-list","bundle"]),a(E,{modelValue:s.model,"onUpdate:modelValue":t[11]||(t[11]=p=>s.model=p)},null,8,["modelValue"]),a(v,{class:"mb-4 mt-4"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[h("div",qe,d(e.$t("Signature")),1),h("div",null,d(e.$t("Please sign the completed form")),1)]),_:1}),a(b,{cols:"12"},{default:i(()=>[a(M,{modelValue:s.model.signature,"onUpdate:modelValue":t[12]||(t[12]=p=>s.model.signature=p),mode:"edit"},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{class:"mb-4 mt-4"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[h("div",Je,d(e.$t("Comment")),1),h("div",null,d(e.$t("You can add any additional comment")),1)]),_:1}),a(b,{cols:"12"},{default:i(()=>[a(ke,{modelValue:s.model.comment,"onUpdate:modelValue":t[13]||(t[13]=p=>s.model.comment=p),variant:"underlined"},null,8,["modelValue"])]),_:1})]),_:1})])):S("",!0)]}),_:1})):S("",!0),a(Se,null,{default:i(()=>[s.model.id&&s.canEdit?(f(),g($,{key:0,onClick:s.removeData,color:"error",variant:"tonal",class:"ml-4"},{default:i(()=>[y(d(e.$t("Delete")),1)]),_:1},8,["onClick"])):S("",!0),a(ve),a($,{onClick:t[14]||(t[14]=O=>this.model={}),color:"orange darken-2",variant:"text"},{default:i(()=>[y(d(e.$t("Cancel")),1)]),_:1}),s.canEdit?(f(),g($,{key:1,onClick:s.saveData,color:"primary",variant:"tonal",class:"mr-4"},{default:i(()=>[y(d(e.$t("Save")),1)]),_:1},8,["onClick"])):S("",!0)]),_:1})]),_:1})]),_:1},8,["model-value","class"])}const We=w(je,[["render",Ye]]),Ge={name:"DistributionInformation",props:{modelValue:{type:Object}},computed:{organization(){var e;return(e=this.modelValue)!=null&&e.organization?this.$_translate(this.modelValue.organization):{}},distributor(){return this.$_translate(this.appStore.user.person)}}},Qe={class:"text-h5 mb-2 offset-md1 black--text"};function Xe(e,t,l,r,m,s){return f(),g(v,{class:"mb-4 mt-4"},{default:i(()=>[a(b,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[h("div",Qe,d(e.$t("Distribution Information")),1),h("div",null,d(e.$t("Information about the current distribution")),1)]),_:1}),a(b,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[a(v,null,{default:i(()=>[a(b,{cols:"12",lg:"6"},{default:i(()=>[a(A,{modelValue:l.modelValue.publicId,"onUpdate:modelValue":t[0]||(t[0]=u=>l.modelValue.publicId=u),label:e.$t("Distribution ID"),readonly:"",id:"public_id",variant:"plain",name:"distributionId"},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>[a(A,{"model-value":s.organization.name,label:e.$t("Distibutring Organization"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])]),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>{var u,o;return[(o=(u=l.modelValue)==null?void 0:u.address)!=null&&o.pCode1?(f(),g(A,{key:0,"model-value":e.$t(l.modelValue.address.pCode1),label:e.$t("Admin 1"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])):S("",!0)]}),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>{var u,o;return[(o=(u=l.modelValue)==null?void 0:u.address)!=null&&o.pCode2?(f(),g(A,{key:0,"model-value":e.$t(l.modelValue.address.pCode2),label:e.$t("Admin 2"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])):S("",!0)]}),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>{var u,o;return[(o=(u=l.modelValue)==null?void 0:u.address)!=null&&o.pCode3?(f(),g(A,{key:0,"model-value":e.$t(l.modelValue.address.pCode3),label:e.$t("Admin 3"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])):S("",!0)]}),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>{var u,o;return[(o=(u=l.modelValue)==null?void 0:u.address)!=null&&o.pCode4?(f(),g(A,{key:0,"model-value":e.$t(l.modelValue.address.pCode4),label:e.$t("Admin 4"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])):S("",!0)]}),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>[a(A,{"model-value":s.distributor.fullName,variant:"plain",label:e.$t("Distributor"),id:"distributor",name:"distributor",readonly:""},null,8,["model-value","label"])]),_:1})]),_:1})]),_:1})]),_:1})}const Ze=w(Ge,[["render",Xe]]),et=e=>{var t,l,r,m,s,u;e.organization=((l=(t=e==null?void 0:e.record)==null?void 0:t[0])==null?void 0:l.organization)||"";for(let o of e.record)o.familyStats.all=o.familyMembersIds.length,o.needsAssistance=(r=o.strings)!=null&&r["Person needs technical assistance"]?1:0,o.selfAssistance=(m=o.strings)!=null&&m["Person needs technical assistance"]?0:1,o.hhNumber=((s=o.strings)==null?void 0:s["Assistance status"])==="Assisted by partner"?1:0,(u=o.items)!=null&&u["Emergency Shelter Kit"];return e},tt=e=>{var t,l;e.organization=((l=(t=e==null?void 0:e.record)==null?void 0:t[0])==null?void 0:l.organization)||"";for(let r of e.record)r.familyStats.all=r.familyMembersIds.length;return e},st=e=>{var t,l;e.organization=((l=(t=e==null?void 0:e.record)==null?void 0:t[0])==null?void 0:l.organization)||"";for(let r of e.record)r.familyStats.all=r.familyMembersIds.length;return e},lt=e=>{var t,l,r,m,s,u;e.organization=((l=(t=e==null?void 0:e.record)==null?void 0:t[0])==null?void 0:l.organization)||"";for(let o of e.record)o.familyStats.all=o.familyMembersIds.length,o["Houses with wooden windows"]=((r=o.strings)==null?void 0:r["Selection criteria"])==="Houses with wooden windows"?1:0,o["Houses with heating system installed more than 20 years ago"]=((m=o.strings)==null?void 0:m["Selection criteria"])==="Houses with heating system installed more than 20 years ago"?1:0,o["Houses without facade insulation"]=((s=o.strings)==null?void 0:s["Selection criteria"])==="Houses without facade insulation"?1:0,o["Installation service is provided"]=(u=o.strings)!=null&&u["Installation service is provided"]?1:0;return e},it=Object.freeze(Object.defineProperty({__proto__:null,SN101:et,SN102:tt,SN104:st,SN105:lt},Symbol.toStringTag,{value:"Module"}));var at={IS_TEST:!0,FRONT_HOST:"https://raisplus-test.unhcr.in.ua",STATIC_ASSETS_PATH:"http://localhost:3000/static/",MS_APP_CLIENT_ID:"4f92930c-13d8-4c36-95d6-2f2d31727e6e",MS_APP_AUTHORITY:"https://login.microsoftonline.com/e5c37981-6664-4134-8a0c-6543d2af80be",BYPASS_MSAL:!0,LOCALE:"uk-ua",LANGUAGE:"uk",BACKEND_HOST:"http://localhost:3000/api/v1",APP_NAME:"rais-plus",APP_SHORTNAME:"RAIS+",APP_FULLNAME:"RAIS+ Ukraine Assistance Monitoring System",APP_DEFAULT_THEME:"gsc",APP_KEY:"UicablEChAKeyNOmerYONYmIkIMELACIstioNIUMItIcARterm"};const ot={props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},inject:["$confirm","$error","$loading","$showResult"],methods:{pCode4ToAdmins:he,async exportData(){var I,_,C,E,M,O,p,K;const e=this.model.bundleName.replace(/-.*/,"");if(!["SN101-2024-0","SN101-2024","SN102-2024","SN104-2024","SN105-2024","SN108-2024","SN109-2024"].includes(this.model.bundleName))return this.$error({errors:[{message:"This template is not implemented"}]});this.$loading(!0);const{assistances:l}=this.$storage,r=await l.filter({publicId:[this.model.publicId]}).sort({createdAt:"asc"}).slice(0,1e4).find();if(!r)return this.$loading(!1),this.$error(result);let m=r.items,s={};s.aor=this.model.aor,s.populationType=this.model.populationType,s.date=new Date(this.model.date).toLocaleDateString("sv-SE"),s.requestId=this.model.id,s.createdBy={email:this.appStore.user.email,name:[(_=(I=this.appStore.user)==null?void 0:I.person)==null?void 0:_.givenName,(E=(C=this.appStore.user)==null?void 0:C.person)==null?void 0:E.familyName].filter(Boolean).join(" "),phone:(O=(M=this.appStore.user)==null?void 0:M.person)!=null&&O.phone?(K=(p=this.appStore.user)==null?void 0:p.person)==null?void 0:K.phone.join(", "):""};const u=this.pCode4ToAdmins(this.model.address.pCode4);s.address=Object.assign({},this.model.address,u),m=m.map((k,H)=>(k.number=H+1,k.headOfHousehold&&(k.headOfHousehold.id=G(k.headOfHousehold)),k.items&&(k.items=P(k.items)),k.strings&&(k.strings=P(k.strings)),k)),s.record=m;const o=it[e];o&&(s=o(s)),this.$loading(!1);const n=`${at.FRONT_HOST}/export/templates/${this.model.bundleName}-${this.model.distributionModality}.xlsx?rev=1`;(async()=>{var H;const k=`${new Date().toISOString().replace(/:/g,"")} - Distribution List ${this.model.publicId} (${(H=this.appStore.user)==null?void 0:H.email}).xlsx`;return await Ie(n,s,k)})()}}};function nt(e,t,l,r,m,s){return f(),g($,{onClick:s.exportData,color:"green","prepend-icon":"mdi-export",class:"mr-2 mb-2 export-file"},{default:i(()=>[y(d(e.$t("Export data")),1)]),_:1},8,["onClick"])}const rt=w(ot,[["render",nt]]),dt={props:{modelValue:{type:Object,default:()=>({})},defaultDistribution:{type:Object,default:()=>({})},disabled:{type:Boolean}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},inject:["$error"],data(){return{dialog:!1}}};function ut(e,t,l,r,m,s){const u=Ae;return f(),V("span",null,[a($,{onClick:t[0]||(t[0]=o=>m.dialog=!0),block:e.$vuetify.display.xs,color:"green","prepend-icon":"mdi-import",class:"mr-2 mb-2",disabled:l.disabled},{default:i(()=>[y(d(e.$t("Import data")),1)]),_:1},8,["block","disabled"]),a(u,{onClose:t[1]||(t[1]=o=>m.dialog=!1),onImported:t[2]||(t[2]=o=>e.$emit("update",o)),initialData:s.model,dialog:m.dialog,disabled:""},null,8,["initialData","dialog"])])}const mt=w(dt,[["render",ut]]),L={"SN101-2024-0":["Person needs technical assistance","Assistance status"],"SN101-2024":["Person needs technical assistance","Assistance status"],"SN105-2024":["Installation service is provided","Selection criteria"]},q={New:"green-darken-2",Duplicated:"red-darken-2"},ct=e=>q[e]?q[e]:"grey-darken-2",ht={name:"DistributionCustomTable",props:{items:{type:Array,default:()=>[]},hasAddress:{type:Boolean},distributionId:{type:String},bundle:String},computed:{filters(){return this.distributionId?{distributionId:[this.distributionId]}:{}},itemList(){return this.items?this.items.map((e,t)=>({title:e.key,value:`item.${e.key}`,align:"center"})):[]},stringList(){return!this.bundle||!L[this.bundle]?[]:L[this.bundle].map(e=>({title:e,value:`strings.${e}`,align:"center"}))},headers(){const e=[{title:"",align:"center",value:"synced"},{title:"Tax ID",align:"start",value:"headOfHousehold.taxId",sortable:!0},{title:"Name",align:"start",value:"headOfHousehold.fullName",sortable:!0},{title:"Place of Origin",align:"start",value:"origin"},{title:"Phone",align:"start",value:"phone"},this.hasAddress?{title:"Address",align:"start",value:"household"}:!1,{title:"Male, <18",align:"center",value:"familyStats.boys"},{title:"Female, <18",align:"center",value:"familyStats.girls"},{title:"Male, 18-60",align:"center",value:"familyStats.men"},{title:"Female, 18-60",align:"center",value:"familyStats.women"},{title:"Male, 60+",align:"center",value:"familyStats.seniorMen"},{title:"Female, 60+",align:"center",value:"familyStats.seniorWomen"},{title:"People with disabilities",align:"center",value:"familyStats.disabled"}].filter(Boolean);return e.push(...this.itemList),e.push(...this.stringList),e.push({title:"Signature",align:"center",value:"signature"}),e}},methods:{getChipColor:ct,getDocument:G,formatAddress:W,getAdmin1:pe,canEdit(e){var t,l,r;if((r=(l=(t=this.appStore)==null?void 0:t.user)==null?void 0:l.role)!=null&&r.includes("Admin")||new Date-new Date(e.date)<30*1e3*60*60*24||new Date-new Date(e.createdAt)<7*1e3*60*60*24)return!0},async loadItems(){this.$refs.mainTable.loadItems()},getString(e,t){if(!Array.isArray(e)||!t)return"";const l=e.find(r=>r.key===t.replace(/^strings\./,""));return l?this.$t(l.value):""}}},pt=["onClick"],ft={class:"text-no-wrap"},bt={class:"text-no-wrap"},yt=["href"],gt={class:"text-no-wrap"},_t={key:0,class:"text-center"};function St(e,t,l,r,m,s){const u=J,o=$e;return e.appStore.loading?S("",!0):(f(),g(o,{key:0,onBtnClick:t[0]||(t[0]=n=>e.$emit("addData")),title:e.$t("Receivers"),button:e.$t("Add"),headers:s.headers,filters:s.filters,"sort-by":{key:"createdAt",sort:"asc"},"search-keys":["headOfHousehold.taxId","headOfHousehold.passport","headOfHousehold.fullName","headOfHousehold.translation.uk.fullName","headOfHousehold.taxId"],index:"distributionId",class:"distribution-table",ref:"mainTable",table:"assistances"},fe({"item.headOfHousehold.taxId":i(({item:n})=>[y(d(s.getDocument(n.headOfHousehold)),1)]),"item.synced":i(({item:n})=>[h("div",null,[s.canEdit(n)?(f(),V("div",{key:0,onClick:c=>e.$emit("editData",n)},[a($,{icon:"mdi-pencil",size:"x-small",color:"grey",variant:"tonal"})],8,pt)):S("",!0)])]),"item.headOfHousehold.fullName":i(({item:n})=>[h("span",ft,d(n.headOfHousehold?e.$_translate(n.headOfHousehold).fullName:""),1)]),"item.origin":i(({item:n})=>{var c;return[h("span",bt,d(s.getAdmin1((c=n.headOfHousehold)==null?void 0:c.origin)),1)]}),"item.phone":i(({item:n})=>[(f(!0),V(F,null,D(n.headOfHousehold.phone,c=>(f(),V("div",null,[h("a",{href:`tel:${c}`,class:"text-no-wrap"},d(c),9,yt)]))),256))]),"item.household":i(({item:n})=>[h("span",gt,d(s.formatAddress(n.household)),1)]),"item.familyStats.girls":i(({item:n})=>[y(d(n.familyStats.girls),1)]),"item.familyStats.boys":i(({item:n})=>[y(d(n.familyStats.boys),1)]),"item.familyStats.men":i(({item:n})=>[y(d(n.familyStats.men),1)]),"item.familyStats.women":i(({item:n})=>[y(d(n.familyStats.women),1)]),"item.familyStats.seniorMen":i(({item:n})=>[y(d(n.familyStats.seniorMen),1)]),"item.familyStats.seniorWomen":i(({item:n})=>[y(d(n.familyStats.seniorWomen),1)]),"item.familyStats.disabled":i(({item:n})=>[y(d(n.familyStats.disabled),1)]),"item.signature":i(({item:n})=>[n.signature?(f(),V("div",_t,[a(u,{modelValue:n.signature,"onUpdate:modelValue":c=>n.signature=c,mode:"view",width:100},null,8,["modelValue","onUpdate:modelValue"])])):S("",!0)]),_:2},[D(l.items,n=>({name:`item.item.${n.key}`,fn:i(({item:c})=>{var I;return[y(d(Array.isArray(c.items)?(I=c.items.find(_=>_.key===n.key))==null?void 0:I.value:0),1)]})})),D(s.stringList,n=>({name:`item.${n.value}`,fn:i(({item:c})=>[y(d(s.getString(c.strings,n.value)),1)])}))]),1032,["title","button","headers","filters"]))}const kt=w(ht,[["render",St]]),vt=["date","bundleName","publicId","aor","distributionModality","populationType","address","collectiveCenter","organization","responsibleOrganization","fundedBy","translation"],Vt=["country","admin1","admin2","admin3","admin4","pCode1","pCode2","pCode3","pCode4"],Q=["SN101-2024-0","SN101-2024","SN105-2024"],It=e=>{const t=JSON.parse(JSON.stringify(e)),l=Object.fromEntries(Object.entries(t).filter(r=>vt.includes(r[0])));return Q.includes(e.bundleName)&&(l.household=Object.fromEntries(Object.entries(t.address).filter(r=>Vt.includes(r[0]))),l.household.type="Household"),l.headOfHousehold={phone:[],translation:{uk:{}}},l.distributionId=e.id,l.familyMembersIds=[],l.familyMembers=[],l.familyStats={},l},X={inject:["$error"],name:"Distribution",computed:{allowImportAndExport(){var e,t,l,r;return(t=(e=this.appStore)==null?void 0:e.user)!=null&&t.role.includes("Admin")?!0:(r=(l=this.appStore)==null?void 0:l.user)==null?void 0:r.role.includes("Partner Manager")},title(){var e;if((e=this.$route.params)!=null&&e._id&&this.$route.params._id!=="new")return this.request.publicId},items(){return this.request.items||[]},hasAddress(){return Q.includes(this.request.bundleName)}},data:()=>({request:{},assistance:{}}),created(){this.init()},methods:{async init(){let{_id:e}=this.$route.params;if(!e)return this.$router.push("/distributions");const{requests:t}=this.$storage;try{const l=await t[e];if(!l)throw"Not found";this.request=l}catch{return await this.$error({title:"Distribution is not found"}),this.$router.push("/distributions")}this.appStore.breadcrumb=this.title||"New request",this.appStore.loading=!1,this.appStore.loading=!1},addData(){this.assistance=It(this.request)},editData(e){var t;(!e.address||typeof e.address=="object"&&!Object.keys(e).length)&&(e.address=this.request.address),e=JSON.parse(JSON.stringify(e)),Array.isArray((t=e.headOfHousehold)==null?void 0:t.phone)||(e.headOfHousehold.phone=[]),this.assistance=e},loadItems(){this.$refs.assistanceTable.loadItems()}}},At={class:"about pa-2"},$t={class:"text-h4 font-weight-bold"},wt={class:"text-h5 mb-2 offset-md1 black--text"},Ot={class:"text-h5 mb-2 offset-md1 black--text"},Nt={class:"mb-4 mt-1"},Tt={class:"text-h5 mb-2 offset-md1 black--text"};function Dt(e,t,l,r,m,s){const u=kt,o=mt,n=rt,c=Ze,I=We;return f(),V("div",At,[a(v,{class:"mb-0 mt-0"},{default:i(()=>[a(b,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[h("div",$t,d(e.$t("Distribution Data")),1)]),_:1})]),_:1}),a(v,{class:"mb-0 mt-0"},{default:i(()=>[a(b,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[a(N,{class:"pt-sm-4 pb-sm-4 pt-md-16 pb-md-16"},{default:i(()=>[a(T,null,{default:i(()=>[a(v,null,{default:i(()=>[a(b,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[h("div",wt,d(e.$t("Receivers' data")),1),h("div",null,d(e.$t("Enter the information about the head of the household")),1)]),_:1}),a(b,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[a(u,{onAddData:s.addData,onEditData:s.editData,"has-address":s.hasAddress,"distribution-id":e.request.id,items:e.request.items,bundle:e.request.bundleName,ref:"assistanceTable"},null,8,["onAddData","onEditData","has-address","distribution-id","items","bundle"])]),_:1})]),_:1})]),_:1})]),_:1}),s.allowImportAndExport?(f(),g(N,{key:0},{default:i(()=>[a(T,null,{default:i(()=>[a(v,{class:"mb-4 mt-4"},{default:i(()=>[a(b,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[h("div",Ot,d(e.$t("Additional operations")),1),h("div",null,d(e.$t("You can do additional actions here")),1)]),_:1}),a(b,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[h("div",Nt,d(e.$t("You can export the data or upload it to RAIS+")),1),h("div",null,[a(o,{modelValue:e.request,"onUpdate:modelValue":t[0]||(t[0]=_=>e.request=_),onUpdate:s.loadItems},null,8,["modelValue","onUpdate"]),a(n,{modelValue:e.request,"onUpdate:modelValue":t[1]||(t[1]=_=>e.request=_)},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1})):S("",!0),a(N,{class:"bg-grey-lighten-3"},{default:i(()=>[a(T,null,{default:i(()=>[a(c,{modelValue:e.request,"onUpdate:modelValue":t[2]||(t[2]=_=>e.request=_)},null,8,["modelValue"])]),_:1})]),_:1}),a(N,{class:"pb-md-16"},{default:i(()=>[a(T,null,{default:i(()=>[a(v,{class:"mb-0 mb-sm-4 mt-4"},{default:i(()=>[a(b,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[h("div",Tt,d(e.$t("Finalize Distribution")),1),h("div",null,d(e.$t("Submit your data after you have finished distribution")),1)]),_:1}),a(b,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[a($,{onClick:t[3]||(t[3]=_=>e.$router.push("/distributions")),block:e.$vuetify.display.xs,color:"warning","prepend-icon":"mdi-close",class:"mb-2 mr-4",text:""},{default:i(()=>[y(d(e.$t("Close")),1)]),_:1},8,["block"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e.request.items?(f(),g(I,{key:0,modelValue:e.assistance,"onUpdate:modelValue":t[4]||(t[4]=_=>e.assistance=_),items:e.request.items,onLoadItems:s.loadItems},null,8,["modelValue","items","onLoadItems"])):S("",!0),a($,{onClick:s.addData,class:"hidden-md-and-up",style:{position:"fixed",bottom:"15px",right:"15px"},color:"primary",icon:"mdi-plus",size:"large"},null,8,["onClick"])])}typeof R=="function"&&R(X);const Ns=w(X,[["render",Dt]]);export{Ns as default};

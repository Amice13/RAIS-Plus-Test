import{p as B}from"./index-D0cxP7tL.js";import{_ as v,o as f,c as b,w as l,a as s,z as _,A as p,C as h,B as S,a4 as g,aW as R,F as D,M as A}from"./index-BYWsBYtF.js";import{a as V,V as y}from"./VCard-C8It3tDs.js";import{a as O,V as r}from"./VRow-D5QUgmxK.js";import{V as j}from"./VBtn-DEU8AXzn.js";import{a as L,_ as M,S as P,b as z,c as J,d as K,e as H,f as F,g as W,h as G,i as Q,j as X,k as Y,l as Z}from"./SN209-jN8vSE90.js";import{_ as x}from"./CustomEntitySelector-DpN7aXCm.js";import{_ as ee}from"./RequestOrganizations-BYOGn7VT.js";import{_ as te}from"./CustomTag-DNZukCra.js";import{_ as se}from"./CustomDate-BvE_k-Ie.js";import{_ as le}from"./CustomPopulationType-qKzO5os5.js";import{_ as ie}from"./CustomBundle-pHbbXnxx.js";import{V as C}from"./VTextField-CLSPMm7c.js";import{b as w}from"./route-block-B_A1xBdJ.js";import"./VAvatar-Bm8XvpvO.js";import"./index-CqdMy8lr.js";import"./VImg-wiXIkP7s.js";/* empty css              */import"./group-BcbT0sDe.js";import"./CustomTextFieldTranslit-DAGdx7D0.js";import"./filter-5KaMYqe0.js";import"./VInput-CwTs2RKk.js";import"./index-bmXFo_Al.js";import"./forwardRefs-D3j0TLhE.js";import"./VList-wnBQ6eUC.js";import"./dialog-transition-CdzLxCw9.js";import"./VMenu-BAWQ3Wct.js";import"./VOverlay-uyg0Ioz0.js";import"./VCheckboxBtn-B1hdxoeT.js";import"./VChip-BnTEbD1P.js";import"./index-DCkz3hMM.js";import"./data-BLrW_n9l.js";import"./debouncer-Whu4ZLob.js";import"./VSpacer-D4hnwTqC.js";const{requests:oe}=B,ae={name:"RequestSumbission",inject:["$confirm","$error","$loading","$showResult"],props:{modelValue:{type:Object,default:()=>({})}},computed:{canEdit(){var e,t,o;if((o=(t=(e=this.appStore)==null?void 0:e.user)==null?void 0:t.role)!=null&&o.includes("Admin")||!this.model.id||new Date-new Date(this.model.date)<30*1e3*60*60*24||new Date-new Date(this.model.createdAt)<7*1e3*60*60*24)return!0},model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},isAdmin(){var e,t,o;return(o=(t=(e=this.appStore)==null?void 0:e.user)==null?void 0:t.role)==null?void 0:o.includes("Admin")}},methods:{async save(){if(!await this.$confirm({title:"Save entity",description:"Would you like to save the entity?"}))return!1;this.$loading(!0),this.model=oe.preprocess(this.model),await this.$nextTick();let t;try{const o=this.$storage.requests;this.model.id||(t=await o.push(this.model)),this.model.id&&(t=await o.update(this.model.id,this.model))}catch(o){t=!1,await this.$error(o)}if(this.$loading(!1),!t)return!1;await this.$showResult(),this.$goToPreviousPage()},async remove(){if(!await this.$confirm({title:"Delete entity",description:"Would you like to save the entity?"}))return!1;this.$loading(!1);try{const t=this.$storage.requests;await delete t[this.model.id]}catch(t){return await this.$error(t),this.$loading(!1)}this.$loading(!1),await this.$showResult(),this.$goToPreviousPage()}}},re={class:"text-h5 mb-2 offset-md1 black--text"};function ne(e,t,o,n,a,i){return f(),b(y,{class:"data-block request-submission pt-sm-4 pb-sm-4 pb-md-16"},{default:l(()=>[s(V,null,{default:l(()=>[s(O,{class:"mb-sm-4 mt-4"},{default:l(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:l(()=>[_("div",re,p(e.$t("Submission")),1),_("div",null,p(e.$t("Please verify and submit your data")),1)]),_:1}),s(r,{cols:"12",md:"9",class:"pr-md-16"},{default:l(()=>[i.canEdit?(f(),b(j,{key:0,onClick:i.save,block:e.$vuetify.display.xs,color:"primary","prepend-icon":"mdi-pencil",class:"mb-2 mr-4"},{default:l(()=>[h(p(e.$t("Save")),1)]),_:1},8,["onClick","block"])):S("",!0),i.model.id&&i.isAdmin&&i.canEdit?(f(),b(j,{key:1,onClick:i.remove,block:e.$vuetify.display.xs,color:"error","prepend-icon":"mdi-pencil",class:"mb-2 mr-4"},{default:l(()=>[h(p(e.$t("Delete")),1)]),_:1},8,["onClick","block"])):S("",!0),s(j,{onClick:t[0]||(t[0]=m=>e.$router.go(-1)),block:e.$vuetify.display.xs,variant:"text",color:"warning","prepend-icon":"mdi-close",class:"mb-sm-2 mr-4"},{default:l(()=>[h(p(e.$t("Cancel")),1)]),_:1},8,["block"])]),_:1})]),_:1})]),_:1})]),_:1})}const ue=v(ae,[["render",ne]]),de={name:"RequestAssignee",props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},me={class:"text-h5 mb-2 offset-md1 black--text"};function ce(e,t,o,n,a,i){const m=x;return f(),b(y,{class:"data-block request-assignee",rounded:"0"},{default:l(()=>[s(V,null,{default:l(()=>[s(O,{class:"mb-4 mt-4"},{default:l(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:l(()=>[_("div",me,[g(e.$slots,"itemset-header",{},()=>[h(p(e.$t("Distributors assignment")),1)])]),_("div",null,[g(e.$slots,"itemset-description",{},()=>[h(p(e.$t("Assign users who will provide the support")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:l(()=>[s(O,null,{default:l(()=>[s(r,{cols:"12"},{default:l(()=>[s(m,{modelValue:i.model.assignees,"onUpdate:modelValue":t[0]||(t[0]=d=>i.model.assignees=d),label:e.$t("Assignees"),field:e.$i18n.locale==="en"?"person.fullName":"person.translation.uk.fullName",fields:["person.fullName","person.translation.uk.fullName"],multiple:"",entity:"users",id:"assignees",name:"assignees",variant:"underlined"},null,8,["modelValue","label","field"])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3})]),_:3})}const pe=v(de,[["render",ce]]),fe={name:"RequestBasic",props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},isUNHCR(){var e,t;return(t=(e=this.appStore.user)==null?void 0:e.organization)!=null&&t.name?/UNHCR/.exec(this.appStore.user.organization.name):!1}},methods:{resetBundle(){this.model.items=[]}}},be={class:"text-h5 mb-2 offset-md1 black--text"};function he(e,t,o,n,a,i){const m=ie,d=le,k=se,$=L,N=te;return f(),b(y,{class:"data-block request-basic pt-sm-4 pb-sm-4 pt-md-16"},{default:l(()=>[s(V,null,{default:l(()=>[s(O,{class:"mb-4 mt-4"},{default:l(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:l(()=>[_("div",be,[g(e.$slots,"itemset-header",{},()=>[h(p(e.$t("Basic information")),1)])]),_("div",null,[g(e.$slots,"itemset-description",{},()=>[h(p(e.$t("Please indicate the basic information about the support that will be provided")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:l(()=>[s(O,null,{default:l(()=>[s(r,{cols:"12"},{default:l(()=>[s(C,{modelValue:i.model.publicId,label:e.$t("Public ID"),id:"public_id",name:"PublicID",variant:"underlined","hide-details":"",readonly:""},null,8,["modelValue","label"])]),_:1}),s(r,{cols:"12"},{default:l(()=>[s(m,{modelValue:i.model.bundleName,"onUpdate:modelValue":[t[0]||(t[0]=c=>i.model.bundleName=c),i.resetBundle],filter:"Distribution"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(r,{cols:"12",lg:"6"},{default:l(()=>[s(d,{modelValue:i.model.populationType,"onUpdate:modelValue":t[1]||(t[1]=c=>i.model.populationType=c),hint:e.$t("Indicate the major group of beneficiaries")},null,8,["modelValue","hint"])]),_:1}),s(r,{cols:"12",lg:"6"},{default:l(()=>[s(k,{modelValue:i.model.date,"onUpdate:modelValue":t[2]||(t[2]=c=>i.model.date=c),label:e.$t("Date of distribution"),hint:e.$t("Indicate the planned date"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1}),s(r,{cols:"12"},{default:l(()=>[i.isUNHCR?S("",!0):(f(),b(C,{key:0,modelValue:i.model.aor,"onUpdate:modelValue":t[3]||(t[3]=c=>i.model.aor=c),label:e.$t("Area of Responsibility"),id:"aor",name:"aor",variant:"underlined","hide-details":""},null,8,["modelValue","label"])),i.isUNHCR?(f(),b($,{key:1,modelValue:i.model.aor,"onUpdate:modelValue":t[4]||(t[4]=c=>i.model.aor=c),label:e.$t("Area of Responsibility"),id:"aor",name:"aor",variant:"underlined","hide-details":""},null,8,["modelValue","label"])):S("",!0)]),_:1}),s(r,{cols:"12"},{default:l(()=>[s(N,{modelValue:i.model.tags,"onUpdate:modelValue":t[5]||(t[5]=c=>i.model.tags=c),label:e.$t("Tags"),entity:"requests"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3})]),_:3})}const _e=v(fe,[["render",he]]),Oe=[{key:"Emergency Shelter Kit",title:"Emergency Shelter Kit"}],U=[{key:"Tarpaulin",title:"Tarpaulin",unit:"sheets"},{key:"Transparent plastic sheeting, 3x10m",title:"Transparent plastic sheeting, 3x10m",unit:"sheets"},{key:"OSB",title:"OSB",unit:"EA"}],Se=[{key:"Timber Batten, 25x100x2000mm",title:"Timber Batten, 25x100x2000mm",unit:"pcs"},{key:"Nails 60",title:"Nails 60",unit:"kg"},{key:"Screws 4.8x100",title:"Screws 4.8x100",unit:"boxes"},{key:"Mounting foam, 850ml",title:"Mounting foam, 850ml",unit:"pcs"},{key:"Tape, adhesive 100m x 45mm",title:"Tape, adhesive 100m x 45mm",unit:"pcs"},{key:"Lath 25x20x2000mm",title:"Lath 25x20x2000mm",unit:"kg"},{key:"Nails 20",title:"Nails 20",unit:"kg"}],q={Tarpaulin:3,"Transparent plastic sheeting, 3x10m":1,OSB:1,"Timber Batten, 25x100x2000mm":20,"Nails 60":.1,"Screws 4.8x100":2,"Mounting foam, 850ml":1,"Tape, adhesive 100m x 45mm":1,"Lath 25x20x2000mm":20,"Nails 20":.05},ge={name:"EskItemList",props:{modelValue:{type:Object}},mounted(){var t,o;if(!((o=(t=this.modelValue)==null?void 0:t.items)!=null&&o.length))return!1;const e=Object.fromEntries(this.modelValue.items.map(n=>[n.key,n.value]));this.esk={"Emergency Shelter Kit":e["Emergency Shelter Kit"]},this.oldEsk=e["Emergency Shelter Kit"],delete e["Emergency Shelter Kit"],this.itemset=e},data(){return{oldEsk:void 0,esk:{},itemset:{}}},methods:{calculateEsk(e){const t=parseInt(e.target.value),o=this.oldEsk||0,n=JSON.parse(JSON.stringify(this.itemset));for(let a of this.itemsList)n[a.key]=Math.round(t*q[a.key]*100)/100;for(let a of U){const i=Math.round((o||0)*q[a.key]*100)/100,m=Math.round((t||0)*q[a.key]*100)/100;let d=(n[a.key]||0)-i+m;n[a.key]=d<0?m:d}this.oldEsk=t,this.itemset=n,this.setModel()},setModel(){const e=Object.entries({...this.esk,...this.itemset}).map(([t,o])=>({key:t,value:parseFloat(o)})).filter(t=>t.value);this.model.items=e}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},kit(){return JSON.parse(JSON.stringify(Oe)).map(t=>(t.title=this.$t(t.key),t))},enabledItemsList(){let e=JSON.parse(JSON.stringify(U));return e=e.map(t=>(t.title=this.$t(t.key),t)),e.sort((t,o)=>t.title.localeCompare(o.title))},itemsList(){let e=JSON.parse(JSON.stringify(Se));return e=e.map(t=>(t.title=this.$t(t.key),t)),e.sort((t,o)=>t.title.localeCompare(o.title))}}},ve={class:"text-h5 mb-2 offset-md1 black--text"};function Ve(e,t,o,n,a,i){const m=M;return f(),b(y,{rounded:"0"},{default:l(()=>[s(V,null,{default:l(()=>[s(O,{class:"mb-4 mt-4"},{default:l(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:l(()=>[_("div",ve,[g(e.$slots,"itemset-header",{},()=>[h(p(e.$t("List of items")),1)])]),_("div",null,[g(e.$slots,"itemset-description",{},()=>[h(p(e.$t("Please select all items that you are going to distribute")),1)])])]),_:3}),s(r,{cols:"12",md:"4",lg:"3",class:"pr-md-16 pt-0 pb-0"},{default:l(()=>[s(m,{modelValue:a.esk,"onUpdate:modelValue":t[0]||(t[0]=d=>a.esk=d),onInput:i.calculateEsk,items:i.kit},null,8,["modelValue","onInput","items"])]),_:1}),s(r,{cols:"12","sm-offset":"0",md:"4","offset-md":"3",lg:"3","offset-lg":"0",class:"pr-md-16 pt-0"},{default:l(()=>[s(m,{modelValue:a.itemset,"onUpdate:modelValue":t[1]||(t[1]=d=>a.itemset=d),onInput:i.setModel,items:i.itemsList,disabled:!0},null,8,["modelValue","onInput","items"])]),_:1}),s(r,{cols:"12",md:"4",lg:"3",class:"pr-md-16 pt-0 pb-0"},{default:l(()=>[s(m,{modelValue:a.itemset,"onUpdate:modelValue":t[2]||(t[2]=d=>a.itemset=d),onInput:i.setModel,items:i.enabledItemsList},null,8,["modelValue","onInput","items"])]),_:1})]),_:3})]),_:3})]),_:3})}const ye=v(ge,[["render",Ve]]),I={"SN101-0":{clusterObjective:"CO1",sectoralObjective:"SO1"},SN1010:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN101:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN102:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN103:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN104:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN105:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN106:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN107:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN108:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN109:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN110:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN111:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN201:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN202:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN203:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN204:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN205:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN206:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN207:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN208:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN209:{clusterObjective:"CO3",sectoralObjective:"SO2"}},ke=()=>({distributionModality:"In-kind",populationType:"IDPs",status:"Requested",organization:void 0,responsibleOrganization:void 0,fundedBy:void 0,date:void 0,items:[],assignees:[],address:{country:{name:"Ukraine",code2:"UA",code3:"UKR",code:"804"}}}),T={name:"request",inject:["$confirm","$error","$loading","$showResult"],components:{SN1010:ye,SN101:P,SN102:z,SN104:J,SN105:K,SN107:H,SN108:F,SN109:W,SN110:G,SN209:Q},data:()=>({request:ke()}),created(){this.init()},computed:{title(){var e;return(e=this.$route.params)!=null&&e._id&&this.$route.params._id!=="new"?(this.appStore.breadcrumb=this.request.publicId,this.request.publicId):(this.appStore.breadcrumb=this.$t("New request"),this.$t("New request"))},publicId(){return R(this.request)}},methods:{async init(){var t,o,n,a;let{_id:e}=this.$route.params;if(e&&e!=="new")return this.loadData(e);this.request.organization=(t=this.appStore.user)==null?void 0:t.organization,this.request.createdBy=(o=this.appStore.user)==null?void 0:o.id,this.request.createdByEmail=(n=this.appStore.user)==null?void 0:n.email,(a=this.appStore.user)!=null&&a.defaults&&Object.assign(this.request,this.appStore.user.defaults),this.appStore.loading=!1},async loadData(e){const{requests:t}=this.$storage;try{const o=await t[e];if(!o)throw"Not found";this.request=o}catch{return await this.$error({title:"Request is not found"}),this.$router.push("/requests")}this.appStore.loading=!1},getTemplate(e){return templates[e]}},watch:{publicId(e){var o;if(this.request.publicId=this.publicId,!((o=this.request)!=null&&o.bundleName))return!1;const t=this.request.bundleName.replace(/-2024/,"");I[t]&&(this.request.objectives=I[t])},"request.address.pCode4"(){this.collectiveCenter={}}}},$e={class:"report pa-2"},Ne={class:"text-h4 font-weight-bold"};function je(e,t,o,n,a,i){const m=_e,d=ee,k=X,$=Y,N=pe,c=Z,E=ue;return f(),D("div",$e,[s(O,{class:"mb-0 mt-0"},{default:l(()=>[s(r,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:l(()=>[_("div",Ne,p(i.title||e.$t("New donation")),1)]),_:1})]),_:1}),s(O,{class:"mb-0 mt-0"},{default:l(()=>[s(r,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:l(()=>[s(m,{modelValue:e.request,"onUpdate:modelValue":t[0]||(t[0]=u=>e.request=u)},null,8,["modelValue"]),s(d,{modelValue:e.request,"onUpdate:modelValue":t[1]||(t[1]=u=>e.request=u)},null,8,["modelValue"]),s(k,{modelValue:e.request,"onUpdate:modelValue":t[2]||(t[2]=u=>e.request=u)},null,8,["modelValue"]),s($,{modelValue:e.request,"onUpdate:modelValue":t[3]||(t[3]=u=>e.request=u)},null,8,["modelValue"]),e.request.bundleName?(f(),b(A(e.request.bundleName.replace("-2024","").replace("-0","0")),{key:0,modelValue:e.request,"onUpdate:modelValue":t[4]||(t[4]=u=>e.request=u)},null,8,["modelValue"])):S("",!0),s(N,{modelValue:e.request,"onUpdate:modelValue":t[5]||(t[5]=u=>e.request=u)},null,8,["modelValue"]),e.$route.params._id!=="new"?(f(),b(c,{key:1,modelValue:e.request,"onUpdate:modelValue":t[6]||(t[6]=u=>e.request=u)},null,8,["modelValue"])):S("",!0),s(E,{modelValue:e.request,"onUpdate:modelValue":t[7]||(t[7]=u=>e.request=u)},null,8,["modelValue"])]),_:1})]),_:1})])}typeof w=="function"&&w(T);const nt=v(T,[["render",je]]);export{nt as default};

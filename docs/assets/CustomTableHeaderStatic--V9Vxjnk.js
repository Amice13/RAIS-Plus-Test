import{_ as F}from"./CustomDate-BvE_k-Ie.js";import{d as B}from"./debouncer-Whu4ZLob.js";import{_ as x,a6 as I,o as u,F as C,z as h,A as c,c as m,w as s,a as n,C as d,B as f,x as b,y as V,G as _,H as A,a8 as N}from"./index-BYWsBYtF.js";import{V as y}from"./index-CqdMy8lr.js";import{V as O}from"./VMenu-BAWQ3Wct.js";import{V as j,a as D,b as U}from"./VCard-C8It3tDs.js";import{V as g,a as z}from"./VBtn-DEU8AXzn.js";import{V as T}from"./VContainer-rOsYQHyZ.js";import{a as J,V as S}from"./VRow-D5QUgmxK.js";import{V as w}from"./VTextField-CLSPMm7c.js";import{V as L,a as E,b as Q}from"./VList-wnBQ6eUC.js";import{V as R}from"./VChip-BnTEbD1P.js";import{V as H}from"./VSpacer-D4hnwTqC.js";const k=t=>{const[e,l]=t.split(/\./g);return l==="0"||e.length===3?e:t},M=t=>t/10**9>1?k((t/10**9).toFixed(1))+"B":t/10**6>1?k((t/10**6).toFixed(1))+"M":t/10**3>1?k((t/10**3).toFixed(1))+"K":t,G={name:"CustomTableHeader",props:{parentItems:{type:Array,default:()=>[]},datatable:{type:Object,default:()=>({})},column:{type:Object,default:{}}},data(){return{loading:!1,fieldQuery:void 0,search:void 0,items:[],menu:!1}},computed:{showItems(){if(!this.search)return this.items;const t=new RegExp(this.search.replace(/[|\\{}()[\]^$+*?.]/g,".").replace(/-/g,"\\-"),"gi");return this.items.filter(e=>this.$t(e.key).match(t))},filterIsSet(){var t,e,l,o;return(e=(t=this.datatable)==null?void 0:t.filters)!=null&&e[this.column.value]?(o=(l=this.datatable)==null?void 0:l.filters)==null?void 0:o[this.column.value].length:!1}},methods:{setSearch:B(function(){this.loadItems()}),async loadItems(){var o;if(!((o=this.column)!=null&&o.filterable)||this.column.type==="date")return!1;this.loading=!0;const t=this.parentItems.map(a=>I(this.column.value,a)).filter(a=>a!==void 0);if(!t.length)return!1;const e=t.reduce((a,i)=>(a[i]||(a[i]=0),a[i]++,a),{}),l=Object.entries(e).sort((a,i)=>i[1]-a[1]).map(([a,i])=>({key:a,value:i}));this.items=l,this.loading=!1},isSorted({value:t}){var l,o,a,i;return(l=this.datatable)!=null&&l.sortBy?(Array.isArray((o=this.datatable)==null?void 0:o.sortBy)?(a=this.datatable)==null?void 0:a.sortBy[0]:(i=this.datatable)==null?void 0:i.sortBy).key===t:!1},isFiltered({value:t}){var e;if(!((e=this.datatable)!=null&&e.filters))return!1;for(let[l,o]of Object.entries(this.datatable.filters))if(l===t&&o.length)return!0},getIcon(t){var e,l;return this.isSorted(t)?(Array.isArray(this.datatable.sortBy)?(e=this.datatable)==null?void 0:e.sortBy[0]:(l=this.datatable)==null?void 0:l.sortBy).order==="desc"?"mdi-sort-descending":"mdi-sort-ascending":this.isFiltered(t)?"mdi-filter":"mdi-chevron-down"},setSort(t){this.$emit("setSort",{key:this.column.key,order:t}),this.menu=!1},hasFilter(t){var e,l,o,a;return(l=(e=this.datatable)==null?void 0:e.filters)!=null&&l[this.column.value]?(a=(o=this.datatable)==null?void 0:o.filters)==null?void 0:a[this.column.value].includes(t):!1},switchFilter(t){const e=JSON.parse(JSON.stringify(this.datatable.filters));e[this.column.value]||(e[this.column.value]=[]);let l=e[this.column.value].indexOf(t);return l>=0?(e[this.column.value].splice(l,1),e[this.column.value].length||delete e[this.column.value],this.$emit("setFilter",e)):(e[this.column.value].push(t),this.$emit("setFilter",e))},resetAllFilters(){const t=JSON.parse(JSON.stringify(this.datatable.filters));return delete t[this.column.value],this.$emit("setFilter",t)},simplifyCount:M},watch:{menu(t){t&&this.loadItems()}}},K={class:"text-no-wrap bg-grey-lighten-3"},P={class:"font-weight-bold"},q={class:"mb-2"},W={class:"text-center"},X={style:{width:"36px"}};function Y(t,e,l,o,a,i){const v=F;return u(),C("td",K,[h("div",{class:N(["w-100 d-flex align-center",{"justify-center":l.column.align==="center","justify-end":l.column.align==="right"}])},[h("span",P,c(t.$t(l.column.title)),1),l.column.sortable||l.column.filterable?(u(),m(g,{key:0,style:{"min-width":"0px"},class:"ml-2 pa-2",size:"small",variant:"text",elevation:"0",color:i.isFiltered(l.column)?"primary":"black"},{default:s(()=>[n(y,null,{default:s(()=>[d(c(i.getIcon(l.column)),1)]),_:1}),n(O,{activator:"parent",transition:"slide-y-transition","close-on-content-click":!1,modelValue:a.menu,"onUpdate:modelValue":e[7]||(e[7]=r=>a.menu=r)},{default:s(()=>[n(j,{"max-width":"350",width:"350"},{default:s(()=>[n(D,{class:"pa-0"},{default:s(()=>[l.column.sortable?(u(),m(g,{key:0,onClick:e[0]||(e[0]=r=>i.setSort("asc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:s(()=>[n(y,{class:"mr-2"},{default:s(()=>e[8]||(e[8]=[d("mdi-sort-ascending")])),_:1}),d(" "+c(t.$t("Sort ascending")),1)]),_:1})):f("",!0),l.column.sortable?(u(),m(g,{key:1,onClick:e[1]||(e[1]=r=>i.setSort("desc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:s(()=>[n(y,{class:"mr-2"},{default:s(()=>e[9]||(e[9]=[d("mdi-sort-descending")])),_:1}),d(" "+c(t.$t("Sort descending")),1)]),_:1})):f("",!0),l.column.filterable?(u(),m(T,{key:2},{default:s(()=>[n(J,null,{default:s(()=>[n(S,{cols:"12"},{default:s(()=>[h("div",q,[h("strong",null,c(t.$t("Filter").toUpperCase()),1)]),l.column.type==="date"?(u(),m(v,{key:0,modelValue:t.startDate,"onUpdate:modelValue":e[2]||(e[2]=r=>t.startDate=r),label:t.$t("Start date"),clearable:"",class:"mt-4"},null,8,["modelValue","label"])):f("",!0),l.column.type==="date"?(u(),m(v,{key:1,modelValue:t.endDate,"onUpdate:modelValue":e[3]||(e[3]=r=>t.endDate=r),clearable:"",label:t.$t("End date")},null,8,["modelValue","label"])):f("",!0),l.column.type==="term"?(u(),m(w,{key:2,modelValue:a.search,"onUpdate:modelValue":e[4]||(e[4]=r=>a.search=r),label:t.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","label"])):f("",!0),l.column.type==="string"?(u(),m(w,{key:3,modelValue:a.fieldQuery,"onUpdate:modelValue":[e[5]||(e[5]=r=>a.fieldQuery=r),i.setSearch],label:t.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])):f("",!0)]),_:1}),l.column.type!=="date"?(u(),m(S,{key:0,cols:"12",class:"pa-0"},{default:s(()=>[b(h("div",W,[n(z,{indeterminate:"",color:"primary"})],512),[[V,a.loading]]),b(n(L,{class:"custom-thumb",nav:"",density:"compact",lines:!1,"max-height":"200"},{default:s(()=>[(u(!0),C(_,null,A(i.showItems,r=>(u(),m(E,{onClick:p=>i.switchFilter(r.key),key:r.key,density:"compact"},{prepend:s(()=>[h("div",X,[b(n(y,null,{default:s(()=>e[10]||(e[10]=[d("mdi-checkbox-blank-outline")])),_:2},1536),[[V,!i.hasFilter(r.key)]]),b(n(y,null,{default:s(()=>e[11]||(e[11]=[d("mdi-checkbox-outline")])),_:2},1536),[[V,i.hasFilter(r.key)]])])]),append:s(()=>[n(R,{size:"x-small"},{default:s(()=>[d(c(i.simplifyCount(r.value)),1)]),_:2},1024)]),default:s(()=>[n(Q,{class:"pr-2"},{default:s(()=>{var p;return[d(c(t.$t((p=r==null?void 0:r.key)==null?void 0:p.replace("@","ï¼ "))),1)]}),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},512),[[V,!a.loading]])]),_:1})):f("",!0)]),_:1})]),_:1})):f("",!0)]),_:1}),l.column.filterable?(u(),m(U,{key:0},{default:s(()=>[b(n(g,{onClick:i.resetAllFilters,size:"x-small"},{default:s(()=>[n(y,{class:"mr-2"},{default:s(()=>e[12]||(e[12]=[d("mdi-checkbox-blank-outline")])),_:1}),d(" "+c(t.$t("Reset all")),1)]),_:1},8,["onClick"]),[[V,i.filterIsSet]]),n(H),n(g,{onClick:e[6]||(e[6]=r=>a.menu=!1),size:"x-small"},{default:s(()=>[d(c(t.$t("Close")),1)]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["color"])):f("",!0)],2)])}const me=x(G,[["render",Y]]);export{me as _};

import{_ as L}from"./CustomTableHeaderStatic-d1pKQ-ga.js";import{d as O}from"./debouncer-Whu4ZLob.js";import{_ as k,F as b,o,c as v,A as c,w as r,a as i,ae as B,x as h,y as n,C as _,q as I,G as T,H as S,z as F,B as z,a8 as A,aW as E,aX as P,ab as V}from"./index-BtIo2-Z_.js";import{d as R}from"./index-T2HRTWtS.js";import{V as M}from"./VProgressCircular-DNPB7izS.js";import{V as g,a as $}from"./VRow-9vAZildp.js";import{V as U}from"./VDataTableVirtual-Cqes2yZi.js";import{a as J,V as C}from"./VBtn--bGuKZaN.js";import{V as H}from"./VTooltip-DXl_TsVy.js";import{V as x,a as X}from"./VToolbar-o4oksDe3.js";import{d as G}from"./VList-Cnqqz-5U.js";import{V as W}from"./VTextField-Bn35T3UG.js";import{_ as j}from"./ReportsLinks-gB2oq9-e.js";import{_ as q}from"./CustomDate-CLArRqjL.js";import{_ as K}from"./CustomBundle-HZg5QtVE.js";import{p as Y}from"./index-CebfcyPH.js";import{b as D}from"./route-block-B_A1xBdJ.js";import{V as Q,a as Z}from"./VCard-DNHZbZ5d.js";import"./index-SDX8Otz2.js";import"./VMenu-Cs322VI3.js";import"./VOverlay-BnbjS8dz.js";import"./forwardRefs--KQCZfKO.js";import"./dialog-transition-Dq7CKyny.js";import"./VContainer-BFGIFtcM.js";/* empty css              */import"./VChip-CKNl8kC9.js";import"./index-C5-hvfiu.js";import"./group-DgRBM2CV.js";import"./VAvatar-l5UJO0sV.js";import"./VImg-FY_z5S7Z.js";import"./VSpacer-bp7-SSB-.js";import"./VDataTable-BrBBORsC.js";import"./VPagination-zp71F-1D.js";import"./filter-ahsWVyiP.js";import"./VInput-CRZE-Mt3.js";import"./VCheckboxBtn-DQUGWCnj.js";import"./VAutocomplete-BVJCf0KD.js";var ee={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const te={name:"ReportsIndicators",mounted(){},props:{data:{type:Array,default:()=>[]},loading:{type:Boolean}},computed:{filteredData(){const e=this.search&&new RegExp(this.search.replace(/[.?*{}\[\]()<>]/g,""),"gi");return this.data.filter(a=>{for(let[s,m]of Object.entries(this.datatable.filters))if(!m.includes(V(s,a)))return!1;return JSON.stringify(a).match(e)})},headers(){return[{title:"Organisation name",align:"left",value:"responsibleOrganization.name",sortable:!1,filterable:!0,type:"term"},{title:"Location Region",align:"left",value:"address.fullAdmin1",sortable:!0,filterable:!0,type:"term"},{title:"Location Raion",align:"left",value:"address.fullAdmin2",sortable:!0,filterable:!0,type:"term"},{title:"Location Hromada",align:"left",value:"address.fullAdmin3",sortable:!0,filterable:!0,type:"term"},{title:"Location Settlement",align:"left",value:"address.fullAdmin4",sortable:!0,filterable:!0,type:"term"},{title:"Location Site",align:"left",value:"collectiveCenter.name",sortable:!1,filterable:!0,type:"term"},{title:"Reporting Month",align:"left",value:"date",sortable:!1,filterable:!0,type:"term"},{title:"Indicators Output",align:"left",value:"output",sortable:!1,filterable:!0,type:"term"},{title:"Indicators Indicator",align:"left",value:"indicator",sortable:!1,filterable:!0,type:"term"},{title:"PoC Category PoC Category",align:"left",value:"populationType",sortable:!1,filterable:!0,type:"term"},{title:"Modality Modality",align:"left",value:"distributionModality",sortable:!1,filterable:!0,type:"term"},{title:"Households",align:"center",value:"households",sortable:!1},{title:"Total Individuals",align:"center",value:"familySize",sortable:!1},{title:"Girls (<18)",align:"center",value:"girls",sortable:!1},{title:"Boys (<18)",align:"center",value:"boys",sortable:!1},{title:"Women (18-59)",align:"center",value:"women",sortable:!1},{title:"Men (18-59)",align:"center",value:"men",sortable:!1},{title:"Elderly women (60+)",align:"center",value:"seniorWomen",sortable:!1},{title:"Elderly men (60+)",align:"center",value:"seniorMen",sortable:!1},{title:"People with disabilities",align:"center",value:"disabled",sortable:!1}]}},data:()=>({search:void 0,searchInput:void 0,datatable:{search:"",searchKeys:[],start:void 0,end:void 0,filters:{},sortBy:[{date:"asc"}]}}),methods:{setSearch:O(function(e){this.search=e}),setFilter(e){this.datatable.filters=e},getFileName(){var m,y,d,f;const e=((y=(m=this.appStore)==null?void 0:m.user)==null?void 0:y.name)||"User",a=((f=(d=this.appStore)==null?void 0:d.user)==null?void 0:f.email)||"no@email";return`${new Date().toLocaleDateString("sv")} - Distribution indicators ${e} (${a}).xlsx`},exportData(){const e=JSON.parse(JSON.stringify(this.filteredData)).map(t=>{var u;const l=new Date(t.date);return t.date=l.getFullYear()+"-"+String(l.getMonth()+1).padStart(2,"0"),(u=t.collectiveCenter)!=null&&u.name||(t.collectiveCenter={name:"N/A"}),t}),a=`${ee.FRONT_HOST}/export/export.xlsx`,s=this.getFileName(),m=this.headers.filter(t=>t.value!=="familySize"),y=m.map(t=>t.title),f=m.map(t=>t.value).filter(t=>t!=="_id").map(t=>e.map(l=>V(t,l)));R(a,{headers:y,columns:f},s)}}},ae={class:"report-summary"},re={class:"text-no-wrap"},se={key:0},le={key:0},ie={key:0},oe={key:0};function ne(e,a,s,m,y,d){const f=L;return o(),b("div",ae,[s.loading?(o(),v(g,{key:0,class:"text-center"},{default:r(()=>[i(M,{size:"48",indeterminate:"",color:"primary"})]),_:1})):c("",!0),s.loading?c("",!0):(o(),v(g,{key:1},{default:r(()=>[i(U,{"sort-by":e.datatable.sortBy,"onUpdate:sortBy":a[3]||(a[3]=t=>e.datatable.sortBy=t),"items-per-page":0,height:e.$vuetify.display.height-390<320?320:e.$vuetify.display.height-390,headers:d.headers,items:d.filteredData,loading:s.loading,"loading-text":e.$t("Loading... Please wait"),"items-per-page-text":e.$t("Records per page"),"item-value":"_id","hide-default-footer":""},B({top:r(()=>[F(i(x,{flat:"",color:"white"},{default:r(()=>[i(X,{style:{"min-width":"150px"}},{default:r(()=>[_(n(e.$t("Summary")),1)]),_:1}),i(G,{class:"mx-4",inset:"",vertical:""}),i(W,{modelValue:e.search,"onUpdate:modelValue":[a[0]||(a[0]=t=>e.search=t),d.setSearch],class:"mr-4 w-100",variant:"outlined",density:"compact",label:e.$t("Search"),"hide-details":"","prepend-icon":"mdi-magnify"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:1},512),[[z,!e.$vuetify.display.xs]])]),headers:r(({columns:t,toggleSort:l})=>[h("tr",null,[(o(!0),b(T,null,S(t,u=>(o(),v(f,{key:u.key,onSetSort:a[1]||(a[1]=p=>e.datatable.sortBy=[p]),onSetFilter:a[2]||(a[2]=p=>d.setFilter(p)),column:u,"parent-items":d.filteredData,datatable:e.datatable},null,8,["column","parent-items","datatable"]))),128))])]),"item._id":r(({item:t})=>[i(J,null,{default:r(()=>[i(H,{text:e.$t("Export to Excel")},{activator:r(({props:l})=>[t.isDonnation?c("",!0):(o(),v(C,I({key:0},l,{onClick:u=>e.createXLSX(t),size:"small",rounded:"2",variant:"text",color:"green-darken-2",icon:"mdi-file-excel-box"}),null,16,["onClick"]))]),_:2},1032,["text"])]),_:2},1024)]),"item.publicId":r(({item:t})=>[h("strong",re,n(t.publicId),1)]),"item.address.pCode1":r(({item:t})=>{var l;return[(l=t.address)!=null&&l.pCode4?(o(),b("span",se,n(e.$t(t.address.pCode4.substring(0,4))),1)):c("",!0)]}),"item.address.pCode2":r(({item:t})=>{var l;return[(l=t.address)!=null&&l.pCode4?(o(),b("span",le,n(e.$t(t.address.pCode4.substring(0,6))),1)):c("",!0)]}),"item.address.pCode3":r(({item:t})=>{var l;return[(l=t.address)!=null&&l.pCode4?(o(),b("span",ie,n(e.$t(t.address.pCode4.substring(0,9))),1)):c("",!0)]}),"item.address.pCode4":r(({item:t})=>{var l;return[(l=t.address)!=null&&l.pCode4?(o(),b("span",oe,n(e.$t(t.address.pCode4)),1)):c("",!0)]}),"item.date":r(({item:t})=>[_(n(new Date(t.date).toLocaleDateString("sv").substring(0,7)),1)]),"no-data":r(()=>[h("div",null,n(e.$t("No data found")),1)]),_:2},[S(e.$slots,(t,l)=>({name:l,fn:r(u=>[A(e.$slots,l,E(P(u||{})))])}))]),1032,["sort-by","height","headers","items","loading","loading-text","items-per-page-text"])]),_:3})),s.loading?c("",!0):(o(),v(g,{key:2,class:"text-right"},{default:r(()=>[i(C,{onClick:d.exportData,color:"primary"},{default:r(()=>[_(n(e.$t("Export")),1)]),_:1},8,["onClick"])]),_:1}))])}const de=k(te,[["render",ne]]),{indicators:ue}=Y,{customDefinitions:N,customPreprocess:me}=ue,w={name:"custom-indicators",beforeMount(){var a,s;const e=localStorage.getItem("unhcr-rais-plus-recent-indicators");e||(this.filters={date:{$gte:new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),$lte:new Date().toLocaleDateString("sv-SE")}}),this.organizations=[(s=(a=this.appStore)==null?void 0:a.user)==null?void 0:s.organization].filter(Boolean),e&&Object.assign(this.filters,JSON.parse(e)),this.getFiltersData(),this.appStore.loading=!1},computed:{isAdmin(){var e,a,s;return(s=(a=(e=this.appStore)==null?void 0:e.user)==null?void 0:a.role)==null?void 0:s.includes("Admin")}},data:()=>({organizations:[],filters:{bundleName:"SN101-2024",date:{$lte:void 0,$gte:void 0}},indicators:[],indicatorsLoading:!0}),methods:{async getFiltersData(){const{organizations:e}=this.$storage,a=await e.slice(0,500).filter({functionalType:["UN Agency","Operational partner","Implementing partner"]}).include(["id","name","translation.uk.name"]).sort([{name:"asc"}]).find();this.organizations=a.items},async getIndicators(){this.indicatorsLoading=!0;let e;if(this.$network.online){const s=JSON.parse(JSON.stringify(this.filters));s.bundleName=Array.isArray(s.bundleName)?s.bundleName:[s.bundleName],e=await this.$api.custom.getIndicators({type:"unhcr",filter:s})}else{if(!this.filters.bundleName||!N[this.filters.bundleName])return this.indicators=[],this.indicatorsLoading=!1;try{e=await Promise.all(N[this.filters.bundleName].map(s=>s(this.$storage,this.filters)))}catch(s){console.log(s)}}const a=e.flat().map(me);this.indicators=a,this.indicatorsLoading=!1}},watch:{filters:{deep:!0,handler(e){localStorage.setItem("unhcr-rais-plus-recent-indicators",JSON.stringify(e)),this.getIndicators()}}}},pe={class:"indicators pa-2"},fe={class:"text-h5 mb-2 offset-md1 black--text"},ce={class:"mb-4"},ge={class:"text-h5 mb-2 offset-md1 black--text"};function be(e,a,s,m,y,d){const f=K,t=q,l=j,u=de;return o(),b("div",pe,[i($,{class:"mb-0 mt-0"},{default:r(()=>[i(g,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:r(()=>[i(Q,null,{default:r(()=>[i(Z,null,{default:r(()=>[i($,null,{default:r(()=>[i(g,{cols:"12",md:"3",class:"pl-md-4"},{default:r(()=>[h("div",fe,n(e.$t("Filters")),1),h("div",ce,n(e.$t("Define the filters for your report")),1),h("div",null,[i(f,{modelValue:e.filters.bundleName,"onUpdate:modelValue":a[0]||(a[0]=p=>e.filters.bundleName=p)},null,8,["modelValue"]),i(t,{modelValue:e.filters.date.$gte,"onUpdate:modelValue":a[1]||(a[1]=p=>e.filters.date.$gte=p),label:e.$t("Start of report period"),class:"mt-4"},null,8,["modelValue","label"]),i(t,{modelValue:e.filters.date.$lte,"onUpdate:modelValue":a[2]||(a[2]=p=>e.filters.date.$lte=p),label:e.$t("End of report period")},null,8,["modelValue","label"])])]),_:1}),i(g,{cols:"12",md:"9",class:"pr-md-4"},{default:r(()=>[i($,null,{default:r(()=>[i(l),i(g,{cols:"12"},{default:r(()=>[h("div",ge,n(e.$t("Custom indicators")),1)]),_:1}),i(g,null,{default:r(()=>[i(u,{data:e.indicators,filters:e.filters,startDate:e.filters.date.$gte,endDate:e.filters.date.$lte,loading:e.indicatorsLoading},null,8,["data","filters","startDate","endDate","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof D=="function"&&D(w);const et=k(w,[["render",be]]);export{et as default};

import{_ as N,a as P,b as E,c as L,d as B,e as j,f as x}from"./DistributionFormDocument-CGT6ZaYm.js";import{_ as R}from"./DistributionFormCash-CywLY2PN.js";import{c as $}from"./config-CpTMMwfY.js";import{_ as k,a2 as A,c as y,o as h,w as o,a as i,A as c,C as n,y as l,F as b,x as r,ac as W,a3 as q,a4 as C,a5 as z,a6 as I,a7 as Y,Y as G,ad as J,ae as K,H as D,G as Q}from"./index-BtIo2-Z_.js";import{V as X,c as Z,a as ee,b as te}from"./VCard-DNHZbZ5d.js";import{a as V,V as v}from"./VRow-9vAZildp.js";import{V as ae}from"./VTextarea-32VTKSi3.js";import{V as S}from"./VBtn--bGuKZaN.js";import{V as se}from"./VSpacer-bp7-SSB-.js";import{V as oe}from"./VDialog-CNptTdRK.js";import{_ as le}from"./CustomTable-CzX_aHyy.js";import{b as O}from"./route-block-B_A1xBdJ.js";import"./index-SDX8Otz2.js";import"./CustomDate-CLArRqjL.js";import"./VMenu-Cs322VI3.js";import"./VOverlay-BnbjS8dz.js";import"./forwardRefs--KQCZfKO.js";import"./dialog-transition-Dq7CKyny.js";import"./index-C5-hvfiu.js";import"./VAvatar-l5UJO0sV.js";import"./VImg-FY_z5S7Z.js";import"./VTextField-Bn35T3UG.js";import"./VInput-CRZE-Mt3.js";import"./CustomGender-C5TgvEjC.js";import"./filter-ahsWVyiP.js";import"./VList-Cnqqz-5U.js";import"./VCheckboxBtn-DQUGWCnj.js";import"./VChip-CKNl8kC9.js";import"./group-DgRBM2CV.js";import"./index-CebfcyPH.js";import"./VProgressCircular-DNPB7izS.js";import"./VDataTable-BrBBORsC.js";import"./VPagination-zp71F-1D.js";import"./CustomTextFieldTranslit-gE4NQy6n.js";import"./CustomPhone-Cd36n-GU.js";import"./VAutocomplete-BVJCf0KD.js";import"./data-BbwszT0d.js";import"./CustomTag-5aeppRFS.js";import"./debouncer-Whu4ZLob.js";import"./CustomPopulationType-DQPosMme.js";import"./VAlert-Or5Mzxjd.js";import"./VSkeletonLoader-BkKepelc.js";import"./VCheckbox-Berrf7y1.js";/* empty css              */import"./VContainer-BFGIFtcM.js";import"./searchProcessor-BfIe0Ps2.js";import"./VToolbar-o4oksDe3.js";const ie={name:"DistributionPocDialow",inject:["$confirm","$error","$loading","$showResult"],props:{modelValue:{type:Object,default:()=>({})},items:{type:Array,default:()=>[]}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},canEdit(){var e,s,m,f,p,a;if((m=(s=(e=this.appStore)==null?void 0:e.user)==null?void 0:s.role)!=null&&m.includes("Admin")||(a=(p=(f=this.appStore)==null?void 0:f.user)==null?void 0:p.role)!=null&&a.includes("Partner Editor")||!this.model.id||new Date-new Date(this.model.date)<$.timeToEditSinceDistribution||this.model.createdAt&&new Date-new Date(this.model.createdAt)<$.timeToEditSinceCreation)return!0},dialog(){const e=document.querySelector("html"),s=Object.keys(this.model).length>0;return e.classList[s?"add":"remove"]("overflow-hidden"),s}},methods:{countFamilyStats(){this.model.familyStats=Y([...this.model.familyMembers,this.model.headOfHousehold])},formatAddress:A,createFamilyMembersIds(){var f;const e=this.model.taxId||this.model.passport||z(),s=I(this.model,e);let m=[];return(f=this.model)!=null&&f.familyMembers&&(m=this.model.familyMembers.map(p=>I(p,e))),[s,...m]},async removeData(){if(!await this.$confirm({title:"Delete assistance",description:"Would you like to delete data about the assistance?"}))return!1;this.$loading(!0);const{assistances:s}=this.$storage;let m;try{m=await delete s[this.model.id]}catch(f){await this.$error(f)}if(this.$loading(!1),!m)return!1;await this.$showResult(),this.model={},this.$emit("loadItems")},async saveData(){var m,f,p,a,_;if(!await this.$confirm({title:"Save assistance",description:"Would you like to save data about the assistance?"}))return!1;(m=this.model)!=null&&m.headOfHousehold&&(this.model.headOfHousehold=q(this.model.headOfHousehold)),(f=this.model)!=null&&f.headOfHousehold&&this.model.household&&((a=(p=this.model)==null?void 0:p.address)!=null&&a.pCode4&&(this.model.household.pCode4=this.model.address.pCode4,this.model.household.admin4=this.model.address.admin4),this.model.household.fullAddress=this.formatAddress(this.model.household,"en"),this.model.household.translation.uk.fullAddress=this.formatAddress(this.model.household,"uk")),this.countFamilyStats(),this.model.familyMembersIds=this.createFamilyMembersIds(),this.model.taxIds=[C((_=this.model)==null?void 0:_.headOfHousehold),...(this.model.familyMembers||[]).map(C)].filter(Boolean);let s;try{if(!this.model.id){const{assistances:t}=this.$storage;s=await t.push(this.model)}this.model.id&&(s=await database.update(this.model.id,this.model))}catch(t){return this.$loading(!1),await this.$error(t)}this.$loading(!1),await this.$showResult(),this.model={},this.$emit("loadItems")}}},de={key:0,class:"main-part"},re={class:"text-h5 mb-2 offset-md1 black--text"},ne={class:"text-h5 mb-2 offset-md1 black--text"};function me(e,s,m,f,p,a){const _=N,t=P,u=E,g=L,w=B,T=j,F=R,U=x;return h(),y(oe,{"model-value":a.dialog,class:W(["assistance-dialog",{"poc-dialog":e.$vuetify.display.xs}]),"content-class":"poc-dialog",scrollable:"",persistent:"",overlay:!1,"max-width":"500px",transition:"slide-x-reverse-transition"},{default:o(()=>[i(X,{tile:"",class:"fill-height"},{default:o(()=>[i(Z,{"primary-title":""},{default:o(()=>[n(l(e.$t("Add")),1)]),_:1}),a.model.headOfHousehold?(h(),y(ee,{key:0,class:"pt-4",style:{"font-size":"0.875rem"}},{default:o(()=>[i(_,{modelValue:a.model.headOfHousehold,"onUpdate:modelValue":s[0]||(s[0]=d=>a.model.headOfHousehold=d),onSetId:s[1]||(s[1]=d=>a.model.householdId=d),onSetFamilyMembers:s[2]||(s[2]=d=>a.model.familyMembers=d),onSetHousehold:s[3]||(s[3]=d=>a.model.household=d),householdId:a.model.householdId},null,8,["modelValue","householdId"]),a.model.householdId?(h(),b("div",de,[i(t,{modelValue:a.model,"onUpdate:modelValue":s[4]||(s[4]=d=>a.model=d)},null,8,["modelValue"]),i(u,{modelValue:a.model.address,"onUpdate:modelValue":s[5]||(s[5]=d=>a.model.address=d)},null,8,["modelValue"]),a.model.headOfHousehold?(h(),y(g,{key:0,modelValue:a.model.headOfHousehold,"onUpdate:modelValue":s[6]||(s[6]=d=>a.model.headOfHousehold=d)},null,8,["modelValue"])):c("",!0),a.model.household?(h(),y(w,{key:1,modelValue:a.model.household,"onUpdate:modelValue":s[7]||(s[7]=d=>a.model.household=d),householdId:a.model.householdId},null,8,["modelValue","householdId"])):c("",!0),i(T,{modelValue:a.model.familyMembers,"onUpdate:modelValue":s[8]||(s[8]=d=>a.model.familyMembers=d)},null,8,["modelValue"]),i(F,{modelValue:a.model,"onUpdate:modelValue":s[9]||(s[9]=d=>a.model=d)},null,8,["modelValue"]),i(V,{class:"mb-4 mt-4"},{default:o(()=>[i(v,{cols:"12"},{default:o(()=>[r("div",re,l(e.$t("Signature")),1),r("div",null,l(e.$t("Please sign the completed form")),1)]),_:1}),i(v,{cols:"12"},{default:o(()=>[i(U,{modelValue:a.model.signature,"onUpdate:modelValue":s[10]||(s[10]=d=>a.model.signature=d),mode:"edit"},null,8,["modelValue"])]),_:1})]),_:1}),i(V,{class:"mb-4 mt-4"},{default:o(()=>[i(v,{cols:"12"},{default:o(()=>[r("div",ne,l(e.$t("Comment")),1),r("div",null,l(e.$t("You can add any additional comment")),1)]),_:1}),i(v,{cols:"12"},{default:o(()=>[i(ae,{modelValue:a.model.comment,"onUpdate:modelValue":s[11]||(s[11]=d=>a.model.comment=d),variant:"underlined"},null,8,["modelValue"])]),_:1})]),_:1})])):c("",!0)]),_:1})):c("",!0),i(te,null,{default:o(()=>[a.canEdit&&a.model.id?(h(),y(S,{key:0,onClick:a.removeData,color:"error",variant:"tonal",class:"ml-4"},{default:o(()=>[n(l(e.$t("Delete")),1)]),_:1},8,["onClick"])):c("",!0),i(se),i(S,{onClick:s[12]||(s[12]=d=>this.model={}),color:"orange darken-2",variant:"text"},{default:o(()=>[n(l(e.$t("Cancel")),1)]),_:1}),a.canEdit?(h(),y(S,{key:1,onClick:a.saveData,color:"primary",variant:"tonal",class:"mr-4"},{default:o(()=>[n(l(e.$t("Save")),1)]),_:1},8,["onClick"])):c("",!0)]),_:1})]),_:1})]),_:1},8,["model-value","class"])}const ue=k(ie,[["render",me]]),H={New:"green-darken-2",Duplicated:"red-darken-2"},he=e=>H[e]?H[e]:"grey-darken-2",fe={name:"CashCustomTable",props:{items:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},hasAddress:{type:Boolean},publicId:{type:String}},computed:{itemList(){return this.items?this.items.map((e,s)=>({title:e.key,value:`item.${e.key}`,align:"center"})):[]},headers(){const e=[{title:"",align:"center",value:"synced"},{title:"Tax ID",align:"start",value:"taxId",sortable:!0},{title:"Name",align:"start",value:"name",sortable:!0},{title:"Place of Origin",align:"start",value:"origin",sortable:!0},{title:"Phone",align:"start",value:"phone"},this.hasAddress?{title:"Address",align:"start",value:"household"}:!1,{title:"Male, <18",align:"center",value:"familyStats.boys"},{title:"Female, <18",align:"center",value:"familyStats.girls"},{title:"Male, 18-60",align:"center",value:"familyStats.men"},{title:"Female, 18-60",align:"center",value:"familyStats.women"},{title:"Male, 60+",align:"center",value:"familyStats.seniorMen"},{title:"Female, 60+",align:"center",value:"familyStats.seniorWomen"},{title:"People with disabilities",align:"center",value:"familyStats.disabled"},{title:"Value",align:"center",value:"value"},{title:"Currency",align:"center",value:"currency"},{title:"Start date",align:"start",value:"attendedFrom"},{title:"End date",align:"start",value:"attendedTo"},{title:"Comment",align:"start",value:"comment"}].filter(Boolean);return e.push(...this.itemList),e}},methods:{getChipColor:he,async loadItems(){this.$refs.mainTable.loadItems()},formatAddress:A,formatPrice:J,formatDate:G}},ce=["onClick"],pe={class:"text-no-wrap"},_e={class:"text-no-wrap"},ye={class:"text-no-wrap"},ge={class:"text-no-wrap"},be={key:0,class:"text-no-wrap"},ve=["href"],Ve={class:"text-no-wrap"},Se={key:0,class:"text-no-wrap"},we={key:0,class:"text-no-wrap"};function ke(e,s,m,f,p,a){const _=le;return e.appStore.loading?c("",!0):(h(),y(_,{key:0,title:e.$t("Receivers"),headers:a.headers,filters:m.filters,"sort-by":{key:"createdAt",sort:"asc"},"search-keys":["headOfHousehold.fullName","headOfHousehold.translation.uk.fullName","headOfHousehold.taxId","headOfHousehold.passport"],index:"date",class:"cash-custom-table",ref:"mainTable",table:"assistances"},K({"item.synced":o(({item:t})=>[r("div",null,[r("div",{onClick:u=>e.$emit("editData",t)},[i(S,{icon:"mdi-pencil",size:"x-small",color:"grey",variant:"tonal"})],8,ce)])]),"item.taxId":o(({item:t})=>{var u;return[n(l((u=t.headOfHousehold)!=null&&u.taxId?t.headOfHousehold.taxId:t.headOfHousehold.passport),1)]}),"item.value":o(({item:t})=>[r("span",pe,l(a.formatPrice(t.value)),1)]),"item.attendedFrom":o(({item:t})=>[r("span",_e,l(a.formatDate(t.attendedFrom)),1)]),"item.attendedTo":o(({item:t})=>[r("span",ye,l(a.formatDate(t.attendedTo)),1)]),"item.name":o(({item:t})=>[r("span",ge,l(t.headOfHousehold?e.$_translate(t.headOfHousehold).fullName:""),1)]),"item.origin":o(({item:t})=>{var u,g;return[(u=t.headOfHousehold)!=null&&u.origin?(h(),b("span",be,l(e.$t(((g=t.headOfHousehold)==null?void 0:g.origin)||""))+" "+l(["UA80","UA01"].includes(t.origin)?"":e.$t("oblast")),1)):c("",!0)]}),"item.phone":o(({item:t})=>[(h(!0),b(Q,null,D(t.headOfHousehold.phone,u=>(h(),b("div",null,[r("a",{href:`tel:${u}`,class:"text-no-wrap"},l(u),9,ve)]))),256))]),"item.household":o(({item:t})=>[r("span",Ve,l(a.formatAddress(t.household)),1)]),"item.familyStats.girls":o(({item:t})=>[n(l(t.familyStats.girls),1)]),"item.familyStats.boys":o(({item:t})=>[n(l(t.familyStats.boys),1)]),"item.familyStats.men":o(({item:t})=>[n(l(t.familyStats.men),1)]),"item.familyStats.women":o(({item:t})=>[n(l(t.familyStats.women),1)]),"item.familyStats.seniorMen":o(({item:t})=>[n(l(t.familyStats.seniorMen),1)]),"item.familyStats.seniorWomen":o(({item:t})=>[n(l(t.familyStats.seniorWomen),1)]),"item.familyStats.disabled":o(({item:t})=>[n(l(t.familyStats.disabled),1)]),"item.attendedFrom":o(({item:t})=>[t.attendedFrom?(h(),b("span",Se,l(new Date(t.attendedFrom).toLocaleDateString("uk")),1)):c("",!0)]),"item.attendedTo":o(({item:t})=>[t.attendedTo?(h(),b("span",we,l(new Date(t.attendedTo).toLocaleDateString("uk")),1)):c("",!0)]),_:2},[D(m.items,t=>({name:`item.item.${t.key}`,fn:o(({item:u})=>{var g;return[n(l(Array.isArray(u.items)?(g=u.items.find(w=>w.key===t.key))==null?void 0:g.value:0),1)]})}))]),1032,["title","headers","filters"]))}const $e=k(fe,[["render",ke]]),M={name:"request",inject:["$confirm","$error","$loading","$showResult"],data:()=>({filters:void 0,assistance:void 0}),created(){this.init()},computed:{title(){this.filters||(this.appStore.breadcrumb="New cash intervention");const{date:e}=this.filters;return this.appStore.breadcrumb="Cash interventions",this.$t("Cash intervention",{date:new Date(e).toLocaleDateString("uk")})}},methods:{async init(){const e=this.$route.query;e["address.pCode4"]=e.pCode4,delete e.pCode4,this.filters=e,this.appStore.loading=!1},loadItems(){this.$refs.cashTable.loadItems()},editData(e){this.assistance=e}}},Ce={class:"report pa-2"},Ie={class:"text-h4 font-weight-bold"},De={class:"bg-grey-lighten-4 pa-4 d-flex w-100 justify-space-between"},Oe={class:"mb-1"},He={class:"mb-1"},Ae={class:"mb-1"};function Me(e,s,m,f,p,a){const _=$e,t=ue;return h(),b("div",Ce,[i(V,{class:"mb-0 mt-0"},{default:o(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:o(()=>[r("div",Ie,l(a.title||e.$t("Cash interventions")),1)]),_:1})]),_:1}),i(V,{class:"mb-0 mt-0"},{default:o(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:o(()=>[r("div",De,[r("div",null,[r("p",Oe,[r("strong",null,l(e.$t("Assistance type"))+":",1),n(" "+l(e.$t(e.filters.bundleName)),1)]),r("p",He,[r("strong",null,l(e.$t("Distribution modality"))+":",1),n(" "+l(e.$t(e.filters.distributionModality)),1)]),r("p",Ae,[r("strong",null,l(e.$t("Population type"))+":",1),n(" "+l(e.$t(e.filters.populationType)),1)]),r("p",null,[r("strong",null,l(e.$t("Locality"))+":",1),n(" "+l(e.$t(e.filters["address.pCode4"])),1)])]),r("div",null,[i(S,{to:"/cash",color:"primary"},{default:o(()=>[n(l(e.$t("Close")),1)]),_:1})])])]),_:1})]),_:1}),i(V,{class:"mb-0 mt-0"},{default:o(()=>[i(v,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:o(()=>[e.filters?(h(),y(_,{key:0,ref:"cashTable",onEditData:a.editData,filters:e.filters},null,8,["onEditData","filters"])):c("",!0)]),_:1})]),_:1}),i(t,{modelValue:e.assistance,"onUpdate:modelValue":s[0]||(s[0]=u=>e.assistance=u),onLoadItems:a.loadItems},null,8,["modelValue","onLoadItems"])])}typeof O=="function"&&O(M);const Ct=k(M,[["render",Me]]);export{Ct as default};

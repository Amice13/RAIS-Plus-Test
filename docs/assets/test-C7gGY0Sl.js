import{_ as m,F as f,o as g,a as o,x as c,w as n,z as y,B as v,Z as $,a0 as S,a1 as w,y as p}from"./index-BtIo2-Z_.js";import{V as C}from"./index-C5-hvfiu.js";import{V as x}from"./VProgressCircular-DNPB7izS.js";import{b as h}from"./route-block-B_A1xBdJ.js";import{V as l,a as u}from"./VRow-9vAZildp.js";import{V as L,a as V}from"./VCard-DNHZbZ5d.js";import"./index-SDX8Otz2.js";/* empty css              */import"./VAvatar-l5UJO0sV.js";import"./VImg-FY_z5S7Z.js";let d={};const D=()=>[{itemStyle:{borderColor:"#777",borderWidth:0,gapWidth:1},upperLabel:{show:!1}},{itemStyle:{borderColor:"#EEE",borderWidth:5,gapWidth:1},emphasis:{itemStyle:{borderColor:"#ddd"}}},{colorSaturation:[.35,.5],itemStyle:{borderWidth:5,gapWidth:1,borderColorSaturation:.6}}],M=({data:i})=>({grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},tooltip:{formatter:function(t){for(var a=t.value,e=t.treePathInfo,r=[],s=1;s<e.length;s++)r.push(e[s].name);return['<div class="tooltip-title">'+S(r.join(" - "))+"</div>","Number: "+w(a)].join("")}},toolbox:{show:!0,left:"right",top:"top",feature:{restore:{},saveAsImage:{}}},series:[{name:"Items",type:"treemap",visibleMin:300,label:{show:!0,width:30,formatter:"{b}"},breadcrumb:{show:!1,formatter:function(t){let a=t.name;return a.length>10?a.slice(0,10)+"â€¦":a},textStyle:{overflow:"truncate",fontSize:10}},upperLabel:{show:!0,height:30},itemStyle:{borderColor:"#fff"},levels:D(),data:i}]}),z={name:"SingleMap",props:{entity:{type:String,required:!0},title:{type:String,default:"Map"},description:{type:String,default:"Map subtitle"},filter:{type:Object},map:{type:String,default:"adm1"},value:{type:Object,default(){return{variable:"address.pCode1",operation:"count"}}}},mounted(){this.id="div"+Math.random();const i=this.$refs.chart;d[this.id]=$(i),this.getData()},data(){return{id:null,isLoading:!0}},methods:{async getData(){this.$vuetify.theme.current.colors["primary-lighten-4"],this.$vuetify.theme.current.colors.primary;let t=this.$storage[this.entity];this.filter&&(t=t.filter(this.filter)),t=await t.aggregate({groupBy:["bundleName"],aggs:{children:{variable:"items",operation:"nested",nested:{groupBy:["key"],aggs:{value:{variable:"value",operation:"sum"}}}}}}),console.log(t),t=t.map(e=>(e.name=this.$t(e.bundleName),e.children||(e.children=e.items),!e.children||!e.children.length?!1:(e.value=e.children.map(r=>r.value).reduce((r,s)=>r+s,0),e.children=e.children.map(r=>(r.name=this.$t(r.key),r)),e))).filter(Boolean),console.log(t);const a=M({title:this.title,description:this.description,data:t,$t:this.$t});d[this.id].setOption(a),this.isLoading=!1},changeParams(){const i=d[this.id].getOption();i.title.text=this.$t(this.title),i.title.subtext=this.$t(this.description),d[this.id].setOption(i,{notMerge:!1,replaceMerge:[]})}},watch:{"$i18n.locale"(){this.changeParams()}}},O={class:"tree-map align-center justify-center custom-chart align-center",style:{"aspect-ratio":"5/3",position:"relative"}},k={"leave-absolute":"",class:"chart-loader text-center w-100 h-100"},B={ref:"chart",class:"h-100"};function N(i,t,a,e,r,s){return g(),f("div",O,[o(C,null,{default:n(()=>[y(c("div",k,[o(x,{color:"primary",size:"56",indeterminate:""})],512),[[v,r.isLoading]])]),_:1}),c("div",B,null,512)])}const j=m(z,[["render",N]]),b={name:"analytics",beforeMount(){var t,a,e,r,s;const i=localStorage.getItem("unhcr-rais-plus-recent-report");i||(this.filters["organization.id"]=(e=(a=(t=this.appStore)==null?void 0:t.user)==null?void 0:a.organization)==null?void 0:e.id,this.filters.date.$gte=new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),this.filters.date.$lte=new Date().toLocaleDateString("sv-SE")),this.organizations=[(s=(r=this.appStore)==null?void 0:r.user)==null?void 0:s.organization].filter(Boolean),i&&Object.assign(this.filters,JSON.parse(i)),this.appStore.loading=!1},computed:{isAdmin(){var i,t,a;return(a=(t=(i=this.appStore)==null?void 0:i.user)==null?void 0:t.role)==null?void 0:a.includes("Admin")}},data:()=>({organizations:[],filters:{"organization.id":void 0,bundleName:"SN101-2024",aor:[],distributionModality:"In-kind",populationType:[],date:{$lte:void 0,$gte:void 0},pCode1:void 0,pCode2:void 0,pCode3:void 0,pCode4:void 0},includeDonations:!1,summary:[],summaryLoading:!0,indicators:[],indicatorsLoading:!0}),methods:{}},E={class:"reports pa-2"},I={class:"text-h5 mb-2 offset-md1 black--text"};function P(i,t,a,e,r,s){const _=j;return g(),f("div",E,[o(u,{class:"mb-0 mt-0"},{default:n(()=>[o(l,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:n(()=>[o(L,null,{default:n(()=>[o(V,null,{default:n(()=>[o(u,null,{default:n(()=>[o(l,{cols:"12",md:"3",class:"pl-md-4"},{default:n(()=>[c("div",I,p(i.$t("Filters")),1),c("div",null,p(i.$t("Define the filters for your report")),1)]),_:1}),o(l,{cols:"12",md:"9",class:"pr-md-4"},{default:n(()=>[o(u,null,{default:n(()=>[o(l,{cols:"12"},{default:n(()=>[o(_,{entity:"assistances"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof h=="function"&&h(b);const K=m(b,[["render",P]]);export{K as default};

import{r as S,N as H,p as K,O,P as Q,h as X,u as $,Q as z,s as x,R as J,S as Z,i as ee,T as te,q as ae,e as A,f as ne,U as se,b as oe,l as re,a as k,n as U,W as ie,X as le,_ as ce,o as h,c as R,w,C as b,A as _,B as g,F as D}from"./index-BYWsBYtF.js";import{V as T}from"./VBtn-DEU8AXzn.js";import{m as ue,u as de,V as N}from"./VOverlay-uyg0Ioz0.js";import{f as fe}from"./forwardRefs-D3j0TLhE.js";import{h as me,i as ve,c as ke,j as he,k as ye,l as pe,f as we,n as _e,o as ge,g as Se}from"./index-CqdMy8lr.js";function Pe(e={}){const{immediate:c=!1,onNeedRefresh:a,onOfflineReady:t,onRegistered:o,onRegisteredSW:i,onRegisterError:l}=e;let n,d,f;const y=async(s=!0)=>{await d,await(f==null?void 0:f())};async function m(){if("serviceWorker"in navigator){if(n=await H(async()=>{const{Workbox:s}=await import("./workbox-window.prod.es5-DL_hIMXg.js");return{Workbox:s}},[]).then(({Workbox:s})=>new s("/sw.js",{scope:"/",type:"classic"})).catch(s=>{l==null||l(s)}),!n)return;f=async()=>{await(n==null?void 0:n.messageSkipWaiting())};{let s=!1;const v=()=>{s=!0,n==null||n.addEventListener("controlling",u=>{u.isUpdate&&window.location.reload()}),a==null||a()};n.addEventListener("installed",u=>{typeof u.isUpdate>"u"?typeof u.isExternal<"u"?u.isExternal?v():!s&&(t==null||t()):u.isExternal?window.location.reload():!s&&(t==null||t()):u.isUpdate||t==null||t()}),n.addEventListener("waiting",v),n.addEventListener("externalwaiting",v)}n.register({immediate:c}).then(s=>{i?i("/sw.js",s):o==null||o(s)}).catch(s=>{l==null||l(s)})}}return d=m(),y}function Ce(e={}){const{immediate:c=!0,onNeedRefresh:a,onOfflineReady:t,onRegistered:o,onRegisteredSW:i,onRegisterError:l}=e,n=S(!1),d=S(!1);return{updateServiceWorker:Pe({immediate:c,onNeedRefresh(){n.value=!0,a==null||a()},onOfflineReady(){d.value=!0,t==null||t()},onRegistered:o,onRegisteredSW:i,onRegisterError:l}),offlineReady:d,needRefresh:n}}function Re(e){const c=x(e());let a=-1;function t(){clearInterval(a)}function o(){t(),le(()=>c.value=e())}function i(l){const n=l?getComputedStyle(l):{transitionDuration:.2},d=parseFloat(n.transitionDuration)*1e3||200;if(t(),c.value<=0)return;const f=performance.now();a=window.setInterval(()=>{const y=performance.now()-f+d;c.value=Math.max(e()-y,0),c.value<=0&&t()},d)}return ie(t),{clear:t,time:c,start:i,reset:o}}const Ve=K({multiLine:Boolean,text:String,timer:[Boolean,String],timeout:{type:[Number,String],default:5e3},vertical:Boolean,...me({location:"bottom"}),...ve(),...ke(),...he(),...O(),...Q(ue({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},"VSnackbar"),be=X()({name:"VSnackbar",props:Ve(),emits:{"update:modelValue":e=>!0},setup(e,c){let{slots:a}=c;const t=$(e,"modelValue"),{positionClasses:o}=ye(e),{scopeId:i}=de(),{themeClasses:l}=z(e),{colorClasses:n,colorStyles:d,variantClasses:f}=pe(e),{roundedClasses:y}=we(e),m=Re(()=>Number(e.timeout)),s=S(),v=S(),u=x(!1),L=x(0),W=S(),I=J(Z,void 0);ee(()=>!!I,()=>{const r=te();ae(()=>{W.value=r.mainStyles.value})}),A(t,P),A(()=>e.timeout,P),ne(()=>{t.value&&P()});let V=-1;function P(){m.reset(),window.clearTimeout(V);const r=Number(e.timeout);if(!t.value||r===-1)return;const p=se(v.value);m.start(p),V=window.setTimeout(()=>{t.value=!1},r)}function j(){m.reset(),window.clearTimeout(V)}function F(){u.value=!0,j()}function E(){u.value=!1,P()}function M(r){L.value=r.touches[0].clientY}function Y(r){Math.abs(L.value-r.changedTouches[0].clientY)>50&&(t.value=!1)}function q(){u.value&&E()}const G=oe(()=>e.location.split(" ").reduce((r,p)=>(r[`v-snackbar--${p}`]=!0,r),{}));return re(()=>{const r=N.filterProps(e),p=!!(a.default||a.text||e.text);return k(N,U({ref:s,class:["v-snackbar",{"v-snackbar--active":t.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--timer":!!e.timer,"v-snackbar--vertical":e.vertical},G.value,o.value,e.class],style:[W.value,e.style]},r,{modelValue:t.value,"onUpdate:modelValue":C=>t.value=C,contentProps:U({class:["v-snackbar__wrapper",l.value,n.value,y.value,f.value],style:[d.value],onPointerenter:F,onPointerleave:E},r.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0,onTouchstartPassive:M,onTouchend:Y,onAfterLeave:q},i),{default:()=>{var C,B;return[_e(!1,"v-snackbar"),e.timer&&!u.value&&k("div",{key:"timer",class:"v-snackbar__timer"},[k(ge,{ref:v,color:typeof e.timer=="string"?e.timer:"info",max:e.timeout,"model-value":m.time.value},null)]),p&&k("div",{key:"content",class:"v-snackbar__content",role:"status","aria-live":"polite"},[((C=a.text)==null?void 0:C.call(a))??e.text,(B=a.default)==null?void 0:B.call(a)]),a.actions&&k(Se,{defaults:{VBtn:{variant:"text",ripple:!1,slim:!0}}},{default:()=>[k("div",{class:"v-snackbar__actions"},[a.actions({isActive:t})])]})]},activator:a.activator})}),fe({},s)}}),{offlineReady:Te,needRefresh:xe,updateServiceWorker:Le}=Ce(),We={name:"ThePwaReloadDialog",computed:{model(){return this.offlineReady||this.needRefresh}},mounted(){this.offlineReady=Te,this.needRefresh=xe},data(){return{text:"Update the app",offlineReady:!1,needRefresh:!1}},methods:{close(){this.offlineReady=!1,this.needRefresh=!1},async update(){await Le(),this.needRefresh=!1}}},Ee={key:0},Be={key:1};function Ae(e,c,a,t,o,i){return h(),R(be,{"model-value":i.model,timeout:-1,color:"primary",class:"pwa-reload"},{actions:w(()=>[o.needRefresh?(h(),R(T,{key:0,onClick:i.close,variant:"text"},{default:w(()=>[b(_(e.$t("Cancel")),1)]),_:1},8,["onClick"])):g("",!0),o.needRefresh?(h(),R(T,{key:1,onClick:i.update,variant:"tonal"},{default:w(()=>[b(_(e.$t("Update")),1)]),_:1},8,["onClick"])):g("",!0),o.offlineReady?(h(),R(T,{key:2,onClick:i.close,variant:"text"},{default:w(()=>[b(_(e.$t("Ok")),1)]),_:1},8,["onClick"])):g("",!0)]),default:w(()=>[o.needRefresh?(h(),D("span",Ee,_(e.$t("Update the app")),1)):g("",!0),o.offlineReady?(h(),D("span",Be,_(e.$t("App is ready to work offline")),1)):g("",!0)]),_:1},8,["model-value"])}const Fe=ce(We,[["render",Ae]]);export{Fe as _};

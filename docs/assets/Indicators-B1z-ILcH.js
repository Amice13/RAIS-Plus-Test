import{_ as I}from"./CustomTableHeaderStatic-d1pKQ-ga.js";import{d as w}from"./debouncer-Whu4ZLob.js";import{_ as C,F as g,o as n,c as v,A as p,w as a,a as s,ae as O,x as h,y as d,C as _,q as F,G as R,H as $,z as B,B as z,a8 as P,aW as T,aX as E,ab as A}from"./index-BtIo2-Z_.js";import{d as L}from"./index-T2HRTWtS.js";import{V as U}from"./VProgressCircular-DNPB7izS.js";import{V as f,a as S}from"./VRow-9vAZildp.js";import{V as G}from"./VDataTableVirtual-Cqes2yZi.js";import{a as M,V}from"./VBtn--bGuKZaN.js";import{V as H}from"./VTooltip-DXl_TsVy.js";import{V as J,a as K}from"./VToolbar-o4oksDe3.js";import{d as W}from"./VList-Cnqqz-5U.js";import{V as X}from"./VTextField-Bn35T3UG.js";import{_ as x}from"./ReportsLinks-gB2oq9-e.js";import{_ as j}from"./CustomDate-CLArRqjL.js";import{_ as q}from"./CustomBundle-HZg5QtVE.js";import{p as Q}from"./index-CebfcyPH.js";import{b as N}from"./route-block-B_A1xBdJ.js";import{V as Y,a as Z}from"./VCard-DNHZbZ5d.js";import"./index-SDX8Otz2.js";import"./VMenu-Cs322VI3.js";import"./VOverlay-BnbjS8dz.js";import"./forwardRefs--KQCZfKO.js";import"./dialog-transition-Dq7CKyny.js";import"./VContainer-BFGIFtcM.js";/* empty css              */import"./VChip-CKNl8kC9.js";import"./index-C5-hvfiu.js";import"./group-DgRBM2CV.js";import"./VAvatar-l5UJO0sV.js";import"./VImg-FY_z5S7Z.js";import"./VSpacer-bp7-SSB-.js";import"./VDataTable-BrBBORsC.js";import"./VPagination-zp71F-1D.js";import"./filter-ahsWVyiP.js";import"./VInput-CRZE-Mt3.js";import"./VCheckboxBtn-DQUGWCnj.js";import"./VAutocomplete-BVJCf0KD.js";var ee={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const te={name:"ReportsIndicators",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean}},computed:{filteredData(){if(!this.search)return this.data;const e=new RegExp(this.search.replace(/[.?*{}\[\]()<>]/g,""),"gi");return this.data.filter(t=>JSON.stringify(t).match(e))},headers(){return[{title:"Reporting Organization Organization name (abbreviation)",align:"left",value:"responsibleOrganization.name",sortable:!1},{title:"Implementing Partner Organization name (abbreviation)",align:"left",value:"organization.name",sortable:!1},{title:"Plan/Project Code",align:"left",value:"additionalCode",sortable:!1},{title:"Indicators - SNFI SNFI Activity",align:"left",value:"output",sortable:!1},{title:"Indicators - SNFI SNFI Indicator",align:"left",value:"indicator",sortable:!1},{title:"Indicators - SNFI SNFI Modality",align:"left",value:"distributionModality",sortable:!1},{title:"Oblast Oblast ENG/UKR",align:"left",value:"address.fullAdmin1",sortable:!0,filterable:!0,type:"term"},{title:"Raion Raion ENG/UKR",align:"left",value:"address.fullAdmin2",sortable:!0,filterable:!0,type:"term"},{title:"Hromada Hromada ENG/PCODE/UKR",align:"left",value:"address.fullAdmin3",sortable:!0,filterable:!0,type:"term"},{title:"Settlement Settlement ENG/PCODE/UKR",align:"left",value:"address.fullAdmin4",sortable:!0,filterable:!0,type:"term"},{title:"Collective Sites Pcode Collective Site Name",align:"left",value:"collectiveCenter.fullName",sortable:!1},{title:"Reporting Month",align:"left",value:"date",sortable:!1},{title:"Population Group Population Group",align:"left",value:"populationType",sortable:!1},{title:"Non-individuals Reached",align:"center",value:"households",sortable:!1},{title:"Total Individuals Reached",align:"center",value:"familySize",sortable:!1},{title:"Girls (0-17)",align:"center",value:"girls",sortable:!1},{title:"Boys (0-17)",align:"center",value:"boys",sortable:!1},{title:"Adult Women (18-59)",align:"center",value:"women",sortable:!1},{title:"Adult Men (18-59)",align:"center",value:"men",sortable:!1},{title:"Older Women (60+)",align:"center",value:"seniorWomen",sortable:!1},{title:"Older Men (60+)",align:"center",value:"seniorMen",sortable:!1},{title:"People with disability",align:"center",value:"disabled",sortable:!1}]}},data:()=>({search:void 0,searchInput:void 0,datatable:{search:"",searchKeys:[],filters:{},sortBy:[{date:"asc"}]}}),methods:{setSearch:w(function(e){this.search=e}),getFileName(){var y,b,o,u;const e=((b=(y=this.appStore)==null?void 0:y.user)==null?void 0:b.name)||"User",t=((u=(o=this.appStore)==null?void 0:o.user)==null?void 0:u.email)||"no@email";return`${new Date().toLocaleDateString("sv")} - Distribution indicators ${e} (${t}).xlsx`},exportData(){let e=JSON.parse(JSON.stringify(this.filteredData));const t=`${ee.FRONT_HOST}/export/export.xlsx`,r=this.getFileName(),b=this.headers.map(o=>o.value).filter(o=>o!=="_id").map(o=>e.map(u=>A(o,u)));L(t,{headers:this.headers.map(o=>o.title),columns:b},r)}}},ae={class:"report-summary"},le={class:"text-no-wrap"},se={key:0},ie={key:0},re={key:0},oe={key:0};function ne(e,t,r,y,b,o){const u=I;return n(),g("div",ae,[r.loading?(n(),v(f,{key:0,class:"text-center"},{default:a(()=>[s(U,{size:"48",indeterminate:"",color:"primary"})]),_:1})):p("",!0),r.loading?p("",!0):(n(),v(f,{key:1},{default:a(()=>[s(G,{"sort-by":e.datatable.sortBy,"onUpdate:sortBy":t[3]||(t[3]=l=>e.datatable.sortBy=l),"items-per-page":0,height:e.$vuetify.display.height-390<320?320:e.$vuetify.display.height-390,headers:o.headers,items:o.filteredData,loading:r.loading,"loading-text":e.$t("Loading... Please wait"),"items-per-page-text":e.$t("Records per page"),"item-value":"_id","hide-default-footer":""},O({top:a(()=>[B(s(J,{flat:"",color:"white"},{default:a(()=>[s(K,{style:{"min-width":"150px"}},{default:a(()=>[_(d(e.$t("Summary")),1)]),_:1}),s(W,{class:"mx-4",inset:"",vertical:""}),s(X,{modelValue:e.search,"onUpdate:modelValue":[t[0]||(t[0]=l=>e.search=l),o.setSearch],class:"mr-4 w-100",variant:"outlined",density:"compact",label:e.$t("Search"),"hide-details":"","prepend-icon":"mdi-magnify"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:1},512),[[z,!e.$vuetify.display.xs]])]),headers:a(({columns:l,toggleSort:i})=>[h("tr",null,[(n(!0),g(R,null,$(l,c=>(n(),v(u,{key:c.key,onSetSort:t[1]||(t[1]=m=>e.datatable.sortBy=[m]),onSetFilter:t[2]||(t[2]=m=>e.setFilter(m)),column:c,"parent-items":o.filteredData,datatable:e.datatable},null,8,["column","parent-items","datatable"]))),128))])]),"item._id":a(({item:l})=>[s(M,null,{default:a(()=>[s(H,{text:e.$t("Export to Excel")},{activator:a(({props:i})=>[l.isDonnation?p("",!0):(n(),v(V,F({key:0},i,{onClick:c=>e.createXLSX(l),size:"small",rounded:"2",variant:"text",color:"green-darken-2",icon:"mdi-file-excel-box"}),null,16,["onClick"]))]),_:2},1032,["text"])]),_:2},1024)]),"item.publicId":a(({item:l})=>[h("strong",le,d(l.publicId),1)]),"item.address.pCode1":a(({item:l})=>{var i;return[(i=l.address)!=null&&i.pCode4?(n(),g("span",se,d(e.$t(l.address.pCode4.substring(0,4))),1)):p("",!0)]}),"item.address.pCode2":a(({item:l})=>{var i;return[(i=l.address)!=null&&i.pCode4?(n(),g("span",ie,d(e.$t(l.address.pCode4.substring(0,6))),1)):p("",!0)]}),"item.address.pCode3":a(({item:l})=>{var i;return[(i=l.address)!=null&&i.pCode4?(n(),g("span",re,d(e.$t(l.address.pCode4.substring(0,9))),1)):p("",!0)]}),"item.address.pCode4":a(({item:l})=>{var i;return[(i=l.address)!=null&&i.pCode4?(n(),g("span",oe,d(e.$t(l.address.pCode4)),1)):p("",!0)]}),"item.date":a(({item:l})=>[_(d(new Date(l.date).toLocaleDateString("sv").substring(0,7)),1)]),"no-data":a(()=>[h("div",null,d(e.$t("No data found")),1)]),_:2},[$(e.$slots,(l,i)=>({name:i,fn:a(c=>[P(e.$slots,i,T(E(c||{})))])}))]),1032,["sort-by","height","headers","items","loading","loading-text","items-per-page-text"])]),_:3})),r.loading?p("",!0):(n(),v(f,{key:2,class:"text-right"},{default:a(()=>[s(V,{onClick:o.exportData,color:"primary"},{default:a(()=>[_(d(e.$t("Export")),1)]),_:1},8,["onClick"])]),_:1}))])}const de=C(te,[["render",ne]]),{indicators:me}=Q,{definitions:D,preprocess:ue}=me,k={name:"indicators",beforeMount(){var t,r;const e=localStorage.getItem("unhcr-rais-plus-recent-indicators");e||(this.filters={date:{$gte:new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),$lte:new Date().toLocaleDateString("sv-SE")}}),this.organizations=[(r=(t=this.appStore)==null?void 0:t.user)==null?void 0:r.organization].filter(Boolean),e&&Object.assign(this.filters,JSON.parse(e)),this.getFiltersData(),this.appStore.loading=!1},computed:{isAdmin(){var e,t,r;return(r=(t=(e=this.appStore)==null?void 0:e.user)==null?void 0:t.role)==null?void 0:r.includes("Admin")}},data:()=>({organizations:[],filters:{bundleName:"SN101-2024",date:{$lte:void 0,$gte:void 0}},indicators:[],indicatorsLoading:!0}),methods:{async getFiltersData(){const{organizations:e}=this.$storage,t=await e.slice(0,500).filter({functionalType:["UN Agency","Operational partner","Implementing partner"]}).include(["id","name","translation.uk.name"]).sort([{name:"asc"}]).find();this.organizations=t.items},async getIndicators(){if(this.indicatorsLoading=!0,!this.filters.bundleName||!D[this.filters.bundleName])return this.indicators=[],this.indicatorsLoading=!1;let e;try{e=await Promise.all(D[this.filters.bundleName].map(r=>r(this.$storage,this.filters)))}catch(r){console.log(r)}const t=e.flat().map(ue);this.indicators=t,this.indicatorsLoading=!1},getData(){this.getIndicators()}},watch:{filters:{deep:!0,handler(e){localStorage.setItem("unhcr-rais-plus-recent-indicators",JSON.stringify(e)),this.getData()}}}},pe={class:"indicators pa-2"},fe={class:"text-h5 mb-2 offset-md1 black--text"},ce={class:"mb-4"},ge={class:"text-h5 mb-2 offset-md1 black--text"};function he(e,t,r,y,b,o){const u=q,l=j,i=x,c=de;return n(),g("div",pe,[s(S,{class:"mb-0 mt-0"},{default:a(()=>[s(f,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:a(()=>[s(Y,null,{default:a(()=>[s(Z,null,{default:a(()=>[s(S,null,{default:a(()=>[s(f,{cols:"12",md:"3",class:"pl-md-4"},{default:a(()=>[h("div",fe,d(e.$t("Filters")),1),h("div",ce,d(e.$t("Define the filters for your report")),1),h("div",null,[s(u,{modelValue:e.filters.bundleName,"onUpdate:modelValue":t[0]||(t[0]=m=>e.filters.bundleName=m)},null,8,["modelValue"]),s(l,{modelValue:e.filters.date.$gte,"onUpdate:modelValue":t[1]||(t[1]=m=>e.filters.date.$gte=m),label:e.$t("Start of report period"),class:"mt-4"},null,8,["modelValue","label"]),s(l,{modelValue:e.filters.date.$lte,"onUpdate:modelValue":t[2]||(t[2]=m=>e.filters.date.$lte=m),label:e.$t("End of report period")},null,8,["modelValue","label"])])]),_:1}),s(f,{cols:"12",md:"9",class:"pr-md-4"},{default:a(()=>[s(S,null,{default:a(()=>[s(i),s(f,{cols:"12"},{default:a(()=>[h("div",ge,d(e.$t("Indicators")),1)]),_:1}),s(f,null,{default:a(()=>[s(c,{data:e.indicators,filters:e.filters,startDate:e.filters.date.$gte,endDate:e.filters.date.$lte,loading:e.indicatorsLoading},null,8,["data","filters","startDate","endDate","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof N=="function"&&N(k);const et=C(k,[["render",he]]);export{et as default};

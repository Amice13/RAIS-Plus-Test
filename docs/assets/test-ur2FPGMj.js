import{i as y,a as v}from"./echarts-B3RPNoSA.js";import{a9 as h,a3 as f,u as a,a6 as p,a4 as n,Q as $,S,W as m}from"./@vue-CVhpfiSJ.js";import{_ as g}from"./index-Dr3A69Vy.js";import{r as w,w as C,z as l,l as L,m as x,A as c}from"./vuetify-8yKwgmF2.js";import{a4 as D}from"./zrender-BxIUiisS.js";import"./md5-Ct8Y5Pza.js";import"./jszip-B9I6jZYU.js";import"./dot-object-sCKibp8s.js";import{b as u}from"./route-block-B_A1xBdJ.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@turf-BykKS3Vs.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./uuid-C6aID195.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";let d={};const M=()=>[{itemStyle:{borderColor:"#777",borderWidth:0,gapWidth:1},upperLabel:{show:!1}},{itemStyle:{borderColor:"#EEE",borderWidth:5,gapWidth:1},emphasis:{itemStyle:{borderColor:"#ddd"}}},{colorSaturation:[.35,.5],itemStyle:{borderWidth:5,gapWidth:1,borderColorSaturation:.6}}],z=({data:i})=>({grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},tooltip:{formatter:function(t){for(var o=t.value,e=t.treePathInfo,r=[],s=1;s<e.length;s++)r.push(e[s].name);return['<div class="tooltip-title">'+D(r.join(" - "))+"</div>","Number: "+v(o)].join("")}},toolbox:{show:!0,left:"right",top:"top",feature:{restore:{},saveAsImage:{}}},series:[{name:"Items",type:"treemap",visibleMin:300,label:{show:!0,width:30,formatter:"{b}"},breadcrumb:{show:!1,formatter:function(t){let o=t.name;return o.length>10?o.slice(0,10)+"â€¦":o},textStyle:{overflow:"truncate",fontSize:10}},upperLabel:{show:!0,height:30},itemStyle:{borderColor:"#fff"},levels:M(),data:i}]}),O={name:"SingleMap",props:{entity:{type:String,required:!0},title:{type:String,default:"Map"},description:{type:String,default:"Map subtitle"},filter:{type:Object},map:{type:String,default:"adm1"},value:{type:Object,default(){return{variable:"address.pCode1",operation:"count"}}}},mounted(){this.id="div"+Math.random();const i=this.$refs.chart;d[this.id]=y(i),this.getData()},data(){return{id:null,isLoading:!0}},methods:{async getData(){this.$vuetify.theme.current.colors["primary-lighten-4"],this.$vuetify.theme.current.colors.primary;let t=this.$storage[this.entity];this.filter&&(t=t.filter(this.filter)),t=await t.aggregate({groupBy:["bundleName"],aggs:{children:{variable:"items",operation:"nested",nested:{groupBy:["key"],aggs:{value:{variable:"value",operation:"sum"}}}}}}),console.log(t),t=t.map(e=>(e.name=this.$t(e.bundleName),e.children||(e.children=e.items),!e.children||!e.children.length?!1:(e.value=e.children.map(r=>r.value).reduce((r,s)=>r+s,0),e.children=e.children.map(r=>(r.name=this.$t(r.key),r)),e))).filter(Boolean),console.log(t);const o=z({title:this.title,description:this.description,data:t,$t:this.$t});d[this.id].setOption(o),this.isLoading=!1},changeParams(){const i=d[this.id].getOption();i.title.text=this.$t(this.title),i.title.subtext=this.$t(this.description),d[this.id].setOption(i,{notMerge:!1,replaceMerge:[]})}},watch:{"$i18n.locale"(){this.changeParams()}}},k={class:"tree-map align-center justify-center custom-chart align-center",style:{"aspect-ratio":"5/3",position:"relative"}},N={"leave-absolute":"",class:"chart-loader text-center w-100 h-100"},V={ref:"chart",class:"h-100"};function B(i,t,o,e,r,s){return f(),h("div",k,[a(C,null,{default:n(()=>[$(p("div",N,[a(w,{color:"primary",size:"56",indeterminate:""})],512),[[S,r.isLoading]])]),_:1}),p("div",V,null,512)])}const W=g(O,[["render",B]]),b={name:"analytics",beforeMount(){var t,o,e,r,s;const i=localStorage.getItem("unhcr-rais-plus-recent-report");i||(this.filters["organization.id"]=(e=(o=(t=this.appStore)==null?void 0:t.user)==null?void 0:o.organization)==null?void 0:e.id,this.filters.date.$gte=new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),this.filters.date.$lte=new Date().toLocaleDateString("sv-SE")),this.organizations=[(s=(r=this.appStore)==null?void 0:r.user)==null?void 0:s.organization].filter(Boolean),i&&Object.assign(this.filters,JSON.parse(i)),this.appStore.loading=!1},computed:{isAdmin(){var i,t,o;return(o=(t=(i=this.appStore)==null?void 0:i.user)==null?void 0:t.role)==null?void 0:o.includes("Admin")}},data:()=>({organizations:[],filters:{"organization.id":void 0,bundleName:"SN101-2024",aor:[],distributionModality:"In-kind",populationType:[],date:{$lte:void 0,$gte:void 0},pCode1:void 0,pCode2:void 0,pCode3:void 0,pCode4:void 0},includeDonations:!1,summary:[],summaryLoading:!0,indicators:[],indicatorsLoading:!0}),methods:{}},j={class:"reports pa-2"},E={class:"text-h5 mb-2 offset-md1 black--text"};function I(i,t,o,e,r,s){const _=W;return f(),h("div",j,[a(c,{class:"mb-0 mt-0"},{default:n(()=>[a(l,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:n(()=>[a(L,null,{default:n(()=>[a(x,null,{default:n(()=>[a(c,null,{default:n(()=>[a(l,{cols:"12",md:"3",class:"pl-md-4"},{default:n(()=>[p("div",E,m(i.$t("Filters")),1),p("div",null,m(i.$t("Define the filters for your report")),1)]),_:1}),a(l,{cols:"12",md:"9",class:"pr-md-4"},{default:n(()=>[a(c,null,{default:n(()=>[a(l,{cols:"12"},{default:n(()=>[a(_,{entity:"assistances"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof u=="function"&&u(b);const yt=g(b,[["render",I]]);export{yt as default};

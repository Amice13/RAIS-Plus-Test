import{d as x}from"./debouncer-Whu4ZLob.js";import{_ as E,F as m,o as a,A as h,z as f,x as r,y as c,c as k,w as n,a as d,C as g,G as w,H as B,ac as v,B as y,ab as _,a9 as C}from"./index-BtIo2-Z_.js";import{V as p}from"./index-SDX8Otz2.js";import{V}from"./VBtn--bGuKZaN.js";import{a as L,b as N}from"./VList-Cnqqz-5U.js";import{V as S}from"./VProgressCircular-DNPB7izS.js";import{V as A}from"./VAutocomplete-BVJCf0KD.js";const j=x(function(e){this.getEntities()}),D={name:"CustomEntitySelector",props:{modelValue:{type:[Array,Object]},disabled:{type:Boolean},multiple:{type:Boolean},entity:{type:String},field:{type:String,default:"name"},fields:{type:Array},label:{type:String},hint:{type:String}},data(){return{search:void 0,currentEntity:void 0,items:[],loading:!1}},methods:{async getEntities(){if(!this.search||this.search.length<3)return[];this.loading=!0;const i=(await this.$storage[this.entity].include(this.fields).filter({[this.field]:{$regex:this.search}}).find()).items.map(u=>C.object(u));this.items=i,this.loading=!1},async addEntity(e){if(!e)return!1;this.multiple?(this.model&&this.model.push(e),this.model||(this.model=[e])):this.model=e,await this.$nextTick(),this.currentEntity=void 0,this.search=void 0},removeEntity(e){if(e===null)return this.model={},!1;this.model.splice(e,1)},translateName(e){return _(this.field,e)}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},translatedLabel(){return this.label?this.label:this.$t("Entity")},selected(){return this.model?this.multiple?this.model.map(e=>_(this.field,e)):[]:[]},itemList(){var l;return(l=this.selected)!=null&&l.length?this.items.filter(i=>{const u=_(this.field,i);return!this.selected.includes(u)}):this.items},showAutocomplete(){if(this.multiple||!this.model||Object.keys(this.model).length===0)return!0}},watch:{search:j}},I={class:"entity-selector"},T={key:0,class:"d-flex align-center"},U={class:"flex-grow-1 mb-2"},q={class:"text-caption"},z={class:"text-h6"},F={key:1},O={class:"text-caption"},G={class:"flex-grow-1 pb-2 pt-2"},H={class:"text-h6"},P={key:0};function J(e,l,i,u,s,t){return a(),m("div",I,[!i.multiple&&t.model&&t.translateName(t.model)?(a(),m("div",T,[r("div",U,[r("div",q,c(t.translatedLabel),1),r("div",z,c(t.translateName(t.model)),1)]),r("div",null,[i.disabled?h("",!0):(a(),k(V,{key:0,variant:"tonal",color:"primary",onClick:l[0]||(l[0]=o=>t.removeEntity(null))},{default:n(()=>[d(p,null,{default:n(()=>l[3]||(l[3]=[g("mdi-delete")])),_:1})]),_:1}))])])):h("",!0),i.multiple&&t.model&&t.model.length?(a(),m("div",F,[r("div",O,c(t.translatedLabel),1),(a(!0),m(w,null,B(t.model,(o,b)=>(a(),m("div",{class:v(["d-flex align-center mb-1 mt-1 pl-2 pr-2",{darken:b%2===0}])},[r("div",G,[r("div",H,c(t.translateName(o)),1)]),i.disabled?h("",!0):(a(),m("div",P,[d(V,{variant:"tonal",color:"primary",onClick:K=>t.removeEntity(b)},{default:n(()=>[d(p,null,{default:n(()=>l[4]||(l[4]=[g("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]))],2))),256))])):h("",!0),f(d(A,{modelValue:s.currentEntity,"onUpdate:modelValue":[l[1]||(l[1]=o=>s.currentEntity=o),t.addEntity],search:s.search,"onUpdate:search":l[2]||(l[2]=o=>s.search=o),"search-input":s.search,items:t.itemList,"hide-no-data":!s.search||s.search.length===0,hint:i.hint?i.hint:"",label:t.translatedLabel,loading:s.loading,"item-title":i.field,disabled:i.disabled,"return-object":"",variant:"underlined","clear-on-select":i.multiple,clearable:"","hide-selected":""},{"no-data":n(()=>[d(L,{class:v({"text-center":s.loading})},{default:n(()=>[f(d(S,{class:"margin-auto",indeterminate:"",color:"primary"},null,512),[[y,s.loading]]),f(d(N,null,{default:n(()=>[g(c(e.$t("No results matching")),1)]),_:1},512),[[y,!s.loading]])]),_:1},8,["class"])]),_:1},8,["modelValue","search","search-input","onUpdate:modelValue","items","hide-no-data","hint","label","loading","item-title","disabled","clear-on-select"]),[[y,t.showAutocomplete]])])}const $=E(D,[["render",J]]);export{$ as _};

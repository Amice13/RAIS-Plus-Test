import{_ as V}from"./CustomTable-CzX_aHyy.js";import{d as N}from"./index-T2HRTWtS.js";import{_ as B,Y as D,v as T,F as g,o as m,a as r,w as a,x as o,C as l,y as s,A as q,G as _,H as z,q as I,c as x,aq as R,ab as S}from"./index-BtIo2-Z_.js";import{b as w}from"./route-block-B_A1xBdJ.js";import{V as h,a as k}from"./VRow-9vAZildp.js";import{V as y}from"./VBtn--bGuKZaN.js";import{V as A}from"./VTooltip-DXl_TsVy.js";import{V as $}from"./VChip-CKNl8kC9.js";import{V as E}from"./VCheckbox-Berrf7y1.js";import"./CustomDate-CLArRqjL.js";import"./VMenu-Cs322VI3.js";import"./VOverlay-BnbjS8dz.js";import"./forwardRefs--KQCZfKO.js";import"./index-SDX8Otz2.js";import"./dialog-transition-Dq7CKyny.js";import"./VSpacer-bp7-SSB-.js";/* empty css              */import"./VAvatar-l5UJO0sV.js";import"./VImg-FY_z5S7Z.js";import"./index-C5-hvfiu.js";import"./VTextField-Bn35T3UG.js";import"./VInput-CRZE-Mt3.js";import"./debouncer-Whu4ZLob.js";import"./VCard-DNHZbZ5d.js";import"./VContainer-BFGIFtcM.js";import"./VProgressCircular-DNPB7izS.js";import"./VList-Cnqqz-5U.js";import"./searchProcessor-BfIe0Ps2.js";import"./VDataTable-BrBBORsC.js";import"./VPagination-zp71F-1D.js";import"./filter-ahsWVyiP.js";import"./VCheckboxBtn-DQUGWCnj.js";import"./VToolbar-o4oksDe3.js";import"./group-DgRBM2CV.js";var L={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const O={name:"manage-requests",computed:{searchKeys(){const e=["publicId","address.admin1","address.admin2","address.admin3","address.admin4"];return this.$i18n.locale!=="en"&&e.push(`address.translation.${this.$i18n.locale}.admin1`,`address.translation.${this.$i18n.locale}.admin2`,`address.translation.${this.$i18n.locale}.admin3`,`address.translation.${this.$i18n.locale}.admin4`),e},headers(){return[{title:"Edit",align:"center",value:"id"},{title:"Distribution date",align:"start",sortable:!0,filterable:!0,value:"date",type:"date"},{title:"Public ID",align:"start",sortable:!0,value:"publicId"},{title:"Bundle name",align:"start",value:"bundleName",filterable:!0,sortable:!0,type:"term"},{title:"Oblast",align:"start",value:"address.pCode1",filterable:!0,type:"term"},{title:"Raion",align:"start",value:"address.pCode2",filterable:!0,type:"term"},{title:"Hromada",align:"start",value:"address.pCode3",filterable:!0,type:"term"},{title:"Locality",align:"start",value:"address.pCode4",filterable:!0,type:"term"},{title:"Status",align:"start",value:"status",filterable:!0,type:"term"},{title:"Population type",align:"start",value:"populationType",filterable:!0,type:"term"},{title:"Author",align:"start",value:"createdByEmail",filterable:!0,type:"string"},{title:"Organizations",value:"organization.name",filterId:"organization.id",translated:["organization.translation",this.$i18n.locale,"name"].join("."),align:"start",filterable:!0,sortable:!0,type:"string"},{title:"Assignees",align:"center",value:"assignees"}]}},data(){return{filters:{status:["In distribution","Requested"],distributionModality:["In-kind"]},exportLoading:!1}},methods:{formatDate:D,async exportData(){this.exportLoading=!0;const{requests:e}=this.$storage,d=`${L.FRONT_HOST}/export/export.xlsx`,v=`${new Date().toISOString().substring(0,10)} - RAIS+ Requests.xlsx`,b=["date","publicId","bundleName","address.admin1","address.admin2","address.admin3","address.admin4","status","populationType","createdByEmail","organization","responsibleOrganization","fundingOrganization","assignees","tags"],p=["Distribution date","Public ID","Bundle name","Oblast","Raion","Hromada","Locality","Status","Population type","Created by","Organization","Responsible organization","Funding organization","Assignees","Tags"];let c=(await e.include([...b,"address"]).filter(this.filters).slice(0,1e4).sort("date").reverse().find()).items;c=c.map(t=>{var i;if(t.date=new Date(new Date(t.date)+60*60*1e3*2),(i=t==null?void 0:t.address)!=null&&i.pCode4){const n=R(t.address.pCode4);Object.assign(t.address,n)}return t.bundleName&&(t.bundleName=this.$t(t.bundleName,"en")),t.organization&&(t.organization=t.organization.name),t.responsibleOrganization&&(t.responsibleOrganization=t.responsibleOrganization.name),t.fundingOrganization&&(t.fundingOrganization=t.fundingOrganization.name),t.assignees&&(t.assignees=t.assignees.map(n=>{var C;return((C=n==null?void 0:n.person)==null?void 0:C.fullName)||""}).join(", ")),t.tags&&(t.tags=t.tags.join(", ")),t});const f=b.map(t=>c.map(i=>S(t,i)));await N(d,{headers:p,columns:f},v),this.exportLoading=!1}}},P={class:"distributions pa-2"},F={class:"text-h4 font-weight-bold"},H={class:"text-no-wrap"},j={class:"text-no-wrap font-weight-bold mb-1 mt-3 title-link",style:{"white-space":"nowrap"}},M={class:"mb-2"},K={style:{"white-space":"nowrap"}},G={style:{"white-space":"nowrap"}},U={style:{"white-space":"nowrap"}},X=["href"],Y={style:{"white-space":"nowrap"}},J={key:0};function Q(e,d,v,b,p,u){const c=T("router-link"),f=V;return m(),g("div",P,[r(k,{class:"mb-0 mt-0"},{default:a(()=>[r(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[o("div",F,[l(s(e.$t("Manage requests"))+" ",1),r(y,{onClick:u.exportData,loading:p.exportLoading,size:"small",color:"grey-dakren-4",variant:"tonal"},{default:a(()=>[l(s(e.$t("Export")),1)]),_:1},8,["onClick","loading"])])]),_:1})]),_:1}),r(k,{class:"mb-0 mt-0"},{default:a(()=>[r(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[r(f,{class:"pa-6",onBtnClick:d[0]||(d[0]=t=>e.$router.push("/requests/new")),button:e.$t("Add"),"sort-by":{key:"date",order:"desc"},filters:p.filters,headers:u.headers,"search-keys":u.searchKeys,title:e.$t("Requests"),index:"status",table:"requests"},{"item.date":a(({item:t})=>[o("span",H,s(u.formatDate(t.date).toLocaleDateString("uk")),1)]),"item.publicId":a(({item:t})=>[o("div",j,[r(c,{to:`/requests/${t.id}`,tag:"a"},{default:a(()=>[l(s(t.publicId),1)]),_:2},1032,["to"])]),o("div",M,[r($,{class:"mr-2 mb-2",size:"small",label:""},{default:a(()=>[o("strong",null,s(e.$t("Modality")),1),l(": "+s(e.$t(t.distributionModality)),1)]),_:2},1024),r($,{class:"mr-2 mb-2",size:"small",label:""},{default:a(()=>[o("strong",null,s(e.$t("Population Type")),1),l(": "+s(e.$t(t.populationType)),1)]),_:2},1024),(m(!0),g(_,null,z(t.tags,i=>(m(),x($,{key:i,size:"small",label:"",class:"mr-2 mb-2"},{default:a(()=>[l(s(i),1)]),_:2},1024))),128))])]),"item.bundleName":a(({item:t})=>[o("span",K,s(e.$t(t.bundleName)),1)]),"item.status":a(({item:t})=>[o("span",G,s(e.$t(t.status)),1)]),"item.populationType":a(({item:t})=>[o("span",U,s(e.$t(t.populationType)),1)]),"item.createdByEmail":a(({item:t})=>[o("a",{href:`mailto:${t.createdByEmail}`,class:"text-decoration-none"},s(t.createdByEmail),9,X)]),"item.organization.name":a(({item:t})=>{var i;return[o("span",Y,s((i=t.organization)==null?void 0:i.name),1)]}),"item.address.pCode1":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,4))),1)]),"item.address.pCode2":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,6))),1)]),"item.address.pCode3":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,9))),1)]),"item.address.pCode4":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4)),1)]),"item.assignees":a(({item:t})=>[r(A,{location:"bottom"},{activator:a(({props:i})=>{var n;return[o("span",I(i,{class:"text-decoration-underline cursor-pointer"}),s(((n=t.assignees)==null?void 0:n.length)||0),17)]}),default:a(()=>{var i;return[(m(!0),g(_,null,z(t.assignees,n=>(m(),g("div",null,s(e.$_translate(n).person.fullName),1))),256)),(i=t.assignees)!=null&&i.length?q("",!0):(m(),g("div",J,s(e.$t("No one is assigned")),1))]}),_:2},1024)]),"item.id":a(({item:t})=>[r(y,{color:"grey-dakren-2",onClick:i=>e.$router.push(`/requests/${t.id}`),variant:"tonal",rounded:"1",icon:"mdi-pencil",size:"x-small"},null,8,["onClick"])]),_:2},1032,["button","filters","headers","search-keys","title"])]),_:1}),r(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[r(E,{modelValue:p.filters.status,"onUpdate:modelValue":d[1]||(d[1]=t=>p.filters.status=t),label:e.$t("Show archived"),value:"Archived"},null,8,["modelValue","label"])]),_:1})]),_:1}),r(y,{onClick:d[2]||(d[2]=t=>e.$router.push("/requests/new")),class:"hidden-sm-and-up",style:{position:"fixed",bottom:"15px",right:"15px"},color:"primary",rounded:"1",icon:"mdi-plus",size:"large"})])}typeof w=="function"&&w(O);const qt=B(O,[["render",Q]]);export{qt as default};

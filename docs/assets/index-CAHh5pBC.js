import{_ as N}from"./CustomTable-B09n9Rt0.js";import{d as B}from"./xlsx-template-browser-scOJpVFS.js";import{_ as D,f as T,i as V,d as I}from"./index-Dr3A69Vy.js";import{b as v}from"./route-block-B_A1xBdJ.js";import{z as h,f as y,A as z,E as q,C as $,R}from"./vuetify-8yKwgmF2.js";import{a1 as x,a9 as g,a3 as m,u as r,a4 as a,a6 as o,Y as l,W as s,a7 as S,F as w,aa as k,G as E,a2 as A}from"./@vue-CVhpfiSJ.js";import"./CustomDate-CfhxorUI.js";import"./debouncer-Whu4ZLob.js";import"./searchProcessor-BfIe0Ps2.js";import"./jszip-B9I6jZYU.js";import"./@turf-BykKS3Vs.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./uuid-C6aID195.js";import"./dot-object-sCKibp8s.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";var L={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const O={name:"manage-requests",computed:{searchKeys(){const e=["publicId","address.admin1","address.admin2","address.admin3","address.admin4"];return this.$i18n.locale!=="en"&&e.push(`address.translation.${this.$i18n.locale}.admin1`,`address.translation.${this.$i18n.locale}.admin2`,`address.translation.${this.$i18n.locale}.admin3`,`address.translation.${this.$i18n.locale}.admin4`),e},headers(){return[{title:"Edit",align:"center",value:"id"},{title:"Distribution date",align:"start",sortable:!0,filterable:!0,value:"date",type:"date"},{title:"Public ID",align:"start",sortable:!0,value:"publicId"},{title:"Bundle name",align:"start",value:"bundleName",filterable:!0,sortable:!0,type:"term"},{title:"Oblast",align:"start",value:"address.pCode1",filterable:!0,type:"term"},{title:"Raion",align:"start",value:"address.pCode2",filterable:!0,type:"term"},{title:"Hromada",align:"start",value:"address.pCode3",filterable:!0,type:"term"},{title:"Locality",align:"start",value:"address.pCode4",filterable:!0,type:"term"},{title:"Status",align:"start",value:"status",filterable:!0,type:"term"},{title:"Population type",align:"start",value:"populationType",filterable:!0,type:"term"},{title:"Author",align:"start",value:"createdByEmail",filterable:!0,type:"string"},{title:"Organizations",value:"organization.name",filterId:"organization.id",translated:["organization.translation",this.$i18n.locale,"name"].join("."),align:"start",filterable:!0,sortable:!0,type:"string"},{title:"Assignees",align:"center",value:"assignees"}]}},data(){return{filters:{status:["In distribution","Requested"],distributionModality:["In-kind"]},exportLoading:!1}},methods:{formatDate:T,async exportData(){this.exportLoading=!0;const{requests:e}=this.$storage,d=`${L.FRONT_HOST}/export/export.xlsx`,C=`${new Date().toISOString().substring(0,10)} - RAIS+ Requests.xlsx`,b=["date","publicId","bundleName","address.admin1","address.admin2","address.admin3","address.admin4","status","populationType","createdByEmail","organization","responsibleOrganization","fundingOrganization","assignees","tags"],p=["Distribution date","Public ID","Bundle name","Oblast","Raion","Hromada","Locality","Status","Population type","Created by","Organization","Responsible organization","Funding organization","Assignees","Tags"];let c=(await e.include([...b,"address"]).filter(this.filters).slice(0,1e4).sort("date").reverse().find()).items;c=c.map(t=>{var i;if(t.date=new Date(new Date(t.date)+60*60*1e3*2),(i=t==null?void 0:t.address)!=null&&i.pCode4){const n=V(t.address.pCode4);Object.assign(t.address,n)}return t.bundleName&&(t.bundleName=this.$t(t.bundleName,"en")),t.organization&&(t.organization=t.organization.name),t.responsibleOrganization&&(t.responsibleOrganization=t.responsibleOrganization.name),t.fundingOrganization&&(t.fundingOrganization=t.fundingOrganization.name),t.assignees&&(t.assignees=t.assignees.map(n=>{var _;return((_=n==null?void 0:n.person)==null?void 0:_.fullName)||""}).join(", ")),t.tags&&(t.tags=t.tags.join(", ")),t});const f=b.map(t=>c.map(i=>I(t,i)));await B(d,{headers:p,columns:f},C),this.exportLoading=!1}}},P={class:"distributions pa-2"},F={class:"text-h4 font-weight-bold"},j={class:"text-no-wrap"},H={class:"text-no-wrap font-weight-bold mb-1 mt-3 title-link",style:{"white-space":"nowrap"}},M={class:"mb-2"},K={style:{"white-space":"nowrap"}},G={style:{"white-space":"nowrap"}},U={style:{"white-space":"nowrap"}},W=["href"],X={style:{"white-space":"nowrap"}},Y={key:0};function J(e,d,C,b,p,u){const c=x("router-link"),f=N;return m(),g("div",P,[r(z,{class:"mb-0 mt-0"},{default:a(()=>[r(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[o("div",F,[l(s(e.$t("Manage requests"))+" ",1),r(y,{onClick:u.exportData,loading:p.exportLoading,size:"small",color:"grey-dakren-4",variant:"tonal"},{default:a(()=>[l(s(e.$t("Export")),1)]),_:1},8,["onClick","loading"])])]),_:1})]),_:1}),r(z,{class:"mb-0 mt-0"},{default:a(()=>[r(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[r(f,{class:"pa-6",onBtnClick:d[0]||(d[0]=t=>e.$router.push("/requests/new")),button:e.$t("Add"),"sort-by":{key:"date",order:"desc"},filters:p.filters,headers:u.headers,"search-keys":u.searchKeys,title:e.$t("Requests"),index:"status",table:"requests"},{"item.date":a(({item:t})=>[o("span",j,s(u.formatDate(t.date).toLocaleDateString("uk")),1)]),"item.publicId":a(({item:t})=>[o("div",H,[r(c,{to:`/requests/${t.id}`,tag:"a"},{default:a(()=>[l(s(t.publicId),1)]),_:2},1032,["to"])]),o("div",M,[r($,{class:"mr-2 mb-2",size:"small",label:""},{default:a(()=>[o("strong",null,s(e.$t("Modality")),1),l(": "+s(e.$t(t.distributionModality)),1)]),_:2},1024),r($,{class:"mr-2 mb-2",size:"small",label:""},{default:a(()=>[o("strong",null,s(e.$t("Population Type")),1),l(": "+s(e.$t(t.populationType)),1)]),_:2},1024),(m(!0),g(w,null,k(t.tags,i=>(m(),A($,{key:i,size:"small",label:"",class:"mr-2 mb-2"},{default:a(()=>[l(s(i),1)]),_:2},1024))),128))])]),"item.bundleName":a(({item:t})=>[o("span",K,s(e.$t(t.bundleName)),1)]),"item.status":a(({item:t})=>[o("span",G,s(e.$t(t.status)),1)]),"item.populationType":a(({item:t})=>[o("span",U,s(e.$t(t.populationType)),1)]),"item.createdByEmail":a(({item:t})=>[o("a",{href:`mailto:${t.createdByEmail}`,class:"text-decoration-none"},s(t.createdByEmail),9,W)]),"item.organization.name":a(({item:t})=>{var i;return[o("span",X,s((i=t.organization)==null?void 0:i.name),1)]}),"item.address.pCode1":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,4))),1)]),"item.address.pCode2":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,6))),1)]),"item.address.pCode3":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4.substring(0,9))),1)]),"item.address.pCode4":a(({item:t})=>[l(s(t.address.pCode4&&e.$t(t.address.pCode4)),1)]),"item.assignees":a(({item:t})=>[r(q,{location:"bottom"},{activator:a(({props:i})=>{var n;return[o("span",E(i,{class:"text-decoration-underline cursor-pointer"}),s(((n=t.assignees)==null?void 0:n.length)||0),17)]}),default:a(()=>{var i;return[(m(!0),g(w,null,k(t.assignees,n=>(m(),g("div",null,s(e.$_translate(n).person.fullName),1))),256)),(i=t.assignees)!=null&&i.length?S("",!0):(m(),g("div",Y,s(e.$t("No one is assigned")),1))]}),_:2},1024)]),"item.id":a(({item:t})=>[r(y,{color:"grey-dakren-2",onClick:i=>e.$router.push(`/requests/${t.id}`),variant:"tonal",rounded:"1",icon:"mdi-pencil",size:"x-small"},null,8,["onClick"])]),_:2},1032,["button","filters","headers","search-keys","title"])]),_:1}),r(h,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:a(()=>[r(R,{modelValue:p.filters.status,"onUpdate:modelValue":d[1]||(d[1]=t=>p.filters.status=t),label:e.$t("Show archived"),value:"Archived"},null,8,["modelValue","label"])]),_:1})]),_:1}),r(y,{onClick:d[2]||(d[2]=t=>e.$router.push("/requests/new")),class:"hidden-sm-and-up",style:{position:"fixed",bottom:"15px",right:"15px"},color:"primary",rounded:"1",icon:"mdi-plus",size:"large"})])}typeof v=="function"&&v(O);const Et=D(O,[["render",J]]);export{Et as default};

import{_ as ee,a as te,b as se,c as le,d as ie,e as ae,f as W}from"./DistributionFormDocument-DxFOV5DB.js";import{_ as oe}from"./CustomTextFieldTranslit-_r0XMlwr.js";import{_ as O,o as ne,k as K,a as Y,p as re,g as j,c as B,b as de,i as ue,j as Q,m as me}from"./index-Dr3A69Vy.js";import{a9 as V,a7 as v,a3 as f,u as a,a4 as i,a6 as h,W as m,F as M,aa as T,Q as X,S as ce,a2 as g,R as he,Y as y,ad as pe,ae as fe}from"./@vue-CVhpfiSJ.js";import{z as b,A as k,R as be,_ as ye,I as $,N as ge,l as A,s as _e,m as D,F as ve,o as Se,f as w,p as ke,q as Ve}from"./vuetify-8yKwgmF2.js";import{c as x}from"./config-CpTMMwfY.js";import{v as Ie}from"./uuid-C6aID195.js";import{d as $e}from"./xlsx-template-browser-scOJpVFS.js";import{_ as we}from"./ImportDialog-Boo1nmcH.js";import{_ as Oe}from"./CustomTable-B09n9Rt0.js";import{b as P}from"./route-block-B_A1xBdJ.js";import"./signature_pad-De9feHul.js";import"./CustomDate-CfhxorUI.js";import"./CustomGender-NBBuUwfP.js";import"./index-1qao1M8l.js";import"./arabic-transliterate-CaB0grAR.js";import"./@turf-BykKS3Vs.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./dot-object-sCKibp8s.js";import"./CustomPhone-XOzdDG_n.js";import"./data-BbwszT0d.js";import"./CustomTag-Dg3cr3e-.js";import"./debouncer-Whu4ZLob.js";import"./CustomPopulationType-CM50j2Gz.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./jszip-B9I6jZYU.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";import"./importProcessor-BuJ9nfbq.js";import"./CustomMultipleBundle-B39GX2p6.js";import"./CustomBundle-Cn7PVTFG.js";import"./xlsx-CILBIiVl.js";import"./searchProcessor-BfIe0Ps2.js";const R={"SN101-2024":[{key:"Person needs technical assistance",values:[{value:"Person needs technical assistance"}]},{key:"Assistance status",values:[{value:"Assisted by partner",filter:{"Person needs technical assistance":"Person needs technical assistance"}},{value:"Assisted by authority or other party",filter:{"Person needs technical assistance":"Person needs technical assistance"}}]}],"SN105-2024":[{key:"Selection criteria",values:[{value:"Houses with wooden windows"},{value:"Houses with heating system installed more than 20 years ago"},{value:"Houses without facade insulation"}]},{key:"Installation service is provided",values:[{value:"Installation service is provided"}]}]},Ne={name:"DistributionFormAdditional",props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},currentStrings:{get(){return this.model.strings?K(this.model.strings):{}},set(e){return!1}},questions(){return R[this.model.bundleName]?R[this.model.bundleName]:[]}},methods:{getOptions(e){let t=e.values;return t?(t=t.map(({value:l,filter:r})=>{if(!r)return l;for(let[d,s]of Object.entries(r))if(this.currentStrings[d]!==s)return!1;return l}).filter(Boolean),t):[]},setKey(e,t){const l=JSON.parse(JSON.stringify(this.currentStrings));t?l[e]=t:delete l[e],this.model.strings=ne(l)}}},Ae={key:0},De={class:"text-h5 mb-2 offset-md1 black--text"},Te={class:"mb-2"};function Ce(e,t,l,r,d,s){const u=oe;return s.questions.length?(f(),V("div",Ae,[a(k,{class:"mb-2 mt-2"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[h("div",De,m(e.$t("Additional data")),1),h("div",Te,m(e.$t("Please provide the information related to the current distribution")),1)]),_:1})]),_:1}),(f(!0),V(M,null,T(s.questions,(o,n)=>X((f(),g(k,{class:"mb-0 mt-2 pb-0",key:n},{default:i(()=>[o.values.length===1?(f(),g(b,{key:0,cols:"12"},{default:i(()=>[a(be,{modelValue:s.currentStrings[o.key],"onUpdate:modelValue":[c=>s.currentStrings[o.key]=c,c=>s.setKey(o.key,c)],value:s.getOptions(o)[0],label:e.$t(o.key),"hide-details":""},null,8,["modelValue","onUpdate:modelValue","value","label"])]),_:2},1024)):(f(),g(b,{key:1,cols:"12"},{default:i(()=>[a(u,{modelValue:s.currentStrings[o.key],"onUpdate:modelValue":[c=>s.currentStrings[o.key]=c,c=>s.setKey(o.key,c)],label:e.$t(o.key),items:s.getOptions(o)},null,8,["modelValue","onUpdate:modelValue","label","items"])]),_:2},1024))]),_:2},1024)),[[ce,s.getOptions(o).length]])),128))])):v("",!0)}const Ee=O(Ne,[["render",Ce]]),U={"SN101-2024-01":[{key:"Emergency Shelter Kit",title:"Emergency Shelter Kit"},{key:"Timber Batten, 25x100x2000mm",title:"Timber Batten, 25x100x2000mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0,coefficient:20},{key:"Nails 20",title:"Nails 20",unit:"kg",depends:"Emergency Shelter Kit",disabled:!0,coefficient:.05},{key:"Nails 60",title:"Nails 60",unit:"kg",depends:"Emergency Shelter Kit",disabled:!0,coefficient:.1},{key:"Screws 4.8x100",title:"Screws 4.8x100",unit:"boxes",depends:"Emergency Shelter Kit",disabled:!0,coefficient:2},{key:"Mounting foam, 850ml",title:"Mounting foam, 850ml",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0},{key:"Tape, adhesive 100m x 45mm",title:"Tape, adhesive 100m x 45mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0},{key:"Lath 25x20x2000mm",title:"Lath 25x20x2000mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0,coefficient:20},{key:"Tarpaulin",title:"Tarpaulin",unit:"sheets",depends:"Emergency Shelter Kit",coefficient:3},{key:"Transparent plastic sheeting, 3x10m",title:"Transparent plastic sheeting, 3x10m",unit:"sheets",depends:"Emergency Shelter Kit"},{key:"OSB",title:"OSB",unit:"EA",depends:"Emergency Shelter Kit"}],"SN101-2024":[{key:"Emergency Shelter Kit",title:"Emergency Shelter Kit"},{key:"Timber Batten, 25x100x2000mm",title:"Timber Batten, 25x100x2000mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0,coefficient:20},{key:"Nails 20",title:"Nails 20",unit:"kg",depends:"Emergency Shelter Kit",disabled:!0,coefficient:.05},{key:"Nails 60",title:"Nails 60",unit:"kg",depends:"Emergency Shelter Kit",disabled:!0,coefficient:.1},{key:"Screws 4.8x100",title:"Screws 4.8x100",unit:"boxes",depends:"Emergency Shelter Kit",disabled:!0,coefficient:2},{key:"Mounting foam, 850ml",title:"Mounting foam, 850ml",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0},{key:"Tape, adhesive 100m x 45mm",title:"Tape, adhesive 100m x 45mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0},{key:"Lath 25x20x2000mm",title:"Lath 25x20x2000mm",unit:"pcs",depends:"Emergency Shelter Kit",disabled:!0,coefficient:20},{key:"Tarpaulin",title:"Tarpaulin",unit:"sheets",depends:"Emergency Shelter Kit",disabled:!0,coefficient:2},{key:"Transparent plastic sheeting, 3x10m",title:"Transparent plastic sheeting, 3x10m",unit:"sheets",disabled:!0,depends:"Emergency Shelter Kit"},{key:"OSB",title:"OSB",unit:"EA",disabled:!0,depends:"Emergency Shelter Kit"},{key:"Tarpaulin (separate)",title:"Tarpaulin (separate)",unit:"sheets"},{key:"Transparent plastic sheeting, 3x10m (separate)",title:"Transparent plastic sheeting, 3x10m (separate)",unit:"sheets"},{key:"OSB (separate)",title:"OSB (separate)",unit:"EA"}],"SN105-2024":[{key:"Rapid Thermal Kit",title:"Rapid Thermal Kit"},{key:"Reflective insulation screen",title:"Reflective insulation screen",unit:"rolls",depends:"Rapid Thermal Kit",disabled:!0,coefficient:2},{key:"Polyethylene film for construction",title:"Polyethylene film for construction",unit:"pcs",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Double-sided adhesive tape",title:"Double-sided adhesive tape",unit:"meters",depends:"Rapid Thermal Kit",disabled:!0,coefficient:2},{key:"Construction tape",title:"Construction tape",unit:"meters",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Masking tape",title:"Masking tape",unit:"meters",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Polyurethane foam stripes",title:"Polyurethane foam stripes",unit:"rolls",depends:"Rapid Thermal Kit",disabled:!0,coefficient:20},{key:"All season mounting foam",title:"All season mounting foam",unit:"pcs",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Box",title:"Box",unit:"pcs",depends:"Rapid Thermal Kit",disabled:!0,coefficient:1},{key:"Wall mounted electrical heater",title:"Wall mounted electrical heater",unit:"pcs"}],"SN108-2024":[{key:"Coal",title:"Coal",unit:"metric ton"},{key:"Firewood",title:"Firewood",unit:"stacked m³"},{key:"Briquettes",title:"Briquettes",unit:"metric ton"},{key:"Pellets",title:"Pellets",unit:"metric ton"},{key:"Liquefied propane butane gas",title:"Liquefied propane butane gas",unit:"litres"}]},L={"SN104-2024"(e,t){const r=["Bed linen set","Towels","Blankets/Quilts","Jerrycans","Kitchen set","Mattress","Pillow","Reinforced bag","Sleeping bag","Solar / Power bank lamp","Thermos"].reduce((s,u)=>(e&&parseFloat(e[u])>0&&s++,s),0),d=parseFloat(e["Bed linen set"]||0)*11+parseFloat(e.Towels||0)*2+parseFloat(e["Blankets/Quilts"]||0)*18+parseFloat(e.Jerrycans||0)*2+parseFloat(e["Kitchen set"]||0)*10+parseFloat(e.Mattress||0)*40+parseFloat(e.Pillow||0)*3+parseFloat(e["Reinforced bag"]||0)*3+parseFloat(e["Sleeping bag"]||0)*35+parseFloat(e["Solar / Power bank lamp"]||0)*24+parseFloat(e.Thermos||0)*10;return e["NFI kit"]=r>=5||d/t>=70?1:0,e}},Fe={name:"DistributionFormItems",props:{modelValue:{type:Array,default:()=>[]},familyMembers:{type:Number,default:1},itemsList:{type:Array},bundle:{type:String}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},availableItems(){if(!U[this.bundle])return this.itemsList;const e=this.itemsList.map(t=>t.key);return U[this.bundle].filter(({key:t})=>e.includes(t))},dependents(){return this.availableItems.filter(e=>e.depends)},items(){let e=this.availableItems&&this.availableItems.length?this.availableItems:[];if(!this.itemsFilter)return this.availableItems;let t=new RegExp(this.itemsFilter.replace(/[^a-zа-яєіїґ -]/gi,""),"i");return e.filter(l=>this.$t(l.key).match(t))}},data(){return{itemsFilter:void 0,currentItems:{},oldItems:{},numberMask:{mask:"ADA",tokens:{D:{pattern:/\./,optional:!0},A:{pattern:/\d/,multiple:!0}}}}},mounted(){var t;if(!Array.isArray(this.modelValue)||!((t=this.modelValue)!=null&&t.length))return!1;const e=Object.fromEntries(this.modelValue.map(l=>[l.key,l.value]));Object.assign(this.oldItems,e),Object.assign(this.currentItems,e)},methods:{addItem(e){if(e.disabled)return!1;this.currentItems[e.key]||(this.currentItems[e.key]=0);const t=e.coefficient?Math.min(e.coefficient,1):1;this.currentItems[e.key]=parseFloat(this.currentItems[e.key])+t},recalculate(e){if(this.currentItems[e.key]===this.oldItems[e.key])return!1;const t=parseFloat(this.oldItems[e.key])||0,l=parseFloat(this.currentItems[e.key]||0),r=this.dependents.filter(s=>s.depends===e.key);let d=JSON.parse(JSON.stringify(this.currentItems));for(let s of r){parseFloat(this.oldItems[s.key]||0);const u=s.coefficient||1,o=Math.round(t*u*100),n=Math.round(l*u*100),c=parseFloat(this.oldItems[s.key]||0)*100-o+n;d[s.key]=c<0?0:c/100}L[this.bundle]&&(d=L[this.bundle](d,this.familyMembers)),Object.assign(this.oldItems,d),Object.assign(this.currentItems,d),this.setModel()},setModel(){const e=Object.entries(this.currentItems).map(([t,l])=>({key:t,value:parseFloat(l)})).filter(t=>t.value);this.model=e}}},He={class:"text-h5 mb-2 offset-md1 black--text"},Me={class:"mb-2"},xe={class:"pl-2 text-left"},Ke={class:"text-left"},ze=["ind"],je=["onClick"],Be={class:"non-selectable"},Pe={style:{width:"30%",cursor:"pointer"},class:"pt-6"};function Re(e,t,l,r,d,s){const u=he("maska");return f(),V(M,null,[a(k,{class:"mb-2 mt-2"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[h("div",He,m(e.$t("Distributed items")),1),h("div",Me,m(e.$t("Check the distributed items")),1)]),_:1})]),_:1}),a(k,{class:"mb-2 mt-2"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[a(ye,null,{top:i(()=>[a(ge,{flat:"",color:"white"},{default:i(()=>[a($,{modelValue:d.itemsFilter,"onUpdate:modelValue":t[0]||(t[0]=o=>d.itemsFilter=o),class:"w-100 mr-4",variant:"outlined",density:"compact",label:e.$t("Filter"),"hide-details":"","prepend-icon":"mdi-magnify"},null,8,["modelValue","label"])]),_:1})]),default:i(()=>[h("thead",null,[h("tr",null,[h("th",xe,m(e.$t("Item")),1),h("th",Ke,m(e.$t("Amount")),1)])]),h("tbody",null,[(f(!0),V(M,null,T(s.items,(o,n)=>(f(),V("tr",{key:"item-"+n,ind:n},[h("td",{class:"pl-2 text-left",onClick:c=>s.addItem(o),style:{width:"70%",cursor:"pointer"}},[t[1]||(t[1]=h("div",null,null,-1)),h("div",Be,m(e.$t(o.key)),1)],8,je),h("td",Pe,[X(a($,{modelValue:d.currentItems[o.key],"onUpdate:modelValue":[c=>d.currentItems[o.key]=c,c=>s.recalculate(o)],type:"number",readonly:o.disabled,label:o.unit?e.$t(o.unit):e.$t("Amount"),density:"compact",variant:"outlined",inputmode:"numeric"},null,8,["modelValue","onUpdate:modelValue","readonly","label"]),[[u,void 0,d.numberMask]])])],8,ze))),128))])]),_:1})]),_:1})]),_:1})],64)}const Ue=O(Fe,[["render",Re]]),Le={name:"DistributionPocDialow",inject:["$confirm","$error","$loading","$showResult"],props:{modelValue:{type:Object,default:()=>({})},items:{type:Array,default:()=>[]}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},canEdit(){var e,t,l,r,d,s;if((l=(t=(e=this.appStore)==null?void 0:e.user)==null?void 0:t.role)!=null&&l.includes("Admin")||(s=(d=(r=this.appStore)==null?void 0:r.user)==null?void 0:d.role)!=null&&s.includes("Partner Editor")||!this.model.id||new Date-new Date(this.model.date)<x.timeToEditSinceDistribution||this.model.createdAt&&new Date-new Date(this.model.createdAt)<x.timeToEditSinceCreation)return!0},dialog(){const e=document.querySelector("html"),t=Object.keys(this.model).length>0;return e.classList[t?"add":"remove"]("overflow-hidden"),t}},methods:{countFamilyStats(){this.model.familyStats=de([...this.model.familyMembers,this.model.headOfHousehold])},formatAddress:Y,createFamilyMembersIds(){var r;const e=this.model.taxId||this.model.passport||Ie(),t=B(this.model,e);let l=[];return(r=this.model)!=null&&r.familyMembers&&(l=this.model.familyMembers.map(d=>B(d,e))),[t,...l]},async removeData(){if(!await this.$confirm({title:"Delete assistance",description:"Would you like to delete data about the assistance?"}))return!1;this.$loading(!0);let t;try{const l=this.$storage.assistances;t=await delete l[this.model.id]}catch(l){return t=!1,await this.$error(l),!1}if(this.$loading(!1),!t)return!1;await this.$showResult(),this.model={},this.$emit("loadItems")},async saveData(){var l,r,d,s,u,o,n;if(!await this.$confirm({title:"Save assistance",description:"Would you like to save data about the assistance?"}))return!1;(l=this.model)!=null&&l.headOfHousehold&&(this.model.headOfHousehold=re(this.model.headOfHousehold)),(r=this.model)!=null&&r.headOfHousehold&&this.model.household&&((s=(d=this.model)==null?void 0:d.address)!=null&&s.pCode4&&(this.model.household.pCode4=this.model.address.pCode4,this.model.household.admin4=this.model.address.admin4),this.model.household.fullAddress=this.formatAddress(this.model.household,"en"),(o=(u=this.model.household.translation)==null?void 0:u.uk)!=null&&o.fullAddress&&(this.model.household.translation.uk.fullAddress=this.formatAddress(this.model.household,"uk"))),this.countFamilyStats(),this.model.familyMembersIds=this.createFamilyMembersIds(),this.model.taxIds=[j((n=this.model)==null?void 0:n.headOfHousehold),...(this.model.familyMembers||[]).map(j)].filter(Boolean);let t;try{const{assistances:c}=this.$storage;this.model.id||(t=await c.push(this.model)),this.model.id&&(t=await c.update(this.model.id,this.model))}catch(c){return t=!1,await this.$error(c)}if(this.$loading(!1),!t)return!1;await this.$showResult(),this.model={},this.$emit("loadItems")}}},qe={key:0,class:"main-part"},Je={class:"text-h5 mb-2 offset-md1 black--text"},We={class:"text-h5 mb-2 offset-md1 black--text"};function Ye(e,t,l,r,d,s){const u=ee,o=te,n=se,c=le,I=ie,_=ae,C=Ue,E=Ee,F=W;return f(),g(Ve,{"model-value":s.dialog,class:pe(["assistance-dialog",{"poc-dialog":e.$vuetify.display.xs}]),"content-class":"poc-dialog",scrollable:"",persistent:"",overlay:!1,"max-width":"500px",transition:"slide-x-reverse-transition"},{default:i(()=>[a(A,{tile:"",class:"fill-height"},{default:i(()=>[a(_e,{"primary-title":""},{default:i(()=>[y(m(e.$t("Add")),1)]),_:1}),s.model.headOfHousehold?(f(),g(D,{key:0,class:"pt-4",style:{"font-size":"0.875rem"}},{default:i(()=>{var N;return[a(u,{modelValue:s.model.headOfHousehold,"onUpdate:modelValue":t[0]||(t[0]=p=>s.model.headOfHousehold=p),onSetId:t[1]||(t[1]=p=>s.model.householdId=p),onSetFamilyMembers:t[2]||(t[2]=p=>s.model.familyMembers=p),onSetHousehold:t[3]||(t[3]=p=>s.model.household=p),onSetDistribution:t[4]||(t[4]=p=>s.model=p),id:s.model.id,date:s.model.date,"distribution-id":s.model.distributionId,"household-id":s.model.householdId},null,8,["modelValue","id","date","distribution-id","household-id"]),s.model.householdId||s.model.id?(f(),V("div",qe,[a(o,{modelValue:s.model,"onUpdate:modelValue":t[5]||(t[5]=p=>s.model=p)},null,8,["modelValue"]),a(n,{modelValue:s.model.address,"onUpdate:modelValue":t[6]||(t[6]=p=>s.model.address=p)},null,8,["modelValue"]),a(c,{modelValue:s.model.headOfHousehold,"onUpdate:modelValue":t[7]||(t[7]=p=>s.model.headOfHousehold=p)},null,8,["modelValue"]),s.model.household?(f(),g(I,{key:0,modelValue:s.model.household,"onUpdate:modelValue":t[8]||(t[8]=p=>s.model.household=p),householdId:s.model.householdId},null,8,["modelValue","householdId"])):v("",!0),a(_,{modelValue:s.model.familyMembers,"onUpdate:modelValue":t[9]||(t[9]=p=>s.model.familyMembers=p),hh:s.model.headOfHousehold,date:s.model.date,"allow-simplified":(N=s.model.bundleName)==null?void 0:N.includes("SN101")},null,8,["modelValue","hh","date","allow-simplified"]),a(C,{modelValue:s.model.items,"onUpdate:modelValue":t[10]||(t[10]=p=>s.model.items=p),"items-list":l.items,bundle:s.model.bundleName},null,8,["modelValue","items-list","bundle"]),a(E,{modelValue:s.model,"onUpdate:modelValue":t[11]||(t[11]=p=>s.model=p)},null,8,["modelValue"]),a(k,{class:"mb-4 mt-4"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[h("div",Je,m(e.$t("Signature")),1),h("div",null,m(e.$t("Please sign the completed form")),1)]),_:1}),a(b,{cols:"12"},{default:i(()=>[a(F,{modelValue:s.model.signature,"onUpdate:modelValue":t[12]||(t[12]=p=>s.model.signature=p),mode:"edit"},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{class:"mb-4 mt-4"},{default:i(()=>[a(b,{cols:"12"},{default:i(()=>[h("div",We,m(e.$t("Comment")),1),h("div",null,m(e.$t("You can add any additional comment")),1)]),_:1}),a(b,{cols:"12"},{default:i(()=>[a(ve,{modelValue:s.model.comment,"onUpdate:modelValue":t[13]||(t[13]=p=>s.model.comment=p),variant:"underlined"},null,8,["modelValue"])]),_:1})]),_:1})])):v("",!0)]}),_:1})):v("",!0),a(Se,null,{default:i(()=>[s.model.id&&s.canEdit?(f(),g(w,{key:0,onClick:s.removeData,color:"error",variant:"tonal",class:"ml-4"},{default:i(()=>[y(m(e.$t("Delete")),1)]),_:1},8,["onClick"])):v("",!0),a(ke),a(w,{onClick:t[14]||(t[14]=N=>this.model={}),color:"orange darken-2",variant:"text"},{default:i(()=>[y(m(e.$t("Cancel")),1)]),_:1}),s.canEdit?(f(),g(w,{key:1,onClick:s.saveData,color:"primary",variant:"tonal",class:"mr-4"},{default:i(()=>[y(m(e.$t("Save")),1)]),_:1},8,["onClick"])):v("",!0)]),_:1})]),_:1})]),_:1},8,["model-value","class"])}const Qe=O(Le,[["render",Ye]]),Xe={name:"DistributionInformation",props:{modelValue:{type:Object}},computed:{organization(){var e;return(e=this.modelValue)!=null&&e.organization?this.$_translate(this.modelValue.organization):{}},distributor(){return this.$_translate(this.appStore.user.person)}}},Ge={class:"text-h5 mb-2 offset-md1 black--text"};function Ze(e,t,l,r,d,s){return f(),g(k,{class:"mb-4 mt-4"},{default:i(()=>[a(b,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[h("div",Ge,m(e.$t("Distribution Information")),1),h("div",null,m(e.$t("Information about the current distribution")),1)]),_:1}),a(b,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[a(k,null,{default:i(()=>[a(b,{cols:"12",lg:"6"},{default:i(()=>[a($,{modelValue:l.modelValue.publicId,"onUpdate:modelValue":t[0]||(t[0]=u=>l.modelValue.publicId=u),label:e.$t("Distribution ID"),readonly:"",id:"public_id",variant:"plain",name:"distributionId"},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>[a($,{"model-value":s.organization.name,label:e.$t("Distibutring Organization"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])]),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>{var u,o;return[(o=(u=l.modelValue)==null?void 0:u.address)!=null&&o.pCode1?(f(),g($,{key:0,"model-value":e.$t(l.modelValue.address.pCode1),label:e.$t("Admin 1"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])):v("",!0)]}),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>{var u,o;return[(o=(u=l.modelValue)==null?void 0:u.address)!=null&&o.pCode2?(f(),g($,{key:0,"model-value":e.$t(l.modelValue.address.pCode2),label:e.$t("Admin 2"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])):v("",!0)]}),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>{var u,o;return[(o=(u=l.modelValue)==null?void 0:u.address)!=null&&o.pCode3?(f(),g($,{key:0,"model-value":e.$t(l.modelValue.address.pCode3),label:e.$t("Admin 3"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])):v("",!0)]}),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>{var u,o;return[(o=(u=l.modelValue)==null?void 0:u.address)!=null&&o.pCode4?(f(),g($,{key:0,"model-value":e.$t(l.modelValue.address.pCode4),label:e.$t("Admin 4"),variant:"plain",id:"organizationId",name:"distibutringOrganization",readonly:""},null,8,["model-value","label"])):v("",!0)]}),_:1}),a(b,{cols:"12",lg:"6"},{default:i(()=>[a($,{"model-value":s.distributor.fullName,variant:"plain",label:e.$t("Distributor"),id:"distributor",name:"distributor",readonly:""},null,8,["model-value","label"])]),_:1})]),_:1})]),_:1})]),_:1})}const et=O(Xe,[["render",Ze]]),tt=e=>{var t,l,r,d,s,u;e.organization=((l=(t=e==null?void 0:e.record)==null?void 0:t[0])==null?void 0:l.organization)||"";for(let o of e.record)o.familyStats.all=o.familyMembersIds.length,o.needsAssistance=(r=o.strings)!=null&&r["Person needs technical assistance"]?1:0,o.selfAssistance=(d=o.strings)!=null&&d["Person needs technical assistance"]?0:1,o.hhNumber=((s=o.strings)==null?void 0:s["Assistance status"])==="Assisted by partner"?1:0,(u=o.items)!=null&&u["Emergency Shelter Kit"];return e},st=e=>{var t,l;e.organization=((l=(t=e==null?void 0:e.record)==null?void 0:t[0])==null?void 0:l.organization)||"";for(let r of e.record)r.familyStats.all=r.familyMembersIds.length;return e},lt=e=>{var t,l;e.organization=((l=(t=e==null?void 0:e.record)==null?void 0:t[0])==null?void 0:l.organization)||"";for(let r of e.record)r.familyStats.all=r.familyMembersIds.length;return e},it=e=>{var t,l,r,d,s,u;e.organization=((l=(t=e==null?void 0:e.record)==null?void 0:t[0])==null?void 0:l.organization)||"";for(let o of e.record)o.familyStats.all=o.familyMembersIds.length,o["Houses with wooden windows"]=((r=o.strings)==null?void 0:r["Selection criteria"])==="Houses with wooden windows"?1:0,o["Houses with heating system installed more than 20 years ago"]=((d=o.strings)==null?void 0:d["Selection criteria"])==="Houses with heating system installed more than 20 years ago"?1:0,o["Houses without facade insulation"]=((s=o.strings)==null?void 0:s["Selection criteria"])==="Houses without facade insulation"?1:0,o["Installation service is provided"]=(u=o.strings)!=null&&u["Installation service is provided"]?1:0;return e},at=Object.freeze(Object.defineProperty({__proto__:null,SN101:tt,SN102:st,SN104:lt,SN105:it},Symbol.toStringTag,{value:"Module"}));var ot={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const nt={props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},inject:["$confirm","$error","$loading","$showResult"],methods:{pCode4ToAdmins:ue,async exportData(){var I,_,C,E,F,N,p,z;const e=this.model.bundleName.replace(/-.*/,"");if(!["SN101-2024-0","SN101-2024","SN102-2024","SN104-2024","SN105-2024","SN108-2024","SN109-2024"].includes(this.model.bundleName))return this.$error({errors:[{message:"This template is not implemented"}]});this.$loading(!0);const{assistances:l}=this.$storage,r=await l.filter({publicId:[this.model.publicId]}).sort({createdAt:"asc"}).slice(0,1e4).find();if(!r)return this.$loading(!1),this.$error(result);let d=r.items,s={};s.aor=this.model.aor,s.populationType=this.model.populationType,s.date=new Date(this.model.date).toLocaleDateString("sv-SE"),s.requestId=this.model.id,s.createdBy={email:this.appStore.user.email,name:[(_=(I=this.appStore.user)==null?void 0:I.person)==null?void 0:_.givenName,(E=(C=this.appStore.user)==null?void 0:C.person)==null?void 0:E.familyName].filter(Boolean).join(" "),phone:(N=(F=this.appStore.user)==null?void 0:F.person)!=null&&N.phone?(z=(p=this.appStore.user)==null?void 0:p.person)==null?void 0:z.phone.join(", "):""};const u=this.pCode4ToAdmins(this.model.address.pCode4);s.address=Object.assign({},this.model.address,u),d=d.map((S,H)=>(S.number=H+1,S.headOfHousehold&&(S.headOfHousehold.id=Q(S.headOfHousehold)),S.items&&(S.items=K(S.items)),S.strings&&(S.strings=K(S.strings)),S)),s.record=d;const o=at[e];o&&(s=o(s)),this.$loading(!1);const n=`${ot.FRONT_HOST}/export/templates/${this.model.bundleName}-${this.model.distributionModality}.xlsx?rev=3`;(async()=>{var H;const S=`${new Date().toISOString().replace(/:/g,"")} - Distribution List ${this.model.publicId} (${(H=this.appStore.user)==null?void 0:H.email}).xlsx`;return await $e(n,s,S)})()}}};function rt(e,t,l,r,d,s){return f(),g(w,{onClick:s.exportData,color:"green","prepend-icon":"mdi-export",class:"mr-2 mb-2 export-file"},{default:i(()=>[y(m(e.$t("Export data")),1)]),_:1},8,["onClick"])}const dt=O(nt,[["render",rt]]),ut={props:{modelValue:{type:Object,default:()=>({})},defaultDistribution:{type:Object,default:()=>({})},disabled:{type:Boolean}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},inject:["$error"],data(){return{dialog:!1}}};function mt(e,t,l,r,d,s){const u=we;return f(),V("span",null,[a(w,{onClick:t[0]||(t[0]=o=>d.dialog=!0),block:e.$vuetify.display.xs,color:"green","prepend-icon":"mdi-import",class:"mr-2 mb-2",disabled:l.disabled},{default:i(()=>[y(m(e.$t("Import data")),1)]),_:1},8,["block","disabled"]),a(u,{onClose:t[1]||(t[1]=o=>d.dialog=!1),onImported:t[2]||(t[2]=o=>e.$emit("update",o)),initialData:s.model,dialog:d.dialog,disabled:""},null,8,["initialData","dialog"])])}const ct=O(ut,[["render",mt]]),q={"SN101-2024-0":["Person needs technical assistance","Assistance status"],"SN101-2024":["Person needs technical assistance","Assistance status"],"SN105-2024":["Installation service is provided","Selection criteria"]},J={New:"green-darken-2",Duplicated:"red-darken-2"},ht=e=>J[e]?J[e]:"grey-darken-2",pt={name:"DistributionCustomTable",props:{items:{type:Array,default:()=>[]},hasAddress:{type:Boolean},distributionId:{type:String},bundle:String},computed:{filters(){return this.distributionId?{distributionId:[this.distributionId]}:{}},itemList(){return this.items?this.items.map((e,t)=>({title:e.key,value:`item.${e.key}`,align:"center"})):[]},stringList(){return!this.bundle||!q[this.bundle]?[]:q[this.bundle].map(e=>({title:e,value:`strings.${e}`,align:"center"}))},headers(){const e=[{title:"",align:"center",value:"synced"},{title:"Tax ID",align:"start",value:"headOfHousehold.taxId",sortable:!0},{title:"Name",align:"start",value:"headOfHousehold.fullName",sortable:!0},{title:"Place of Origin",align:"start",value:"origin"},{title:"Phone",align:"start",value:"phone"},this.hasAddress?{title:"Address",align:"start",value:"household"}:!1,{title:"Male, <18",align:"center",value:"familyStats.boys"},{title:"Female, <18",align:"center",value:"familyStats.girls"},{title:"Male, 18-60",align:"center",value:"familyStats.men"},{title:"Female, 18-60",align:"center",value:"familyStats.women"},{title:"Male, 60+",align:"center",value:"familyStats.seniorMen"},{title:"Female, 60+",align:"center",value:"familyStats.seniorWomen"},{title:"People with disabilities",align:"center",value:"familyStats.disabled"}].filter(Boolean);return e.push(...this.itemList),e.push(...this.stringList),e.push({title:"Signature",align:"center",value:"signature"}),e}},methods:{getChipColor:ht,getDocument:Q,formatAddress:Y,getAdmin1:me,canEdit(e){var t,l,r,d,s,u;if((r=(l=(t=this.appStore)==null?void 0:t.user)==null?void 0:l.role)!=null&&r.includes("Admin")||(u=(s=(d=this.appStore)==null?void 0:d.user)==null?void 0:s.role)!=null&&u.includes("Partner Editor")||!e.id||new Date-new Date(e.date)<x.timeToEditSinceDistribution||e.createdAt&&new Date-new Date(e.createdAt)<x.timeToEditSinceCreation)return!0},async loadItems(){this.$refs.mainTable.loadItems()},getString(e,t){if(!Array.isArray(e)||!t)return"";const l=e.find(r=>r.key===t.replace(/^strings\./,""));return l?this.$t(l.value):""}}},ft=["onClick"],bt={class:"text-no-wrap"},yt={class:"text-no-wrap"},gt=["href"],_t={class:"text-no-wrap"},vt={key:0,class:"text-center"};function St(e,t,l,r,d,s){const u=W,o=Oe;return e.appStore.loading?v("",!0):(f(),g(o,{key:0,onBtnClick:t[0]||(t[0]=n=>e.$emit("addData")),title:e.$t("Receivers"),button:e.$t("Add"),headers:s.headers,filters:s.filters,"sort-by":{key:"createdAt",sort:"asc"},"search-keys":["headOfHousehold.taxId","headOfHousehold.passport","headOfHousehold.fullName","headOfHousehold.translation.uk.fullName","headOfHousehold.taxId"],index:"distributionId",class:"distribution-table",ref:"mainTable",table:"assistances"},fe({"item.headOfHousehold.taxId":i(({item:n})=>[y(m(s.getDocument(n.headOfHousehold)),1)]),"item.synced":i(({item:n})=>[h("div",null,[s.canEdit(n)?(f(),V("div",{key:0,onClick:c=>e.$emit("editData",n)},[a(w,{icon:"mdi-pencil",size:"x-small",color:"grey",variant:"tonal"})],8,ft)):v("",!0)])]),"item.headOfHousehold.fullName":i(({item:n})=>[h("span",bt,m(n.headOfHousehold?e.$_translate(n.headOfHousehold).fullName:""),1)]),"item.origin":i(({item:n})=>{var c;return[h("span",yt,m(s.getAdmin1((c=n.headOfHousehold)==null?void 0:c.origin)),1)]}),"item.phone":i(({item:n})=>[(f(!0),V(M,null,T(n.headOfHousehold.phone,c=>(f(),V("div",null,[h("a",{href:`tel:${c}`,class:"text-no-wrap"},m(c),9,gt)]))),256))]),"item.household":i(({item:n})=>[h("span",_t,m(s.formatAddress(n.household)),1)]),"item.familyStats.girls":i(({item:n})=>[y(m(n.familyStats.girls),1)]),"item.familyStats.boys":i(({item:n})=>[y(m(n.familyStats.boys),1)]),"item.familyStats.men":i(({item:n})=>[y(m(n.familyStats.men),1)]),"item.familyStats.women":i(({item:n})=>[y(m(n.familyStats.women),1)]),"item.familyStats.seniorMen":i(({item:n})=>[y(m(n.familyStats.seniorMen),1)]),"item.familyStats.seniorWomen":i(({item:n})=>[y(m(n.familyStats.seniorWomen),1)]),"item.familyStats.disabled":i(({item:n})=>[y(m(n.familyStats.disabled),1)]),"item.signature":i(({item:n})=>[n.signature?(f(),V("div",vt,[a(u,{modelValue:n.signature,"onUpdate:modelValue":c=>n.signature=c,mode:"view",width:100},null,8,["modelValue","onUpdate:modelValue"])])):v("",!0)]),_:2},[T(l.items,n=>({name:`item.item.${n.key}`,fn:i(({item:c})=>{var I;return[y(m(Array.isArray(c.items)?(I=c.items.find(_=>_.key===n.key))==null?void 0:I.value:0),1)]})})),T(s.stringList,n=>({name:`item.${n.value}`,fn:i(({item:c})=>[y(m(s.getString(c.strings,n.value)),1)])}))]),1032,["title","button","headers","filters"]))}const kt=O(pt,[["render",St]]),Vt=["date","bundleName","publicId","aor","distributionModality","populationType","address","collectiveCenter","organization","responsibleOrganization","fundedBy","translation"],It=["country","admin1","admin2","admin3","admin4","pCode1","pCode2","pCode3","pCode4"],G=["SN101-2024-0","SN101-2024","SN105-2024"],$t=e=>{const t=JSON.parse(JSON.stringify(e)),l=Object.fromEntries(Object.entries(t).filter(r=>Vt.includes(r[0])));return G.includes(e.bundleName)&&(l.household=Object.fromEntries(Object.entries(t.address).filter(r=>It.includes(r[0]))),l.household.type="Household"),l.headOfHousehold={phone:[],translation:{uk:{}}},l.distributionId=e.id,l.familyMembersIds=[],l.familyMembers=[],l.familyStats={},l},Z={inject:["$error"],name:"Distribution",computed:{allowImportAndExport(){var e,t,l,r;return(t=(e=this.appStore)==null?void 0:e.user)!=null&&t.role.includes("Admin")?!0:(r=(l=this.appStore)==null?void 0:l.user)==null?void 0:r.role.includes("Partner Manager")},title(){var e;if((e=this.$route.params)!=null&&e._id&&this.$route.params._id!=="new")return this.request.publicId},items(){return this.request.items||[]},hasAddress(){return G.includes(this.request.bundleName)}},data:()=>({request:{},assistance:{}}),created(){this.init()},methods:{async init(){let{_id:e}=this.$route.params;if(!e)return this.$router.push("/distributions");const{requests:t}=this.$storage;try{const l=await t[e];if(!l)throw"Not found";this.request=l}catch{return await this.$error({title:"Distribution is not found"}),this.$router.push("/distributions")}this.appStore.breadcrumb=this.title||"New request",this.appStore.loading=!1,this.appStore.loading=!1},addData(){this.assistance=$t(this.request)},editData(e){var d;(!e.address||typeof e.address=="object"&&!Object.keys(e).length)&&(e.address=this.request.address);const t=e.organization,l=e.responsibleOrganization,r=e.fundedBy;e=JSON.parse(JSON.stringify(e)),Object.assign(e,{organization:t,responsibleOrganization:l,fundedBy:r}),Array.isArray((d=e.headOfHousehold)==null?void 0:d.phone)||(e.headOfHousehold.phone=[]),this.assistance=e},loadItems(){this.$refs.assistanceTable.loadItems()}}},wt={class:"about pa-2"},Ot={class:"text-h4 font-weight-bold"},Nt={class:"text-h5 mb-2 offset-md1 black--text"},At={class:"text-h5 mb-2 offset-md1 black--text"},Dt={class:"mb-4 mt-1"},Tt={class:"text-h5 mb-2 offset-md1 black--text"};function Ct(e,t,l,r,d,s){const u=kt,o=ct,n=dt,c=et,I=Qe;return f(),V("div",wt,[a(k,{class:"mb-0 mt-0"},{default:i(()=>[a(b,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[h("div",Ot,m(e.$t("Distribution Data")),1)]),_:1})]),_:1}),a(k,{class:"mb-0 mt-0"},{default:i(()=>[a(b,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[a(A,{class:"pt-sm-4 pb-sm-4 pt-md-16 pb-md-16"},{default:i(()=>[a(D,null,{default:i(()=>[a(k,null,{default:i(()=>[a(b,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[h("div",Nt,m(e.$t("Receivers' data")),1),h("div",null,m(e.$t("Enter the information about the head of the household")),1)]),_:1}),a(b,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[a(u,{onAddData:s.addData,onEditData:s.editData,"has-address":s.hasAddress,"distribution-id":e.request.id,items:e.request.items,bundle:e.request.bundleName,ref:"assistanceTable"},null,8,["onAddData","onEditData","has-address","distribution-id","items","bundle"])]),_:1})]),_:1})]),_:1})]),_:1}),s.allowImportAndExport?(f(),g(A,{key:0},{default:i(()=>[a(D,null,{default:i(()=>[a(k,{class:"mb-4 mt-4"},{default:i(()=>[a(b,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[h("div",At,m(e.$t("Additional operations")),1),h("div",null,m(e.$t("You can do additional actions here")),1)]),_:1}),a(b,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[h("div",Dt,m(e.$t("You can export the data or upload it to RAIS+")),1),h("div",null,[a(o,{modelValue:e.request,"onUpdate:modelValue":t[0]||(t[0]=_=>e.request=_),onUpdate:s.loadItems},null,8,["modelValue","onUpdate"]),a(n,{modelValue:e.request,"onUpdate:modelValue":t[1]||(t[1]=_=>e.request=_)},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1})):v("",!0),a(A,{class:"bg-grey-lighten-3"},{default:i(()=>[a(D,null,{default:i(()=>[a(c,{modelValue:e.request,"onUpdate:modelValue":t[2]||(t[2]=_=>e.request=_)},null,8,["modelValue"])]),_:1})]),_:1}),a(A,{class:"pb-md-16"},{default:i(()=>[a(D,null,{default:i(()=>[a(k,{class:"mb-0 mb-sm-4 mt-4"},{default:i(()=>[a(b,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[h("div",Tt,m(e.$t("Finalize Distribution")),1),h("div",null,m(e.$t("Submit your data after you have finished distribution")),1)]),_:1}),a(b,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[a(w,{onClick:t[3]||(t[3]=_=>e.$router.push("/distributions")),block:e.$vuetify.display.xs,color:"warning","prepend-icon":"mdi-close",class:"mb-2 mr-4",text:""},{default:i(()=>[y(m(e.$t("Close")),1)]),_:1},8,["block"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e.request.items?(f(),g(I,{key:0,modelValue:e.assistance,"onUpdate:modelValue":t[4]||(t[4]=_=>e.assistance=_),items:e.request.items,onLoadItems:s.loadItems},null,8,["modelValue","items","onLoadItems"])):v("",!0),a(w,{onClick:s.addData,class:"hidden-md-and-up",style:{position:"fixed",bottom:"15px",right:"15px"},color:"primary",icon:"mdi-plus",size:"large"},null,8,["onClick"])])}typeof P=="function"&&P(Z);const Fs=O(Z,[["render",Ct]]);export{Fs as default};

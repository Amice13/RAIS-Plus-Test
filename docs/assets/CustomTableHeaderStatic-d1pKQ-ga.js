import{_ as F}from"./CustomDate-CLArRqjL.js";import{d as B}from"./debouncer-Whu4ZLob.js";import{_ as x,F as C,o as u,x as h,c as m,A as f,y as c,w as a,a as n,C as d,z as b,B as V,G as I,H as _,ac as A,ab as N}from"./index-BtIo2-Z_.js";import{V as y}from"./index-SDX8Otz2.js";import{V as O}from"./VMenu-Cs322VI3.js";import{V as j,a as D,b as U}from"./VCard-DNHZbZ5d.js";import{V as g}from"./VBtn--bGuKZaN.js";import{V as z}from"./VContainer-BFGIFtcM.js";import{a as T,V as S}from"./VRow-9vAZildp.js";import{V as w}from"./VTextField-Bn35T3UG.js";import{V as J}from"./VProgressCircular-DNPB7izS.js";import{V as L,a as E,b as Q}from"./VList-Cnqqz-5U.js";import{V as R}from"./VChip-CKNl8kC9.js";import{V as H}from"./VSpacer-bp7-SSB-.js";const k=t=>{const[e,l]=t.split(/\./g);return l==="0"||e.length===3?e:t},M=t=>t/10**9>1?k((t/10**9).toFixed(1))+"B":t/10**6>1?k((t/10**6).toFixed(1))+"M":t/10**3>1?k((t/10**3).toFixed(1))+"K":t,G={name:"CustomTableHeader",props:{parentItems:{type:Array,default:()=>[]},datatable:{type:Object,default:()=>({})},column:{type:Object,default:{}}},data(){return{loading:!1,fieldQuery:void 0,search:void 0,items:[],menu:!1}},computed:{showItems(){if(!this.search)return this.items;const t=new RegExp(this.search.replace(/[|\\{}()[\]^$+*?.]/g,".").replace(/-/g,"\\-"),"gi");return this.items.filter(e=>this.$t(e.key).match(t))},filterIsSet(){var t,e,l,o;return(e=(t=this.datatable)==null?void 0:t.filters)!=null&&e[this.column.value]?(o=(l=this.datatable)==null?void 0:l.filters)==null?void 0:o[this.column.value].length:!1}},methods:{setSearch:B(function(){this.loadItems()}),async loadItems(){var o;if(!((o=this.column)!=null&&o.filterable)||this.column.type==="date")return!1;this.loading=!0;const t=this.parentItems.map(s=>N(this.column.value,s)).filter(s=>s!==void 0);if(!t.length)return!1;const e=t.reduce((s,i)=>(s[i]||(s[i]=0),s[i]++,s),{}),l=Object.entries(e).sort((s,i)=>i[1]-s[1]).map(([s,i])=>({key:s,value:i}));this.items=l,this.loading=!1},isSorted({value:t}){var l,o,s,i;return(l=this.datatable)!=null&&l.sortBy?(Array.isArray((o=this.datatable)==null?void 0:o.sortBy)?(s=this.datatable)==null?void 0:s.sortBy[0]:(i=this.datatable)==null?void 0:i.sortBy).key===t:!1},isFiltered({value:t}){var e;if(!((e=this.datatable)!=null&&e.filters))return!1;for(let[l,o]of Object.entries(this.datatable.filters))if(l===t&&o.length)return!0},getIcon(t){var e,l;return this.isSorted(t)?(Array.isArray(this.datatable.sortBy)?(e=this.datatable)==null?void 0:e.sortBy[0]:(l=this.datatable)==null?void 0:l.sortBy).order==="desc"?"mdi-sort-descending":"mdi-sort-ascending":this.isFiltered(t)?"mdi-filter":"mdi-chevron-down"},setSort(t){this.$emit("setSort",{key:this.column.key,order:t}),this.menu=!1},hasFilter(t){var e,l,o,s;return(l=(e=this.datatable)==null?void 0:e.filters)!=null&&l[this.column.value]?(s=(o=this.datatable)==null?void 0:o.filters)==null?void 0:s[this.column.value].includes(t):!1},switchFilter(t){const e=JSON.parse(JSON.stringify(this.datatable.filters));e[this.column.value]||(e[this.column.value]=[]);let l=e[this.column.value].indexOf(t);return l>=0?(e[this.column.value].splice(l,1),e[this.column.value].length||delete e[this.column.value],this.$emit("setFilter",e)):(e[this.column.value].push(t),this.$emit("setFilter",e))},resetAllFilters(){const t=JSON.parse(JSON.stringify(this.datatable.filters));return delete t[this.column.value],this.$emit("setFilter",t)},simplifyCount:M},watch:{menu(t){t&&this.loadItems()}}},K={class:"text-no-wrap bg-grey-lighten-3"},P={class:"font-weight-bold"},q={class:"mb-2"},W={class:"text-center"},X={style:{width:"36px"}};function Y(t,e,l,o,s,i){const v=F;return u(),C("td",K,[h("div",{class:A(["w-100 d-flex align-center",{"justify-center":l.column.align==="center","justify-end":l.column.align==="right"}])},[h("span",P,c(t.$t(l.column.title)),1),l.column.sortable||l.column.filterable?(u(),m(g,{key:0,style:{"min-width":"0px"},class:"ml-2 pa-2",size:"small",variant:"text",elevation:"0",color:i.isFiltered(l.column)?"primary":"black"},{default:a(()=>[n(y,null,{default:a(()=>[d(c(i.getIcon(l.column)),1)]),_:1}),n(O,{activator:"parent",transition:"slide-y-transition","close-on-content-click":!1,modelValue:s.menu,"onUpdate:modelValue":e[7]||(e[7]=r=>s.menu=r)},{default:a(()=>[n(j,{"max-width":"350",width:"350"},{default:a(()=>[n(D,{class:"pa-0"},{default:a(()=>[l.column.sortable?(u(),m(g,{key:0,onClick:e[0]||(e[0]=r=>i.setSort("asc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:a(()=>[n(y,{class:"mr-2"},{default:a(()=>e[8]||(e[8]=[d("mdi-sort-ascending")])),_:1}),d(" "+c(t.$t("Sort ascending")),1)]),_:1})):f("",!0),l.column.sortable?(u(),m(g,{key:1,onClick:e[1]||(e[1]=r=>i.setSort("desc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:a(()=>[n(y,{class:"mr-2"},{default:a(()=>e[9]||(e[9]=[d("mdi-sort-descending")])),_:1}),d(" "+c(t.$t("Sort descending")),1)]),_:1})):f("",!0),l.column.filterable?(u(),m(z,{key:2},{default:a(()=>[n(T,null,{default:a(()=>[n(S,{cols:"12"},{default:a(()=>[h("div",q,[h("strong",null,c(t.$t("Filter").toUpperCase()),1)]),l.column.type==="date"?(u(),m(v,{key:0,modelValue:t.startDate,"onUpdate:modelValue":e[2]||(e[2]=r=>t.startDate=r),label:t.$t("Start date"),clearable:"",class:"mt-4"},null,8,["modelValue","label"])):f("",!0),l.column.type==="date"?(u(),m(v,{key:1,modelValue:t.endDate,"onUpdate:modelValue":e[3]||(e[3]=r=>t.endDate=r),clearable:"",label:t.$t("End date")},null,8,["modelValue","label"])):f("",!0),l.column.type==="term"?(u(),m(w,{key:2,modelValue:s.search,"onUpdate:modelValue":e[4]||(e[4]=r=>s.search=r),label:t.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","label"])):f("",!0),l.column.type==="string"?(u(),m(w,{key:3,modelValue:s.fieldQuery,"onUpdate:modelValue":[e[5]||(e[5]=r=>s.fieldQuery=r),i.setSearch],label:t.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])):f("",!0)]),_:1}),l.column.type!=="date"?(u(),m(S,{key:0,cols:"12",class:"pa-0"},{default:a(()=>[b(h("div",W,[n(J,{indeterminate:"",color:"primary"})],512),[[V,s.loading]]),b(n(L,{class:"custom-thumb",nav:"",density:"compact",lines:!1,"max-height":"200"},{default:a(()=>[(u(!0),C(I,null,_(i.showItems,r=>(u(),m(E,{onClick:p=>i.switchFilter(r.key),key:r.key,density:"compact"},{prepend:a(()=>[h("div",X,[b(n(y,null,{default:a(()=>e[10]||(e[10]=[d("mdi-checkbox-blank-outline")])),_:2},1536),[[V,!i.hasFilter(r.key)]]),b(n(y,null,{default:a(()=>e[11]||(e[11]=[d("mdi-checkbox-outline")])),_:2},1536),[[V,i.hasFilter(r.key)]])])]),append:a(()=>[n(R,{size:"x-small"},{default:a(()=>[d(c(i.simplifyCount(r.value)),1)]),_:2},1024)]),default:a(()=>[n(Q,{class:"pr-2"},{default:a(()=>{var p;return[d(c(t.$t((p=r==null?void 0:r.key)==null?void 0:p.replace("@","ï¼ "))),1)]}),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},512),[[V,!s.loading]])]),_:1})):f("",!0)]),_:1})]),_:1})):f("",!0)]),_:1}),l.column.filterable?(u(),m(U,{key:0},{default:a(()=>[b(n(g,{onClick:i.resetAllFilters,size:"x-small"},{default:a(()=>[n(y,{class:"mr-2"},{default:a(()=>e[12]||(e[12]=[d("mdi-checkbox-blank-outline")])),_:1}),d(" "+c(t.$t("Reset all")),1)]),_:1},8,["onClick"]),[[V,i.filterIsSet]]),n(H),n(g,{onClick:e[6]||(e[6]=r=>s.menu=!1),size:"x-small"},{default:a(()=>[d(c(t.$t("Close")),1)]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["color"])):f("",!0)],2)])}const fe=x(G,[["render",Y]]);export{fe as _};

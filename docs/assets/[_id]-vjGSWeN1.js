import{c as C}from"./config-CpTMMwfY.js";import{p as R}from"./index-1qao1M8l.js";import{_ as v,A as D}from"./index-Dr3A69Vy.js";import{m as y,A as O,z as r,f as j,l as V,I as w}from"./vuetify-8yKwgmF2.js";import{a2 as b,a3 as f,a4 as i,u as s,a6 as _,W as p,a7 as S,Y as h,ac as g,a9 as A,V as L}from"./@vue-CVhpfiSJ.js";import{a as P,_ as M,S as z,b as J,c as K,d as H,e as W,f as F,g as Y,h as G,i as Q,j as X,k as Z,l as x}from"./SN209-J5K7l-C5.js";import{_ as ee}from"./CustomEntitySelector-Dr1atJmJ.js";import{_ as te}from"./RequestOrganizations-BFVj8dre.js";import{_ as se}from"./CustomTag-Dg3cr3e-.js";import{_ as le}from"./CustomDate-CfhxorUI.js";import{_ as ie}from"./CustomPopulationType-CM50j2Gz.js";import{_ as oe}from"./CustomBundle-Cn7PVTFG.js";import{b as I}from"./route-block-B_A1xBdJ.js";import"./arabic-transliterate-CaB0grAR.js";import"./@turf-BykKS3Vs.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./dot-object-sCKibp8s.js";import"./uuid-C6aID195.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./jszip-B9I6jZYU.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";import"./CustomTextFieldTranslit-_r0XMlwr.js";import"./index-BDyHuw1_.js";import"./data-BbwszT0d.js";import"./debouncer-Whu4ZLob.js";const{requests:ae}=R,re={name:"RequestSumbission",inject:["$confirm","$error","$loading","$showResult"],props:{modelValue:{type:Object,default:()=>({})}},computed:{canEdit(){var e,t,o,n,a,l;if((o=(t=(e=this.appStore)==null?void 0:e.user)==null?void 0:t.role)!=null&&o.includes("Admin")||(l=(a=(n=this.appStore)==null?void 0:n.user)==null?void 0:a.role)!=null&&l.includes("Partner Editor")||!this.model.id||new Date-new Date(this.body.date)<C.timeToEditSinceDistribution||this.model.createdAt&&new Date-new Date(this.body.createdAt)<C.timeToEditSinceCreation)return!0},model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},isAdmin(){var e,t,o;return(o=(t=(e=this.appStore)==null?void 0:e.user)==null?void 0:t.role)==null?void 0:o.includes("Admin")}},methods:{async save(){if(!await this.$confirm({title:"Save entity",description:"Would you like to save the entity?"}))return!1;this.$loading(!0),this.model=ae.preprocess(this.model),await this.$nextTick();let t;try{const o=this.$storage.requests;this.model.id||(t=await o.push(this.model)),this.model.id&&(t=await o.update(this.model.id,this.model))}catch(o){t=!1,await this.$error(o)}if(this.$loading(!1),!t)return!1;await this.$showResult(),this.$goToPreviousPage()},async remove(){if(!await this.$confirm({title:"Delete entity",description:"Would you like to save the entity?"}))return!1;this.$loading(!1);try{const t=this.$storage.requests;await delete t[this.model.id]}catch(t){return await this.$error(t),this.$loading(!1)}this.$loading(!1),await this.$showResult(),this.$goToPreviousPage()}}},ne={class:"text-h5 mb-2 offset-md1 black--text"};function ue(e,t,o,n,a,l){return f(),b(V,{class:"data-block request-submission pt-sm-4 pb-sm-4 pb-md-16"},{default:i(()=>[s(y,null,{default:i(()=>[s(O,{class:"mb-sm-4 mt-4"},{default:i(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[_("div",ne,p(e.$t("Submission")),1),_("div",null,p(e.$t("Please verify and submit your data")),1)]),_:1}),s(r,{cols:"12",md:"9",class:"pr-md-16"},{default:i(()=>[l.canEdit?(f(),b(j,{key:0,onClick:l.save,block:e.$vuetify.display.xs,color:"primary","prepend-icon":"mdi-pencil",class:"mb-2 mr-4"},{default:i(()=>[h(p(e.$t("Save")),1)]),_:1},8,["onClick","block"])):S("",!0),l.model.id&&l.isAdmin&&l.canEdit?(f(),b(j,{key:1,onClick:l.remove,block:e.$vuetify.display.xs,color:"error","prepend-icon":"mdi-pencil",class:"mb-2 mr-4"},{default:i(()=>[h(p(e.$t("Delete")),1)]),_:1},8,["onClick","block"])):S("",!0),s(j,{onClick:t[0]||(t[0]=d=>e.$router.go(-1)),block:e.$vuetify.display.xs,variant:"text",color:"warning","prepend-icon":"mdi-close",class:"mb-sm-2 mr-4"},{default:i(()=>[h(p(e.$t("Cancel")),1)]),_:1},8,["block"])]),_:1})]),_:1})]),_:1})]),_:1})}const me=v(re,[["render",ue]]),de={name:"RequestAssignee",props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},ce={class:"text-h5 mb-2 offset-md1 black--text"};function pe(e,t,o,n,a,l){const d=ee;return f(),b(V,{class:"data-block request-assignee",rounded:"0"},{default:i(()=>[s(y,null,{default:i(()=>[s(O,{class:"mb-4 mt-4"},{default:i(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[_("div",ce,[g(e.$slots,"itemset-header",{},()=>[h(p(e.$t("Distributors assignment")),1)])]),_("div",null,[g(e.$slots,"itemset-description",{},()=>[h(p(e.$t("Assign users who will provide the support")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:i(()=>[s(O,null,{default:i(()=>[s(r,{cols:"12"},{default:i(()=>[s(d,{modelValue:l.model.assignees,"onUpdate:modelValue":t[0]||(t[0]=m=>l.model.assignees=m),label:e.$t("Assignees"),field:e.$i18n.locale==="en"?"person.fullName":"person.translation.uk.fullName",fields:["person.fullName","person.translation.uk.fullName"],multiple:"",entity:"users",id:"assignees",name:"assignees",variant:"underlined"},null,8,["modelValue","label","field"])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3})]),_:3})}const fe=v(de,[["render",pe]]),be={name:"RequestBasic",props:{modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},isUNHCR(){var e,t;return(t=(e=this.appStore.user)==null?void 0:e.organization)!=null&&t.name?/UNHCR/.exec(this.appStore.user.organization.name):!1}},methods:{resetBundle(){this.model.items=[]}}},he={class:"text-h5 mb-2 offset-md1 black--text"};function _e(e,t,o,n,a,l){const d=oe,m=ie,k=le,$=P,N=se;return f(),b(V,{class:"data-block request-basic pt-sm-4 pb-sm-4 pt-md-16"},{default:i(()=>[s(y,null,{default:i(()=>[s(O,{class:"mb-4 mt-4"},{default:i(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[_("div",he,[g(e.$slots,"itemset-header",{},()=>[h(p(e.$t("Basic information")),1)])]),_("div",null,[g(e.$slots,"itemset-description",{},()=>[h(p(e.$t("Please indicate the basic information about the support that will be provided")),1)])])]),_:3}),s(r,{cols:"12",md:"9",class:"pr-md-16 pt-0"},{default:i(()=>[s(O,null,{default:i(()=>[s(r,{cols:"12"},{default:i(()=>[s(w,{modelValue:l.model.publicId,label:e.$t("Public ID"),id:"public_id",name:"PublicID",variant:"underlined","hide-details":"",readonly:""},null,8,["modelValue","label"])]),_:1}),s(r,{cols:"12"},{default:i(()=>[s(d,{modelValue:l.model.bundleName,"onUpdate:modelValue":[t[0]||(t[0]=c=>l.model.bundleName=c),l.resetBundle],filter:"Distribution"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(r,{cols:"12",lg:"6"},{default:i(()=>[s(m,{modelValue:l.model.populationType,"onUpdate:modelValue":t[1]||(t[1]=c=>l.model.populationType=c),hint:e.$t("Indicate the major group of beneficiaries")},null,8,["modelValue","hint"])]),_:1}),s(r,{cols:"12",lg:"6"},{default:i(()=>[s(k,{modelValue:l.model.date,"onUpdate:modelValue":t[2]||(t[2]=c=>l.model.date=c),label:e.$t("Date of distribution"),hint:e.$t("Indicate the planned date"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1}),s(r,{cols:"12"},{default:i(()=>[l.isUNHCR?S("",!0):(f(),b(w,{key:0,modelValue:l.model.aor,"onUpdate:modelValue":t[3]||(t[3]=c=>l.model.aor=c),label:e.$t("Area of Responsibility"),id:"aor",name:"aor",variant:"underlined","hide-details":""},null,8,["modelValue","label"])),l.isUNHCR?(f(),b($,{key:1,modelValue:l.model.aor,"onUpdate:modelValue":t[4]||(t[4]=c=>l.model.aor=c),label:e.$t("Area of Responsibility"),id:"aor",name:"aor",variant:"underlined","hide-details":""},null,8,["modelValue","label"])):S("",!0)]),_:1}),s(r,{cols:"12"},{default:i(()=>[s(N,{modelValue:l.model.tags,"onUpdate:modelValue":t[5]||(t[5]=c=>l.model.tags=c),label:e.$t("Tags"),entity:"requests"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3})]),_:3})}const Oe=v(be,[["render",_e]]),Se=[{key:"Emergency Shelter Kit",title:"Emergency Shelter Kit"}],U=[{key:"Tarpaulin",title:"Tarpaulin",unit:"sheets"},{key:"Transparent plastic sheeting, 3x10m",title:"Transparent plastic sheeting, 3x10m",unit:"sheets"},{key:"OSB",title:"OSB",unit:"EA"}],ge=[{key:"Timber Batten, 25x100x2000mm",title:"Timber Batten, 25x100x2000mm",unit:"pcs"},{key:"Nails 60",title:"Nails 60",unit:"kg"},{key:"Screws 4.8x100",title:"Screws 4.8x100",unit:"boxes"},{key:"Mounting foam, 850ml",title:"Mounting foam, 850ml",unit:"pcs"},{key:"Tape, adhesive 100m x 45mm",title:"Tape, adhesive 100m x 45mm",unit:"pcs"},{key:"Lath 25x20x2000mm",title:"Lath 25x20x2000mm",unit:"kg"},{key:"Nails 20",title:"Nails 20",unit:"kg"}],q={Tarpaulin:3,"Transparent plastic sheeting, 3x10m":1,OSB:1,"Timber Batten, 25x100x2000mm":20,"Nails 60":.1,"Screws 4.8x100":2,"Mounting foam, 850ml":1,"Tape, adhesive 100m x 45mm":1,"Lath 25x20x2000mm":20,"Nails 20":.05},ve={name:"EskItemList",props:{modelValue:{type:Object}},mounted(){var t,o;if(!((o=(t=this.modelValue)==null?void 0:t.items)!=null&&o.length))return!1;const e=Object.fromEntries(this.modelValue.items.map(n=>[n.key,n.value]));this.esk={"Emergency Shelter Kit":e["Emergency Shelter Kit"]},this.oldEsk=e["Emergency Shelter Kit"],delete e["Emergency Shelter Kit"],this.itemset=e},data(){return{oldEsk:void 0,esk:{},itemset:{}}},methods:{calculateEsk(e){const t=parseInt(e.target.value),o=this.oldEsk||0,n=JSON.parse(JSON.stringify(this.itemset));for(let a of this.itemsList)n[a.key]=Math.round(t*q[a.key]*100)/100;for(let a of U){const l=Math.round((o||0)*q[a.key]*100)/100,d=Math.round((t||0)*q[a.key]*100)/100;let m=(n[a.key]||0)-l+d;n[a.key]=m<0?d:m}this.oldEsk=t,this.itemset=n,this.setModel()},setModel(){const e=Object.entries({...this.esk,...this.itemset}).map(([t,o])=>({key:t,value:parseFloat(o)})).filter(t=>t.value);this.model.items=e}},computed:{model:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},kit(){return JSON.parse(JSON.stringify(Se)).map(t=>(t.title=this.$t(t.key),t))},enabledItemsList(){let e=JSON.parse(JSON.stringify(U));return e=e.map(t=>(t.title=this.$t(t.key),t)),e.sort((t,o)=>t.title.localeCompare(o.title))},itemsList(){let e=JSON.parse(JSON.stringify(ge));return e=e.map(t=>(t.title=this.$t(t.key),t)),e.sort((t,o)=>t.title.localeCompare(o.title))}}},ye={class:"text-h5 mb-2 offset-md1 black--text"};function Ve(e,t,o,n,a,l){const d=M;return f(),b(V,{rounded:"0"},{default:i(()=>[s(y,null,{default:i(()=>[s(O,{class:"mb-4 mt-4"},{default:i(()=>[s(r,{cols:"12",md:"3",class:"pl-md-16"},{default:i(()=>[_("div",ye,[g(e.$slots,"itemset-header",{},()=>[h(p(e.$t("List of items")),1)])]),_("div",null,[g(e.$slots,"itemset-description",{},()=>[h(p(e.$t("Please select all items that you are going to distribute")),1)])])]),_:3}),s(r,{cols:"12",md:"4",lg:"3",class:"pr-md-16 pt-0 pb-0"},{default:i(()=>[s(d,{modelValue:a.esk,"onUpdate:modelValue":t[0]||(t[0]=m=>a.esk=m),onInput:l.calculateEsk,items:l.kit},null,8,["modelValue","onInput","items"])]),_:1}),s(r,{cols:"12","sm-offset":"0",md:"4","offset-md":"3",lg:"3","offset-lg":"0",class:"pr-md-16 pt-0"},{default:i(()=>[s(d,{modelValue:a.itemset,"onUpdate:modelValue":t[1]||(t[1]=m=>a.itemset=m),onInput:l.setModel,items:l.itemsList,disabled:!0},null,8,["modelValue","onInput","items"])]),_:1}),s(r,{cols:"12",md:"4",lg:"3",class:"pr-md-16 pt-0 pb-0"},{default:i(()=>[s(d,{modelValue:a.itemset,"onUpdate:modelValue":t[2]||(t[2]=m=>a.itemset=m),onInput:l.setModel,items:l.enabledItemsList},null,8,["modelValue","onInput","items"])]),_:1})]),_:3})]),_:3})]),_:3})}const ke=v(ve,[["render",Ve]]),T={"SN101-0":{clusterObjective:"CO1",sectoralObjective:"SO1"},SN1010:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN101:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN102:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN103:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN104:{clusterObjective:"CO1",sectoralObjective:"SO1"},SN105:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN106:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN107:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN108:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN109:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN110:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN111:{clusterObjective:"CO2",sectoralObjective:"SO1"},SN201:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN202:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN203:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN204:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN205:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN206:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN207:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN208:{clusterObjective:"CO3",sectoralObjective:"SO2"},SN209:{clusterObjective:"CO3",sectoralObjective:"SO2"}},$e=()=>({distributionModality:"In-kind",populationType:"IDPs",status:"Requested",organization:void 0,responsibleOrganization:void 0,fundedBy:void 0,date:void 0,items:[],assignees:[],address:{country:{name:"Ukraine",code2:"UA",code3:"UKR",code:"804"}}}),E={name:"request",inject:["$confirm","$error","$loading","$showResult"],components:{SN1010:ke,SN101:Q,SN102:G,SN104:Y,SN105:F,SN107:W,SN108:H,SN109:K,SN110:J,SN209:z},data:()=>({request:$e()}),created(){this.init()},computed:{title(){var e;return(e=this.$route.params)!=null&&e._id&&this.$route.params._id!=="new"?(this.appStore.breadcrumb=this.request.publicId,this.request.publicId):(this.appStore.breadcrumb=this.$t("New request"),this.$t("New request"))},publicId(){return D(this.request)}},methods:{async init(){var t,o,n,a;let{_id:e}=this.$route.params;if(e&&e!=="new")return this.loadData(e);this.request.organization=(t=this.appStore.user)==null?void 0:t.organization,this.request.createdBy=(o=this.appStore.user)==null?void 0:o.id,this.request.createdByEmail=(n=this.appStore.user)==null?void 0:n.email,(a=this.appStore.user)!=null&&a.defaults&&Object.assign(this.request,this.appStore.user.defaults),this.appStore.loading=!1},async loadData(e){const{requests:t}=this.$storage;try{const o=await t[e];if(!o)throw"Not found";this.request=o}catch{return await this.$error({title:"Request is not found"}),this.$router.push("/requests")}this.appStore.loading=!1},getTemplate(e){return templates[e]}},watch:{publicId(e){var o;if(this.request.publicId=this.publicId,!((o=this.request)!=null&&o.bundleName))return!1;const t=this.request.bundleName.replace(/-2024/,"");T[t]&&(this.request.objectives=T[t])},"request.address.pCode4"(){this.collectiveCenter={}}}},Ne={class:"report pa-2"},je={class:"text-h4 font-weight-bold"};function qe(e,t,o,n,a,l){const d=Oe,m=te,k=X,$=Z,N=fe,c=x,B=me;return f(),A("div",Ne,[s(O,{class:"mb-0 mt-0"},{default:i(()=>[s(r,{cols:"12",md:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[_("div",je,p(l.title||e.$t("New donation")),1)]),_:1})]),_:1}),s(O,{class:"mb-0 mt-0"},{default:i(()=>[s(r,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:i(()=>[s(d,{modelValue:e.request,"onUpdate:modelValue":t[0]||(t[0]=u=>e.request=u)},null,8,["modelValue"]),s(m,{modelValue:e.request,"onUpdate:modelValue":t[1]||(t[1]=u=>e.request=u)},null,8,["modelValue"]),s(k,{modelValue:e.request,"onUpdate:modelValue":t[2]||(t[2]=u=>e.request=u)},null,8,["modelValue"]),s($,{modelValue:e.request,"onUpdate:modelValue":t[3]||(t[3]=u=>e.request=u)},null,8,["modelValue"]),e.request.bundleName?(f(),b(L(e.request.bundleName.replace("-2024","").replace("-0","0")),{key:0,modelValue:e.request,"onUpdate:modelValue":t[4]||(t[4]=u=>e.request=u)},null,8,["modelValue"])):S("",!0),s(N,{modelValue:e.request,"onUpdate:modelValue":t[5]||(t[5]=u=>e.request=u)},null,8,["modelValue"]),e.$route.params._id!=="new"?(f(),b(c,{key:1,modelValue:e.request,"onUpdate:modelValue":t[6]||(t[6]=u=>e.request=u)},null,8,["modelValue"])):S("",!0),s(B,{modelValue:e.request,"onUpdate:modelValue":t[7]||(t[7]=u=>e.request=u)},null,8,["modelValue"])]),_:1})]),_:1})])}typeof I=="function"&&I(E);const Vt=v(E,[["render",qe]]);export{Vt as default};

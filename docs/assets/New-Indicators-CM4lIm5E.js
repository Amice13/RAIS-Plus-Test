import{_ as L}from"./CustomTableHeaderStatic-BjFfQxyZ.js";import{d as O}from"./debouncer-Whu4ZLob.js";import{_ as w,d as S}from"./index-Dr3A69Vy.js";import{d as I}from"./xlsx-template-browser-scOJpVFS.js";import{a9 as h,a3 as d,a2 as v,a7 as f,a4 as s,u as r,ae as B,a6 as b,W as u,Y as _,G as T,F,aa as V,Q as z,S as E,ac as A,af as P,ag as R}from"./@vue-CVhpfiSJ.js";import{r as M,z as c,M as U,a6 as J,E as H,f as D,N as x,O as G,P as W,I as X,l as j,m as Y,A as $}from"./vuetify-8yKwgmF2.js";import{_ as K}from"./ReportsLinks-CiinT4Th.js";import{_ as Q}from"./CustomDate-CfhxorUI.js";import{_ as q}from"./CustomBundle-Cn7PVTFG.js";import{p as Z}from"./index-1qao1M8l.js";import{b as C}from"./route-block-B_A1xBdJ.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@turf-BykKS3Vs.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./uuid-C6aID195.js";import"./dot-object-sCKibp8s.js";import"./jszip-B9I6jZYU.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";import"./arabic-transliterate-CaB0grAR.js";var ee={FRONT_HOST:"https://raisplus-test.unhcr.in.ua"};const te={name:"ReportsIndicators",mounted(){},props:{data:{type:Array,default:()=>[]},loading:{type:Boolean}},computed:{filteredData(){const e=this.search&&new RegExp(this.search.replace(/[.?*{}\[\]()<>]/g,""),"gi");return this.data.filter(a=>{for(let[i,p]of Object.entries(this.datatable.filters))if(!p.includes(S(i,a)))return!1;return JSON.stringify(a).match(e)})},headers(){return[{title:"Organisation name",align:"left",value:"responsibleOrganization.name",sortable:!1,filterable:!0,type:"term"},{title:"Location Oblast",align:"left",value:"address.fullAdmin1",sortable:!0,filterable:!0,type:"term"},{title:"Location Raion",align:"left",value:"address.fullAdmin2",sortable:!0,filterable:!0,type:"term"},{title:"Location Hromada",align:"left",value:"address.fullAdmin3",sortable:!0,filterable:!0,type:"term"},{title:"Location Settlement",align:"left",value:"address.fullAdmin4",sortable:!0,filterable:!0,type:"term"},{title:"Location Site",align:"left",value:"collectiveCenter.name",sortable:!1,filterable:!0,type:"term"},{title:"Reporting Month",align:"left",value:"date",sortable:!1,filterable:!0,type:"term"},{title:"Indicators Output",align:"left",value:"output",sortable:!1,filterable:!0,type:"term"},{title:"Indicators Indicator",align:"left",value:"indicator",sortable:!1,filterable:!0,type:"term"},{title:"PoC Category",align:"left",value:"populationType",sortable:!1,filterable:!0,type:"term"},{title:"Modality",align:"left",value:"distributionModality",sortable:!1,filterable:!0,type:"term"},{title:"Households",align:"center",value:"households",sortable:!1},{title:"Total Individuals",align:"center",value:"familySize",sortable:!1},{title:"Girls (<18)",align:"center",value:"girls",sortable:!1},{title:"Boys (<18)",align:"center",value:"boys",sortable:!1},{title:"Women (18-59)",align:"center",value:"women",sortable:!1},{title:"Men (18-59)",align:"center",value:"men",sortable:!1},{title:"Elderly women (60+)",align:"center",value:"seniorWomen",sortable:!1},{title:"Elderly men (60+)",align:"center",value:"seniorMen",sortable:!1},{title:"People with disabilities",align:"center",value:"disabled",sortable:!1}]}},data:()=>({search:void 0,searchInput:void 0,datatable:{search:"",searchKeys:[],start:void 0,end:void 0,filters:{},sortBy:[{date:"asc"}]}}),methods:{setSearch:O(function(e){this.search=e}),setFilter(e){this.datatable.filters=e},getFileName(){var p,y,n,o;const e=((y=(p=this.appStore)==null?void 0:p.user)==null?void 0:y.name)||"User",a=((o=(n=this.appStore)==null?void 0:n.user)==null?void 0:o.email)||"no@email";return`${new Date().toLocaleDateString("sv")} - Distribution indicators ${e} (${a}).xlsx`},exportData(){const e=JSON.parse(JSON.stringify(this.filteredData)).map(o=>{var l;const t=new Date(o.date);return o.date=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0"),(l=o.collectiveCenter)!=null&&l.name||(o.collectiveCenter={name:"N/A"}),o}),a=`${ee.FRONT_HOST}/export/export.xlsx`,i=this.getFileName(),p=this.headers.map(o=>o.title),n=this.headers.map(o=>o.value).filter(o=>o!=="_id").map(o=>e.map(t=>S(o,t)));I(a,{headers:p,columns:n},i)}}},ae={class:"report-summary"},se={class:"text-no-wrap"},re={key:0},le={key:0},ie={key:0},oe={key:0};function ne(e,a,i,p,y,n){const o=L;return d(),h("div",ae,[i.loading?(d(),v(c,{key:0,class:"text-center"},{default:s(()=>[r(M,{size:"48",indeterminate:"",color:"primary"})]),_:1})):f("",!0),i.loading?f("",!0):(d(),v(c,{key:1},{default:s(()=>[r(U,{"sort-by":e.datatable.sortBy,"onUpdate:sortBy":a[3]||(a[3]=t=>e.datatable.sortBy=t),"items-per-page":0,height:e.$vuetify.display.height-390<320?320:e.$vuetify.display.height-390,headers:n.headers,items:n.filteredData,loading:i.loading,"loading-text":e.$t("Loading... Please wait"),"items-per-page-text":e.$t("Records per page"),"item-value":"_id","hide-default-footer":""},B({top:s(()=>[z(r(x,{flat:"",color:"white"},{default:s(()=>[r(G,{style:{"min-width":"150px"}},{default:s(()=>[_(u(e.$t("Summary")),1)]),_:1}),r(W,{class:"mx-4",inset:"",vertical:""}),r(X,{modelValue:e.search,"onUpdate:modelValue":[a[0]||(a[0]=t=>e.search=t),n.setSearch],class:"mr-4 w-100",variant:"outlined",density:"compact",label:e.$t("Search"),"hide-details":"","prepend-icon":"mdi-magnify"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:1},512),[[E,!e.$vuetify.display.xs]])]),headers:s(({columns:t,toggleSort:l})=>[b("tr",null,[(d(!0),h(F,null,V(t,g=>(d(),v(o,{key:g.key,onSetSort:a[1]||(a[1]=m=>e.datatable.sortBy=[m]),onSetFilter:a[2]||(a[2]=m=>n.setFilter(m)),column:g,"parent-items":n.filteredData,datatable:e.datatable},null,8,["column","parent-items","datatable"]))),128))])]),"item._id":s(({item:t})=>[r(J,null,{default:s(()=>[r(H,{text:e.$t("Export to Excel")},{activator:s(({props:l})=>[t.isDonnation?f("",!0):(d(),v(D,T({key:0},l,{onClick:g=>e.createXLSX(t),size:"small",rounded:"2",variant:"text",color:"green-darken-2",icon:"mdi-file-excel-box"}),null,16,["onClick"]))]),_:2},1032,["text"])]),_:2},1024)]),"item.publicId":s(({item:t})=>[b("strong",se,u(t.publicId),1)]),"item.address.pCode1":s(({item:t})=>{var l;return[(l=t.address)!=null&&l.pCode4?(d(),h("span",re,u(e.$t(t.address.pCode4.substring(0,4))),1)):f("",!0)]}),"item.address.pCode2":s(({item:t})=>{var l;return[(l=t.address)!=null&&l.pCode4?(d(),h("span",le,u(e.$t(t.address.pCode4.substring(0,6))),1)):f("",!0)]}),"item.address.pCode3":s(({item:t})=>{var l;return[(l=t.address)!=null&&l.pCode4?(d(),h("span",ie,u(e.$t(t.address.pCode4.substring(0,9))),1)):f("",!0)]}),"item.address.pCode4":s(({item:t})=>{var l;return[(l=t.address)!=null&&l.pCode4?(d(),h("span",oe,u(e.$t(t.address.pCode4)),1)):f("",!0)]}),"item.date":s(({item:t})=>[_(u(new Date(t.date).toLocaleDateString("sv").substring(0,7)),1)]),"no-data":s(()=>[b("div",null,u(e.$t("No data found")),1)]),_:2},[V(e.$slots,(t,l)=>({name:l,fn:s(g=>[A(e.$slots,l,P(R(g||{})))])}))]),1032,["sort-by","height","headers","items","loading","loading-text","items-per-page-text"])]),_:3})),i.loading?f("",!0):(d(),v(c,{key:2,class:"text-right"},{default:s(()=>[r(D,{onClick:n.exportData,color:"primary"},{default:s(()=>[_(u(e.$t("Export")),1)]),_:1},8,["onClick"])]),_:1}))])}const de=w(te,[["render",ne]]),{indicators:ue}=Z,{customDefinitions:k,customPreprocess:me}=ue,N={name:"custom-indicators",beforeMount(){var a,i;const e=localStorage.getItem("unhcr-rais-plus-recent-indicators");e||(this.filters={date:{$gte:new Date().toLocaleDateString("sv-SE").replace(/-\d+$/,"-01"),$lte:new Date().toLocaleDateString("sv-SE")}}),this.organizations=[(i=(a=this.appStore)==null?void 0:a.user)==null?void 0:i.organization].filter(Boolean),e&&Object.assign(this.filters,JSON.parse(e)),this.getFiltersData(),this.appStore.loading=!1},computed:{isAdmin(){var e,a,i;return(i=(a=(e=this.appStore)==null?void 0:e.user)==null?void 0:a.role)==null?void 0:i.includes("Admin")}},data:()=>({organizations:[],filters:{bundleName:"SN101-2024",date:{$lte:void 0,$gte:void 0}},indicators:[],indicatorsLoading:!0}),methods:{async getFiltersData(){const{organizations:e}=this.$storage,a=await e.slice(0,500).filter({functionalType:["UN Agency","Operational partner","Implementing partner"]}).include(["id","name","translation.uk.name"]).sort([{name:"asc"}]).find();this.organizations=a.items},async getIndicators(){this.indicatorsLoading=!0;let e;if(this.$network.online)e=await this.$api.custom.getIndicators({type:"cluster",filter:this.filters});else{if(!this.filters.bundleName||!k[this.filters.bundleName])return this.indicators=[],this.indicatorsLoading=!1;try{e=await Promise.all(k[this.filters.bundleName].map(i=>i(this.$storage,this.filters)))}catch(i){console.log(i)}}const a=e.flat().map(me);this.indicators=a,this.indicatorsLoading=!1}},watch:{filters:{deep:!0,handler(e){localStorage.setItem("unhcr-rais-plus-recent-indicators",JSON.stringify(e)),this.getIndicators()}}}},pe={class:"indicators pa-2"},fe={class:"text-h5 mb-2 offset-md1 black--text"},ce={class:"mb-4"},ge={class:"text-h5 mb-2 offset-md1 black--text"};function he(e,a,i,p,y,n){const o=q,t=Q,l=K,g=de;return d(),h("div",pe,[r($,{class:"mb-0 mt-0"},{default:s(()=>[r(c,{cols:"12",md:"12",class:"mb-0 mt-0 pb-0 pt-0"},{default:s(()=>[r(j,null,{default:s(()=>[r(Y,null,{default:s(()=>[r($,null,{default:s(()=>[r(c,{cols:"12",md:"3",class:"pl-md-4"},{default:s(()=>[b("div",fe,u(e.$t("Filters")),1),b("div",ce,u(e.$t("Define the filters for your report")),1),b("div",null,[r(o,{modelValue:e.filters.bundleName,"onUpdate:modelValue":a[0]||(a[0]=m=>e.filters.bundleName=m)},null,8,["modelValue"]),r(t,{modelValue:e.filters.date.$gte,"onUpdate:modelValue":a[1]||(a[1]=m=>e.filters.date.$gte=m),label:e.$t("Start of report period"),class:"mt-4"},null,8,["modelValue","label"]),r(t,{modelValue:e.filters.date.$lte,"onUpdate:modelValue":a[2]||(a[2]=m=>e.filters.date.$lte=m),label:e.$t("End of report period")},null,8,["modelValue","label"])])]),_:1}),r(c,{cols:"12",md:"9",class:"pr-md-4"},{default:s(()=>[r($,null,{default:s(()=>[r(l),r(c,{cols:"12"},{default:s(()=>[b("div",ge,u(e.$t("Custom indicators")),1)]),_:1}),r(c,null,{default:s(()=>[r(g,{data:e.indicators,filters:e.filters,startDate:e.filters.date.$gte,endDate:e.filters.date.$lte,loading:e.indicatorsLoading},null,8,["data","filters","startDate","endDate","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}typeof C=="function"&&C(N);const lt=w(N,[["render",he]]);export{lt as default};

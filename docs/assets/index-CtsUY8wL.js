import{_ as A,a as at,f as H}from"./index-Dr3A69Vy.js";import{a1 as st,a2 as y,a3 as u,a4 as s,u as i,a6 as h,a9 as k,a7 as c,Y as m,W as o,Q as v,S as V,F as D,aa as w,ad as W}from"./@vue-CVhpfiSJ.js";import{m as T,C as x,n as F,p as z,o as Q,f as C,l as U,h as it,t as X,A as I,z as _,I as B,r as j,i as Z,j as G,k as tt,N as rt,O as nt,T as dt,U as ot,W as ut,X as mt,Y as ft,q as ht,Z as ct}from"./vuetify-8yKwgmF2.js";import{_ as et}from"./CustomDate-CfhxorUI.js";import{d as q}from"./debouncer-Whu4ZLob.js";import{d as bt}from"./searchProcessor-BfIe0Ps2.js";import{b as Y}from"./route-block-B_A1xBdJ.js";/* empty css             */import"./pinia-DJQ_g8GY.js";import"./pinia-plugin-persistedstate-Bx52SgID.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./pinia-shared-state-C4xqZbDc.js";import"./broadcast-channel-TeH36tNo.js";import"./oblivious-set-DL5W-sud.js";import"./dexie-DU0pVwlp.js";import"./@turf-BykKS3Vs.js";import"./@azure-suSn7m2_.js";import"./bson-objectid-DhxNlv_d.js";import"./joi-BOBjTjze.js";import"./comlink-B8fJUUNV.js";import"./vue-i18n-rpOKKwMw.js";import"./@intlify-DAAxr81y.js";import"./axios-xsH4HHeE.js";import"./md5-Ct8Y5Pza.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./uuid-C6aID195.js";import"./dot-object-sCKibp8s.js";import"./jszip-B9I6jZYU.js";import"./echarts-B3RPNoSA.js";import"./zrender-BxIUiisS.js";import"./@faker-js-9AjqWMS-.js";import"./jwt-decode-VWaDGczM.js";import"./vue-router-V8rnRB0-.js";import"./maska-DMix1GTA.js";const yt={name:"DistributionCard",props:{mode:{type:String,default:"edit"},modelValue:{type:Object,default:()=>({})}},computed:{model:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},translated(){return this.$_translate(this.modelValue)}},methods:{formatAddress:at}},pt={class:"text-h6 mt-2 title-link",style:{"font-size":"120% !important"}},gt={class:"text-caption mb-2",style:{"font-size":"80% !important"}},kt={class:"text-caption"},vt={class:"cursor-pointer flip-url"},Vt={class:"mb-4"},St={key:0},Ft={key:1};function _t(t,e,a,f,r,l){const p=st("router-link");return u(),y(U,{class:"pa-0 flip-card-front h-100 d-flex flex-column border-left-primary distribution-card"},{default:s(()=>[i(T,{class:"pb-0"},{default:s(()=>{var n;return[h("div",null,[i(x,{size:"x-small",label:"",color:"primary",variant:"flat",class:"mr-1"},{default:s(()=>[m(o(t.$t("Distribution")),1)]),_:1}),i(x,{size:"x-small",label:"",color:l.model.status==="Requested"?"orange-darken-2":"green",variant:"tonal"},{default:s(()=>[m(o(t.$t(l.model.status)),1)]),_:1},8,["color"])]),h("div",pt,[i(p,{to:`/distributions/${l.model.id}`,tag:"a"},{default:s(()=>[m(o(t.$t(l.model.bundleName)),1)]),_:1},8,["to"])]),h("div",gt,o(l.model.publicId),1),h("div",kt,[h("span",vt,[i(F,{size:"small"},{default:s(()=>e[1]||(e[1]=[m("mdi-calendar")])),_:1}),m(" "+o(new Date(l.model.date).toLocaleDateString("uk")),1)]),m(" · "+o(t.$t(l.model.aor)),1)]),e[3]||(e[3]=h("hr",{class:"mb-4"},null,-1)),h("div",Vt,[h("strong",null,o(t.$t("Items"))+":",1),e[2]||(e[2]=h("br",null,null,-1)),m(" "+o(l.model.items.map(d=>t.$t(d.key)).join(", ")),1)]),(n=l.model.address)!=null&&n.street?(u(),k("div",St,[h("strong",null,o(t.$t("Address"))+":",1),m(" "+o(l.formatAddress(l.model.address)),1)])):c("",!0),l.model.address.pCode4?(u(),k("div",Ft,[h("div",null,[h("strong",null,o(t.$t("Municipality"))+":",1),m(" "+o(t.$t(l.model.address.pCode4)),1)]),h("div",null,[h("strong",null,o(t.$t("Hromada"))+":",1),m(" "+o(t.$t(l.model.address.pCode4.substring(0,9))),1)]),h("div",null,[h("strong",null,o(t.$t("Raion"))+":",1),m(" "+o(t.$t(l.model.address.pCode4.substring(0,6))),1)]),h("div",null,[h("strong",null,o(t.$t("Oblast"))+":",1),m(" "+o(t.$t(l.model.address.pCode4.substring(0,4))),1)])])):c("",!0)]}),_:1}),i(z),i(Q,null,{default:s(()=>[i(z),v(i(C,{onClick:e[0]||(e[0]=n=>t.$router.push(`/distributions/${l.model.id}`)),color:"primary","prepend-icon":"mdi-play",variant:"tonal",class:"pl-3 pr-3"},{default:s(()=>[m(o(t.$t("Start")),1)]),_:1},512),[[V,a.mode==="view"]])]),_:1})]),_:1})}const Ct=A(yt,[["render",_t]]),E=t=>{const[e,a]=t.split(/\./g);return a==="0"||e.length===3?e:t},It=t=>t/10**9>1?E((t/10**9).toFixed(1))+"B":t/10**6>1?E((t/10**6).toFixed(1))+"M":t/10**3>1?E((t/10**3).toFixed(1))+"K":t,Dt={name:"CustomFilterButton",props:{table:{type:String},field:{type:Object,default:{}},datatable:{type:Object,default:{}}},data(){return{loading:!1,search:void 0,items:[],menu:!1}},computed:{singleName(){var e,a;return this.field.type==="term"?this.$t((a=(e=this.datatable)==null?void 0:e.filters)==null?void 0:a[this.title][0]):this.items.find(f=>{var r;return f.key===((r=this.datatable)==null?void 0:r.filters[this.key][0])})[this.title]||this.$t("Multiple")},title(){let t=this.field.value;return this.field.translated&&this.$i18n.locale!=="en"&&(t=this.field.translated),t},key(){return this.field.filterId||this.field.value},startDate:{get(){return this.datatable.start},set(t){this.$emit("setStart",t)}},endDate:{get(){return this.datatable.end},set(t){this.$emit("setEnd",t)}},showItems(){if(!this.search)return this.items;const t=new RegExp(this.search.replace(/[|\\{}()[\]^$+*?.]/g,".").replace(/-/g,"\\-"),"gi");return this.items.filter(e=>{var f;let a=e.title.replace("@","＠");return this.$i18n.locale!=="en"&&((f=this.field)!=null&&f.translated)?a.match(t):this.$t(a).match(t)})},filterIsSet(){var t,e,a,f,r;return(e=(t=this.datatable)==null?void 0:t.filters)!=null&&e[this.key]?((r=(f=(a=this.datatable)==null?void 0:a.filters)==null?void 0:f[this.key])==null?void 0:r.length)>0:!1},filterIsSorted(){var t,e;return(t=this.datatable.sortBy)!=null&&t[0]?((e=this.datatable.sortBy)==null?void 0:e[0].key)===this.key:!1},numberOfFilters(){var t,e,a;return((a=(e=(t=this.datatable)==null?void 0:t.filters)==null?void 0:e[this.key])==null?void 0:a.length)||0}},methods:{setSearch:q(function(){if(!this.menu)return!1;this.loadItems()}),async loadItems(){var l,p,n;if(!((l=this.field)!=null&&l.filterable)||this.field.type==="date")return!1;this.loading=!0;let t=this.$storage[this.table];if(this.index&&(t=t.useIndex(this.index)),this.datatable.filters){const d={...this.datatable.filters};delete d[this.key],t=t.filter(d)}if(this.search&&(t=t.should({[this.title]:{$regex:this.search}})),this.datatable.end||this.datatable.start){const d=Object.fromEntries([["$lte",this.datatable.end],["$gte",this.datatable.start]].filter(([,b])=>b));t=t.filter({date:d})}t=t.sort([{value:"desc"},{[this.key]:"asc"}]);const e={groupBy:[this.key],aggs:{value:{variable:"id",operation:"count"}}};this.field.filterId&&e.groupBy.push(this.title);let a=await t.aggregate(e);a=a.map(d=>(d.key||(d.key=d[this.key],d.title=d[this.title]),d));const f=a.map(d=>d.key),r=((n=(p=this.datatable)==null?void 0:p.filters)==null?void 0:n[this.key])||[];for(let d of r)f.includes(d)||a.push({key:d,value:0});this.items=a,this.loading=!1},isSorted({value:t}){var a,f,r,l;return(a=this.datatable)!=null&&a.sortBy?(Array.isArray((f=this.datatable)==null?void 0:f.sortBy)?(r=this.datatable)==null?void 0:r.sortBy[0]:(l=this.datatable)==null?void 0:l.sortBy).key===t:!1},isFiltered({value:t}){var e;if(!((e=this.datatable)!=null&&e.filters))return!1;for(let[a,f]of Object.entries(this.datatable.filters))if(a===t&&f.length)return!0},getIcon(t){var e,a;return this.isSorted(t)?(Array.isArray(this.datatable.sortBy)?(e=this.datatable)==null?void 0:e.sortBy[0]:(a=this.datatable)==null?void 0:a.sortBy).order==="desc"?"mdi-sort-descending":"mdi-sort-ascending":this.isFiltered(t)?"mdi-filter":"mdi-chevron-down"},setSort(t){this.$emit("setSort",{key:this.title,order:t}),this.menu=!1},hasFilter(t){var e,a,f,r;return(a=(e=this.datatable)==null?void 0:e.filters)!=null&&a[this.key]?(r=(f=this.datatable)==null?void 0:f.filters)==null?void 0:r[this.key].includes(t):!1},switchFilter(t){const e={...this.datatable.filters};e[this.key]=e[this.key]||[];let a=e[this.key].indexOf(t);return a>=0?(e[this.key].splice(a,1),e[this.key].length||delete e[this.key],this.$emit("setFilter",e)):(e[this.key].push(t),this.$emit("setFilter",e))},resetAllFilters(){const t=JSON.parse(JSON.stringify(this.datatable.filters));return delete t[this.key],this.$emit("setFilter",t)},simplifyCount:It,formatDate:H},watch:{menu(t){t&&this.loadItems()}}},wt={key:0},Bt={key:0,class:"mr-1"},Ot={key:1,class:"mr-1"},xt={key:2},zt={key:3},Ut={key:4},At={key:1},Nt={key:2},Et={class:"mb-2"},Pt={class:"text-center"},Tt={style:{width:"36px"}};function jt(t,e,a,f,r,l){const p=et;return u(),y(C,{class:W(["filter-button mr-2 mb-2",{"is-sorted":l.filterIsSorted}]),size:"small",color:l.filterIsSet?"grey-lighten-2":"grey-darken-1","prepend-icon":a.field.icon,variant:l.filterIsSet?"flat":"tonal"},{default:s(()=>[m(o(t.$t(a.field.title))+" ",1),a.field.type==="date"&&(l.startDate||l.endDate)?(u(),k("span",wt,[e[8]||(e[8]=h("span",null,": ",-1)),l.startDate?c("",!0):(u(),k("span",Bt,o(t.$t("before")),1)),l.endDate?c("",!0):(u(),k("span",Ot,o(t.$t("after")),1)),l.startDate?(u(),k("span",xt,o(l.formatDate(l.startDate).toLocaleDateString("uk")),1)):c("",!0),l.startDate&&l.endDate?(u(),k("span",zt," - ")):c("",!0),l.endDate?(u(),k("span",Ut,o(l.formatDate(l.endDate).toLocaleDateString("uk")),1)):c("",!0)])):c("",!0),l.numberOfFilters===1?(u(),k("span",At,": "+o(l.singleName),1)):c("",!0),l.numberOfFilters>1?(u(),k("span",Nt,": "+o(t.$t("Multiple")),1)):c("",!0),i(it,{activator:"parent",transition:"slide-y-transition","close-on-content-click":!1,modelValue:r.menu,"onUpdate:modelValue":e[7]||(e[7]=n=>r.menu=n)},{default:s(()=>[i(U,{"max-width":"350",width:"350"},{default:s(()=>[i(T,{class:"pa-0"},{default:s(()=>[a.field.sortable?(u(),y(C,{key:0,onClick:e[0]||(e[0]=n=>l.setSort("asc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:s(()=>[i(F,{class:"mr-2"},{default:s(()=>e[9]||(e[9]=[m("mdi-sort-ascending")])),_:1}),m(" "+o(t.$t("Sort ascending")),1)]),_:1})):c("",!0),a.field.sortable?(u(),y(C,{key:1,onClick:e[1]||(e[1]=n=>l.setSort("desc")),block:"",rounded:"0",variant:"plain",class:"justify-start"},{default:s(()=>[i(F,{class:"mr-2"},{default:s(()=>e[10]||(e[10]=[m("mdi-sort-descending")])),_:1}),m(" "+o(t.$t("Sort descending")),1)]),_:1})):c("",!0),a.field.filterable?(u(),y(X,{key:2},{default:s(()=>[i(I,null,{default:s(()=>[i(_,{cols:"12"},{default:s(()=>[h("div",Et,[h("strong",null,o(t.$t("Filter").toUpperCase()),1)]),a.field.type==="date"?(u(),y(p,{key:0,modelValue:l.startDate,"onUpdate:modelValue":e[2]||(e[2]=n=>l.startDate=n),clearable:"",label:t.$t("Start date"),class:"mt-4"},null,8,["modelValue","label"])):c("",!0),a.field.type==="date"?(u(),y(p,{key:1,modelValue:l.endDate,"onUpdate:modelValue":e[3]||(e[3]=n=>l.endDate=n),clearable:"",label:t.$t("End date")},null,8,["modelValue","label"])):c("",!0),a.field.type==="term"?(u(),y(B,{key:2,modelValue:r.search,"onUpdate:modelValue":[e[4]||(e[4]=n=>r.search=n),l.setSearch],label:t.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])):c("",!0),a.field.type==="string"?(u(),y(B,{key:3,modelValue:r.search,"onUpdate:modelValue":e[5]||(e[5]=n=>r.search=n),label:t.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","label"])):c("",!0)]),_:1}),a.field.type!=="date"?(u(),y(_,{key:0,cols:"12",class:"pa-0"},{default:s(()=>[v(h("div",Pt,[i(j,{indeterminate:"",color:"primary"})],512),[[V,r.loading]]),v(i(Z,{class:"custom-thumb",nav:"",density:"compact",lines:!1,"max-height":"200"},{default:s(()=>[(u(!0),k(D,null,w(l.showItems,n=>(u(),y(G,{onClick:d=>l.switchFilter(n.key),key:n.key,density:"compact"},{prepend:s(()=>[h("div",Tt,[v(i(F,null,{default:s(()=>e[11]||(e[11]=[m("mdi-checkbox-blank-outline")])),_:2},1536),[[V,!l.hasFilter(n.key)]]),v(i(F,null,{default:s(()=>e[12]||(e[12]=[m("mdi-checkbox-outline")])),_:2},1536),[[V,l.hasFilter(n.key)]])])]),append:s(()=>[i(x,{size:"x-small"},{default:s(()=>[m(o(l.simplifyCount(n.value)),1)]),_:2},1024)]),default:s(()=>[i(tt,{class:"pr-2"},{default:s(()=>{var d;return[m(o(a.field.type==="term"?t.$t((d=n==null?void 0:n.title)==null?void 0:d.replace("@","＠")):n==null?void 0:n.title),1)]}),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},512),[[V,!r.loading]])]),_:1})):c("",!0)]),_:1})]),_:1})):c("",!0)]),_:1}),a.field.filterable?(u(),y(Q,{key:0},{default:s(()=>[v(i(C,{onClick:l.resetAllFilters,size:"x-small"},{default:s(()=>[i(F,{class:"mr-2"},{default:s(()=>e[13]||(e[13]=[m("mdi-checkbox-blank-outline")])),_:1}),m(" "+o(t.$t("Reset all")),1)]),_:1},8,["onClick"]),[[V,l.filterIsSet]]),i(z),i(C,{onClick:e[6]||(e[6]=n=>r.menu=!1),size:"x-small"},{default:s(()=>[m(o(t.$t("Close")),1)]),_:1})]),_:1})):c("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class","color","prepend-icon","variant"])}const qt=A(Dt,[["render",jt]]),P=t=>{const[e,a]=t.split(/\./g);return a==="0"||e.length===3?e:t},Rt=t=>t/10**9>1?P((t/10**9).toFixed(1))+"B":t/10**6>1?P((t/10**6).toFixed(1))+"M":t/10**3>1?P((t/10**3).toFixed(1))+"K":t,$t={props:{fields:{type:Array,default:()=>[]},table:{type:String},datatable:{type:Object,default:{}}},data(){return{filter:void 0,dialog:!1,loading:!1,search:void 0,items:[],menu:!1}},computed:{currentFilter(){return this.fields[this.filter]},startDate:{get(){return this.datatable.start},set(t){this.$emit("setStart",t)}},endDate:{get(){return this.datatable.end},set(t){this.$emit("setEnd",t)}},showItems(){if(!this.search)return this.items;const t=new RegExp(this.search.replace(/[|\\{}()[\]^$+*?.]/g,".").replace(/-/g,"\\-"),"gi");return this.items.filter(e=>{var f;let a=e.title.replace("@","＠");return this.$i18n.locale!=="en"&&((f=this.currentFilter)!=null&&f.translated)?a.match(t):this.$t(a).match(t)})},filterIsSet(){var t,e,a,f;return(e=(t=this.datatable)==null?void 0:t.filters)!=null&&e[this.key]?(f=(a=this.datatable)==null?void 0:a.filters)==null?void 0:f[this.key].length:!1},filterIsSorted(){var t,e;return(t=this.datatable.sortBy)!=null&&t[0]?((e=this.datatable.sortBy)==null?void 0:e[0].key)===this.field.value:!1},numberOfFilters(){var t,e,a;return((a=(e=(t=this.datatable)==null?void 0:t.filters)==null?void 0:e[this.field.value])==null?void 0:a.length)||0}},methods:{setSearch:q(function(){this.loadItems()}),async loadItems(){var l,p,n;if(!this.currentFilter||!((l=this.currentFilter)!=null&&l.filterable)||this.currentFilter.type==="date")return!1;this.loading=!0;let t=this.$storage[this.table];if(this.index&&(t=t.useIndex(this.index)),this.datatable.filters){const d={...this.datatable.filters};delete d[this.key],t=t.filter(d)}if(this.search&&(t=t.should({[this.title]:{$regex:this.search}})),this.datatable.end||this.datatable.start){const d=Object.fromEntries([["$lte",this.datatable.end],["$gte",this.datatable.start]].filter(([,b])=>b));t=t.filter({date:d})}t=t.sort([{value:"desc"},{[this.key]:"asc"}]);const e={groupBy:[this.key],aggs:{value:{variable:"id",operation:"count"}}};this.currentFilter.filterId&&e.groupBy.push(this.title);let a=await t.aggregate(e);a=a.map(d=>(d.key||(d.key=d[this.key],d.title=d[this.title]),d));const f=a.map(d=>d.key),r=((n=(p=this.datatable)==null?void 0:p.filters)==null?void 0:n[this.key])||[];for(let d of r)f.includes(d)||a.push({key:d,value:0});this.items=a,this.loading=!1},setSort(t){this.$emit("setSort",{key:this.currentFilter.value,order:t}),this.menu=!1},isFiltered(t){},hasFilter(t){var e,a,f,r,l,p;return(f=(e=this.datatable)==null?void 0:e.filters)!=null&&f[(a=this.currentFilter)==null?void 0:a.value]?(p=(r=this.datatable)==null?void 0:r.filters)==null?void 0:p[(l=this.currentFilter)==null?void 0:l.value].includes(t):!1},switchFilter(t){var f,r,l,p,n,d,b;const e=JSON.parse(JSON.stringify(this.datatable.filters));e[(f=this.currentFilter)==null?void 0:f.value]||(e[(r=this.currentFilter)==null?void 0:r.value]=[]);let a=e[(l=this.currentFilter)==null?void 0:l.value].indexOf(t);return a>=0?(e[(p=this.currentFilter)==null?void 0:p.value].splice(a,1),e[(n=this.currentFilter)==null?void 0:n.value].length||delete e[(d=this.currentFilter)==null?void 0:d.value],this.$emit("setFilter",e)):(e[(b=this.currentFilter)==null?void 0:b.value].push(t),this.$emit("setFilter",e))},resetAllFilters(){var e;const t=JSON.parse(JSON.stringify(this.datatable.filters));return delete t[(e=this.currentFilter)==null?void 0:e.value],this.$emit("setFilter",t)},simplifyCount:Rt,formatDate:H},watch:{filter(){this.loadItems()}}},Lt={class:"mt-1"},Mt={class:"text-center"},Jt={style:{width:"36px"}},Kt={class:"mr-2 ml-2 mt-8"};function Yt(t,e,a,f,r,l){const p=et;return u(),k("div",null,[i(C,{onClick:e[0]||(e[0]=n=>r.dialog=!0),class:"custom-fab",location:"bottom right",position:"fixed",color:"primary",icon:"mdi-filter"}),i(ht,{modelValue:r.dialog,"onUpdate:modelValue":e[8]||(e[8]=n=>r.dialog=n),transition:"dialog-bottom-transition",fullscreen:""},{default:s(()=>[i(U,{class:"custom-filter-dialog h-100"},{default:s(()=>[i(rt,{color:"primary",density:"compact"},{default:s(()=>[i(F,{class:"ml-4"},{default:s(()=>e[9]||(e[9]=[m(" mdi-filter ")])),_:1}),i(nt,null,{default:s(()=>[m(o(t.$t("Filters")),1)]),_:1}),i(z),i(dt,null,{default:s(()=>[i(C,{icon:"mdi-close",onClick:e[1]||(e[1]=n=>r.dialog=!1)})]),_:1})]),_:1}),i(ot,{modelValue:r.filter,"onUpdate:modelValue":e[6]||(e[6]=n=>r.filter=n)},{default:s(()=>[(u(!0),k(D,null,w(a.fields,n=>(u(),y(ut,{key:n.value,elevation:"0"},{default:s(()=>{var d,b,S,O,R,$;return[i(mt,{class:W({"text-primary-lighten-1":((S=(b=(d=a.datatable)==null?void 0:d.filters)==null?void 0:b[n==null?void 0:n.value])==null?void 0:S.length)>0,"font-weight-bold":(($=(R=(O=a.datatable)==null?void 0:O.filters)==null?void 0:R[n==null?void 0:n.value])==null?void 0:$.length)>0})},{default:s(()=>[i(F,{class:"mr-4"},{default:s(()=>[m(o(n.icon),1)]),_:2},1024),h("div",Lt,o(t.$t(n.title)),1)]),_:2},1032,["class"]),i(ft,null,{default:s(()=>[i(U,{elevation:"0"},{default:s(()=>[i(T,{class:"pa-0"},{default:s(()=>[n.filterable?(u(),y(X,{key:0},{default:s(()=>{var L,M,J,K;return[i(I,null,{default:s(()=>[i(_,{cols:"12"},{default:s(()=>[n.type==="date"?(u(),y(p,{key:0,modelValue:l.startDate,"onUpdate:modelValue":e[2]||(e[2]=g=>l.startDate=g),clearable:"",label:t.$t("Start date"),class:"mt-4"},null,8,["modelValue","label"])):c("",!0),n.type==="date"?(u(),y(p,{key:1,modelValue:l.endDate,"onUpdate:modelValue":e[3]||(e[3]=g=>l.endDate=g),clearable:"",label:t.$t("End date")},null,8,["modelValue","label"])):c("",!0),n.type==="term"?(u(),y(B,{key:2,modelValue:r.search,"onUpdate:modelValue":e[4]||(e[4]=g=>r.search=g),label:t.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","label"])):c("",!0),n.type==="string"?(u(),y(B,{key:3,modelValue:r.search,"onUpdate:modelValue":[e[5]||(e[5]=g=>r.search=g),l.setSearch],label:t.$t("Search"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])):c("",!0)]),_:2},1024),n.type!=="date"?(u(),y(_,{key:0,cols:"12",class:"pa-0"},{default:s(()=>[v(h("div",Mt,[i(j,{indeterminate:"",color:"primary"})],512),[[V,r.loading]]),v(i(Z,{class:"custom-thumb",nav:"",lines:!1,"max-height":"200"},{default:s(()=>[(u(!0),k(D,null,w(l.showItems,g=>(u(),y(G,{onClick:N=>l.switchFilter(g.key),key:g.key,density:"compact"},{prepend:s(()=>[h("div",Jt,[v(i(F,null,{default:s(()=>e[10]||(e[10]=[m("mdi-checkbox-blank-outline")])),_:2},1536),[[V,!l.hasFilter(g.key)]]),v(i(F,null,{default:s(()=>e[11]||(e[11]=[m("mdi-checkbox-outline")])),_:2},1536),[[V,l.hasFilter(g.key)]])])]),append:s(()=>[i(x,{size:"small"},{default:s(()=>[m(o(l.simplifyCount(g.value)),1)]),_:2},1024)]),default:s(()=>[i(tt,{class:"pr-2 f-100"},{default:s(()=>{var N;return[m(o(l.currentFilter.type==="term"?t.$t((N=g==null?void 0:g.title)==null?void 0:N.replace("@","＠")):g==null?void 0:g.title),1)]}),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},512),[[V,!r.loading]])]),_:1})):c("",!0)]),_:2},1024),v(i(C,{onClick:l.resetAllFilters,size:"x-small"},{default:s(()=>[i(F,{class:"mr-2"},{default:s(()=>e[12]||(e[12]=[m("mdi-checkbox-blank-outline")])),_:1}),m(" "+o(t.$t("Reset all")),1)]),_:1},8,["onClick"]),[[V,l.filterIsSet]]),l.currentFilter&&((L=l.currentFilter)==null?void 0:L.type)!=="date"&&!r.loading&&((K=(J=(M=a.datatable)==null?void 0:M.filters)==null?void 0:J[n==null?void 0:n.value])!=null&&K.length)?(u(),y(C,{key:0,onClick:l.resetAllFilters,color:"primary-lighten-4",class:"mt-6",size:"small",elevation:"0"},{default:s(()=>[i(F,{class:"mr-2",size:"large"},{default:s(()=>e[13]||(e[13]=[m("mdi-checkbox-blank-outline")])),_:1}),m(" "+o(t.$t("Reset all")),1)]),_:1},8,["onClick"])):c("",!0)]}),_:2},1024)):c("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]}),_:2},1024))),128))]),_:1},8,["modelValue"]),e[14]||(e[14]=h("div",{class:"h-100"},null,-1)),h("div",Kt,[i(C,{onClick:e[7]||(e[7]=n=>r.dialog=!1),color:"primary",block:"",class:"mr-2 mb-2"},{default:s(()=>[m(o(t.$t("Apply")),1)]),_:1})])]),_:1})]),_:1},8,["modelValue"])])}const Ht=A($t,[["render",Yt]]),lt={name:"Distributions",computed:{debouncedSearch:{get(){return this.search},set(t){this.search=t,this.setSearch(t)}},numberOfPages(){return this.datatable.totalItems?Math.ceil(this.datatable.totalItems/this.datatable.itemsPerPage):0},isDistributor(){var e;let t=(e=this.appStore.user)==null?void 0:e.role;return t!=null&&t.length?t.length===1&&t[0]==="Distributor":!1},searchKeys(){const t=["publicId","address.admin1","address.admin2","address.admin3","address.admin4"];return this.$i18n.locale!=="en"&&t.push(`address.translation.${this.$i18n.locale}.admin1`,`address.translation.${this.$i18n.locale}.admin2`,`address.translation.${this.$i18n.locale}.admin3`,`address.translation.${this.$i18n.locale}.admin4`),t},fields(){return[{icon:"mdi-calendar",title:"Distribution date",value:"date",align:"start",sortable:!0,filterable:!0,type:"date"},{icon:"mdi-domain",title:"Organization",value:"organization.name",filterId:"organization.id",translated:["organization.translation",this.$i18n.locale,"name"].join("."),align:"start",filterable:!0,sortable:!0,type:"string"},{icon:"mdi-list-box",title:"Bundle name",value:"bundleName",align:"start",filterable:!0,sortable:!0,type:"term"},{icon:"mdi-map",title:"Oblast",value:"address.pCode1",align:"start",filterable:!0,type:"term"},{icon:"mdi-map-search",title:"Raion",value:"address.pCode2",align:"start",filterable:!0,type:"term"},{icon:"mdi-map-marker",title:"Hromada",value:"address.pCode3",align:"start",filterable:!0,type:"term"},{icon:"mdi-home-map-marker",title:"Locality",value:"address.pCode4",align:"start",filterable:!0,type:"term"},{icon:"mdi-list-status",title:"Status",value:"status",align:"start",filterable:!0,type:"term"}]}},data(){return{search:void 0,datatable:{search:void 0,filters:{distributionModality:["In-kind"],status:["In distribution","Requested"]},page:1,itemsPerPage:12,totalItems:0,sortBy:[{key:"date",order:"desc"}]},loading:!1,items:[]}},mounted(){this.loadItems()},methods:{setSearch:q(function(t){this.datatable.search=t}),async loadItems(){this.loading=!0;let t=this.$storage.requests;t=t.useIndex("publicId"),t=bt(t,this.datatable,this.searchKeys);const e=await t.find();e&&(this.items=e.items,this.datatable.totalItems=e.count),this.loading=!1,await this.$nextTick(),this.appStore.loading=!1},setFilter(t){this.datatable.filters=t,this.loadItems()}},watch:{datatable:{async handler(){await this.loadItems()},deep:!0}}},Wt={class:"distributions pa-2"},Qt={class:"text-h4 font-weight-bold"},Xt={class:"mb-4"},Zt={class:"mb-4"};function Gt(t,e,a,f,r,l){const p=Ht,n=qt,d=Ct;return u(),k("div",Wt,[i(p,{class:"hidden-md-and-up",onSetSort:e[0]||(e[0]=b=>r.datatable.sortBy=[b]),onSetFilter:e[1]||(e[1]=b=>l.setFilter(b)),onSetStart:e[2]||(e[2]=b=>r.datatable.start=b),onSetEnd:e[3]||(e[3]=b=>r.datatable.end=b),table:"requests",fields:l.fields,datatable:r.datatable},null,8,["fields","datatable"]),i(I,{class:"mb-0 mt-0"},{default:s(()=>[i(_,{cols:"12",class:"mb-0 mt-0 pb-4 pt-0 pl-md-8 pr-md-8"},{default:s(()=>[h("div",Qt,o(t.$t("Distribute items")),1)]),_:1})]),_:1}),i(I,null,{default:s(()=>[i(_,{cols:"12",class:"pl-md-8 pr-md-8 d-flex"},{default:s(()=>[i(B,{modelValue:l.debouncedSearch,"onUpdate:modelValue":e[4]||(e[4]=b=>l.debouncedSearch=b),placeholder:t.$t("Search by id"),"prepend-icon":t.$vuetify.display.mobile?void 0:"mdi-magnify",variant:"solo","hide-details":"",clearable:"",name:"search",id:"search"},null,8,["modelValue","placeholder","prepend-icon"])]),_:1})]),_:1}),i(I,{class:"hidden-sm-and-down"},{default:s(()=>[i(_,{cols:"12",class:"pl-md-8 pr-md-8 d-flex"},{default:s(()=>[i(F,{icon:"mdi-filter",class:"mr-4"}),h("div",null,[(u(!0),k(D,null,w(l.fields,b=>(u(),y(n,{onSetSort:e[5]||(e[5]=S=>r.datatable.sortBy=[S]),onSetFilter:e[6]||(e[6]=S=>l.setFilter(S)),onSetStart:e[7]||(e[7]=S=>r.datatable.start=S),onSetEnd:e[8]||(e[8]=S=>r.datatable.end=S),table:"requests",field:b,datatable:r.datatable},null,8,["field","datatable"]))),256))])]),_:1})]),_:1}),i(I,{class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:s(()=>[v(i(_,{cols:"12",class:"text-center"},{default:s(()=>[i(j,{indeterminate:"",color:"primary",size:"large"})]),_:1},512),[[V,r.loading]]),(u(!0),k(D,null,w(r.items,(b,S)=>v((u(),y(_,{cols:"12",lg:"4"},{default:s(()=>[i(d,{modelValue:r.items[S],"onUpdate:modelValue":O=>r.items[S]=O,mode:"view"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)),[[V,!r.loading]])),256)),v(i(_,{cols:"12",class:"text-center"},{default:s(()=>[h("div",Xt,o(t.$t("You haven't created any requests yet")),1),i(C,{color:"primary","prepend-icon":"mdi-plus",onClick:e[9]||(e[9]=b=>t.$router.push("./requests/new"))},{default:s(()=>[m(o(t.$t("Add")),1)]),_:1})]),_:1},512),[[V,!r.items.length&&!l.isDistributor]]),v(i(_,{cols:"12",class:"text-center"},{default:s(()=>[h("div",Zt,o(t.$t("You haven't been assigned to any distribution yet")),1)]),_:1},512),[[V,!r.items.length&&l.isDistributor]])]),_:1}),i(I,{class:"mb-0 mt-0 pb-0 pt-0 pl-md-8 pr-md-8"},{default:s(()=>[i(_,{cols:"12"},{default:s(()=>[v(i(ct,{modelValue:r.datatable.page,"onUpdate:modelValue":e[10]||(e[10]=b=>r.datatable.page=b),color:"primary",length:l.numberOfPages,"total-visible":t.$vuetify.display.mobile?3:8},null,8,["modelValue","length","total-visible"]),[[V,l.numberOfPages>1]])]),_:1})]),_:1})])}typeof Y=="function"&&Y(lt);const Pe=A(lt,[["render",Gt]]);export{Pe as default};
